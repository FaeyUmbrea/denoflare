

export const WEBTAIL_APP_HASH = '49d772369a7704f98353a3986aaeb6a8e3637a55';
export const WEBTAIL_APP_B64 = 'Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5Cgpjb25zdCBkaXJlY3RpdmVzID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgaXNEaXJlY3RpdmUgPSAobyk9PnsKICAgIHJldHVybiB0eXBlb2YgbyA9PT0gImZ1bmN0aW9uIiAmJiBkaXJlY3RpdmVzLmhhcyhvKTsKfTsKY29uc3QgaXNDRVBvbHlmaWxsID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgd2luZG93LmN1c3RvbUVsZW1lbnRzICE9IG51bGwgJiYgd2luZG93LmN1c3RvbUVsZW1lbnRzLnBvbHlmaWxsV3JhcEZsdXNoQ2FsbGJhY2sgIT09IHZvaWQgMDsKY29uc3QgcmVwYXJlbnROb2RlcyA9IChjb250YWluZXIsIHN0YXJ0LCBlbmQgPSBudWxsLCBiZWZvcmUgPSBudWxsKT0+ewogICAgd2hpbGUoc3RhcnQgIT09IGVuZCl7CiAgICAgICAgY29uc3QgbiA9IHN0YXJ0Lm5leHRTaWJsaW5nOwogICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoc3RhcnQsIGJlZm9yZSk7CiAgICAgICAgc3RhcnQgPSBuOwogICAgfQp9Owpjb25zdCByZW1vdmVOb2RlcyA9IChjb250YWluZXIsIHN0YXJ0LCBlbmQgPSBudWxsKT0+ewogICAgd2hpbGUoc3RhcnQgIT09IGVuZCl7CiAgICAgICAgY29uc3QgbiA9IHN0YXJ0Lm5leHRTaWJsaW5nOwogICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChzdGFydCk7CiAgICAgICAgc3RhcnQgPSBuOwogICAgfQp9Owpjb25zdCBub0NoYW5nZSA9IHt9Owpjb25zdCBub3RoaW5nID0ge307CmNvbnN0IG1hcmtlciA9IGB7e2xpdC0ke1N0cmluZyhNYXRoLnJhbmRvbSgpKS5zbGljZSgyKX19fWA7CmNvbnN0IG5vZGVNYXJrZXIgPSBgPCEtLSR7bWFya2VyfS0tPmA7CmNvbnN0IG1hcmtlclJlZ2V4ID0gbmV3IFJlZ0V4cChgJHttYXJrZXJ9fCR7bm9kZU1hcmtlcn1gKTsKY29uc3QgYm91bmRBdHRyaWJ1dGVTdWZmaXggPSAiJGxpdCQiOwpjbGFzcyBUZW1wbGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihyZXN1bHQsIGVsZW1lbnQpewogICAgICAgIHRoaXMucGFydHMgPSBbXTsKICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIGNvbnN0IG5vZGVzVG9SZW1vdmUgPSBbXTsKICAgICAgICBjb25zdCBzdGFjayA9IFtdOwogICAgICAgIGNvbnN0IHdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIoZWxlbWVudC5jb250ZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgbGFzdFBhcnRJbmRleCA9IDA7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgbGV0IHBhcnRJbmRleCA9IDA7CiAgICAgICAgY29uc3QgeyBzdHJpbmdzICwgdmFsdWVzOiB7IGxlbmd0aCAgfSAgfSA9IHJlc3VsdDsKICAgICAgICB3aGlsZShwYXJ0SW5kZXggPCBsZW5ndGgpewogICAgICAgICAgICBjb25zdCBub2RlID0gd2Fsa2VyLm5leHROb2RlKCk7CiAgICAgICAgICAgIGlmIChub2RlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB3YWxrZXIuY3VycmVudE5vZGUgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgbGVuZ3RoOiBsZW5ndGgyICB9ID0gYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW5ndGgyOyBpKyspewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kc1dpdGgoYXR0cmlidXRlc1tpXS5uYW1lLCBib3VuZEF0dHJpYnV0ZVN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoY291bnQtLSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdGb3JQYXJ0ID0gc3RyaW5nc1twYXJ0SW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbGFzdEF0dHJpYnV0ZU5hbWVSZWdleC5leGVjKHN0cmluZ0ZvclBhcnQpWzJdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVMb29rdXBOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpICsgYm91bmRBdHRyaWJ1dGVTdWZmaXg7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZVZhbHVlID0gbm9kZS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTG9va3VwTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZUxvb2t1cE5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0aWNzID0gYXR0cmlidXRlVmFsdWUuc3BsaXQobWFya2VyUmVnZXgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImF0dHJpYnV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdzOiBzdGF0aWNzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXggKz0gc3RhdGljcy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChub2RlLnRhZ05hbWUgPT09ICJURU1QTEFURSIpIHsKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKG5vZGUpOwogICAgICAgICAgICAgICAgICAgIHdhbGtlci5jdXJyZW50Tm9kZSA9IG5vZGUuY29udGVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhMSA9IG5vZGUuZGF0YTsKICAgICAgICAgICAgICAgIGlmIChkYXRhMS5pbmRleE9mKG1hcmtlcikgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdzMiA9IGRhdGExLnNwbGl0KG1hcmtlclJlZ2V4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0SW5kZXggPSBzdHJpbmdzMi5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsYXN0SW5kZXg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnNlcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzID0gc3RyaW5nczJbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzID09PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ID0gY3JlYXRlTWFya2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXguZXhlYyhzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCAhPT0gbnVsbCAmJiBlbmRzV2l0aChtYXRjaFsyXSwgYm91bmRBdHRyaWJ1dGVTdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHMuc2xpY2UoMCwgbWF0Y2guaW5kZXgpICsgbWF0Y2hbMV0gKyBtYXRjaFsyXS5zbGljZSgwLCAtYm91bmRBdHRyaWJ1dGVTdWZmaXgubGVuZ3RoKSArIG1hdGNoWzNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShpbnNlcnQsIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6ICsraW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmdzMltsYXN0SW5kZXhdID09PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGNyZWF0ZU1hcmtlcigpLCBub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNUb1JlbW92ZS5wdXNoKG5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YSA9IHN0cmluZ3MyW2xhc3RJbmRleF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCArPSBsYXN0SW5kZXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PT0gOCkgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YSA9PT0gbWFya2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnByZXZpb3VzU2libGluZyA9PT0gbnVsbCB8fCBpbmRleCA9PT0gbGFzdFBhcnRJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGNyZWF0ZU1hcmtlcigpLCBub2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGFzdFBhcnRJbmRleCA9IGluZGV4OwogICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5uZXh0U2libGluZyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmRhdGEgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmVtb3ZlLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LS07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKChpID0gbm9kZS5kYXRhLmluZGV4T2YobWFya2VyLCBpICsgMSkpICE9PSAtMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAibm9kZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogLTEKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IG4gb2Ygbm9kZXNUb1JlbW92ZSl7CiAgICAgICAgICAgIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgZW5kc1dpdGggPSAoc3RyLCBzdWZmaXgpPT57CiAgICBjb25zdCBpbmRleCA9IHN0ci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoOwogICAgcmV0dXJuIGluZGV4ID49IDAgJiYgc3RyLnNsaWNlKGluZGV4KSA9PT0gc3VmZml4Owp9Owpjb25zdCBpc1RlbXBsYXRlUGFydEFjdGl2ZSA9IChwYXJ0KT0+cGFydC5pbmRleCAhPT0gLTE7CmNvbnN0IGNyZWF0ZU1hcmtlciA9ICgpPT5kb2N1bWVudC5jcmVhdGVDb21tZW50KCIiKTsKY29uc3QgbGFzdEF0dHJpYnV0ZU5hbWVSZWdleCA9IC8oWyBceDA5XHgwYVx4MGNceDBkXSkoW15cMC1ceDFGXHg3Ri1ceDlGICInPj0vXSspKFsgXHgwOVx4MGFceDBjXHgwZF0qPVsgXHgwOVx4MGFceDBjXHgwZF0qKD86W14gXHgwOVx4MGFceDBjXHgwZCInYDw+PV0qfCJbXiJdKnwnW14nXSopKSQvOwpjbGFzcyBUZW1wbGF0ZUluc3RhbmNlIHsKICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlLCBwcm9jZXNzb3IsIG9wdGlvbnMpewogICAgICAgIHRoaXMuX19wYXJ0cyA9IFtdOwogICAgICAgIHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKICAgICAgICB0aGlzLnByb2Nlc3NvciA9IHByb2Nlc3NvcjsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgfQogICAgdXBkYXRlKHZhbHVlcykgewogICAgICAgIGxldCBpID0gMDsKICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgdGhpcy5fX3BhcnRzKXsKICAgICAgICAgICAgaWYgKHBhcnQgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcGFydC5zZXRWYWx1ZSh2YWx1ZXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBwYXJ0MSBvZiB0aGlzLl9fcGFydHMpewogICAgICAgICAgICBpZiAocGFydDEgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcGFydDEuY29tbWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBfY2xvbmUoKSB7CiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBpc0NFUG9seWZpbGwgPyB0aGlzLnRlbXBsYXRlLmVsZW1lbnQuY29udGVudC5jbG9uZU5vZGUodHJ1ZSkgOiBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxhdGUuZWxlbWVudC5jb250ZW50LCB0cnVlKTsKICAgICAgICBjb25zdCBzdGFjayA9IFtdOwogICAgICAgIGNvbnN0IHBhcnRzMiA9IHRoaXMudGVtcGxhdGUucGFydHM7CiAgICAgICAgY29uc3Qgd2Fsa2VyID0gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihmcmFnbWVudCwgMTMzLCBudWxsLCBmYWxzZSk7CiAgICAgICAgbGV0IHBhcnRJbmRleCA9IDA7CiAgICAgICAgbGV0IG5vZGVJbmRleCA9IDA7CiAgICAgICAgbGV0IHBhcnQ7CiAgICAgICAgbGV0IG5vZGUgPSB3YWxrZXIubmV4dE5vZGUoKTsKICAgICAgICB3aGlsZShwYXJ0SW5kZXggPCBwYXJ0czIubGVuZ3RoKXsKICAgICAgICAgICAgcGFydCA9IHBhcnRzMltwYXJ0SW5kZXhdOwogICAgICAgICAgICBpZiAoIWlzVGVtcGxhdGVQYXJ0QWN0aXZlKHBhcnQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaCh2b2lkIDApOwogICAgICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZShub2RlSW5kZXggPCBwYXJ0LmluZGV4KXsKICAgICAgICAgICAgICAgIG5vZGVJbmRleCsrOwogICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICJURU1QTEFURSIpIHsKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKG5vZGUpOwogICAgICAgICAgICAgICAgICAgIHdhbGtlci5jdXJyZW50Tm9kZSA9IG5vZGUuY29udGVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgobm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpKSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHdhbGtlci5jdXJyZW50Tm9kZSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIG5vZGUgPSB3YWxrZXIubmV4dE5vZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFydC50eXBlID09PSAibm9kZSIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnQyID0gdGhpcy5wcm9jZXNzb3IuaGFuZGxlVGV4dEV4cHJlc3Npb24odGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIHBhcnQyLmluc2VydEFmdGVyTm9kZShub2RlLnByZXZpb3VzU2libGluZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaChwYXJ0Mik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaCguLi50aGlzLnByb2Nlc3Nvci5oYW5kbGVBdHRyaWJ1dGVFeHByZXNzaW9ucyhub2RlLCBwYXJ0Lm5hbWUsIHBhcnQuc3RyaW5ncywgdGhpcy5vcHRpb25zKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NFUG9seWZpbGwpIHsKICAgICAgICAgICAgZG9jdW1lbnQuYWRvcHROb2RlKGZyYWdtZW50KTsKICAgICAgICAgICAgY3VzdG9tRWxlbWVudHMudXBncmFkZShmcmFnbWVudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmcmFnbWVudDsKICAgIH0KfQpjb25zdCBwb2xpY3kgPSB3aW5kb3cudHJ1c3RlZFR5cGVzICYmIHRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3koImxpdC1odG1sIiwgewogICAgY3JlYXRlSFRNTDogKHMpPT5zCn0pOwpjb25zdCBjb21tZW50TWFya2VyID0gYCAke21hcmtlcn0gYDsKY2xhc3MgVGVtcGxhdGVSZXN1bHQgewogICAgY29uc3RydWN0b3Ioc3RyaW5ncywgdmFsdWVzLCB0eXBlLCBwcm9jZXNzb3IpewogICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7CiAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICB0aGlzLnByb2Nlc3NvciA9IHByb2Nlc3NvcjsKICAgIH0KICAgIGdldEhUTUwoKSB7CiAgICAgICAgY29uc3QgbCA9IHRoaXMuc3RyaW5ncy5sZW5ndGggLSAxOwogICAgICAgIGxldCBodG1sMiA9ICIiOwogICAgICAgIGxldCBpc0NvbW1lbnRCaW5kaW5nID0gZmFsc2U7CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGw7IGkrKyl7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLnN0cmluZ3NbaV07CiAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRPcGVuID0gcy5sYXN0SW5kZXhPZigiPCEtLSIpOwogICAgICAgICAgICBpc0NvbW1lbnRCaW5kaW5nID0gKGNvbW1lbnRPcGVuID4gLTEgfHwgaXNDb21tZW50QmluZGluZykgJiYgcy5pbmRleE9mKCItLT4iLCBjb21tZW50T3BlbiArIDEpID09PSAtMTsKICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlTWF0Y2ggPSBsYXN0QXR0cmlidXRlTmFtZVJlZ2V4LmV4ZWMocyk7CiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVNYXRjaCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgaHRtbDIgKz0gcyArIChpc0NvbW1lbnRCaW5kaW5nID8gY29tbWVudE1hcmtlciA6IG5vZGVNYXJrZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaHRtbDIgKz0gcy5zdWJzdHIoMCwgYXR0cmlidXRlTWF0Y2guaW5kZXgpICsgYXR0cmlidXRlTWF0Y2hbMV0gKyBhdHRyaWJ1dGVNYXRjaFsyXSArIGJvdW5kQXR0cmlidXRlU3VmZml4ICsgYXR0cmlidXRlTWF0Y2hbM10gKyBtYXJrZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaHRtbDIgKz0gdGhpcy5zdHJpbmdzW2xdOwogICAgICAgIHJldHVybiBodG1sMjsKICAgIH0KICAgIGdldFRlbXBsYXRlRWxlbWVudCgpIHsKICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5nZXRIVE1MKCk7CiAgICAgICAgaWYgKHBvbGljeSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHZhbHVlID0gcG9saWN5LmNyZWF0ZUhUTUwodmFsdWUpOwogICAgICAgIH0KICAgICAgICB0ZW1wbGF0ZS5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGVtcGxhdGU7CiAgICB9Cn0KY2xhc3MgU1ZHVGVtcGxhdGVSZXN1bHQgZXh0ZW5kcyBUZW1wbGF0ZVJlc3VsdCB7CiAgICBnZXRIVE1MKCkgewogICAgICAgIHJldHVybiBgPHN2Zz4ke3N1cGVyLmdldEhUTUwoKX08L3N2Zz5gOwogICAgfQogICAgZ2V0VGVtcGxhdGVFbGVtZW50KCkgewogICAgICAgIGNvbnN0IHRlbXBsYXRlID0gc3VwZXIuZ2V0VGVtcGxhdGVFbGVtZW50KCk7CiAgICAgICAgY29uc3QgY29udGVudCA9IHRlbXBsYXRlLmNvbnRlbnQ7CiAgICAgICAgY29uc3Qgc3ZnRWxlbWVudCA9IGNvbnRlbnQuZmlyc3RDaGlsZDsKICAgICAgICBjb250ZW50LnJlbW92ZUNoaWxkKHN2Z0VsZW1lbnQpOwogICAgICAgIHJlcGFyZW50Tm9kZXMoY29udGVudCwgc3ZnRWxlbWVudC5maXJzdENoaWxkKTsKICAgICAgICByZXR1cm4gdGVtcGxhdGU7CiAgICB9Cn0KY29uc3QgaXNQcmltaXRpdmUgPSAodmFsdWUpPT57CiAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgISh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiIHx8IHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIik7Cn07CmNvbnN0IGlzSXRlcmFibGUgPSAodmFsdWUpPT57CiAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgISEodmFsdWUgJiYgdmFsdWVbU3ltYm9sLml0ZXJhdG9yXSk7Cn07CmNsYXNzIEF0dHJpYnV0ZUNvbW1pdHRlciB7CiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKXsKICAgICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgICAgICB0aGlzLnBhcnRzID0gW107CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHN0cmluZ3MubGVuZ3RoIC0gMTsgaSsrKXsKICAgICAgICAgICAgdGhpcy5wYXJ0c1tpXSA9IHRoaXMuX2NyZWF0ZVBhcnQoKTsKICAgICAgICB9CiAgICB9CiAgICBfY3JlYXRlUGFydCgpIHsKICAgICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZVBhcnQodGhpcyk7CiAgICB9CiAgICBfZ2V0VmFsdWUoKSB7CiAgICAgICAgY29uc3Qgc3RyaW5ncyA9IHRoaXMuc3RyaW5nczsKICAgICAgICBjb25zdCBsID0gc3RyaW5ncy5sZW5ndGggLSAxOwogICAgICAgIGNvbnN0IHBhcnRzMiA9IHRoaXMucGFydHM7CiAgICAgICAgaWYgKGwgPT09IDEgJiYgc3RyaW5nc1swXSA9PT0gIiIgJiYgc3RyaW5nc1sxXSA9PT0gIiIpIHsKICAgICAgICAgICAgY29uc3QgdiA9IHBhcnRzMlswXS52YWx1ZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAic3ltYm9sIikgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJzdHJpbmciIHx8ICFpc0l0ZXJhYmxlKHYpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgdGV4dCA9ICIiOwogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsOyBpKyspewogICAgICAgICAgICB0ZXh0ICs9IHN0cmluZ3NbaV07CiAgICAgICAgICAgIGNvbnN0IHBhcnQgPSBwYXJ0czJbaV07CiAgICAgICAgICAgIGlmIChwYXJ0ICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHYgPSBwYXJ0LnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKGlzUHJpbWl0aXZlKHYpIHx8ICFpc0l0ZXJhYmxlKHYpKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSB0eXBlb2YgdiA9PT0gInN0cmluZyIgPyB2IDogU3RyaW5nKHYpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygdil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gdHlwZW9mIHQgPT09ICJzdHJpbmciID8gdCA6IFN0cmluZyh0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGV4dCArPSBzdHJpbmdzW2xdOwogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSh0aGlzLm5hbWUsIHRoaXMuX2dldFZhbHVlKCkpOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBBdHRyaWJ1dGVQYXJ0IHsKICAgIGNvbnN0cnVjdG9yKGNvbW1pdHRlcil7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLmNvbW1pdHRlciA9IGNvbW1pdHRlcjsKICAgIH0KICAgIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlICE9PSBub0NoYW5nZSAmJiAoIWlzUHJpbWl0aXZlKHZhbHVlKSB8fCB2YWx1ZSAhPT0gdGhpcy52YWx1ZSkpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICBpZiAoIWlzRGlyZWN0aXZlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgdGhpcy5jb21taXR0ZXIuZGlydHkgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIHdoaWxlKGlzRGlyZWN0aXZlKHRoaXMudmFsdWUpKXsKICAgICAgICAgICAgY29uc3QgZGlyZWN0aXZlMiA9IHRoaXMudmFsdWU7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBub0NoYW5nZTsKICAgICAgICAgICAgZGlyZWN0aXZlMih0aGlzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jb21taXR0ZXIuY29tbWl0KCk7CiAgICB9Cn0KY2xhc3MgTm9kZVBhcnQgewogICAgY29uc3RydWN0b3Iob3B0aW9ucyl7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICB9CiAgICBhcHBlbmRJbnRvKGNvbnRhaW5lcikgewogICAgICAgIHRoaXMuc3RhcnROb2RlID0gY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZU1hcmtlcigpKTsKICAgICAgICB0aGlzLmVuZE5vZGUgPSBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlTWFya2VyKCkpOwogICAgfQogICAgaW5zZXJ0QWZ0ZXJOb2RlKHJlZikgewogICAgICAgIHRoaXMuc3RhcnROb2RlID0gcmVmOwogICAgICAgIHRoaXMuZW5kTm9kZSA9IHJlZi5uZXh0U2libGluZzsKICAgIH0KICAgIGFwcGVuZEludG9QYXJ0KHBhcnQpIHsKICAgICAgICBwYXJ0Ll9faW5zZXJ0KHRoaXMuc3RhcnROb2RlID0gY3JlYXRlTWFya2VyKCkpOwogICAgICAgIHBhcnQuX19pbnNlcnQodGhpcy5lbmROb2RlID0gY3JlYXRlTWFya2VyKCkpOwogICAgfQogICAgaW5zZXJ0QWZ0ZXJQYXJ0KHJlZikgewogICAgICAgIHJlZi5fX2luc2VydCh0aGlzLnN0YXJ0Tm9kZSA9IGNyZWF0ZU1hcmtlcigpKTsKICAgICAgICB0aGlzLmVuZE5vZGUgPSByZWYuZW5kTm9kZTsKICAgICAgICByZWYuZW5kTm9kZSA9IHRoaXMuc3RhcnROb2RlOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuc3RhcnROb2RlLnBhcmVudE5vZGUgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB3aGlsZShpc0RpcmVjdGl2ZSh0aGlzLl9fcGVuZGluZ1ZhbHVlKSl7CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGl2ZTIgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICAgICAgICAgIGRpcmVjdGl2ZTIodGhpcyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICBpZiAodmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzUHJpbWl0aXZlKHZhbHVlKSkgewogICAgICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMudmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19jb21taXRUZXh0KHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlc3VsdCkgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0VGVtcGxhdGVSZXN1bHQodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBOb2RlKSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXROb2RlKHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKGlzSXRlcmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXRJdGVyYWJsZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gbm90aGluZykgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gbm90aGluZzsKICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXRUZXh0KHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBfX2luc2VydChub2RlKSB7CiAgICAgICAgdGhpcy5lbmROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIHRoaXMuZW5kTm9kZSk7CiAgICB9CiAgICBfX2NvbW1pdE5vZGUodmFsdWUpIHsKICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fX2luc2VydCh2YWx1ZSk7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgfQogICAgX19jb21taXRUZXh0KHZhbHVlKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuc3RhcnROb2RlLm5leHRTaWJsaW5nOwogICAgICAgIHZhbHVlID0gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWU7CiAgICAgICAgY29uc3QgdmFsdWVBc1N0cmluZyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZSA6IFN0cmluZyh2YWx1ZSk7CiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMuZW5kTm9kZS5wcmV2aW91c1NpYmxpbmcgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMykgewogICAgICAgICAgICBub2RlLmRhdGEgPSB2YWx1ZUFzU3RyaW5nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXROb2RlKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlQXNTdHJpbmcpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgfQogICAgX19jb21taXRUZW1wbGF0ZVJlc3VsdCh2YWx1ZSkgewogICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlRmFjdG9yeSh2YWx1ZSk7CiAgICAgICAgaWYgKHRoaXMudmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZUluc3RhbmNlICYmIHRoaXMudmFsdWUudGVtcGxhdGUgPT09IHRlbXBsYXRlKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUudXBkYXRlKHZhbHVlLnZhbHVlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgVGVtcGxhdGVJbnN0YW5jZSh0ZW1wbGF0ZSwgdmFsdWUucHJvY2Vzc29yLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICBjb25zdCBmcmFnbWVudCA9IGluc3RhbmNlLl9jbG9uZSgpOwogICAgICAgICAgICBpbnN0YW5jZS51cGRhdGUodmFsdWUudmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdE5vZGUoZnJhZ21lbnQpOwogICAgICAgICAgICB0aGlzLnZhbHVlID0gaW5zdGFuY2U7CiAgICAgICAgfQogICAgfQogICAgX19jb21taXRJdGVyYWJsZSh2YWx1ZSkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gW107CiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXRlbVBhcnRzID0gdGhpcy52YWx1ZTsKICAgICAgICBsZXQgcGFydEluZGV4ID0gMDsKICAgICAgICBsZXQgaXRlbVBhcnQ7CiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHZhbHVlKXsKICAgICAgICAgICAgaXRlbVBhcnQgPSBpdGVtUGFydHNbcGFydEluZGV4XTsKICAgICAgICAgICAgaWYgKGl0ZW1QYXJ0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIGl0ZW1QYXJ0ID0gbmV3IE5vZGVQYXJ0KHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgICAgICBpdGVtUGFydHMucHVzaChpdGVtUGFydCk7CiAgICAgICAgICAgICAgICBpZiAocGFydEluZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbVBhcnQuYXBwZW5kSW50b1BhcnQodGhpcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGl0ZW1QYXJ0Lmluc2VydEFmdGVyUGFydChpdGVtUGFydHNbcGFydEluZGV4IC0gMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGl0ZW1QYXJ0LnNldFZhbHVlKGl0ZW0pOwogICAgICAgICAgICBpdGVtUGFydC5jb21taXQoKTsKICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgfQogICAgICAgIGlmIChwYXJ0SW5kZXggPCBpdGVtUGFydHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGl0ZW1QYXJ0cy5sZW5ndGggPSBwYXJ0SW5kZXg7CiAgICAgICAgICAgIHRoaXMuY2xlYXIoaXRlbVBhcnQgJiYgaXRlbVBhcnQuZW5kTm9kZSk7CiAgICAgICAgfQogICAgfQogICAgY2xlYXIoc3RhcnROb2RlID0gdGhpcy5zdGFydE5vZGUpIHsKICAgICAgICByZW1vdmVOb2Rlcyh0aGlzLnN0YXJ0Tm9kZS5wYXJlbnROb2RlLCBzdGFydE5vZGUubmV4dFNpYmxpbmcsIHRoaXMuZW5kTm9kZSk7CiAgICB9Cn0KY2xhc3MgQm9vbGVhbkF0dHJpYnV0ZVBhcnQgewogICAgY29uc3RydWN0b3IoZWxlbWVudCwgbmFtZSwgc3RyaW5ncyl7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdm9pZCAwOwogICAgICAgIGlmIChzdHJpbmdzLmxlbmd0aCAhPT0gMiB8fCBzdHJpbmdzWzBdICE9PSAiIiB8fCBzdHJpbmdzWzFdICE9PSAiIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJvb2xlYW4gYXR0cmlidXRlcyBjYW4gb25seSBjb250YWluIGEgc2luZ2xlIGV4cHJlc3Npb24iKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7CiAgICB9CiAgICBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICB3aGlsZShpc0RpcmVjdGl2ZSh0aGlzLl9fcGVuZGluZ1ZhbHVlKSl7CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGl2ZTIgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICAgICAgICAgIGRpcmVjdGl2ZTIodGhpcyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9fcGVuZGluZ1ZhbHVlID09PSBub0NoYW5nZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZhbHVlID0gISF0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgIGlmICh0aGlzLnZhbHVlICE9PSB2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUodGhpcy5uYW1lLCAiIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHRoaXMubmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICB9Cn0KY2xhc3MgUHJvcGVydHlDb21taXR0ZXIgZXh0ZW5kcyBBdHRyaWJ1dGVDb21taXR0ZXIgewogICAgY29uc3RydWN0b3IoZWxlbWVudCwgbmFtZSwgc3RyaW5ncyl7CiAgICAgICAgc3VwZXIoZWxlbWVudCwgbmFtZSwgc3RyaW5ncyk7CiAgICAgICAgdGhpcy5zaW5nbGUgPSBzdHJpbmdzLmxlbmd0aCA9PT0gMiAmJiBzdHJpbmdzWzBdID09PSAiIiAmJiBzdHJpbmdzWzFdID09PSAiIjsKICAgIH0KICAgIF9jcmVhdGVQYXJ0KCkgewogICAgICAgIHJldHVybiBuZXcgUHJvcGVydHlQYXJ0KHRoaXMpOwogICAgfQogICAgX2dldFZhbHVlKCkgewogICAgICAgIGlmICh0aGlzLnNpbmdsZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJ0c1swXS52YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLl9nZXRWYWx1ZSgpOwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5lbGVtZW50W3RoaXMubmFtZV0gPSB0aGlzLl9nZXRWYWx1ZSgpOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBQcm9wZXJ0eVBhcnQgZXh0ZW5kcyBBdHRyaWJ1dGVQYXJ0IHsKfQpsZXQgZXZlbnRPcHRpb25zU3VwcG9ydGVkID0gZmFsc2U7CigoKT0+ewogICAgdHJ5IHsKICAgICAgICBjb25zdCBvcHRpb25zID0gewogICAgICAgICAgICBnZXQgY2FwdHVyZSAoKSB7CiAgICAgICAgICAgICAgICBldmVudE9wdGlvbnNTdXBwb3J0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidGVzdCIsIG9wdGlvbnMsIG9wdGlvbnMpOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJ0ZXN0Iiwgb3B0aW9ucywgb3B0aW9ucyk7CiAgICB9IGNhdGNoIChfZSkge30KfSkoKTsKY2xhc3MgRXZlbnRQYXJ0IHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIGV2ZW50TmFtZSwgZXZlbnRDb250ZXh0KXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgICB0aGlzLmV2ZW50TmFtZSA9IGV2ZW50TmFtZTsKICAgICAgICB0aGlzLmV2ZW50Q29udGV4dCA9IGV2ZW50Q29udGV4dDsKICAgICAgICB0aGlzLl9fYm91bmRIYW5kbGVFdmVudCA9IChlKT0+dGhpcy5oYW5kbGVFdmVudChlKTsKICAgIH0KICAgIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZhbHVlOwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIHdoaWxlKGlzRGlyZWN0aXZlKHRoaXMuX19wZW5kaW5nVmFsdWUpKXsKICAgICAgICAgICAgY29uc3QgZGlyZWN0aXZlMiA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgICAgICAgICAgZGlyZWN0aXZlMih0aGlzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX19wZW5kaW5nVmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3TGlzdGVuZXIgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgIGNvbnN0IG9sZExpc3RlbmVyID0gdGhpcy52YWx1ZTsKICAgICAgICBjb25zdCBzaG91bGRSZW1vdmVMaXN0ZW5lciA9IG5ld0xpc3RlbmVyID09IG51bGwgfHwgb2xkTGlzdGVuZXIgIT0gbnVsbCAmJiAobmV3TGlzdGVuZXIuY2FwdHVyZSAhPT0gb2xkTGlzdGVuZXIuY2FwdHVyZSB8fCBuZXdMaXN0ZW5lci5vbmNlICE9PSBvbGRMaXN0ZW5lci5vbmNlIHx8IG5ld0xpc3RlbmVyLnBhc3NpdmUgIT09IG9sZExpc3RlbmVyLnBhc3NpdmUpOwogICAgICAgIGNvbnN0IHNob3VsZEFkZExpc3RlbmVyID0gbmV3TGlzdGVuZXIgIT0gbnVsbCAmJiAob2xkTGlzdGVuZXIgPT0gbnVsbCB8fCBzaG91bGRSZW1vdmVMaXN0ZW5lcik7CiAgICAgICAgaWYgKHNob3VsZFJlbW92ZUxpc3RlbmVyKSB7CiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLl9fYm91bmRIYW5kbGVFdmVudCwgdGhpcy5fX29wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAoc2hvdWxkQWRkTGlzdGVuZXIpIHsKICAgICAgICAgICAgdGhpcy5fX29wdGlvbnMgPSBnZXRPcHRpb25zKG5ld0xpc3RlbmVyKTsKICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIHRoaXMuX19ib3VuZEhhbmRsZUV2ZW50LCB0aGlzLl9fb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHRoaXMudmFsdWUgPSBuZXdMaXN0ZW5lcjsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICB9CiAgICBoYW5kbGVFdmVudChldmVudCkgewogICAgICAgIGlmICh0eXBlb2YgdGhpcy52YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aGlzLnZhbHVlLmNhbGwodGhpcy5ldmVudENvbnRleHQgfHwgdGhpcy5lbGVtZW50LCBldmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy52YWx1ZS5oYW5kbGVFdmVudChldmVudCk7CiAgICAgICAgfQogICAgfQp9CmNvbnN0IGdldE9wdGlvbnMgPSAobyk9Pm8gJiYgKGV2ZW50T3B0aW9uc1N1cHBvcnRlZCA/IHsKICAgICAgICBjYXB0dXJlOiBvLmNhcHR1cmUsCiAgICAgICAgcGFzc2l2ZTogby5wYXNzaXZlLAogICAgICAgIG9uY2U6IG8ub25jZQogICAgfSA6IG8uY2FwdHVyZSk7CmNsYXNzIERlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvciB7CiAgICBoYW5kbGVBdHRyaWJ1dGVFeHByZXNzaW9ucyhlbGVtZW50LCBuYW1lLCBzdHJpbmdzLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZVswXTsKICAgICAgICBpZiAocHJlZml4ID09PSAiLiIpIHsKICAgICAgICAgICAgY29uc3QgY29tbWl0dGVyMiA9IG5ldyBQcm9wZXJ0eUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBzdHJpbmdzKTsKICAgICAgICAgICAgcmV0dXJuIGNvbW1pdHRlcjIucGFydHM7CiAgICAgICAgfQogICAgICAgIGlmIChwcmVmaXggPT09ICJAIikgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgbmV3IEV2ZW50UGFydChlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBvcHRpb25zLmV2ZW50Q29udGV4dCkKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgaWYgKHByZWZpeCA9PT0gIj8iKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBuZXcgQm9vbGVhbkF0dHJpYnV0ZVBhcnQoZWxlbWVudCwgbmFtZS5zbGljZSgxKSwgc3RyaW5ncykKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29tbWl0dGVyID0gbmV3IEF0dHJpYnV0ZUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKTsKICAgICAgICByZXR1cm4gY29tbWl0dGVyLnBhcnRzOwogICAgfQogICAgaGFuZGxlVGV4dEV4cHJlc3Npb24ob3B0aW9ucykgewogICAgICAgIHJldHVybiBuZXcgTm9kZVBhcnQob3B0aW9ucyk7CiAgICB9Cn0KY29uc3QgZGVmYXVsdFRlbXBsYXRlUHJvY2Vzc29yID0gbmV3IERlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvcigpOwpmdW5jdGlvbiB0ZW1wbGF0ZUZhY3RvcnkocmVzdWx0KSB7CiAgICBsZXQgdGVtcGxhdGVDYWNoZSA9IHRlbXBsYXRlQ2FjaGVzLmdldChyZXN1bHQudHlwZSk7CiAgICBpZiAodGVtcGxhdGVDYWNoZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGVtcGxhdGVDYWNoZSA9IHsKICAgICAgICAgICAgc3RyaW5nc0FycmF5OiBuZXcgV2Vha01hcCgpLAogICAgICAgICAgICBrZXlTdHJpbmc6IG5ldyBNYXAoKQogICAgICAgIH07CiAgICAgICAgdGVtcGxhdGVDYWNoZXMuc2V0KHJlc3VsdC50eXBlLCB0ZW1wbGF0ZUNhY2hlKTsKICAgIH0KICAgIGxldCB0ZW1wbGF0ZSA9IHRlbXBsYXRlQ2FjaGUuc3RyaW5nc0FycmF5LmdldChyZXN1bHQuc3RyaW5ncyk7CiAgICBpZiAodGVtcGxhdGUgIT09IHZvaWQgMCkgewogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHJlc3VsdC5zdHJpbmdzLmpvaW4obWFya2VyKTsKICAgIHRlbXBsYXRlID0gdGVtcGxhdGVDYWNoZS5rZXlTdHJpbmcuZ2V0KGtleSk7CiAgICBpZiAodGVtcGxhdGUgPT09IHZvaWQgMCkgewogICAgICAgIHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKHJlc3VsdCwgcmVzdWx0LmdldFRlbXBsYXRlRWxlbWVudCgpKTsKICAgICAgICB0ZW1wbGF0ZUNhY2hlLmtleVN0cmluZy5zZXQoa2V5LCB0ZW1wbGF0ZSk7CiAgICB9CiAgICB0ZW1wbGF0ZUNhY2hlLnN0cmluZ3NBcnJheS5zZXQocmVzdWx0LnN0cmluZ3MsIHRlbXBsYXRlKTsKICAgIHJldHVybiB0ZW1wbGF0ZTsKfQpjb25zdCB0ZW1wbGF0ZUNhY2hlcyA9IG5ldyBNYXAoKTsKY29uc3QgcGFydHMgPSBuZXcgV2Vha01hcCgpOwpjb25zdCByZW5kZXIgPSAocmVzdWx0LCBjb250YWluZXIsIG9wdGlvbnMpPT57CiAgICBsZXQgcGFydCA9IHBhcnRzLmdldChjb250YWluZXIpOwogICAgaWYgKHBhcnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbW92ZU5vZGVzKGNvbnRhaW5lciwgY29udGFpbmVyLmZpcnN0Q2hpbGQpOwogICAgICAgIHBhcnRzLnNldChjb250YWluZXIsIHBhcnQgPSBuZXcgTm9kZVBhcnQoT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICAgIHRlbXBsYXRlRmFjdG9yeQogICAgICAgIH0sIG9wdGlvbnMpKSk7CiAgICAgICAgcGFydC5hcHBlbmRJbnRvKGNvbnRhaW5lcik7CiAgICB9CiAgICBwYXJ0LnNldFZhbHVlKHJlc3VsdCk7CiAgICBwYXJ0LmNvbW1pdCgpOwp9OwppZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICh3aW5kb3dbImxpdEh0bWxWZXJzaW9ucyJdIHx8ICh3aW5kb3dbImxpdEh0bWxWZXJzaW9ucyJdID0gW10pKS5wdXNoKCIxLjQuMSIpOwp9CmNvbnN0IGh0bWwgPSAoc3RyaW5ncywgLi4udmFsdWVzKT0+bmV3IFRlbXBsYXRlUmVzdWx0KHN0cmluZ3MsIHZhbHVlcywgImh0bWwiLCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IpOwpjb25zdCBzdmcgPSAoc3RyaW5ncywgLi4udmFsdWVzKT0+bmV3IFNWR1RlbXBsYXRlUmVzdWx0KHN0cmluZ3MsIHZhbHVlcywgInN2ZyIsIGRlZmF1bHRUZW1wbGF0ZVByb2Nlc3Nvcik7CnZhciBfYTsKd2luZG93LkpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkgPSAocHJvcCwgX29iaik9PnByb3A7CmNvbnN0IGRlZmF1bHRDb252ZXJ0ZXIgPSB7CiAgICB0b0F0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/ICIiIDogbnVsbDsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZnJvbUF0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbDsKICAgICAgICAgICAgY2FzZSBOdW1iZXI6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgPyBudWxsIDogTnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KfTsKY29uc3Qgbm90RXF1YWwgPSAodmFsdWUsIG9sZCk9PnsKICAgIHJldHVybiBvbGQgIT09IHZhbHVlICYmIChvbGQgPT09IG9sZCB8fCB2YWx1ZSA9PT0gdmFsdWUpOwp9Owpjb25zdCBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbiA9IHsKICAgIGF0dHJpYnV0ZTogdHJ1ZSwKICAgIHR5cGU6IFN0cmluZywKICAgIGNvbnZlcnRlcjogZGVmYXVsdENvbnZlcnRlciwKICAgIHJlZmxlY3Q6IGZhbHNlLAogICAgaGFzQ2hhbmdlZDogbm90RXF1YWwKfTsKY29uc3QgU1RBVEVfSEFTX1VQREFURUQgPSAxOwpjb25zdCBTVEFURV9VUERBVEVfUkVRVUVTVEVEID0gMSA8PCAyOwpjb25zdCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURSA9IDEgPDwgMzsKY29uc3QgU1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWSA9IDEgPDwgNDsKY29uc3QgZmluYWxpemVkID0gImZpbmFsaXplZCI7CmNsYXNzIFVwZGF0aW5nRWxlbWVudCBleHRlbmRzIEhUTUxFbGVtZW50IHsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLmluaXRpYWxpemUoKTsKICAgIH0KICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gW107CiAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLmZvckVhY2goKHYsIHApPT57CiAgICAgICAgICAgIGNvbnN0IGF0dHIgPSB0aGlzLl9hdHRyaWJ1dGVOYW1lRm9yUHJvcGVydHkocCwgdik7CiAgICAgICAgICAgIGlmIChhdHRyICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJpYnV0ZVRvUHJvcGVydHlNYXAuc2V0KGF0dHIsIHApOwogICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKGF0dHIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXM7CiAgICB9CiAgICBzdGF0aWMgX2Vuc3VyZUNsYXNzUHJvcGVydGllcygpIHsKICAgICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoSlNDb21waWxlcl9yZW5hbWVQcm9wZXJ0eSgiX2NsYXNzUHJvcGVydGllcyIsIHRoaXMpKSkgewogICAgICAgICAgICB0aGlzLl9jbGFzc1Byb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IHN1cGVyUHJvcGVydGllcyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fY2xhc3NQcm9wZXJ0aWVzOwogICAgICAgICAgICBpZiAoc3VwZXJQcm9wZXJ0aWVzICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHN1cGVyUHJvcGVydGllcy5mb3JFYWNoKCh2LCBrKT0+dGhpcy5fY2xhc3NQcm9wZXJ0aWVzLnNldChrLCB2KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgY3JlYXRlUHJvcGVydHkobmFtZSwgb3B0aW9ucyA9IGRlZmF1bHRQcm9wZXJ0eURlY2xhcmF0aW9uKSB7CiAgICAgICAgdGhpcy5fZW5zdXJlQ2xhc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLnNldChuYW1lLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy5ub0FjY2Vzc29yIHx8IHRoaXMucHJvdG90eXBlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3Qga2V5ID0gdHlwZW9mIG5hbWUgPT09ICJzeW1ib2wiID8gU3ltYm9sKCkgOiBgX18ke25hbWV9YDsKICAgICAgICBjb25zdCBkZXNjcmlwdG9yID0gdGhpcy5nZXRQcm9wZXJ0eURlc2NyaXB0b3IobmFtZSwga2V5LCBvcHRpb25zKTsKICAgICAgICBpZiAoZGVzY3JpcHRvciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnByb3RvdHlwZSwgbmFtZSwgZGVzY3JpcHRvcik7CiAgICAgICAgfQogICAgfQogICAgc3RhdGljIGdldFByb3BlcnR5RGVzY3JpcHRvcihuYW1lLCBrZXksIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXQgKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNba2V5XTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0ICh2YWx1ZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzW25hbWVdOwogICAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGVJbnRlcm5hbChuYW1lLCBvbGRWYWx1ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgICAgIH07CiAgICB9CiAgICBzdGF0aWMgZ2V0UHJvcGVydHlPcHRpb25zKG5hbWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2xhc3NQcm9wZXJ0aWVzICYmIHRoaXMuX2NsYXNzUHJvcGVydGllcy5nZXQobmFtZSkgfHwgZGVmYXVsdFByb3BlcnR5RGVjbGFyYXRpb247CiAgICB9CiAgICBzdGF0aWMgZmluYWxpemUoKSB7CiAgICAgICAgY29uc3Qgc3VwZXJDdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpOwogICAgICAgIGlmICghc3VwZXJDdG9yLmhhc093blByb3BlcnR5KGZpbmFsaXplZCkpIHsKICAgICAgICAgICAgc3VwZXJDdG9yLmZpbmFsaXplKCk7CiAgICAgICAgfQogICAgICAgIHRoaXNbZmluYWxpemVkXSA9IHRydWU7CiAgICAgICAgdGhpcy5fZW5zdXJlQ2xhc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5fYXR0cmlidXRlVG9Qcm9wZXJ0eU1hcCA9IG5ldyBNYXAoKTsKICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShKU0NvbXBpbGVyX3JlbmFtZVByb3BlcnR5KCJwcm9wZXJ0aWVzIiwgdGhpcykpKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgICAgICAgICBjb25zdCBwcm9wS2V5cyA9IFsKICAgICAgICAgICAgICAgIC4uLk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHByb3BzKSwKICAgICAgICAgICAgICAgIC4uLnR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhwcm9wcykgOiBbXQogICAgICAgICAgICBdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgcHJvcEtleXMpewogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVQcm9wZXJ0eShwLCBwcm9wc1twXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgX2F0dHJpYnV0ZU5hbWVGb3JQcm9wZXJ0eShuYW1lLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgYXR0cmlidXRlID0gb3B0aW9ucy5hdHRyaWJ1dGU7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZSA9PT0gZmFsc2UgPyB2b2lkIDAgOiB0eXBlb2YgYXR0cmlidXRlID09PSAic3RyaW5nIiA/IGF0dHJpYnV0ZSA6IHR5cGVvZiBuYW1lID09PSAic3RyaW5nIiA/IG5hbWUudG9Mb3dlckNhc2UoKSA6IHZvaWQgMDsKICAgIH0KICAgIHN0YXRpYyBfdmFsdWVIYXNDaGFuZ2VkKHZhbHVlLCBvbGQsIGhhc0NoYW5nZWQgPSBub3RFcXVhbCkgewogICAgICAgIHJldHVybiBoYXNDaGFuZ2VkKHZhbHVlLCBvbGQpOwogICAgfQogICAgc3RhdGljIF9wcm9wZXJ0eVZhbHVlRnJvbUF0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGNvbnN0IHR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAgICAgY29uc3QgY29udmVydGVyID0gb3B0aW9ucy5jb252ZXJ0ZXIgfHwgZGVmYXVsdENvbnZlcnRlcjsKICAgICAgICBjb25zdCBmcm9tQXR0cmlidXRlID0gdHlwZW9mIGNvbnZlcnRlciA9PT0gImZ1bmN0aW9uIiA/IGNvbnZlcnRlciA6IGNvbnZlcnRlci5mcm9tQXR0cmlidXRlOwogICAgICAgIHJldHVybiBmcm9tQXR0cmlidXRlID8gZnJvbUF0dHJpYnV0ZSh2YWx1ZSwgdHlwZSkgOiB2YWx1ZTsKICAgIH0KICAgIHN0YXRpYyBfcHJvcGVydHlWYWx1ZVRvQXR0cmlidXRlKHZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMucmVmbGVjdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgICBjb25zdCBjb252ZXJ0ZXIgPSBvcHRpb25zLmNvbnZlcnRlcjsKICAgICAgICBjb25zdCB0b0F0dHJpYnV0ZSA9IGNvbnZlcnRlciAmJiBjb252ZXJ0ZXIudG9BdHRyaWJ1dGUgfHwgZGVmYXVsdENvbnZlcnRlci50b0F0dHJpYnV0ZTsKICAgICAgICByZXR1cm4gdG9BdHRyaWJ1dGUodmFsdWUsIHR5cGUpOwogICAgfQogICAgaW5pdGlhbGl6ZSgpIHsKICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IDA7CiAgICAgICAgdGhpcy5fdXBkYXRlUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMpPT50aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyID0gcmVzKTsKICAgICAgICB0aGlzLl9jaGFuZ2VkUHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLl9zYXZlSW5zdGFuY2VQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5yZXF1ZXN0VXBkYXRlSW50ZXJuYWwoKTsKICAgIH0KICAgIF9zYXZlSW5zdGFuY2VQcm9wZXJ0aWVzKCkgewogICAgICAgIHRoaXMuY29uc3RydWN0b3IuX2NsYXNzUHJvcGVydGllcy5mb3JFYWNoKChfdiwgcCk9PnsKICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkocCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1twXTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzW3BdOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMuc2V0KHAsIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgX2FwcGx5SW5zdGFuY2VQcm9wZXJ0aWVzKCkgewogICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcy5mb3JFYWNoKCh2LCBwKT0+dGhpc1twXSA9IHYpOwogICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcyA9IHZvaWQgMDsKICAgIH0KICAgIGNvbm5lY3RlZENhbGxiYWNrKCkgewogICAgICAgIHRoaXMuZW5hYmxlVXBkYXRpbmcoKTsKICAgIH0KICAgIGVuYWJsZVVwZGF0aW5nKCkgewogICAgICAgIGlmICh0aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlVXBkYXRpbmdSZXNvbHZlcigpOwogICAgICAgICAgICB0aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyID0gdm9pZCAwOwogICAgICAgIH0KICAgIH0KICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge30KICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhuYW1lLCBvbGQsIHZhbHVlKSB7CiAgICAgICAgaWYgKG9sZCAhPT0gdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlVG9Qcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgX3Byb3BlcnR5VG9BdHRyaWJ1dGUobmFtZSwgdmFsdWUsIG9wdGlvbnMgPSBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbikgewogICAgICAgIGNvbnN0IGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yOwogICAgICAgIGNvbnN0IGF0dHIgPSBjdG9yLl9hdHRyaWJ1dGVOYW1lRm9yUHJvcGVydHkobmFtZSwgb3B0aW9ucyk7CiAgICAgICAgaWYgKGF0dHIgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBhdHRyVmFsdWUgPSBjdG9yLl9wcm9wZXJ0eVZhbHVlVG9BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoYXR0clZhbHVlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfSVNfUkVGTEVDVElOR19UT19BVFRSSUJVVEU7CiAgICAgICAgICAgIGlmIChhdHRyVmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoYXR0cik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShhdHRyLCBhdHRyVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgJiB+U1RBVEVfSVNfUkVGTEVDVElOR19UT19BVFRSSUJVVEU7CiAgICAgICAgfQogICAgfQogICAgX2F0dHJpYnV0ZVRvUHJvcGVydHkobmFtZSwgdmFsdWUpIHsKICAgICAgICBpZiAodGhpcy5fdXBkYXRlU3RhdGUgJiBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yOwogICAgICAgIGNvbnN0IHByb3BOYW1lID0gY3Rvci5fYXR0cmlidXRlVG9Qcm9wZXJ0eU1hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKHByb3BOYW1lICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGN0b3IuZ2V0UHJvcGVydHlPcHRpb25zKHByb3BOYW1lKTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSB8IFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFk7CiAgICAgICAgICAgIHRoaXNbcHJvcE5hbWVdID0gY3Rvci5fcHJvcGVydHlWYWx1ZUZyb21BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMpOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlICYgflNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFk7CiAgICAgICAgfQogICAgfQogICAgcmVxdWVzdFVwZGF0ZUludGVybmFsKG5hbWUsIG9sZFZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgbGV0IHNob3VsZFJlcXVlc3RVcGRhdGUgPSB0cnVlOwogICAgICAgIGlmIChuYW1lICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgY29uc3QgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IGN0b3IuZ2V0UHJvcGVydHlPcHRpb25zKG5hbWUpOwogICAgICAgICAgICBpZiAoY3Rvci5fdmFsdWVIYXNDaGFuZ2VkKHRoaXNbbmFtZV0sIG9sZFZhbHVlLCBvcHRpb25zLmhhc0NoYW5nZWQpKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2NoYW5nZWRQcm9wZXJ0aWVzLmhhcyhuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZWRQcm9wZXJ0aWVzLnNldChuYW1lLCBvbGRWYWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5yZWZsZWN0ID09PSB0cnVlICYmICEodGhpcy5fdXBkYXRlU3RhdGUgJiBTVEFURV9JU19SRUZMRUNUSU5HX1RPX1BST1BFUlRZKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcy5zZXQobmFtZSwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzaG91bGRSZXF1ZXN0VXBkYXRlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLl9oYXNSZXF1ZXN0ZWRVcGRhdGUgJiYgc2hvdWxkUmVxdWVzdFVwZGF0ZSkgewogICAgICAgICAgICB0aGlzLl91cGRhdGVQcm9taXNlID0gdGhpcy5fZW5xdWV1ZVVwZGF0ZSgpOwogICAgICAgIH0KICAgIH0KICAgIHJlcXVlc3RVcGRhdGUobmFtZSwgb2xkVmFsdWUpIHsKICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGVJbnRlcm5hbChuYW1lLCBvbGRWYWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlQ29tcGxldGU7CiAgICB9CiAgICBhc3luYyBfZW5xdWV1ZVVwZGF0ZSgpIHsKICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfVVBEQVRFX1JFUVVFU1RFRDsKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCB0aGlzLl91cGRhdGVQcm9taXNlOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5wZXJmb3JtVXBkYXRlKCk7CiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgIGF3YWl0IHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICF0aGlzLl9oYXNSZXF1ZXN0ZWRVcGRhdGU7CiAgICB9CiAgICBnZXQgX2hhc1JlcXVlc3RlZFVwZGF0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlU3RhdGUgJiBTVEFURV9VUERBVEVfUkVRVUVTVEVEOwogICAgfQogICAgZ2V0IGhhc1VwZGF0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZVN0YXRlICYgMTsKICAgIH0KICAgIHBlcmZvcm1VcGRhdGUoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9oYXNSZXF1ZXN0ZWRVcGRhdGUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5SW5zdGFuY2VQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICAgIGxldCBzaG91bGRVcGRhdGUgPSBmYWxzZTsKICAgICAgICBjb25zdCBjaGFuZ2VkUHJvcGVydGllcyA9IHRoaXMuX2NoYW5nZWRQcm9wZXJ0aWVzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IHRoaXMuc2hvdWxkVXBkYXRlKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX21hcmtVcGRhdGVkKCk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIGlmIChzaG91bGRVcGRhdGUpIHsKICAgICAgICAgICAgaWYgKCEodGhpcy5fdXBkYXRlU3RhdGUgJiAxKSkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSB8IFNUQVRFX0hBU19VUERBVEVEOwogICAgICAgICAgICAgICAgdGhpcy5maXJzdFVwZGF0ZWQoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudXBkYXRlZChjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgfQogICAgfQogICAgX21hcmtVcGRhdGVkKCkgewogICAgICAgIHRoaXMuX2NoYW5nZWRQcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgJiB+U1RBVEVfVVBEQVRFX1JFUVVFU1RFRDsKICAgIH0KICAgIGdldCB1cGRhdGVDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VXBkYXRlQ29tcGxldGUoKTsKICAgIH0KICAgIF9nZXRVcGRhdGVDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRVcGRhdGVDb21wbGV0ZSgpOwogICAgfQogICAgZ2V0VXBkYXRlQ29tcGxldGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZVByb21pc2U7CiAgICB9CiAgICBzaG91bGRVcGRhdGUoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB1cGRhdGUoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7CiAgICAgICAgaWYgKHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzICE9PSB2b2lkIDAgJiYgdGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgdGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMuZm9yRWFjaCgodiwgayk9PnRoaXMuX3Byb3BlcnR5VG9BdHRyaWJ1dGUoaywgdGhpc1trXSwgdikpOwogICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyA9IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgIH0KICAgIHVwZGF0ZWQoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7fQogICAgZmlyc3RVcGRhdGVkKF9jaGFuZ2VkUHJvcGVydGllcykge30KfQpfYSA9IGZpbmFsaXplZDsKVXBkYXRpbmdFbGVtZW50W19hXSA9IHRydWU7CmNvbnN0IEVsZW1lbnRQcm90byA9IEVsZW1lbnQucHJvdG90eXBlOwpFbGVtZW50UHJvdG8ubXNNYXRjaGVzU2VsZWN0b3IgfHwgRWxlbWVudFByb3RvLndlYmtpdE1hdGNoZXNTZWxlY3RvcjsKY29uc3Qgc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzID0gd2luZG93LlNoYWRvd1Jvb3QgJiYgKHdpbmRvdy5TaGFkeUNTUyA9PT0gdm9pZCAwIHx8IHdpbmRvdy5TaGFkeUNTUy5uYXRpdmVTaGFkb3cpICYmICJhZG9wdGVkU3R5bGVTaGVldHMiIGluIERvY3VtZW50LnByb3RvdHlwZSAmJiAicmVwbGFjZSIgaW4gQ1NTU3R5bGVTaGVldC5wcm90b3R5cGU7CmNvbnN0IGNvbnN0cnVjdGlvblRva2VuID0gU3ltYm9sKCk7CmNsYXNzIENTU1Jlc3VsdCB7CiAgICBjb25zdHJ1Y3Rvcihjc3NUZXh0LCBzYWZlVG9rZW4pewogICAgICAgIGlmIChzYWZlVG9rZW4gIT09IGNvbnN0cnVjdGlvblRva2VuKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ1NTUmVzdWx0IGlzIG5vdCBjb25zdHJ1Y3RhYmxlLiBVc2UgYHVuc2FmZUNTU2Agb3IgYGNzc2AgaW5zdGVhZC4iKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jc3NUZXh0ID0gY3NzVGV4dDsKICAgIH0KICAgIGdldCBzdHlsZVNoZWV0KCkgewogICAgICAgIGlmICh0aGlzLl9zdHlsZVNoZWV0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgaWYgKHN1cHBvcnRzQWRvcHRpbmdTdHlsZVNoZWV0cykgewogICAgICAgICAgICAgICAgdGhpcy5fc3R5bGVTaGVldCA9IG5ldyBDU1NTdHlsZVNoZWV0KCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zdHlsZVNoZWV0LnJlcGxhY2VTeW5jKHRoaXMuY3NzVGV4dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zdHlsZVNoZWV0ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVTaGVldDsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLmNzc1RleHQ7CiAgICB9Cn0KY29uc3QgdW5zYWZlQ1NTID0gKHZhbHVlKT0+ewogICAgcmV0dXJuIG5ldyBDU1NSZXN1bHQoU3RyaW5nKHZhbHVlKSwgY29uc3RydWN0aW9uVG9rZW4pOwp9Owpjb25zdCB0ZXh0RnJvbUNTU1Jlc3VsdCA9ICh2YWx1ZSk9PnsKICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIENTU1Jlc3VsdCkgewogICAgICAgIHJldHVybiB2YWx1ZS5jc3NUZXh0OwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZhbHVlIHBhc3NlZCB0byAnY3NzJyBmdW5jdGlvbiBtdXN0IGJlIGEgJ2NzcycgZnVuY3Rpb24gcmVzdWx0OiAke3ZhbHVlfS4gVXNlICd1bnNhZmVDU1MnIHRvIHBhc3Mgbm9uLWxpdGVyYWwgdmFsdWVzLCBidXQKICAgICAgICAgICAgdGFrZSBjYXJlIHRvIGVuc3VyZSBwYWdlIHNlY3VyaXR5LmApOwogICAgfQp9Owpjb25zdCBjc3MgPSAoc3RyaW5ncywgLi4udmFsdWVzKT0+ewogICAgY29uc3QgY3NzVGV4dCA9IHZhbHVlcy5yZWR1Y2UoKGFjYywgdiwgaWR4KT0+YWNjICsgdGV4dEZyb21DU1NSZXN1bHQodikgKyBzdHJpbmdzW2lkeCArIDFdLCBzdHJpbmdzWzBdKTsKICAgIHJldHVybiBuZXcgQ1NTUmVzdWx0KGNzc1RleHQsIGNvbnN0cnVjdGlvblRva2VuKTsKfTsKKHdpbmRvd1sibGl0RWxlbWVudFZlcnNpb25zIl0gfHwgKHdpbmRvd1sibGl0RWxlbWVudFZlcnNpb25zIl0gPSBbXSkpLnB1c2goIjIuNS4xIik7CmNvbnN0IHJlbmRlck5vdEltcGxlbWVudGVkID0ge307CmNsYXNzIExpdEVsZW1lbnQgZXh0ZW5kcyBVcGRhdGluZ0VsZW1lbnQgewogICAgc3RhdGljIGdldFN0eWxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHlsZXM7CiAgICB9CiAgICBzdGF0aWMgX2dldFVuaXF1ZVN0eWxlcygpIHsKICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShKU0NvbXBpbGVyX3JlbmFtZVByb3BlcnR5KCJfc3R5bGVzIiwgdGhpcykpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdXNlclN0eWxlcyA9IHRoaXMuZ2V0U3R5bGVzKCk7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlclN0eWxlcykpIHsKICAgICAgICAgICAgY29uc3QgYWRkU3R5bGVzID0gKHN0eWxlczIsIHNldDIpPT5zdHlsZXMyLnJlZHVjZVJpZ2h0KChzZXQzLCBzKT0+QXJyYXkuaXNBcnJheShzKSA/IGFkZFN0eWxlcyhzLCBzZXQzKSA6IChzZXQzLmFkZChzKSwgc2V0MyksIHNldDIpOwogICAgICAgICAgICBjb25zdCBzZXQgPSBhZGRTdHlsZXModXNlclN0eWxlcywgbmV3IFNldCgpKTsKICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0gW107CiAgICAgICAgICAgIHNldC5mb3JFYWNoKCh2KT0+c3R5bGVzLnVuc2hpZnQodikpOwogICAgICAgICAgICB0aGlzLl9zdHlsZXMgPSBzdHlsZXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fc3R5bGVzID0gdXNlclN0eWxlcyA9PT0gdm9pZCAwID8gW10gOiBbCiAgICAgICAgICAgICAgICB1c2VyU3R5bGVzCiAgICAgICAgICAgIF07CiAgICAgICAgfQogICAgICAgIHRoaXMuX3N0eWxlcyA9IHRoaXMuX3N0eWxlcy5tYXAoKHMpPT57CiAgICAgICAgICAgIGlmIChzIGluc3RhbmNlb2YgQ1NTU3R5bGVTaGVldCAmJiAhc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjc3NUZXh0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwocy5jc3NSdWxlcykucmVkdWNlKChjc3MyLCBydWxlKT0+Y3NzMiArIHJ1bGUuY3NzVGV4dCwgIiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHVuc2FmZUNTUyhjc3NUZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9KTsKICAgIH0KICAgIGluaXRpYWxpemUoKSB7CiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZSgpOwogICAgICAgIHRoaXMuY29uc3RydWN0b3IuX2dldFVuaXF1ZVN0eWxlcygpOwogICAgICAgIHRoaXMucmVuZGVyUm9vdCA9IHRoaXMuY3JlYXRlUmVuZGVyUm9vdCgpOwogICAgICAgIGlmICh3aW5kb3cuU2hhZG93Um9vdCAmJiB0aGlzLnJlbmRlclJvb3QgaW5zdGFuY2VvZiB3aW5kb3cuU2hhZG93Um9vdCkgewogICAgICAgICAgICB0aGlzLmFkb3B0U3R5bGVzKCk7CiAgICAgICAgfQogICAgfQogICAgY3JlYXRlUmVuZGVyUm9vdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5hdHRhY2hTaGFkb3codGhpcy5jb25zdHJ1Y3Rvci5zaGFkb3dSb290T3B0aW9ucyk7CiAgICB9CiAgICBhZG9wdFN0eWxlcygpIHsKICAgICAgICBjb25zdCBzdHlsZXMgPSB0aGlzLmNvbnN0cnVjdG9yLl9zdHlsZXM7CiAgICAgICAgaWYgKHN0eWxlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAod2luZG93LlNoYWR5Q1NTICE9PSB2b2lkIDAgJiYgIXdpbmRvdy5TaGFkeUNTUy5uYXRpdmVTaGFkb3cpIHsKICAgICAgICAgICAgd2luZG93LlNoYWR5Q1NTLlNjb3BpbmdTaGltLnByZXBhcmVBZG9wdGVkQ3NzVGV4dChzdHlsZXMubWFwKChzKT0+cy5jc3NUZXh0KSwgdGhpcy5sb2NhbE5hbWUpOwogICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgIHRoaXMucmVuZGVyUm9vdC5hZG9wdGVkU3R5bGVTaGVldHMgPSBzdHlsZXMubWFwKChzKT0+cyBpbnN0YW5jZW9mIENTU1N0eWxlU2hlZXQgPyBzIDogcy5zdHlsZVNoZWV0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMgPSB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIGNvbm5lY3RlZENhbGxiYWNrKCkgewogICAgICAgIHN1cGVyLmNvbm5lY3RlZENhbGxiYWNrKCk7CiAgICAgICAgaWYgKHRoaXMuaGFzVXBkYXRlZCAmJiB3aW5kb3cuU2hhZHlDU1MgIT09IHZvaWQgMCkgewogICAgICAgICAgICB3aW5kb3cuU2hhZHlDU1Muc3R5bGVFbGVtZW50KHRoaXMpOwogICAgICAgIH0KICAgIH0KICAgIHVwZGF0ZShjaGFuZ2VkUHJvcGVydGllcykgewogICAgICAgIGNvbnN0IHRlbXBsYXRlUmVzdWx0ID0gdGhpcy5yZW5kZXIoKTsKICAgICAgICBzdXBlci51cGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgIGlmICh0ZW1wbGF0ZVJlc3VsdCAhPT0gcmVuZGVyTm90SW1wbGVtZW50ZWQpIHsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5yZW5kZXIodGVtcGxhdGVSZXN1bHQsIHRoaXMucmVuZGVyUm9vdCwgewogICAgICAgICAgICAgICAgc2NvcGVOYW1lOiB0aGlzLmxvY2FsTmFtZSwKICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dDogdGhpcwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX25lZWRzU2hpbUFkb3B0ZWRTdHlsZVNoZWV0cykgewogICAgICAgICAgICB0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5fc3R5bGVzLmZvckVhY2goKHMpPT57CiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICAgICAgICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9IHMuY3NzVGV4dDsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUm9vdC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIHJlbmRlcigpIHsKICAgICAgICByZXR1cm4gcmVuZGVyTm90SW1wbGVtZW50ZWQ7CiAgICB9Cn0KTGl0RWxlbWVudFsiZmluYWxpemVkIl0gPSB0cnVlOwpMaXRFbGVtZW50LnJlbmRlciA9IHJlbmRlcjsKTGl0RWxlbWVudC5zaGFkb3dSb290T3B0aW9ucyA9IHsKICAgIG1vZGU6ICJvcGVuIgp9Owphc3luYyBmdW5jdGlvbiBsaXN0RHVyYWJsZU9iamVjdHNOYW1lc3BhY2VzKGFjY291bnRJZCwgYXBpVG9rZW4pIHsKICAgIGNvbnN0IHVybCA9IGAke2NvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpfS93b3JrZXJzL2R1cmFibGVfb2JqZWN0cy9uYW1lc3BhY2VzYDsKICAgIHJldHVybiAoYXdhaXQgZXhlY3V0ZSgnbGlzdER1cmFibGVPYmplY3RzTmFtZXNwYWNlcycsICdHRVQnLCB1cmwsIGFwaVRva2VuKSkucmVzdWx0Owp9CmFzeW5jIGZ1bmN0aW9uIGxpc3RTY3JpcHRzKGFjY291bnRJZCwgYXBpVG9rZW4pIHsKICAgIGNvbnN0IHVybCA9IGAke2NvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpfS93b3JrZXJzL3NjcmlwdHNgOwogICAgcmV0dXJuIChhd2FpdCBleGVjdXRlKCdsaXN0U2NyaXB0cycsICdHRVQnLCB1cmwsIGFwaVRva2VuKSkucmVzdWx0Owp9CmFzeW5jIGZ1bmN0aW9uIGxpc3RUYWlscyhhY2NvdW50SWQsIHNjcmlwdE5hbWUsIGFwaVRva2VuKSB7CiAgICBjb25zdCB1cmwgPSBgJHtjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKX0vd29ya2Vycy9zY3JpcHRzLyR7c2NyaXB0TmFtZX0vdGFpbHNgOwogICAgcmV0dXJuIChhd2FpdCBleGVjdXRlKCdsaXN0VGFpbHMnLCAnR0VUJywgdXJsLCBhcGlUb2tlbikpLnJlc3VsdDsKfQphc3luYyBmdW5jdGlvbiBjcmVhdGVUYWlsKGFjY291bnRJZCwgc2NyaXB0TmFtZSwgYXBpVG9rZW4pIHsKICAgIGNvbnN0IHVybCA9IGAke2NvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpfS93b3JrZXJzL3NjcmlwdHMvJHtzY3JpcHROYW1lfS90YWlsc2A7CiAgICByZXR1cm4gKGF3YWl0IGV4ZWN1dGUoJ2NyZWF0ZVRhaWwnLCAnUE9TVCcsIHVybCwgYXBpVG9rZW4pKS5yZXN1bHQ7Cn0KY2xhc3MgQ2xvdWRmbGFyZUFwaSB7CiAgICBzdGF0aWMgREVCVUcgPSBmYWxzZTsKICAgIHN0YXRpYyBVUkxfVFJBTlNGT1JNRVIgPSAodik9PnY7Cn0KY29uc3QgQVBQTElDQVRJT05fSlNPTiA9ICdhcHBsaWNhdGlvbi9qc29uJzsKY29uc3QgQVBQTElDQVRJT05fSlNPTl9VVEY4ID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnOwpjb25zdCBBUFBMSUNBVElPTl9PQ1RFVF9TVFJFQU0gPSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJzsKY29uc3QgVEVYVF9QTEFJTl9VVEY4ID0gJ3RleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgnOwpmdW5jdGlvbiBjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKSB7CiAgICByZXR1cm4gQ2xvdWRmbGFyZUFwaS5VUkxfVFJBTlNGT1JNRVIoYGh0dHBzOi8vYXBpLmNsb3VkZmxhcmUuY29tL2NsaWVudC92NC9hY2NvdW50cy8ke2FjY291bnRJZH1gKTsKfQpmdW5jdGlvbiBpc1N0cmluZ1JlY29yZChvYmopIHsKICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmogIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkob2JqKSAmJiBvYmouY29uc3RydWN0b3IgPT09IE9iamVjdDsKfQphc3luYyBmdW5jdGlvbiBleGVjdXRlKG9wLCBtZXRob2QsIHVybCwgYXBpVG9rZW4sIGJvZHksIHJlc3BvbnNlVHlwZSA9ICdqc29uJykgewogICAgaWYgKENsb3VkZmxhcmVBcGkuREVCVUcpIGNvbnNvbGUubG9nKGAke29wfTogJHttZXRob2R9ICR7dXJsfWApOwogICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHthcGlUb2tlbn1gCiAgICB9KTsKICAgIGxldCBib2R5T2JqOwogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykgewogICAgICAgIGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBURVhUX1BMQUlOX1VURjgpOwogICAgfSBlbHNlIGlmIChpc1N0cmluZ1JlY29yZChib2R5KSkgewogICAgICAgIGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBBUFBMSUNBVElPTl9KU09OX1VURjgpOwogICAgICAgIGJvZHlPYmogPSBib2R5OwogICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTsKICAgIH0KICAgIGlmIChDbG91ZGZsYXJlQXBpLkRFQlVHKSBjb25zb2xlLmxvZyhbCiAgICAgICAgLi4uaGVhZGVycwogICAgXS5tYXAoKHYpPT52LmpvaW4oJzogJykpLmpvaW4oJ1xuJykpOwogICAgaWYgKENsb3VkZmxhcmVBcGkuREVCVUcgJiYgYm9keU9iaikgY29uc29sZS5sb2coYm9keU9iaik7CiAgICBjb25zdCBmZXRjaFJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgYm9keQogICAgfSk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaS5ERUJVRykgY29uc29sZS5sb2coYCR7ZmV0Y2hSZXNwb25zZS5zdGF0dXN9ICR7ZmV0Y2hSZXNwb25zZS51cmx9YCk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaS5ERUJVRykgY29uc29sZS5sb2coWwogICAgICAgIC4uLmZldGNoUmVzcG9uc2UuaGVhZGVycwogICAgXS5tYXAoKHYpPT52LmpvaW4oJzogJykpLmpvaW4oJ1xuJykpOwogICAgY29uc3QgY29udGVudFR5cGUgPSBmZXRjaFJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKSB8fCAnJzsKICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICdlbXB0eScgJiYgZmV0Y2hSZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIGZldGNoUmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7CiAgICAgICAgaWYgKGNvbnRlbnRUeXBlICE9PSAnJykgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGNvbnRlbnQtdHlwZSAoZXhwZWN0ZWQgbm9uZSk6ICR7Y29udGVudFR5cGV9LCBmZXRjaFJlc3BvbnNlPSR7ZmV0Y2hSZXNwb25zZX0sIGJvZHk9JHthd2FpdCBmZXRjaFJlc3BvbnNlLnRleHQoKX1gKTsKICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZmV0Y2hSZXNwb25zZS50ZXh0KCk7CiAgICAgICAgaWYgKHRleHQgIT09ICcnKSB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgYm9keSAoZXhwZWN0ZWQgbm9uZSk6ICR7dGV4dH0sIGZldGNoUmVzcG9uc2U9JHtmZXRjaFJlc3BvbnNlfSwgYm9keT0ke3RleHR9YCk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKChyZXNwb25zZVR5cGUgPT09ICdieXRlcycgfHwgcmVzcG9uc2VUeXBlID09PSAnYnl0ZXM/JykgJiYgY29udGVudFR5cGUgPT09IEFQUExJQ0FUSU9OX09DVEVUX1NUUkVBTSkgewogICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGZldGNoUmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgIH0KICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICd0ZXh0PycgJiYgY29udGVudFR5cGUuc3RhcnRzV2l0aCgndGV4dC8nKSkgewogICAgICAgIHJldHVybiBhd2FpdCBmZXRjaFJlc3BvbnNlLnRleHQoKTsKICAgIH0KICAgIGlmICghWwogICAgICAgIEFQUExJQ0FUSU9OX0pTT05fVVRGOCwKICAgICAgICBBUFBMSUNBVElPTl9KU09OCiAgICBdLmluY2x1ZGVzKGNvbnRlbnRUeXBlKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBjb250ZW50LXR5cGU6ICR7Y29udGVudFR5cGV9LCBmZXRjaFJlc3BvbnNlPSR7ZmV0Y2hSZXNwb25zZX0sIGJvZHk9JHthd2FpdCBmZXRjaFJlc3BvbnNlLnRleHQoKX1gKTsKICAgIH0KICAgIGNvbnN0IGFwaVJlc3BvbnNlID0gYXdhaXQgZmV0Y2hSZXNwb25zZS5qc29uKCk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaS5ERUJVRykgY29uc29sZS5sb2coYXBpUmVzcG9uc2UpOwogICAgaWYgKCFhcGlSZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgaWYgKGZldGNoUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQgJiYgWwogICAgICAgICAgICAnYnl0ZXM/JywKICAgICAgICAgICAgJ2pzb24/JwogICAgICAgIF0uaW5jbHVkZXMocmVzcG9uc2VUeXBlKSkgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB0aHJvdyBuZXcgQ2xvdWRmbGFyZUFwaUVycm9yKGAke29wfSBmYWlsZWQ6IHN0YXR1cz0ke2ZldGNoUmVzcG9uc2Uuc3RhdHVzfSwgZXJyb3JzPSR7YXBpUmVzcG9uc2UuZXJyb3JzLm1hcCgodik9PmAke3YuY29kZX0gJHt2Lm1lc3NhZ2V9YCkuam9pbignLCAnKX1gLCBmZXRjaFJlc3BvbnNlLnN0YXR1cywgYXBpUmVzcG9uc2UuZXJyb3JzKTsKICAgIH0KICAgIHJldHVybiBhcGlSZXNwb25zZTsKfQpjbGFzcyBDbG91ZGZsYXJlQXBpRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICBzdGF0dXM7CiAgICBlcnJvcnM7CiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBzdGF0dXMsIGVycm9ycyl7CiAgICAgICAgc3VwZXIobWVzc2FnZSk7CiAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBlcnJvcnM7CiAgICB9Cn0KZnVuY3Rpb24gc2V0U3VidHJhY3QobGhzLCByaHMpIHsKICAgIGNvbnN0IHJ0ID0gbmV3IFNldChsaHMpOwogICAgZm9yIChjb25zdCBpdGVtIG9mIHJocyl7CiAgICAgICAgcnQuZGVsZXRlKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJ0Owp9CmZ1bmN0aW9uIHNldFVuaW9uKGxocywgcmhzKSB7CiAgICBjb25zdCBydCA9IG5ldyBTZXQobGhzKTsKICAgIGZvciAoY29uc3QgaXRlbSBvZiByaHMpewogICAgICAgIHJ0LmFkZChpdGVtKTsKICAgIH0KICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBzZXRJbnRlcnNlY3QobGhzLCByaHMpIHsKICAgIGNvbnN0IHJ0ID0gbmV3IFNldCgpOwogICAgZm9yIChjb25zdCBpdGVtIG9mIGxocyl7CiAgICAgICAgaWYgKHJocy5oYXMoaXRlbSkpIHJ0LmFkZChpdGVtKTsKICAgIH0KICAgIGZvciAoY29uc3QgaXRlbTEgb2YgcmhzKXsKICAgICAgICBpZiAobGhzLmhhcyhpdGVtMSkpIHJ0LmFkZChpdGVtMSk7CiAgICB9CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gc2V0RXF1YWwobGhzLCByaHMpIHsKICAgIHJldHVybiBsaHMuc2l6ZSA9PT0gcmhzLnNpemUgJiYgWwogICAgICAgIC4uLmxocwogICAgXS5ldmVyeSgodik9PnJocy5oYXModikpOwp9CmZ1bmN0aW9uIHBhcnNlSGVhZGVyRmlsdGVyKGhlYWRlcikgewogICAgY29uc3QgaSA9IGhlYWRlci5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaSA8IDApIHJldHVybiB7CiAgICAgICAga2V5OiBoZWFkZXIKICAgIH07CiAgICBjb25zdCBrZXkgPSBoZWFkZXIuc3Vic3RyaW5nKDAsIGkpLnRyaW0oKTsKICAgIGNvbnN0IHF1ZXJ5MSA9IGhlYWRlci5zdWJzdHJpbmcoaSArIDEpLnRyaW0oKTsKICAgIHJldHVybiB7CiAgICAgICAga2V5LAogICAgICAgIHF1ZXJ5OiBxdWVyeTEKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMgPSBuZXcgU2V0KFsKICAgICdvdXRjb21lJywKICAgICdzY3JpcHROYW1lJywKICAgICdleGNlcHRpb25zJywKICAgICdsb2dzJywKICAgICdldmVudFRpbWVzdGFtcCcsCiAgICAnZXZlbnQnCl0pOwpjb25zdCBLTk9XTl9PVVRDT01FUyA9IG5ldyBTZXQoWwogICAgJ29rJywKICAgICdleGNlcHRpb24nLAogICAgJ2V4Y2VlZGVkQ3B1JywKICAgICdjYW5jZWxlZCcsCiAgICAndW5rbm93bicKXSk7CmZ1bmN0aW9uIHBhcnNlVGFpbE1lc3NhZ2Uob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGFpbE1lc3NhZ2U6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IG91dGNvbWUgLCBzY3JpcHROYW1lICwgZXZlbnRUaW1lc3RhbXAgIH0gPSBvYmpBc0FueTsKICAgIGlmICghS05PV05fT1VUQ09NRVMuaGFzKG91dGNvbWUpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBvdXRjb21lOiBleHBlY3RlZCBvbmUgb2YgWyR7WwogICAgICAgIC4uLktOT1dOX09VVENPTUVTCiAgICBdLmpvaW4oJywgJyl9XSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvdXRjb21lKX1gKTsKICAgIGlmIChzY3JpcHROYW1lICE9PSBudWxsICYmIHR5cGVvZiBzY3JpcHROYW1lICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKGBCYWQgc2NyaXB0TmFtZTogZXhwZWN0ZWQgc3RyaW5nIG9yIG51bGwsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkoc2NyaXB0TmFtZSl9YCk7CiAgICBjb25zdCBsb2dzID0gcGFyc2VMb2dzKG9iakFzQW55LmxvZ3MpOwogICAgY29uc3QgZXhjZXB0aW9ucyA9IHBhcnNlRXhjZXB0aW9ucyhvYmpBc0FueS5leGNlcHRpb25zKTsKICAgIGlmIChldmVudFRpbWVzdGFtcCA9PT0gbnVsbCAmJiBvYmpBc0FueS5ldmVudCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG91dGNvbWUsCiAgICAgICAgICAgIHNjcmlwdE5hbWUsCiAgICAgICAgICAgIGV4Y2VwdGlvbnMsCiAgICAgICAgICAgIGxvZ3MsCiAgICAgICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICBldmVudDogbnVsbAogICAgICAgIH07CiAgICB9CiAgICBpZiAoISh0eXBlb2YgZXZlbnRUaW1lc3RhbXAgPT09ICdudW1iZXInICYmIGV2ZW50VGltZXN0YW1wID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIGV2ZW50VGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkoZXZlbnRUaW1lc3RhbXApfWApOwogICAgY29uc3QgZXZlbnQgPSBvYmpBc0FueS5ldmVudCAmJiBvYmpBc0FueS5ldmVudC5yZXF1ZXN0ID8gcGFyc2VUYWlsTWVzc2FnZVJlcXVlc3RFdmVudChvYmpBc0FueS5ldmVudCkgOiBwYXJzZVRhaWxNZXNzYWdlQ3JvbkV2ZW50KG9iakFzQW55LmV2ZW50KTsKICAgIHJldHVybiB7CiAgICAgICAgb3V0Y29tZSwKICAgICAgICBzY3JpcHROYW1lLAogICAgICAgIGV4Y2VwdGlvbnMsCiAgICAgICAgbG9ncywKICAgICAgICBldmVudFRpbWVzdGFtcCwKICAgICAgICBldmVudAogICAgfTsKfQpmdW5jdGlvbiBwYXJzZUxvZ3Mob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbG9nczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlTG9nKTsKfQpmdW5jdGlvbiBwYXJzZUV4Y2VwdGlvbnMob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgZXhjZXB0aW9uczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlRXhjZXB0aW9uKTsKfQpmdW5jdGlvbiBpc0xvZ01lc3NhZ2VQYXJ0KHZhbHVlKSB7CiAgICBjb25zdCB0ID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuIHQgPT09ICdzdHJpbmcnIHx8IHQgPT09ICdudW1iZXInIHx8IHQgPT09ICdib29sZWFuJyB8fCB0ID09PSAndW5kZWZpbmVkJyB8fCB0ID09PSAnb2JqZWN0JzsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMgPSBuZXcgU2V0KFsKICAgICdtZXNzYWdlJywKICAgICdsZXZlbCcsCiAgICAndGltZXN0YW1wJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUxvZyhvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUxvZzogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCBtZXNzYWdlID0gcGFyc2VMb2dNZXNzYWdlUGFydEFycmF5KG9iakFzQW55Lm1lc3NhZ2UsICdtZXNzYWdlJyk7CiAgICBjb25zdCB7IGxldmVsICwgdGltZXN0YW1wICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgbGV2ZWwgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbGV2ZWw6IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJHtKU09OLnN0cmluZ2lmeShsZXZlbCl9YCk7CiAgICBpZiAoISh0eXBlb2YgdGltZXN0YW1wID09PSAnbnVtYmVyJyAmJiB0aW1lc3RhbXAgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodGltZXN0YW1wKX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgbWVzc2FnZSwKICAgICAgICBsZXZlbCwKICAgICAgICB0aW1lc3RhbXAKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VYQ0VQVElPTl9LRVlTID0gbmV3IFNldChbCiAgICAnbmFtZScsCiAgICAnbWVzc2FnZScsCiAgICAndGltZXN0YW1wJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUV4Y2VwdGlvbihvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUV4Y2VwdGlvbjogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVhDRVBUSU9OX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IG5hbWUgLCBtZXNzYWdlICwgdGltZXN0YW1wICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBuYW1lOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobmFtZSl9YCk7CiAgICBpZiAoISh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBtZXNzYWdlOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobWVzc2FnZSl9YCk7CiAgICBpZiAoISh0eXBlb2YgdGltZXN0YW1wID09PSAnbnVtYmVyJyAmJiB0aW1lc3RhbXAgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodGltZXN0YW1wKX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgbmFtZSwKICAgICAgICBtZXNzYWdlLAogICAgICAgIHRpbWVzdGFtcAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTID0gbmV3IFNldChbCiAgICAnY3JvbicsCiAgICAnc2NoZWR1bGVkVGltZScKXSk7CmZ1bmN0aW9uIGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIGZhbHNlOwogICAgY29uc3Qga2V5cyA9IG5ldyBTZXQoT2JqZWN0LmtleXMob2JqKSk7CiAgICByZXR1cm4gc2V0RXF1YWwoa2V5cywgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0NST05fRVZFTlRfS0VZUyk7Cn0KZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUNyb25FdmVudChvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUNyb25FdmVudDogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyBjcm9uICwgc2NoZWR1bGVkVGltZSAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIGNyb24gPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY3JvbjogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KGNyb24pfWApOwogICAgaWYgKCEodHlwZW9mIHNjaGVkdWxlZFRpbWUgPT09ICdudW1iZXInICYmIHNjaGVkdWxlZFRpbWUgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgc2NoZWR1bGVkVGltZTogZXhwZWN0ZWQgcG9zaXRpdmUgbnVtYmVyLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHNjaGVkdWxlZFRpbWUpfWApOwogICAgcmV0dXJuIHsKICAgICAgICBjcm9uLAogICAgICAgIHNjaGVkdWxlZFRpbWUKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX1JFUVVFU1RfRVZFTlRfS0VZUyA9IG5ldyBTZXQoWwogICAgJ3JlcXVlc3QnCl0pOwpjb25zdCBPUFRJT05BTF9UQUlMX01FU1NBR0VfUkVRVUVTVF9FVkVOVF9LRVlTID0gbmV3IFNldChbCiAgICAncmVzcG9uc2UnCl0pOwpjb25zdCBBTExfVEFJTF9NRVNTQUdFX1JFUVVFU1RfRVZFTlRfS0VZUyA9IHNldFVuaW9uKFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMsIE9QVElPTkFMX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMpOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMsIEFMTF9UQUlMX01FU1NBR0VfUkVRVUVTVF9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgcmVxdWVzdCA9IHBhcnNlVGFpbE1lc3NhZ2VFdmVudFJlcXVlc3Qob2JqQXNBbnkucmVxdWVzdCk7CiAgICBjb25zdCByZXNwb25zZSA9IHBhcnNlVGFpbE1lc3NhZ2VFdmVudFJlc3BvbnNlKG9iakFzQW55LnJlc3BvbnNlKTsKICAgIHJldHVybiB7CiAgICAgICAgcmVxdWVzdCwKICAgICAgICByZXNwb25zZQogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAndXJsJywKICAgICdtZXRob2QnLAogICAgJ2hlYWRlcnMnCl0pOwpjb25zdCBPUFRJT05BTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAnY2YnCl0pOwpjb25zdCBBTExfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyA9IHNldFVuaW9uKFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIE9QVElPTkFMX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMpOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIEFMTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyB1cmwgLCBtZXRob2QgIH0gPSBvYmpBc0FueTsKICAgIGlmICghKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdXJsOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodXJsKX1gKTsKICAgIGlmICghKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbWV0aG9kOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobWV0aG9kKX1gKTsKICAgIGNvbnN0IGhlYWRlcnMgPSBwYXJzZVN0cmluZ1JlY29yZChvYmpBc0FueS5oZWFkZXJzLCAnaGVhZGVycycpOwogICAgY29uc3QgY2YgPSBvYmpBc0FueS5jZiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqQXNBbnkuY2YpOwogICAgcmV0dXJuIHsKICAgICAgICB1cmwsCiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgY2YKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VWRU5UX1JFU1BPTlNFX0tFWVMgPSBuZXcgU2V0KFsKICAgICdzdGF0dXMnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXZlbnRSZXNwb25zZShvYmopIHsKICAgIGlmIChvYmogPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUV2ZW50UmVzcG9uc2U6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VWRU5UX1JFU1BPTlNFX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IHN0YXR1cyAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIHN0YXR1cyA9PT0gJ251bWJlcicpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBzdGF0dXM6IGV4cGVjdGVkIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShzdGF0dXMpfWApOwogICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXMKICAgIH07Cn0KZnVuY3Rpb24gY2hlY2tLZXlzKG9iaiwgcmVxdWlyZWRLZXlzLCBhbGxLZXlzKSB7CiAgICBjb25zdCBrZXlzID0gbmV3IFNldChPYmplY3Qua2V5cyhvYmopKTsKICAgIGNvbnN0IG1pc3NpbmdLZXlzID0gc2V0U3VidHJhY3QocmVxdWlyZWRLZXlzLCBrZXlzKTsKICAgIGlmIChtaXNzaW5nS2V5cy5zaXplID4gMCkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGtleXM6ICR7WwogICAgICAgIC4uLm1pc3NpbmdLZXlzCiAgICBdLmpvaW4oJywgJyl9YCk7CiAgICBjb25zdCBleHRyYUtleXMgPSBzZXRTdWJ0cmFjdChrZXlzLCBhbGxLZXlzIHx8IHJlcXVpcmVkS2V5cyk7CiAgICBpZiAoZXh0cmFLZXlzLnNpemUgPiAwKSB0aHJvdyBuZXcgRXJyb3IoYEV4dHJhIGtleXM6ICR7WwogICAgICAgIC4uLmV4dHJhS2V5cwogICAgXS5qb2luKCcsICcpfWApOwp9CmZ1bmN0aW9uIHBhcnNlU3RyaW5nUmVjb3JkKG9iaiwgbmFtZSkgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIHN0cmluZyByZWNvcmQsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGZvciAoY29uc3QgW18sIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYmopKXsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lfTogRXhwZWN0ZWQgc3RyaW5nIHJlY29yZCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgfQogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBwYXJzZUxvZ01lc3NhZ2VQYXJ0QXJyYXkob2JqLCBuYW1lKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lfTogRXhwZWN0ZWQgbG9nIG1lc3NhZ2UgcGFydCBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgZm9yIChjb25zdCB2YWx1ZSBvZiBvYmopewogICAgICAgIGlmICghaXNMb2dNZXNzYWdlUGFydCh2YWx1ZSkpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIGxvZyBtZXNzYWdlIHBhcnQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIH0KICAgIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY2Y6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBkdW1wTWVzc2FnZVByZXR0eShtZXNzYWdlLCBsb2dnZXIsIGFkZGl0aW9uYWxMb2dzID0gW10pIHsKICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKG1lc3NhZ2UuZXZlbnRUaW1lc3RhbXApKTsKICAgIGNvbnN0IG91dGNvbWUgPSBQUkVUVFlfT1VUQ09NRVMuZ2V0KG1lc3NhZ2Uub3V0Y29tZSkgfHwgbWVzc2FnZS5vdXRjb21lOwogICAgY29uc3Qgb3V0Y29tZUNvbG9yID0gbWVzc2FnZS5vdXRjb21lID09PSAnb2snID8gJ2dyZWVuJyA6ICdyZWQnOwogICAgY29uc3QgeyBwcm9wcyAsIHJlbWFpbmluZ0xvZ3MgIH0gPSBwYXJzZUxvZ1Byb3BzKG1lc3NhZ2UubG9ncyk7CiAgICBpZiAoaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlLmV2ZW50KSkgewogICAgICAgIGNvbnN0IGNvbG8gPSBwcm9wcy5jb2xvIHx8ICc/Pz8nOwogICAgICAgIGxvZ2dlcihgWyVjJHt0aW1lfSVjXSBbJWMke2NvbG99JWNdIFslYyR7b3V0Y29tZX0lY10gJWMke21lc3NhZ2UuZXZlbnQuY3Jvbn1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IG1ldGhvZCAsIHVybCAsIGNmICB9ID0gbWVzc2FnZS5ldmVudCA9PT0gbnVsbCA/IHsKICAgICAgICAgICAgbWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIHVybDogdW5kZWZpbmVkLAogICAgICAgICAgICBjZjogdW5kZWZpbmVkCiAgICAgICAgfSA6IG1lc3NhZ2UuZXZlbnQucmVxdWVzdDsKICAgICAgICBjb25zdCB1bnJlZGFjdGVkVXJsID0gdHlwZW9mIHByb3BzLnVybCA9PT0gJ3N0cmluZycgPyBwcm9wcy51cmwgOiB1cmw7CiAgICAgICAgY29uc3QgY29sbyA9IGNmPy5jb2xvIHx8IHByb3BzLmNvbG8gfHwgJz8/Pyc7CiAgICAgICAgaWYgKGNmID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc3QgeyBkdXJhYmxlT2JqZWN0Q2xhc3MgLCBkdXJhYmxlT2JqZWN0TmFtZSAsIGR1cmFibGVPYmplY3RJZCAgfSA9IGNvbXB1dGVEdXJhYmxlT2JqZWN0SW5mbyhwcm9wcyk7CiAgICAgICAgICAgIGNvbnN0IGRvVGVtcGxhdGVzID0gW107CiAgICAgICAgICAgIGNvbnN0IGRvU3R5bGVzID0gW107CiAgICAgICAgICAgIGlmIChkdXJhYmxlT2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGRvVGVtcGxhdGVzLnB1c2goYCVjJHtkdXJhYmxlT2JqZWN0Q2xhc3N9JWNgKTsKICAgICAgICAgICAgICAgIGRvU3R5bGVzLnB1c2goYGNvbG9yOiBncmF5OyB4LWR1cmFibGUtb2JqZWN0LWNsYXNzOiAnJHtkdXJhYmxlT2JqZWN0Q2xhc3N9J2AsICcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZHVyYWJsZU9iamVjdE5hbWUpIHsKICAgICAgICAgICAgICAgIGRvVGVtcGxhdGVzLnB1c2goYCVjJHtkdXJhYmxlT2JqZWN0TmFtZX0lY2ApOwogICAgICAgICAgICAgICAgZG9TdHlsZXMucHVzaChgY29sb3I6IGdyYXk7IHgtZHVyYWJsZS1vYmplY3QtbmFtZTogJyR7ZHVyYWJsZU9iamVjdE5hbWV9J2AsICcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZHVyYWJsZU9iamVjdElkKSB7CiAgICAgICAgICAgICAgICBkb1RlbXBsYXRlcy5wdXNoKGAlYyR7Y29tcHV0ZVNob3J0RHVyYWJsZU9iamVjdElkKGR1cmFibGVPYmplY3RJZCl9JWNgKTsKICAgICAgICAgICAgICAgIGRvU3R5bGVzLnB1c2goYGNvbG9yOiBncmF5OyB4LWR1cmFibGUtb2JqZWN0LWlkOiAnJHtkdXJhYmxlT2JqZWN0SWR9J2AsICcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9UZW1wbGF0ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBkb1RlbXBsYXRlcy5wdXNoKGAlY0RPJWNgKTsKICAgICAgICAgICAgICAgIGRvU3R5bGVzLnB1c2goJ2NvbG9yOiBncmF5JywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtZXNzYWdlLmV2ZW50ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIoYFslYyR7dGltZX0lY10gWyVjJHtjb2xvfSVjXSBbJWMke291dGNvbWV9JWNdIFske2RvVGVtcGxhdGVzLmpvaW4oJyAnKX1dIEFMQVJNYCwgJ2NvbG9yOiBncmF5JywgJycsICdjb2xvcjogZ3JheScsICcnLCBgY29sb3I6ICR7b3V0Y29tZUNvbG9yfWAsICcnLCAuLi5kb1N0eWxlcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dnZXIoYFslYyR7dGltZX0lY10gWyVjJHtjb2xvfSVjXSBbJWMke291dGNvbWV9JWNdIFske2RvVGVtcGxhdGVzLmpvaW4oJyAnKX1dICR7bWV0aG9kfSAlYyR7dW5yZWRhY3RlZFVybH1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsIC4uLmRvU3R5bGVzLCAnY29sb3I6IHJlZDsgZm9udC1zdHlsZTogYm9sZDsnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvZ2dlcihgWyVjJHt0aW1lfSVjXSBbJWMke2NvbG99JWNdIFslYyR7b3V0Y29tZX0lY10gJHttZXRob2R9ICVjJHt1bnJlZGFjdGVkVXJsfWAsICdjb2xvcjogZ3JheScsICcnLCAnY29sb3I6IGdyYXknLCAnJywgYGNvbG9yOiAke291dGNvbWVDb2xvcn1gLCAnJywgJ2NvbG9yOiByZWQ7IGZvbnQtc3R5bGU6IGJvbGQ7Jyk7CiAgICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCB7IGRhdGE6IGRhdGEyICB9IG9mIGFkZGl0aW9uYWxMb2dzKXsKICAgICAgICBsb2dnZXIoLi4uZGF0YTIpOwogICAgfQogICAgZm9yIChjb25zdCB7IGxldmVsICwgbWVzc2FnZTogbG9nTWVzc2FnZSAgfSBvZiByZW1haW5pbmdMb2dzKXsKICAgICAgICBjb25zdCBsZXZlbENvbG9yID0gTE9HX0xFVkVMX0NPTE9SUy5nZXQobGV2ZWwpIHx8ICdncmF5JzsKICAgICAgICBjb25zdCBsb2dNZXNzYWdlcyA9IGxvZ01lc3NhZ2UubWFwKGZvcm1hdExvZ01lc3NhZ2VQYXJ0KS5qb2luKCcsICcpOwogICAgICAgIGxvZ2dlcihgICVjfCVjIFslYyR7bGV2ZWx9JWNdICR7bG9nTWVzc2FnZXN9YCwgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtsZXZlbENvbG9yfWAsICcnKTsKICAgIH0KICAgIGZvciAoY29uc3QgeyBuYW1lICwgbWVzc2FnZTogZXhjZXB0aW9uTWVzc2FnZSAgfSBvZiBtZXNzYWdlLmV4Y2VwdGlvbnMpewogICAgICAgIGxvZ2dlcihgICVjfCVjIFslYyR7bmFtZX0lY10gJWMke2V4Y2VwdGlvbk1lc3NhZ2V9YCwgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkYCwgJycsICdjb2xvcjogcmVkJyk7CiAgICB9CiAgICBpZiAobWVzc2FnZS5ldmVudCAhPT0gbnVsbCAmJiAhaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlLmV2ZW50KSkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbWVzc2FnZS5ldmVudC5yZXNwb25zZTsKICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgbG9nZ2VyKGAgJWN8JWMgWyVjcmVzJWNdICVjJHtyZXNwb25zZS5zdGF0dXN9YCwgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogZ3JheWAsICcnLCAnY29sb3I6IGdyYXknKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhkYXRlKSB7CiAgICByZXR1cm4gWwogICAgICAgIGRhdGUuZ2V0RnVsbFllYXIoKSwKICAgICAgICAnLScsCiAgICAgICAgcGFkMihkYXRlLmdldE1vbnRoKCkgKyAxKSwKICAgICAgICAnLScsCiAgICAgICAgcGFkMihkYXRlLmdldERhdGUoKSksCiAgICAgICAgJyAnLAogICAgICAgIHBhZDIoZGF0ZS5nZXRIb3VycygpKSwKICAgICAgICAnOicsCiAgICAgICAgcGFkMihkYXRlLmdldE1pbnV0ZXMoKSksCiAgICAgICAgJzonLAogICAgICAgIHBhZDIoZGF0ZS5nZXRTZWNvbmRzKCkpCiAgICBdLmpvaW4oJycpOwp9CmZ1bmN0aW9uIHBhcnNlTG9nUHJvcHMobG9ncykgewogICAgY29uc3QgcmVtYWluaW5nTG9ncyA9IFtdOwogICAgY29uc3QgcHJvcHMgPSB7fTsKICAgIGZvciAoY29uc3QgbG9nIG9mIGxvZ3MpewogICAgICAgIGlmIChsb2cubWVzc2FnZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGxvZy5tZXNzYWdlWzBdOwogICAgICAgICAgICBpZiAodHlwZW9mIG1zZyA9PT0gJ3N0cmluZycgJiYgbXNnLnN0YXJ0c1dpdGgoJ2xvZ3Byb3BzOicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFpbGVyID0gbXNnLnN1YnN0cmluZyhtc2cuaW5kZXhPZignOicpICsgMSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFpbGVyUHJvcHMgPSB0cnlQYXJzZVByb3BzRnJvbUpzb24odHJhaWxlcik7CiAgICAgICAgICAgICAgICBhcHBlbmRQcm9wcyh0cmFpbGVyUHJvcHMsIHByb3BzKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBsb2cubWVzc2FnZS5zbGljZSgxKSl7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydFByb3BzID0gdHJ5UGFyc2VQcm9wc0Zyb21QYXJ0KHBhcnQpOwogICAgICAgICAgICAgICAgICAgIGFwcGVuZFByb3BzKHBhcnRQcm9wcywgcHJvcHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVtYWluaW5nTG9ncy5wdXNoKGxvZyk7CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHByb3BzLAogICAgICAgIHJlbWFpbmluZ0xvZ3MKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUR1cmFibGVPYmplY3RJbmZvKHByb3BzKSB7CiAgICBjb25zdCBkdXJhYmxlT2JqZWN0Q2xhc3MgPSB1bmRlZmluZWRJZkVtcHR5KCh0eXBlb2YgcHJvcHMuZHVyYWJsZU9iamVjdENsYXNzID09PSAnc3RyaW5nJyA/IHByb3BzLmR1cmFibGVPYmplY3RDbGFzcyA6ICcnKS50cmltKCkpOwogICAgY29uc3QgZHVyYWJsZU9iamVjdElkID0gdW5kZWZpbmVkSWZFbXB0eSgodHlwZW9mIHByb3BzLmR1cmFibGVPYmplY3RJZCA9PT0gJ3N0cmluZycgPyBwcm9wcy5kdXJhYmxlT2JqZWN0SWQgOiAnJykudHJpbSgpKTsKICAgIGNvbnN0IGR1cmFibGVPYmplY3ROYW1lID0gdW5kZWZpbmVkSWZFbXB0eSgodHlwZW9mIHByb3BzLmR1cmFibGVPYmplY3ROYW1lID09PSAnc3RyaW5nJyA/IHByb3BzLmR1cmFibGVPYmplY3ROYW1lIDogJycpLnRyaW0oKSk7CiAgICByZXR1cm4gewogICAgICAgIGR1cmFibGVPYmplY3RDbGFzcywKICAgICAgICBkdXJhYmxlT2JqZWN0SWQsCiAgICAgICAgZHVyYWJsZU9iamVjdE5hbWUKICAgIH07Cn0KZnVuY3Rpb24gdW5kZWZpbmVkSWZFbXB0eShzdHIpIHsKICAgIHJldHVybiBzdHIgPT09ICcnID8gdW5kZWZpbmVkIDogc3RyOwp9CmZ1bmN0aW9uIGNvbXB1dGVTaG9ydER1cmFibGVPYmplY3RJZChpZCkgewogICAgcmV0dXJuIC9eWzAtOWEtZkEtRl17NSx9JC8udGVzdChpZCkgPyBgJHtpZC5zdWJzdHJpbmcoMCwgNCl94oCmYCA6IGlkOwp9CmZ1bmN0aW9uIGFwcGVuZFByb3BzKHNyYywgZHN0KSB7CiAgICBpZiAoc3JjKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoc3JjKSl7CiAgICAgICAgICAgIGRzdFtrZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIHRyeVBhcnNlUHJvcHNGcm9tSnNvbih2YWx1ZSkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9wcyA9IEpTT04ucGFyc2UodmFsdWUudHJpbSgpKTsKICAgICAgICBpZiAodHlwZW9mIHByb3BzID09PSAnb2JqZWN0JyAmJiBwcm9wcyAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwcm9wcykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb3BzOwogICAgICAgIH0KICAgIH0gY2F0Y2ggIHt9CiAgICByZXR1cm4gdW5kZWZpbmVkOwp9CmZ1bmN0aW9uIHRyeVBhcnNlUHJvcHNGcm9tUGFydChwYXJ0KSB7CiAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2YgcGFydCA9PT0gJ29iamVjdCcgJiYgcGFydCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwYXJ0KSkgewogICAgICAgICAgICByZXR1cm4gcGFydDsKICAgICAgICB9CiAgICB9IGNhdGNoICB7fQogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBmb3JtYXRMb2dNZXNzYWdlUGFydChwYXJ0KSB7CiAgICBpZiAodHlwZW9mIHBhcnQgPT09ICdvYmplY3QnKSByZXR1cm4gSlNPTi5zdHJpbmdpZnkocGFydCk7CiAgICByZXR1cm4gYCR7cGFydH1gOwp9CmZ1bmN0aW9uIHBhZDIobnVtKSB7CiAgICByZXR1cm4gbnVtLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKfQpjb25zdCBQUkVUVFlfT1VUQ09NRVMgPSBuZXcgTWFwKFsKICAgIFsKICAgICAgICAnb2snLAogICAgICAgICdPaycKICAgIF0sCiAgICBbCiAgICAgICAgJ2V4Y2VwdGlvbicsCiAgICAgICAgJ0Vycm9yJwogICAgXSwKICAgIFsKICAgICAgICAnZXhjZWVkZWRDcHUnLAogICAgICAgICdFeGNlZWRlZCBMaW1pdCcKICAgIF0sCiAgICBbCiAgICAgICAgJ2NhbmNlbGVkJywKICAgICAgICAnQ2FuY2VsZWQnCiAgICBdLAogICAgWwogICAgICAgICd1bmtub3duJywKICAgICAgICAnVW5rbm93bicKICAgIF0sIApdKTsKY29uc3QgTE9HX0xFVkVMX0NPTE9SUyA9IG5ldyBNYXAoWwogICAgWwogICAgICAgICd0cmFjZScsCiAgICAgICAgJ2dyYXknCiAgICBdLAogICAgWwogICAgICAgICdkZWJ1ZycsCiAgICAgICAgJ3B1cnBsZScKICAgIF0sCiAgICBbCiAgICAgICAgJ2xvZycsCiAgICAgICAgJ2dyYXknCiAgICBdLAogICAgWwogICAgICAgICdpbmZvJywKICAgICAgICAnZ3JheScKICAgIF0sCiAgICBbCiAgICAgICAgJ3dhcm4nLAogICAgICAgICdyZWQnCiAgICBdLAogICAgWwogICAgICAgICdlcnJvcicsCiAgICAgICAgJ3JlZCcKICAgIF0sIApdKTsKY2xhc3MgVGFpbENvbm5lY3Rpb24gewogICAgc3RhdGljIFZFUkJPU0UgPSBmYWxzZTsKICAgIHdzOwogICAgY2FsbGJhY2tzOwogICAgb3B0aW9uczsKICAgIGhlYXJ0YmVhdElkOwogICAgY29uc3RydWN0b3Iod2ViU29ja2V0VXJsLCBjYWxsYmFja3MsIG9wdHMpewogICAgICAgIHRoaXMud3MgPSBuZXcgV2ViU29ja2V0KHdlYlNvY2tldFVybCwgJ3RyYWNlLXYxJyk7CiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7CiAgICAgICAgY29uc3QgeyB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzICB9ID0gb3B0czsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIHRoaXMuc2VuZE9wdGlvbnNJZk9wZW4oKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbk9wZW4pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vbk9wZW4odGhpcywgdGltZVN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCBgc2VuZGluZyB3cyBwaW5nIHt9IGV2ZXJ5ICR7d2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kc31gKTsKICAgICAgICAgICAgICAgIHRoaXMuaGVhcnRiZWF0SWQgPSBzZXRJbnRlcnZhbCgoKT0+ewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLndzLnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCBgc2VuZGluZyB3cyBwaW5nIHt9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud3Muc2VuZCgne30nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzICogMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IGNvZGUgLCByZWFzb24gLCB3YXNDbGVhbiAsIHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICBpZiAoVGFpbENvbm5lY3Rpb24uVkVSQk9TRSkgY29uc29sZS5sb2coZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhuZXcgRGF0ZSgpKSwgJ1RhaWxDb25uZWN0aW9uOiB3cyBjbG9zZScsIHsKICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICByZWFzb24sCiAgICAgICAgICAgICAgICB3YXNDbGVhbiwKICAgICAgICAgICAgICAgIHRpbWVTdGFtcAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmhlYXJ0YmVhdElkKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbkNsb3NlKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25DbG9zZSh0aGlzLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIChldmVudCk9PnsKICAgICAgICAgICAgY29uc3QgeyB0aW1lU3RhbXAgIH0gPSBldmVudDsKICAgICAgICAgICAgY29uc3QgZXJyb3JJbmZvID0gY29tcHV0ZUVycm9ySW5mbyhldmVudCk7CiAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCAnVGFpbENvbm5lY3Rpb246IHdzIGVycm9yJywgZXJyb3JJbmZvKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbkVycm9yKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25FcnJvcih0aGlzLCB0aW1lU3RhbXAsIGVycm9ySW5mbyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBhc3luYyAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIGlmIChldmVudC5kYXRhIGluc3RhbmNlb2YgQmxvYikgewogICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGV2ZW50LmRhdGEudGV4dCgpOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZSh0ZXh0KTsKICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcGFyc2VUYWlsTWVzc2FnZShvYmopOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblVucGFyc2VkTWVzc2FnZSh0aGlzLCB0aW1lU3RhbXAsIG9iaiwgZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbE1lc3NhZ2UodGhpcywgdGltZVN0YW1wLCBtZXNzYWdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblVucGFyc2VkTWVzc2FnZSh0aGlzLCB0aW1lU3RhbXAsIGV2ZW50LmRhdGEsIG5ldyBFcnJvcihgRXhwZWN0ZWQgZXZlbnQuZGF0YSB0byBiZSBCbG9iYCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMuc2VuZE9wdGlvbnNJZk9wZW4oKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb3NlKGNvZGUsIHJlYXNvbikgewogICAgICAgIHRoaXMud3MuY2xvc2UoY29kZSwgcmVhc29uKTsKICAgIH0KICAgIHNlbmRPcHRpb25zSWZPcGVuKCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy53cy5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikgewogICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgaWYgKFRhaWxDb25uZWN0aW9uLlZFUkJPU0UpIGNvbnNvbGUubG9nKGBzZW5kT3B0aW9uc0lmT3Blbjogc2VuZGluZyAke3BheWxvYWR9YCk7CiAgICAgICAgICAgIHRoaXMud3Muc2VuZChwYXlsb2FkKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gY29tcHV0ZUVycm9ySW5mbyhldmVudCkgewogICAgaWYgKGV2ZW50LnR5cGUgPT09ICdlcnJvcicpIHsKICAgICAgICBjb25zdCB7IG1lc3NhZ2UgLCBmaWxlbmFtZSAsIGxpbmVubyAsIGNvbG5vICwgZXJyb3IgIH0gPSBldmVudDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtZXNzYWdlLAogICAgICAgICAgICBmaWxlbmFtZSwKICAgICAgICAgICAgbGluZW5vLAogICAgICAgICAgICBjb2xubywKICAgICAgICAgICAgZXJyb3IKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBnZW5lcmF0ZVV1aWQoKSB7CiAgICBjb25zdCBjcnlwdG9Bc0FueSA9IGNyeXB0bzsKICAgIGlmICh0eXBlb2YgY3J5cHRvQXNBbnkucmFuZG9tVVVJRCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBjcnlwdG9Bc0FueS5yYW5kb21VVUlEKCk7CiAgICB9CiAgICBjb25zdCBybmRzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxNikpOwogICAgcm5kc1s2XSA9IHJuZHNbNl0gJiAweDBmIHwgMHg0MDsKICAgIHJuZHNbOF0gPSBybmRzWzhdICYgMHgzZiB8IDB4ODA7CiAgICByZXR1cm4gYnl0ZXNUb1V1aWQocm5kcyk7Cn0KZnVuY3Rpb24gYnl0ZXNUb1V1aWQoYnl0ZXMpIHsKICAgIGNvbnN0IGJpdHMgPSBbCiAgICAgICAgLi4uYnl0ZXMKICAgIF0ubWFwKChiaXQpPT57CiAgICAgICAgY29uc3QgcyA9IGJpdC50b1N0cmluZygxNik7CiAgICAgICAgcmV0dXJuIGJpdCA8IDB4MTAgPyAiMCIgKyBzIDogczsKICAgIH0pOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5iaXRzLnNsaWNlKDAsIDQpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDQsIDYpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDYsIDgpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDgsIDEwKSwKICAgICAgICAiLSIsCiAgICAgICAgLi4uYml0cy5zbGljZSgxMCwgMTYpLCAKICAgIF0uam9pbigiIik7Cn0KZnVuY3Rpb24gY2hlY2tFcXVhbChuYW1lLCB2YWx1ZSwgZXhwZWN0ZWQpIHsKICAgIGlmICh2YWx1ZSAhPT0gZXhwZWN0ZWQpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IGV4cGVjdGVkICR7ZXhwZWN0ZWR9LCBmb3VuZCAke3ZhbHVlfWApOwp9CmZ1bmN0aW9uIGNoZWNrTWF0Y2hlcyhuYW1lLCB2YWx1ZSwgcGF0dGVybikgewogICAgaWYgKCFwYXR0ZXJuLnRlc3QodmFsdWUpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCAke25hbWV9OiAke3ZhbHVlfWApOwogICAgcmV0dXJuIHZhbHVlOwp9CmNsYXNzIEdyYXBocWxRdWVyeSB7CiAgICBfcGFyZW50OwogICAgX25vZGVzOwogICAgX25vZGVPcmRlcjsKICAgIF9hcmdzOwogICAgX2FyZ09yZGVyOwogICAgY29uc3RydWN0b3IocGFyZW50LCBub2Rlcywgbm9kZU9yZGVyLCBhcmdzLCBhcmdPcmRlcil7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50OwogICAgICAgIHRoaXMuX25vZGVzID0gbm9kZXM7CiAgICAgICAgdGhpcy5fbm9kZU9yZGVyID0gbm9kZU9yZGVyOwogICAgICAgIHRoaXMuX2FyZ3MgPSBhcmdzOwogICAgICAgIHRoaXMuX2FyZ09yZGVyID0gYXJnT3JkZXI7CiAgICB9CiAgICBzdGF0aWMgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgR3JhcGhxbFF1ZXJ5KFtdLCBuZXcgTWFwKCksIFtdLCBuZXcgTWFwKCksIFtdKTsKICAgIH0KICAgIHNjYWxhcihuYW1lKSB7CiAgICAgICAgdGhpcy5hZGQobmFtZSwgTm9kZUtpbmQuU2NhbGFyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG9iamVjdChuYW1lKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYWRkKG5hbWUsIE5vZGVLaW5kLk9iamVjdCk7CiAgICAgICAgY29uc3QgcnQgPSBuZXcgR3JhcGhxbFF1ZXJ5KFsKICAgICAgICAgICAgdGhpcwogICAgICAgIF0sIG5ldyBNYXAoKSwgW10sIG5ldyBNYXAoKSwgW10pOwogICAgICAgIG5vZGUucXVlcnkucHVzaChydCk7CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQogICAgb2JqZWN0UXVlcnkobmFtZSwgcXVlcnkyKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYWRkKG5hbWUsIE5vZGVLaW5kLk9iamVjdCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5Mi5jb3B5V2l0aFBhcmVudCh0aGlzKTsKICAgICAgICBjb25zdCBydCA9IHE7CiAgICAgICAgbm9kZS5xdWVyeS5wdXNoKHJ0KTsKICAgICAgICByZXR1cm4gcnQ7CiAgICB9CiAgICBhcmdSYXcobmFtZSwgcmF3VmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGRBcmcobmFtZSwgcmF3VmFsdWUpOwogICAgfQogICAgYXJnQm9vbGVhbihuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCB2YWx1ZSA/ICd0cnVlJyA6ICdmYWxzZScpOwogICAgfQogICAgYXJnTG9uZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgJHt2YWx1ZX1gKTsKICAgIH0KICAgIGFyZ1N0cmluZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgIiR7dmFsdWUucmVwbGFjZUFsbCgnIicsICdcXCInKX0iYCk7CiAgICB9CiAgICBhcmdPYmplY3QobmFtZSwgZmllbGROYW1lLCBmaWVsZFZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQXJnKG5hbWUsIGB7JHtmaWVsZE5hbWV9OiIke2ZpZWxkVmFsdWUucmVwbGFjZUFsbCgnIicsICdcXCInKX0ifWApOwogICAgfQogICAgYXJnVmFyaWFibGUobmFtZSwgdmFyaWFibGVOYW1lKSB7CiAgICAgICAgY2hlY2tNYXRjaGVzKCd2YXJpYWJsZU5hbWUnLCB2YXJpYWJsZU5hbWUsIC9eW2Etel0rJC8pOwogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgJCR7dmFyaWFibGVOYW1lfWApOwogICAgfQogICAgZW5kKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQubGVuZ3RoID4gMCA/IHRoaXMuX3BhcmVudFswXSA6IHRoaXM7CiAgICB9CiAgICB0b3AoKSB7CiAgICAgICAgbGV0IHJ0ID0gdGhpczsKICAgICAgICB3aGlsZShydC5fcGFyZW50Lmxlbmd0aCA+IDApewogICAgICAgICAgICBydCA9IHJ0Ll9wYXJlbnRbMF07CiAgICAgICAgfQogICAgICAgIHJldHVybiBydDsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICAgIGNvbnN0IGxpbmVzID0gW107CiAgICAgICAgbGluZXMucHVzaCgneycpOwogICAgICAgIHRoaXMud3JpdGUobGluZXMsIDEpOwogICAgICAgIGxpbmVzLnB1c2goJ30nKTsKICAgICAgICByZXR1cm4gbGluZXMuam9pbignXG4nKTsKICAgIH0KICAgIGFkZEFyZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLl9hcmdzLmhhcyhuYW1lKSkgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGUgYXJnOiAke25hbWV9YCk7CiAgICAgICAgdGhpcy5fYXJnT3JkZXIucHVzaChuYW1lKTsKICAgICAgICB0aGlzLl9hcmdzLnNldChuYW1lLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB3cml0ZShsaW5lcywgbGV2ZWwpIHsKICAgICAgICBjb25zdCBpbmRlbnQgPSAnICAnLnJlcGVhdChsZXZlbCk7CiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5fbm9kZU9yZGVyKXsKICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNoZWNrR2V0KCdfbm9kZXMnLCB0aGlzLl9ub2Rlcywga2V5KTsKICAgICAgICAgICAgaWYgKG5vZGUua2luZCA9PT0gTm9kZUtpbmQuU2NhbGFyKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGAke2luZGVudH0ke2tleX1gKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmtpbmQgPT09IE5vZGVLaW5kLk9iamVjdCkgewogICAgICAgICAgICAgICAgY29uc3QgcSA9IG5vZGUucXVlcnlbMF07CiAgICAgICAgICAgICAgICBsZXQgbGluZSA9IGAke2luZGVudH0ke2tleX1gOwogICAgICAgICAgICAgICAgaWYgKHEuX2FyZ09yZGVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcoJzsKICAgICAgICAgICAgICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBhcmdOYW1lIG9mIHEuX2FyZ09yZGVyKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPiAwKSBsaW5lICs9ICcsICc7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gYCR7YXJnTmFtZX06ICR7Y2hlY2tHZXQoJ3EuX2FyZ3MnLCBxLl9hcmdzLCBhcmdOYW1lKX1gOwogICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gJyknOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGluZSArPSAnIHsnOwogICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lKTsKICAgICAgICAgICAgICAgIG5vZGUucXVlcnlbMF0ud3JpdGUobGluZXMsIGxldmVsICsgMSk7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGAke2luZGVudH19YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEltcGxlbWVudCBub2RlIGtpbmQgJHtub2RlLmtpbmR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhZGQobmFtZSwga2luZCkgewogICAgICAgIGlmICh0aGlzLl9ub2Rlcy5oYXMobmFtZSkpIHRocm93IG5ldyBFcnJvcihgRHVwbGljYXRlIGZpZWxkOiAke25hbWV9YCk7CiAgICAgICAgY29uc3QgcnQgPSBuZXcgTm9kZTEoa2luZCk7CiAgICAgICAgdGhpcy5fbm9kZXMuc2V0KG5hbWUsIHJ0KTsKICAgICAgICB0aGlzLl9ub2RlT3JkZXIucHVzaChuYW1lKTsKICAgICAgICByZXR1cm4gcnQ7CiAgICB9CiAgICBjb3B5V2l0aFBhcmVudChwYXJlbnQpIHsKICAgICAgICBjb25zdCBub2RlcyA9IG5ldyBNYXAoKTsKICAgICAgICBjb25zdCBub2RlT3JkZXIgPSBbCiAgICAgICAgICAgIC4uLnRoaXMuX25vZGVPcmRlcgogICAgICAgIF07CiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBNYXAoKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9hcmdzLmVudHJpZXMoKSl7CiAgICAgICAgICAgIGFyZ3Muc2V0KGtleSwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmdPcmRlciA9IFsKICAgICAgICAgICAgLi4udGhpcy5fYXJnT3JkZXIKICAgICAgICBdOwogICAgICAgIGNvbnN0IHJ0ID0gbmV3IEdyYXBocWxRdWVyeShbCiAgICAgICAgICAgIHBhcmVudAogICAgICAgIF0sIG5vZGVzLCBub2RlT3JkZXIsIGFyZ3MsIGFyZ09yZGVyKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXkxLCBub2RlXSBvZiB0aGlzLl9ub2Rlcy5lbnRyaWVzKCkpewogICAgICAgICAgICBjb25zdCBuZXdOb2RlID0gbmV3IE5vZGUxKG5vZGUua2luZCk7CiAgICAgICAgICAgIGlmIChub2RlLnF1ZXJ5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1F1ZXJ5ID0gbm9kZS5xdWVyeVswXS5jb3B5V2l0aFBhcmVudChydCk7CiAgICAgICAgICAgICAgICBuZXdOb2RlLnF1ZXJ5LnB1c2gobmV3UXVlcnkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5vZGVzLnNldChrZXkxLCBuZXdOb2RlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQp9CmZ1bmN0aW9uIGNoZWNrR2V0KG1hcE5hbWUsIG1hcCwga2V5KSB7CiAgICBjb25zdCBydCA9IG1hcC5nZXQoa2V5KTsKICAgIGlmICghcnQpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bWFwTmFtZX0ua2V5OiAke2tleX1gKTsKICAgIHJldHVybiBydDsKfQp2YXIgTm9kZUtpbmQ7CihmdW5jdGlvbihOb2RlS2luZDEpIHsKICAgIE5vZGVLaW5kMVtOb2RlS2luZDFbIlNjYWxhciJdID0gMV0gPSAiU2NhbGFyIjsKICAgIE5vZGVLaW5kMVtOb2RlS2luZDFbIk9iamVjdCJdID0gMl0gPSAiT2JqZWN0IjsKfSkoTm9kZUtpbmQgfHwgKE5vZGVLaW5kID0ge30pKTsKY2xhc3MgTm9kZTEgewogICAga2luZDsKICAgIHF1ZXJ5ID0gW107CiAgICBjb25zdHJ1Y3RvcihraW5kKXsKICAgICAgICB0aGlzLmtpbmQgPSBraW5kOwogICAgfQp9CmNsYXNzIENmR3FsQ2xpZW50IHsKICAgIHN0YXRpYyBERUJVRyA9IGZhbHNlOwogICAgc3RhdGljIFVSTF9UUkFOU0ZPUk1FUiA9ICh2KT0+djsKICAgIHByb2ZpbGU7CiAgICBjb25zdHJ1Y3Rvcihwcm9maWxlKXsKICAgICAgICB0aGlzLnByb2ZpbGUgPSBwcm9maWxlOwogICAgfQogICAgYXN5bmMgZ2V0RHVyYWJsZU9iamVjdFBlcmlvZGljTWV0cmljc0J5RGF0ZShzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgICAgICByZXR1cm4gYXdhaXQgX2dldER1cmFibGVPYmplY3RQZXJpb2RpY01ldHJpY3NCeURhdGUodGhpcy5wcm9maWxlLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpOwogICAgfQogICAgYXN5bmMgZ2V0RHVyYWJsZU9iamVjdFN0b3JhZ2VCeURhdGUoc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IF9nZXREdXJhYmxlT2JqZWN0U3RvcmFnZUJ5RGF0ZSh0aGlzLnByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSk7CiAgICB9CiAgICBhc3luYyBnZXREdXJhYmxlT2JqZWN0SW52b2NhdGlvbnNCeURhdGUoc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IF9nZXREdXJhYmxlT2JqZWN0SW52b2NhdGlvbnNCeURhdGUodGhpcy5wcm9maWxlLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpOwogICAgfQogICAgYXN5bmMgZ2V0UjJTdG9yYWdlQnlEYXRlKHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgICAgIHJldHVybiBhd2FpdCBfZ2V0UjJTdG9yYWdlQnlEYXRlKHRoaXMucHJvZmlsZSwgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKTsKICAgIH0KICAgIGFzeW5jIGdldFIyT3BlcmF0aW9uc0J5RGF0ZShvcGVyYXRpb25DbGFzcywgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IF9nZXRSMk9wZXJhdGlvbnNCeURhdGUodGhpcy5wcm9maWxlLCBvcGVyYXRpb25DbGFzcywgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBxdWVyeShwcm9maWxlLCBxdWVyeUZuLCB2YXJpYWJsZXMpIHsKICAgIGNvbnN0IHsgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgY29uc3QgcSA9IEdyYXBocWxRdWVyeS5jcmVhdGUoKS5zY2FsYXIoJ2Nvc3QnKS5vYmplY3QoJ3ZpZXdlcicpLnNjYWxhcignYnVkZ2V0Jykub2JqZWN0KCdhY2NvdW50cycpLmFyZ09iamVjdCgnZmlsdGVyJywgJ2FjY291bnRUYWcnLCBhY2NvdW50SWQpLnNjYWxhcignYWNjb3VudFRhZycpOwogICAgcXVlcnlGbihxKTsKICAgIGNvbnN0IHF1ZXJ5MSA9IHEudG9wKCkudG9TdHJpbmcoKTsKICAgIGlmIChDZkdxbENsaWVudC5ERUJVRykgY29uc29sZS5sb2cocXVlcnkxKTsKICAgIGNvbnN0IHJlcU9iaiA9IHsKICAgICAgICBxdWVyeTogcXVlcnkxLAogICAgICAgIHZhcmlhYmxlcwogICAgfTsKICAgIGNvbnN0IGJvZHkgPSBKU09OLnN0cmluZ2lmeShyZXFPYmopOwogICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgY29uc3QgdXJsID0gQ2ZHcWxDbGllbnQuVVJMX1RSQU5TRk9STUVSKCdodHRwczovL2FwaS5jbG91ZGZsYXJlLmNvbS9jbGllbnQvdjQvZ3JhcGhxbCcpOwogICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnLAogICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHthcGlUb2tlbn1gCiAgICAgICAgfSwKICAgICAgICBib2R5CiAgICB9KTsKICAgIGNvbnN0IGZldGNoTWlsbGlzID0gRGF0ZS5ub3coKSAtIHN0YXJ0OwogICAgaWYgKENmR3FsQ2xpZW50LkRFQlVHKSBjb25zb2xlLmxvZyhyZXMpOwogICAgaWYgKHJlcy5zdGF0dXMgIT09IDIwMCkgdGhyb3cgbmV3IEVycm9yKGBCYWQgcmVzLnN0YXR1czogJHtyZXMuc3RhdHVzfSwgZXhwZWN0ZWQgMjAwLCB0ZXh0PSR7YXdhaXQgcmVzLnRleHQoKX1gKTsKICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKTsKICAgIGlmIChjb250ZW50VHlwZSAhPT0gJ2FwcGxpY2F0aW9uL2pzb24nKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCByZXMuY29udGVudFR5cGU6ICR7Y29udGVudFR5cGV9LCBleHBlY3RlZCBhcHBsaWNhdGlvbi9qc29uLCBmb3VuZCAke2NvbnRlbnRUeXBlfSwgdGV4dD0ke2F3YWl0IHJlcy50ZXh0KCl9YCk7CiAgICBjb25zdCByZXNPYmogPSBhd2FpdCByZXMuanNvbigpOwogICAgcmVzT2JqLmZldGNoTWlsbGlzID0gZmV0Y2hNaWxsaXM7CiAgICBpZiAoQ2ZHcWxDbGllbnQuREVCVUcpIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc09iaiwgdW5kZWZpbmVkLCAyKSk7CiAgICBpZiAoaXNHcWxFcnJvclJlc3BvbnNlKHJlc09iaikpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzT2JqLmVycm9ycy5tYXAoY29tcHV0ZUdxbEVycm9yU3RyaW5nKS5qb2luKCcsICcpKTsKICAgIH0KICAgIHJldHVybiByZXNPYmo7Cn0KZnVuY3Rpb24gaXNHcWxFcnJvclJlc3BvbnNlKG9iaikgewogICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmIG9iai5kYXRhID09PSBudWxsICYmIEFycmF5LmlzQXJyYXkob2JqLmVycm9ycyk7Cn0KZnVuY3Rpb24gY29tcHV0ZUdxbEVycm9yU3RyaW5nKGVycm9yKSB7CiAgICBjb25zdCBwaWVjZXMgPSBbCiAgICAgICAgZXJyb3IubWVzc2FnZQogICAgXTsKICAgIGlmIChlcnJvci5wYXRoKSBwaWVjZXMucHVzaChgKCR7ZXJyb3IucGF0aC5qb2luKCcvJyl9KWApOwogICAgaWYgKGVycm9yLmV4dGVuc2lvbnMuY29kZSkgcGllY2VzLnB1c2goYChjb2RlPSR7ZXJyb3IuZXh0ZW5zaW9ucy5jb2RlfSlgKTsKICAgIHJldHVybiBwaWVjZXMuam9pbignICcpOwp9CmFzeW5jIGZ1bmN0aW9uIF9nZXREdXJhYmxlT2JqZWN0UGVyaW9kaWNNZXRyaWNzQnlEYXRlKHByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgY29uc3QgcmVzT2JqID0gYXdhaXQgcXVlcnkocHJvZmlsZSwgKHEpPT5xLm9iamVjdCgnZHVyYWJsZU9iamVjdHNQZXJpb2RpY0dyb3VwcycpLmFyZ0xvbmcoJ2xpbWl0JywgMTAwMDApLmFyZ1JhdygnZmlsdGVyJywgYHtkYXRlX2dlcTogJHN0YXJ0LCBkYXRlX2xlcTogJGVuZH1gKS5hcmdSYXcoJ29yZGVyQnknLCBgW2RhdGVfQVNDXWApLm9iamVjdCgnZGltZW5zaW9ucycpLnNjYWxhcignZGF0ZScpLnNjYWxhcignbmFtZXNwYWNlSWQnKS5lbmQoKS5vYmplY3QoJ21heCcpLnNjYWxhcignYWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMnKS5lbmQoKS5vYmplY3QoJ3N1bScpLnNjYWxhcignYWN0aXZlVGltZScpLnNjYWxhcignY3B1VGltZScpLnNjYWxhcignZXhjZWVkZWRDcHVFcnJvcnMnKS5zY2FsYXIoJ2V4Y2VlZGVkTWVtb3J5RXJyb3JzJykuc2NhbGFyKCdmYXRhbEludGVybmFsRXJyb3JzJykuc2NhbGFyKCdpbmJvdW5kV2Vic29ja2V0TXNnQ291bnQnKS5zY2FsYXIoJ291dGJvdW5kV2Vic29ja2V0TXNnQ291bnQnKS5zY2FsYXIoJ3N0b3JhZ2VEZWxldGVzJykuc2NhbGFyKCdzdG9yYWdlUmVhZFVuaXRzJykuc2NhbGFyKCdzdG9yYWdlV3JpdGVVbml0cycpLnNjYWxhcignc3VicmVxdWVzdHMnKSwgewogICAgICAgIHN0YXJ0OiBzdGFydERhdGVJbmNsdXNpdmUsCiAgICAgICAgZW5kOiBlbmREYXRlSW5jbHVzaXZlCiAgICB9KTsKICAgIGNvbnN0IGZldGNoTWlsbGlzID0gcmVzT2JqLmZldGNoTWlsbGlzOwogICAgY29uc3QgcmVzID0gcmVzT2JqOwogICAgY29uc3QgY29zdCA9IHJlcy5kYXRhLmNvc3Q7CiAgICBjb25zdCBidWRnZXQgPSByZXMuZGF0YS52aWV3ZXIuYnVkZ2V0OwogICAgY29uc3Qgcm93cyA9IFtdOwogICAgZm9yIChjb25zdCBhY2NvdW50IG9mIHJlcy5kYXRhLnZpZXdlci5hY2NvdW50cyl7CiAgICAgICAgY2hlY2tFcXVhbCgnYWNjb3VudC5hY2NvdW50VGFnJywgYWNjb3VudC5hY2NvdW50VGFnLCBwcm9maWxlLmFjY291bnRJZCk7CiAgICAgICAgZm9yIChjb25zdCBncm91cCBvZiBhY2NvdW50LmR1cmFibGVPYmplY3RzUGVyaW9kaWNHcm91cHMpewogICAgICAgICAgICBjb25zdCBkYXRlID0gZ3JvdXAuZGltZW5zaW9ucy5kYXRlOwogICAgICAgICAgICBjb25zdCBuYW1lc3BhY2VJZCA9IGdyb3VwLmRpbWVuc2lvbnMubmFtZXNwYWNlSWQ7CiAgICAgICAgICAgIGNvbnN0IG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zID0gZ3JvdXAubWF4LmFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zOwogICAgICAgICAgICBjb25zdCBzdW1BY3RpdmVUaW1lID0gZ3JvdXAuc3VtLmFjdGl2ZVRpbWU7CiAgICAgICAgICAgIGNvbnN0IHN1bUNwdVRpbWUgPSBncm91cC5zdW0uY3B1VGltZTsKICAgICAgICAgICAgY29uc3Qgc3VtRXhjZWVkZWRDcHVFcnJvcnMgPSBncm91cC5zdW0uZXhjZWVkZWRDcHVFcnJvcnM7CiAgICAgICAgICAgIGNvbnN0IHN1bUV4Y2VlZGVkTWVtb3J5RXJyb3JzID0gZ3JvdXAuc3VtLmV4Y2VlZGVkTWVtb3J5RXJyb3JzOwogICAgICAgICAgICBjb25zdCBzdW1GYXRhbEludGVybmFsRXJyb3JzID0gZ3JvdXAuc3VtLmZhdGFsSW50ZXJuYWxFcnJvcnM7CiAgICAgICAgICAgIGNvbnN0IHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCA9IGdyb3VwLnN1bS5pbmJvdW5kV2Vic29ja2V0TXNnQ291bnQ7CiAgICAgICAgICAgIGNvbnN0IHN1bU91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQgPSBncm91cC5zdW0ub3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudDsKICAgICAgICAgICAgY29uc3Qgc3VtU3RvcmFnZURlbGV0ZXMgPSBncm91cC5zdW0uc3RvcmFnZURlbGV0ZXM7CiAgICAgICAgICAgIGNvbnN0IHN1bVN0b3JhZ2VSZWFkVW5pdHMgPSBncm91cC5zdW0uc3RvcmFnZVJlYWRVbml0czsKICAgICAgICAgICAgY29uc3Qgc3VtU3RvcmFnZVdyaXRlVW5pdHMgPSBncm91cC5zdW0uc3RvcmFnZVdyaXRlVW5pdHM7CiAgICAgICAgICAgIGNvbnN0IHN1bVN1YnJlcXVlc3RzID0gZ3JvdXAuc3VtLnN1YnJlcXVlc3RzOwogICAgICAgICAgICByb3dzLnB1c2goewogICAgICAgICAgICAgICAgZGF0ZSwKICAgICAgICAgICAgICAgIG5hbWVzcGFjZUlkLAogICAgICAgICAgICAgICAgbWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMsCiAgICAgICAgICAgICAgICBzdW1BY3RpdmVUaW1lLAogICAgICAgICAgICAgICAgc3VtQ3B1VGltZSwKICAgICAgICAgICAgICAgIHN1bUV4Y2VlZGVkQ3B1RXJyb3JzLAogICAgICAgICAgICAgICAgc3VtRXhjZWVkZWRNZW1vcnlFcnJvcnMsCiAgICAgICAgICAgICAgICBzdW1GYXRhbEludGVybmFsRXJyb3JzLAogICAgICAgICAgICAgICAgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgICAgIHN1bVN0b3JhZ2VEZWxldGVzLAogICAgICAgICAgICAgICAgc3VtU3RvcmFnZVJlYWRVbml0cywKICAgICAgICAgICAgICAgIHN1bVN0b3JhZ2VXcml0ZVVuaXRzLAogICAgICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBpbmZvOiB7CiAgICAgICAgICAgIGZldGNoTWlsbGlzLAogICAgICAgICAgICBjb3N0LAogICAgICAgICAgICBidWRnZXQKICAgICAgICB9LAogICAgICAgIHJvd3MKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gX2dldER1cmFibGVPYmplY3RTdG9yYWdlQnlEYXRlKHByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgY29uc3QgcmVzT2JqID0gYXdhaXQgcXVlcnkocHJvZmlsZSwgKHEpPT5xLm9iamVjdCgnZHVyYWJsZU9iamVjdHNTdG9yYWdlR3JvdXBzJykuYXJnTG9uZygnbGltaXQnLCAxMDAwMCkuYXJnUmF3KCdmaWx0ZXInLCBge2RhdGVfZ2VxOiAkc3RhcnQsIGRhdGVfbGVxOiAkZW5kfWApLmFyZ1Jhdygnb3JkZXJCeScsIGBbZGF0ZV9BU0NdYCkub2JqZWN0KCdkaW1lbnNpb25zJykuc2NhbGFyKCdkYXRlJykuZW5kKCkub2JqZWN0KCdtYXgnKS5zY2FsYXIoJ3N0b3JlZEJ5dGVzJykuZW5kKCksIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5kdXJhYmxlT2JqZWN0c1N0b3JhZ2VHcm91cHMpewogICAgICAgICAgICBjb25zdCBkYXRlID0gZ3JvdXAuZGltZW5zaW9ucy5kYXRlOwogICAgICAgICAgICBjb25zdCBtYXhTdG9yZWRCeXRlcyA9IGdyb3VwLm1heC5zdG9yZWRCeXRlczsKICAgICAgICAgICAgcm93cy5wdXNoKHsKICAgICAgICAgICAgICAgIGRhdGUsCiAgICAgICAgICAgICAgICBtYXhTdG9yZWRCeXRlcwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGluZm86IHsKICAgICAgICAgICAgZmV0Y2hNaWxsaXMsCiAgICAgICAgICAgIGNvc3QsCiAgICAgICAgICAgIGJ1ZGdldAogICAgICAgIH0sCiAgICAgICAgcm93cwogICAgfTsKfQphc3luYyBmdW5jdGlvbiBfZ2V0RHVyYWJsZU9iamVjdEludm9jYXRpb25zQnlEYXRlKHByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgY29uc3QgcmVzT2JqID0gYXdhaXQgcXVlcnkocHJvZmlsZSwgKHEpPT5xLm9iamVjdCgnZHVyYWJsZU9iamVjdHNJbnZvY2F0aW9uc0FkYXB0aXZlR3JvdXBzJykuYXJnTG9uZygnbGltaXQnLCAxMDAwMCkuYXJnUmF3KCdmaWx0ZXInLCBge2RhdGVfZ2VxOiAkc3RhcnQsIGRhdGVfbGVxOiAkZW5kfWApLmFyZ1Jhdygnb3JkZXJCeScsIGBbZGF0ZV9BU0NdYCkub2JqZWN0KCdkaW1lbnNpb25zJykuc2NhbGFyKCdkYXRlJykuc2NhbGFyKCduYW1lc3BhY2VJZCcpLmVuZCgpLm9iamVjdCgnYXZnJykuc2NhbGFyKCdzYW1wbGVJbnRlcnZhbCcpLmVuZCgpLm9iamVjdCgnc3VtJykuc2NhbGFyKCdyZXF1ZXN0cycpLmVuZCgpLCB7CiAgICAgICAgc3RhcnQ6IHN0YXJ0RGF0ZUluY2x1c2l2ZSwKICAgICAgICBlbmQ6IGVuZERhdGVJbmNsdXNpdmUKICAgIH0pOwogICAgY29uc3QgZmV0Y2hNaWxsaXMgPSByZXNPYmouZmV0Y2hNaWxsaXM7CiAgICBjb25zdCByZXMgPSByZXNPYmo7CiAgICBjb25zdCBjb3N0ID0gcmVzLmRhdGEuY29zdDsKICAgIGNvbnN0IGJ1ZGdldCA9IHJlcy5kYXRhLnZpZXdlci5idWRnZXQ7CiAgICBjb25zdCByb3dzID0gW107CiAgICBmb3IgKGNvbnN0IGFjY291bnQgb2YgcmVzLmRhdGEudmlld2VyLmFjY291bnRzKXsKICAgICAgICBjaGVja0VxdWFsKCdhY2NvdW50LmFjY291bnRUYWcnLCBhY2NvdW50LmFjY291bnRUYWcsIHByb2ZpbGUuYWNjb3VudElkKTsKICAgICAgICBmb3IgKGNvbnN0IGdyb3VwIG9mIGFjY291bnQuZHVyYWJsZU9iamVjdHNJbnZvY2F0aW9uc0FkYXB0aXZlR3JvdXBzKXsKICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGdyb3VwLmRpbWVuc2lvbnMuZGF0ZTsKICAgICAgICAgICAgY29uc3QgbmFtZXNwYWNlSWQgPSBncm91cC5kaW1lbnNpb25zLm5hbWVzcGFjZUlkOwogICAgICAgICAgICBjb25zdCBhdmdTYW1wbGVJbnRlcnZhbCA9IGdyb3VwLmF2Zy5zYW1wbGVJbnRlcnZhbDsKICAgICAgICAgICAgY29uc3Qgc3VtUmVxdWVzdHMgPSBncm91cC5zdW0ucmVxdWVzdHM7CiAgICAgICAgICAgIHJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICBkYXRlLAogICAgICAgICAgICAgICAgbmFtZXNwYWNlSWQsCiAgICAgICAgICAgICAgICBhdmdTYW1wbGVJbnRlcnZhbCwKICAgICAgICAgICAgICAgIHN1bVJlcXVlc3RzCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgaW5mbzogewogICAgICAgICAgICBmZXRjaE1pbGxpcywKICAgICAgICAgICAgY29zdCwKICAgICAgICAgICAgYnVkZ2V0CiAgICAgICAgfSwKICAgICAgICByb3dzCiAgICB9Owp9CmFzeW5jIGZ1bmN0aW9uIF9nZXRSMlN0b3JhZ2VCeURhdGUocHJvZmlsZSwgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICBjb25zdCByZXNPYmogPSBhd2FpdCBxdWVyeShwcm9maWxlLCAocSk9PnEub2JqZWN0KCdyMlN0b3JhZ2VBZGFwdGl2ZUdyb3VwcycpLmFyZ0xvbmcoJ2xpbWl0JywgMTAwMDApLmFyZ1JhdygnZmlsdGVyJywgYHtkYXRlX2dlcTogJHN0YXJ0LCBkYXRlX2xlcTogJGVuZH1gKS5hcmdSYXcoJ29yZGVyQnknLCBgW2RhdGVfQVNDXWApLm9iamVjdCgnZGltZW5zaW9ucycpLnNjYWxhcignZGF0ZScpLnNjYWxhcignYnVja2V0TmFtZScpLmVuZCgpLm9iamVjdCgnbWF4Jykuc2NhbGFyKCdtZXRhZGF0YVNpemUnKS5zY2FsYXIoJ3BheWxvYWRTaXplJykuc2NhbGFyKCdvYmplY3RDb3VudCcpLnNjYWxhcigndXBsb2FkQ291bnQnKS5lbmQoKSwgewogICAgICAgIHN0YXJ0OiBzdGFydERhdGVJbmNsdXNpdmUsCiAgICAgICAgZW5kOiBlbmREYXRlSW5jbHVzaXZlCiAgICB9KTsKICAgIGNvbnN0IGZldGNoTWlsbGlzID0gcmVzT2JqLmZldGNoTWlsbGlzOwogICAgY29uc3QgcmVzID0gcmVzT2JqOwogICAgY29uc3QgY29zdCA9IHJlcy5kYXRhLmNvc3Q7CiAgICBjb25zdCBidWRnZXQgPSByZXMuZGF0YS52aWV3ZXIuYnVkZ2V0OwogICAgY29uc3Qgcm93cyA9IFtdOwogICAgZm9yIChjb25zdCBhY2NvdW50IG9mIHJlcy5kYXRhLnZpZXdlci5hY2NvdW50cyl7CiAgICAgICAgY2hlY2tFcXVhbCgnYWNjb3VudC5hY2NvdW50VGFnJywgYWNjb3VudC5hY2NvdW50VGFnLCBwcm9maWxlLmFjY291bnRJZCk7CiAgICAgICAgZm9yIChjb25zdCBncm91cCBvZiBhY2NvdW50LnIyU3RvcmFnZUFkYXB0aXZlR3JvdXBzKXsKICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGdyb3VwLmRpbWVuc2lvbnMuZGF0ZTsKICAgICAgICAgICAgY29uc3QgYnVja2V0TmFtZSA9IGdyb3VwLmRpbWVuc2lvbnMuYnVja2V0TmFtZTsKICAgICAgICAgICAgY29uc3QgbWF4TWV0YWRhdGFTaXplID0gZ3JvdXAubWF4Lm1ldGFkYXRhU2l6ZTsKICAgICAgICAgICAgY29uc3QgbWF4UGF5bG9hZFNpemUgPSBncm91cC5tYXgucGF5bG9hZFNpemU7CiAgICAgICAgICAgIGNvbnN0IG1heE9iamVjdENvdW50ID0gZ3JvdXAubWF4Lm9iamVjdENvdW50OwogICAgICAgICAgICBjb25zdCBtYXhVcGxvYWRDb3VudCA9IGdyb3VwLm1heC51cGxvYWRDb3VudDsKICAgICAgICAgICAgcm93cy5wdXNoKHsKICAgICAgICAgICAgICAgIGRhdGUsCiAgICAgICAgICAgICAgICBidWNrZXROYW1lLAogICAgICAgICAgICAgICAgbWF4TWV0YWRhdGFTaXplLAogICAgICAgICAgICAgICAgbWF4UGF5bG9hZFNpemUsCiAgICAgICAgICAgICAgICBtYXhPYmplY3RDb3VudCwKICAgICAgICAgICAgICAgIG1heFVwbG9hZENvdW50CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgaW5mbzogewogICAgICAgICAgICBmZXRjaE1pbGxpcywKICAgICAgICAgICAgY29zdCwKICAgICAgICAgICAgYnVkZ2V0CiAgICAgICAgfSwKICAgICAgICByb3dzCiAgICB9Owp9CmFzeW5jIGZ1bmN0aW9uIF9nZXRSMk9wZXJhdGlvbnNCeURhdGUocHJvZmlsZSwgb3BlcmF0aW9uQ2xhc3MsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgY29uc3QgYWN0aW9uVHlwZXMgPSBvcGVyYXRpb25DbGFzcyA9PT0gJ0EnID8gWwogICAgICAgICdMaXN0QnVja2V0cycsCiAgICAgICAgJ1B1dEJ1Y2tldCcsCiAgICAgICAgJ0xpc3RPYmplY3RzJywKICAgICAgICAnUHV0T2JqZWN0JywKICAgICAgICAnQ29weU9iamVjdCcsCiAgICAgICAgJ0NvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkJywKICAgICAgICAnQ3JlYXRlTXVsdGlwYXJ0VXBsb2FkJywKICAgICAgICAnVXBsb2FkUGFydENvcHknCiAgICBdIDogWwogICAgICAgICdIZWFkQnVja2V0JywKICAgICAgICAnSGVhZE9iamVjdCcsCiAgICAgICAgJ0dldE9iamVjdCcKICAgIF07CiAgICBjb25zdCByZXNPYmogPSBhd2FpdCBxdWVyeShwcm9maWxlLCAocSk9PnEub2JqZWN0KCdyMk9wZXJhdGlvbnNBZGFwdGl2ZUdyb3VwcycpLmFyZ0xvbmcoJ2xpbWl0JywgMTAwMDApLmFyZ1JhdygnZmlsdGVyJywgYHtkYXRlX2dlcTogJHN0YXJ0LCBkYXRlX2xlcTogJGVuZCwgYWN0aW9uU3RhdHVzOiAic3VjY2VzcyIsIGFjdGlvblR5cGVfaW46ICR7SlNPTi5zdHJpbmdpZnkoYWN0aW9uVHlwZXMpfX1gKS5hcmdSYXcoJ29yZGVyQnknLCBgW2RhdGVfQVNDXWApLm9iamVjdCgnZGltZW5zaW9ucycpLnNjYWxhcignZGF0ZScpLnNjYWxhcignYnVja2V0TmFtZScpLmVuZCgpLm9iamVjdCgnc3VtJykuc2NhbGFyKCdyZXF1ZXN0cycpLnNjYWxhcigncmVzcG9uc2VPYmplY3RTaXplJykuZW5kKCksIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5yMk9wZXJhdGlvbnNBZGFwdGl2ZUdyb3Vwcyl7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBncm91cC5kaW1lbnNpb25zLmRhdGU7CiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldE5hbWUgPSBncm91cC5kaW1lbnNpb25zLmJ1Y2tldE5hbWU7CiAgICAgICAgICAgIGNvbnN0IHN1bVN1Y2Nlc3NmdWxSZXF1ZXN0cyA9IGdyb3VwLnN1bS5yZXF1ZXN0czsKICAgICAgICAgICAgY29uc3Qgc3VtU3VjY2Vzc2Z1bFJlc3BvbnNlT2JqZWN0U2l6ZSA9IGdyb3VwLnN1bS5yZXNwb25zZU9iamVjdFNpemU7CiAgICAgICAgICAgIHJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICBkYXRlLAogICAgICAgICAgICAgICAgYnVja2V0TmFtZSwKICAgICAgICAgICAgICAgIHN1bVN1Y2Nlc3NmdWxSZXF1ZXN0cywKICAgICAgICAgICAgICAgIHN1bVN1Y2Nlc3NmdWxSZXNwb25zZU9iamVjdFNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBpbmZvOiB7CiAgICAgICAgICAgIGZldGNoTWlsbGlzLAogICAgICAgICAgICBjb3N0LAogICAgICAgICAgICBidWRnZXQKICAgICAgICB9LAogICAgICAgIHJvd3MKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gY29tcHV0ZUR1cmFibGVPYmplY3RzQ29zdHNUYWJsZShjbGllbnQsIG9wdHMpIHsKICAgIGNvbnN0IHsgc3RhcnQ6IHN0YXJ0MSAsIGVuZDogZW5kMSAgfSA9ICgoKT0+ewogICAgICAgIGlmICgnbG9va2JhY2tEYXlzJyBpbiBvcHRzKSB7CiAgICAgICAgICAgIGNvbnN0IGVuZCA9IHV0Y0N1cnJlbnREYXRlKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gYWRkRGF5c1RvRGF0ZShlbmQsIC1vcHRzLmxvb2tiYWNrRGF5cyk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzdGFydCwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhcnQgLCBlbmQgIH0gPSBvcHRzOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgc3RhcnQsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KSgpOwogICAgY29uc3QgW3N0b3JhZ2UsIHBlcmlvZGljLCBpbnZvY2F0aW9ucywgbmFtZXNwYWNlc10gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgY2xpZW50LmdldER1cmFibGVPYmplY3RTdG9yYWdlQnlEYXRlKHN0YXJ0MSwgZW5kMSksCiAgICAgICAgY2xpZW50LmdldER1cmFibGVPYmplY3RQZXJpb2RpY01ldHJpY3NCeURhdGUoc3RhcnQxLCBlbmQxKSwKICAgICAgICBjbGllbnQuZ2V0RHVyYWJsZU9iamVjdEludm9jYXRpb25zQnlEYXRlKHN0YXJ0MSwgZW5kMSksCiAgICAgICAgdHJ5TGlzdER1cmFibGVPYmplY3RzTmFtZXNwYWNlcyhjbGllbnQucHJvZmlsZSksIAogICAgXSk7CiAgICBjb25zdCBncWxSZXN1bHRJbmZvcyA9IHsKICAgICAgICAnc3RvcmFnZSc6IHN0b3JhZ2UuaW5mbywKICAgICAgICAncGVyaW9kaWMnOiBwZXJpb2RpYy5pbmZvLAogICAgICAgICdpbnZvY2F0aW9ucyc6IGludm9jYXRpb25zLmluZm8KICAgIH07CiAgICBjb25zdCByb3dzQnlOYW1lc3BhY2UgPSB7fTsKICAgIGNvbnN0IHJvd3NCeURhdGUgPSB7fTsKICAgIGZvciAoY29uc3QgcFJvdyBvZiBwZXJpb2RpYy5yb3dzKXsKICAgICAgICBjb25zdCB7IGRhdGUgLCBuYW1lc3BhY2VJZCAsIG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zICwgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50ICwgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCAsIHN1bVN1YnJlcXVlc3RzICwgc3VtQWN0aXZlVGltZSAsIHN1bVN0b3JhZ2VSZWFkVW5pdHMgLCBzdW1TdG9yYWdlV3JpdGVVbml0cyAsIHN1bVN0b3JhZ2VEZWxldGVzICwgIH0gPSBwUm93OwogICAgICAgIGxldCByb3dzID0gcm93c0J5TmFtZXNwYWNlW25hbWVzcGFjZUlkXTsKICAgICAgICBpZiAoIXJvd3MpIHsKICAgICAgICAgICAgcm93cyA9IFtdOwogICAgICAgICAgICByb3dzQnlOYW1lc3BhY2VbbmFtZXNwYWNlSWRdID0gcm93czsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGVSb3dzID0gcm93c0J5RGF0ZVtkYXRlXTsKICAgICAgICBpZiAoIWRhdGVSb3dzKSB7CiAgICAgICAgICAgIGRhdGVSb3dzID0gW107CiAgICAgICAgICAgIHJvd3NCeURhdGVbZGF0ZV0gPSBkYXRlUm93czsKICAgICAgICB9CiAgICAgICAgY29uc3QgeyBzdW1SZXF1ZXN0cyAgfSA9IGludm9jYXRpb25zLnJvd3MuZmlsdGVyKCh2KT0+di5kYXRlID09PSBkYXRlICYmIHYubmFtZXNwYWNlSWQgPT09IG5hbWVzcGFjZUlkKVswXSB8fCB7CiAgICAgICAgICAgIHN1bVJlcXVlc3RzOiAwCiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IHJlcXVlc3RzQ29zdCAsIHdlYnNvY2tldHNDb3N0ICwgc3VicmVxdWVzdHNDb3N0ICwgYWN0aXZlQ29zdCAsIHJlYWRVbml0c0Nvc3QgLCB3cml0ZVVuaXRzQ29zdCAsIGRlbGV0ZXNDb3N0ICwgdG90YWxDb3N0ICwgYWN0aXZlR2JTZWNvbmRzICB9ID0gY29tcHV0ZUNvc3RzKHsKICAgICAgICAgICAgc3VtUmVxdWVzdHMsCiAgICAgICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMsCiAgICAgICAgICAgIHN1bUFjdGl2ZVRpbWUsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHMsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VXcml0ZVVuaXRzLAogICAgICAgICAgICBzdW1TdG9yYWdlRGVsZXRlcywKICAgICAgICAgICAgZXhjbHVkZUZyZWVVc2FnZTogZmFsc2UsCiAgICAgICAgICAgIHN0b3JhZ2VDb3N0OiAwCiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgcm93ID0gewogICAgICAgICAgICBkYXRlLAogICAgICAgICAgICBzdW1SZXF1ZXN0cywKICAgICAgICAgICAgcmVxdWVzdHNDb3N0LAogICAgICAgICAgICBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucywKICAgICAgICAgICAgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICB3ZWJzb2NrZXRzQ29zdCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMsCiAgICAgICAgICAgIHN1YnJlcXVlc3RzQ29zdCwKICAgICAgICAgICAgc3VtQWN0aXZlVGltZSwKICAgICAgICAgICAgYWN0aXZlR2JTZWNvbmRzLAogICAgICAgICAgICBhY3RpdmVDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlUmVhZFVuaXRzLAogICAgICAgICAgICByZWFkVW5pdHNDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlV3JpdGVVbml0cywKICAgICAgICAgICAgd3JpdGVVbml0c0Nvc3QsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VEZWxldGVzLAogICAgICAgICAgICBkZWxldGVzQ29zdCwKICAgICAgICAgICAgdG90YWxDb3N0CiAgICAgICAgfTsKICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgICBkYXRlUm93cy5wdXNoKHJvdyk7CiAgICB9CiAgICBjb25zdCBuYW1lc3BhY2VUYWJsZXMgPSB7fTsKICAgIGZvciAoY29uc3QgW25hbWVzcGFjZUlkLCByb3dzXSBvZiBPYmplY3QuZW50cmllcyhyb3dzQnlOYW1lc3BhY2UpKXsKICAgICAgICBjb25zdCBlc3RpbWF0ZWQzMERheVJvdyA9IGNvbXB1dGVFc3RpbWF0ZWQzMERheVJvdyhyb3dzLCBmYWxzZSk7CiAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gbmFtZXNwYWNlcy5maW5kKCh2KT0+di5pZCA9PT0gbmFtZXNwYWNlSWQpOwogICAgICAgIG5hbWVzcGFjZVRhYmxlc1tuYW1lc3BhY2VJZF0gPSB7CiAgICAgICAgICAgIHJvd3MsCiAgICAgICAgICAgIGVzdGltYXRlZDMwRGF5Um93LAogICAgICAgICAgICBuYW1lc3BhY2UsCiAgICAgICAgICAgIGVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlOiB1bmRlZmluZWQKICAgICAgICB9OwogICAgfQogICAgY29uc3QgYWNjb3VudFJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgW2RhdGUsIGRhdGVSb3dzXSBvZiBPYmplY3QuZW50cmllcyhyb3dzQnlEYXRlKSl7CiAgICAgICAgY29uc3QgeyBtYXhTdG9yZWRCeXRlcyAgfSA9IHN0b3JhZ2Uucm93cy5maWx0ZXIoKHYpPT52LmRhdGUgPT09IGRhdGUpWzBdIHx8IHsKICAgICAgICAgICAgbWF4U3RvcmVkQnl0ZXM6IDAKICAgICAgICB9OwogICAgICAgIGNvbnN0IHN0b3JhZ2VHYiA9IG1heFN0b3JlZEJ5dGVzIC8gMTAyNCAvIDEwMjQgLyAxMDI0OwogICAgICAgIGNvbnN0IHN0b3JhZ2VDb3N0ID0gc3RvcmFnZUdiICogLjIwIC8gMzA7CiAgICAgICAgYWNjb3VudFJvd3MucHVzaChjb21wdXRlVG90YWxSb3coZGF0ZSwgZGF0ZVJvd3MsIHsKICAgICAgICAgICAgc3RvcmFnZUdiLAogICAgICAgICAgICBzdG9yYWdlQ29zdAogICAgICAgIH0pKTsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VDb3N0ID0gYWNjb3VudFJvd3MubGVuZ3RoID4gMCA/IGFjY291bnRSb3dzLm1hcCgodik9PnYuc3RvcmFnZUNvc3QgfHwgMCkucmVkdWNlKChhLCBiKT0+YSArIGIpIDogMDsKICAgIGNvbnN0IGFjY291bnRPcHRzID0gewogICAgICAgIHN0b3JhZ2VHYjogMCwKICAgICAgICBzdG9yYWdlQ29zdAogICAgfTsKICAgIGNvbnN0IGVzdGltYXRlZDMwRGF5Um93ID0gY29tcHV0ZUVzdGltYXRlZDMwRGF5Um93KGFjY291bnRSb3dzLCBmYWxzZSwgYWNjb3VudE9wdHMpOwogICAgY29uc3QgZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUgPSBjb21wdXRlRXN0aW1hdGVkMzBEYXlSb3coYWNjb3VudFJvd3MsIHRydWUsIGFjY291bnRPcHRzKTsKICAgIGNvbnN0IGFjY291bnRUYWJsZSA9IHsKICAgICAgICByb3dzOiBhY2NvdW50Um93cywKICAgICAgICBlc3RpbWF0ZWQzMERheVJvdywKICAgICAgICBlc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZSwKICAgICAgICBuYW1lc3BhY2U6IHVuZGVmaW5lZAogICAgfTsKICAgIHJldHVybiB7CiAgICAgICAgYWNjb3VudFRhYmxlLAogICAgICAgIG5hbWVzcGFjZVRhYmxlcywKICAgICAgICBncWxSZXN1bHRJbmZvcwogICAgfTsKfQpmdW5jdGlvbiBjb21wdXRlQ29zdHMoaW5wdXQpIHsKICAgIGNvbnN0IHsgc3VtQWN0aXZlVGltZSAsIHN1bVN0b3JhZ2VSZWFkVW5pdHMgLCBzdW1TdG9yYWdlV3JpdGVVbml0cyAsIHN1bVN0b3JhZ2VEZWxldGVzICwgZXhjbHVkZUZyZWVVc2FnZSAsIHN0b3JhZ2VDb3N0ICB9ID0gaW5wdXQ7CiAgICBjb25zdCB7IHN1bVJlcXVlc3RzOiBzdW1SZXF1ZXN0czEgLCBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQ6IHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudDEgLCBzdW1TdWJyZXF1ZXN0czogc3VtU3VicmVxdWVzdHMxICB9ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbGV0IHsgc3VtUmVxdWVzdHMgLCBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQgLCBzdW1TdWJyZXF1ZXN0cyAgfSA9IGlucHV0OwogICAgICAgIGlmIChleGNsdWRlRnJlZVVzYWdlKSB7CiAgICAgICAgICAgIGxldCByZW1haW5pbmcgPSAxMDAwMDAwOwogICAgICAgICAgICBsZXQgdGFrZSA9IE1hdGgubWluKHJlbWFpbmluZywgc3VtUmVxdWVzdHMpOwogICAgICAgICAgICBpZiAodGFrZSA+IDApIHsKICAgICAgICAgICAgICAgIHN1bVJlcXVlc3RzIC09IHRha2U7CiAgICAgICAgICAgICAgICByZW1haW5pbmcgLT0gdGFrZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YWtlID0gTWF0aC5taW4ocmVtYWluaW5nLCBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQpOwogICAgICAgICAgICBpZiAodGFrZSA+IDApIHsKICAgICAgICAgICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCAtPSB0YWtlOwogICAgICAgICAgICAgICAgcmVtYWluaW5nIC09IHRha2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFrZSA9IE1hdGgubWluKHJlbWFpbmluZywgc3VtU3VicmVxdWVzdHMpOwogICAgICAgICAgICBpZiAodGFrZSA+IDApIHsKICAgICAgICAgICAgICAgIHN1bVN1YnJlcXVlc3RzIC09IHRha2U7CiAgICAgICAgICAgICAgICByZW1haW5pbmcgLT0gdGFrZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdW1SZXF1ZXN0cywKICAgICAgICAgICAgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICBzdW1TdWJyZXF1ZXN0cwogICAgICAgIH07CiAgICB9KCk7CiAgICBjb25zdCByZXF1ZXN0c0Nvc3QgPSBzdW1SZXF1ZXN0czEgLyAxMDAwMDAwICogMC4xNTsKICAgIGNvbnN0IHdlYnNvY2tldHNDb3N0ID0gc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50MSAvIDEwMDAwMDAgKiAwLjE1OwogICAgY29uc3Qgc3VicmVxdWVzdHNDb3N0ID0gc3VtU3VicmVxdWVzdHMxIC8gMTAwMDAwMCAqIDAuMTU7CiAgICBjb25zdCBhY3RpdmVUaW1lU2Vjb25kcyA9IHN1bUFjdGl2ZVRpbWUgLyAxMDAwIC8gMTAwMDsKICAgIGxldCBhY3RpdmVHYlNlY29uZHMgPSBhY3RpdmVUaW1lU2Vjb25kcyAqIDEyOCAvIDEwMjQ7CiAgICBpZiAoZXhjbHVkZUZyZWVVc2FnZSkgewogICAgICAgIGFjdGl2ZUdiU2Vjb25kcyA9IE1hdGgubWF4KDAsIGFjdGl2ZUdiU2Vjb25kcyAtIDQwMDAwMCk7CiAgICB9CiAgICBjb25zdCBhY3RpdmVDb3N0ID0gYWN0aXZlR2JTZWNvbmRzIC8gNDAwMDAwICogMTIuNTA7CiAgICBjb25zdCByZWFkVW5pdHNDb3N0ID0gKGV4Y2x1ZGVGcmVlVXNhZ2UgPyBNYXRoLm1heCgwLCBzdW1TdG9yYWdlUmVhZFVuaXRzIC0gMTAwMDAwMCkgOiBzdW1TdG9yYWdlUmVhZFVuaXRzKSAvIDEwMDAwMDAgKiAuMjA7CiAgICBjb25zdCB3cml0ZVVuaXRzQ29zdCA9IChleGNsdWRlRnJlZVVzYWdlID8gTWF0aC5tYXgoMCwgc3VtU3RvcmFnZVdyaXRlVW5pdHMgLSAxMDAwMDAwKSA6IHN1bVN0b3JhZ2VXcml0ZVVuaXRzKSAvIDEwMDAwMDAgKiAxOwogICAgY29uc3QgZGVsZXRlc0Nvc3QgPSAoZXhjbHVkZUZyZWVVc2FnZSA/IE1hdGgubWF4KDAsIHN1bVN0b3JhZ2VEZWxldGVzIC0gMTAwMDAwMCkgOiBzdW1TdG9yYWdlRGVsZXRlcykgLyAxMDAwMDAwICogMTsKICAgIGxldCBuZXdTdG9yYWdlQ29zdCA9IHN0b3JhZ2VDb3N0IHx8IDA7CiAgICBpZiAoZXhjbHVkZUZyZWVVc2FnZSkgbmV3U3RvcmFnZUNvc3QgPSBNYXRoLm1heCgwLCBuZXdTdG9yYWdlQ29zdCAtIDAuMjApOwogICAgY29uc3QgdG90YWxDb3N0ID0gcmVxdWVzdHNDb3N0ICsgd2Vic29ja2V0c0Nvc3QgKyBzdWJyZXF1ZXN0c0Nvc3QgKyBhY3RpdmVDb3N0ICsgcmVhZFVuaXRzQ29zdCArIHdyaXRlVW5pdHNDb3N0ICsgZGVsZXRlc0Nvc3QgKyBuZXdTdG9yYWdlQ29zdDsKICAgIHJldHVybiB7CiAgICAgICAgcmVxdWVzdHNDb3N0LAogICAgICAgIHdlYnNvY2tldHNDb3N0LAogICAgICAgIHN1YnJlcXVlc3RzQ29zdCwKICAgICAgICBhY3RpdmVDb3N0LAogICAgICAgIHJlYWRVbml0c0Nvc3QsCiAgICAgICAgd3JpdGVVbml0c0Nvc3QsCiAgICAgICAgZGVsZXRlc0Nvc3QsCiAgICAgICAgdG90YWxDb3N0LAogICAgICAgIGFjdGl2ZUdiU2Vjb25kcywKICAgICAgICBuZXdTdG9yYWdlQ29zdAogICAgfTsKfQphc3luYyBmdW5jdGlvbiB0cnlMaXN0RHVyYWJsZU9iamVjdHNOYW1lc3BhY2VzKHByb2ZpbGUpIHsKICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IGxpc3REdXJhYmxlT2JqZWN0c05hbWVzcGFjZXMocHJvZmlsZS5hY2NvdW50SWQsIHByb2ZpbGUuYXBpVG9rZW4pOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybihlKTsKICAgICAgICByZXR1cm4gW107CiAgICB9Cn0KZnVuY3Rpb24gY29tcHV0ZVRvdGFsUm93KGRhdGUsIHJvd3MsIG9wdHMpIHsKICAgIGxldCBjb21wdXRlZFN0b3JhZ2VDb3N0ID0gZmFsc2U7CiAgICBjb25zdCBjb21wdXRlU3RvcmFnZUNvc3RPbmNlID0gKCk9PnsKICAgICAgICBjb25zdCBydCA9ICFjb21wdXRlZFN0b3JhZ2VDb3N0ID8gb3B0cz8uc3RvcmFnZUNvc3QgfHwgMCA6IDA7CiAgICAgICAgY29tcHV0ZWRTdG9yYWdlQ29zdCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfTsKICAgIHJldHVybiByb3dzLnJlZHVjZSgobGhzLCByaHMpPT4oewogICAgICAgICAgICBkYXRlLAogICAgICAgICAgICBzdW1SZXF1ZXN0czogbGhzLnN1bVJlcXVlc3RzICsgcmhzLnN1bVJlcXVlc3RzLAogICAgICAgICAgICByZXF1ZXN0c0Nvc3Q6IGxocy5yZXF1ZXN0c0Nvc3QgKyByaHMucmVxdWVzdHNDb3N0LAogICAgICAgICAgICBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9uczogbGhzLm1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zICsgcmhzLm1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zLAogICAgICAgICAgICBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQ6IGxocy5zdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQgKyByaHMuc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50OiBsaHMuc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCArIHJocy5zdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICB3ZWJzb2NrZXRzQ29zdDogbGhzLndlYnNvY2tldHNDb3N0ICsgcmhzLndlYnNvY2tldHNDb3N0LAogICAgICAgICAgICBzdW1TdWJyZXF1ZXN0czogbGhzLnN1bVN1YnJlcXVlc3RzICsgcmhzLnN1bVN1YnJlcXVlc3RzLAogICAgICAgICAgICBzdWJyZXF1ZXN0c0Nvc3Q6IGxocy5zdWJyZXF1ZXN0c0Nvc3QgKyByaHMuc3VicmVxdWVzdHNDb3N0LAogICAgICAgICAgICBzdW1BY3RpdmVUaW1lOiBsaHMuc3VtQWN0aXZlVGltZSArIHJocy5zdW1BY3RpdmVUaW1lLAogICAgICAgICAgICBhY3RpdmVHYlNlY29uZHM6IGxocy5hY3RpdmVHYlNlY29uZHMgKyByaHMuYWN0aXZlR2JTZWNvbmRzLAogICAgICAgICAgICBhY3RpdmVDb3N0OiBsaHMuYWN0aXZlQ29zdCArIHJocy5hY3RpdmVDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlUmVhZFVuaXRzOiBsaHMuc3VtU3RvcmFnZVJlYWRVbml0cyArIHJocy5zdW1TdG9yYWdlUmVhZFVuaXRzLAogICAgICAgICAgICByZWFkVW5pdHNDb3N0OiBsaHMucmVhZFVuaXRzQ29zdCArIHJocy5yZWFkVW5pdHNDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlV3JpdGVVbml0czogbGhzLnN1bVN0b3JhZ2VXcml0ZVVuaXRzICsgcmhzLnN1bVN0b3JhZ2VXcml0ZVVuaXRzLAogICAgICAgICAgICB3cml0ZVVuaXRzQ29zdDogbGhzLndyaXRlVW5pdHNDb3N0ICsgcmhzLndyaXRlVW5pdHNDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlRGVsZXRlczogbGhzLnN1bVN0b3JhZ2VEZWxldGVzICsgcmhzLnN1bVN0b3JhZ2VEZWxldGVzLAogICAgICAgICAgICBkZWxldGVzQ29zdDogbGhzLmRlbGV0ZXNDb3N0ICsgcmhzLmRlbGV0ZXNDb3N0LAogICAgICAgICAgICBzdG9yYWdlR2I6IG9wdHM/LnN0b3JhZ2VHYiwKICAgICAgICAgICAgc3RvcmFnZUNvc3Q6IG9wdHM/LnN0b3JhZ2VDb3N0LAogICAgICAgICAgICB0b3RhbENvc3Q6IGxocy50b3RhbENvc3QgKyByaHMudG90YWxDb3N0ICsgY29tcHV0ZVN0b3JhZ2VDb3N0T25jZSgpCiAgICAgICAgfSkpOwp9CmZ1bmN0aW9uIG11bHRpcGx5Um93KHJvdywgbXVsdGlwbGllcikgewogICAgcmV0dXJuIHsKICAgICAgICBkYXRlOiAnJywKICAgICAgICBzdW1SZXF1ZXN0czogcm93LnN1bVJlcXVlc3RzICogbXVsdGlwbGllciwKICAgICAgICByZXF1ZXN0c0Nvc3Q6IHJvdy5yZXF1ZXN0c0Nvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zOiByb3cubWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudDogcm93LnN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudDogcm93LnN1bU91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQgKiBtdWx0aXBsaWVyLAogICAgICAgIHdlYnNvY2tldHNDb3N0OiByb3cud2Vic29ja2V0c0Nvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bVN1YnJlcXVlc3RzOiByb3cuc3VtU3VicmVxdWVzdHMgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1YnJlcXVlc3RzQ29zdDogcm93LnN1YnJlcXVlc3RzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtQWN0aXZlVGltZTogcm93LnN1bUFjdGl2ZVRpbWUgKiBtdWx0aXBsaWVyLAogICAgICAgIGFjdGl2ZUdiU2Vjb25kczogcm93LmFjdGl2ZUdiU2Vjb25kcyAqIG11bHRpcGxpZXIsCiAgICAgICAgYWN0aXZlQ29zdDogcm93LmFjdGl2ZUNvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHM6IHJvdy5zdW1TdG9yYWdlUmVhZFVuaXRzICogbXVsdGlwbGllciwKICAgICAgICByZWFkVW5pdHNDb3N0OiByb3cucmVhZFVuaXRzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHM6IHJvdy5zdW1TdG9yYWdlV3JpdGVVbml0cyAqIG11bHRpcGxpZXIsCiAgICAgICAgd3JpdGVVbml0c0Nvc3Q6IHJvdy53cml0ZVVuaXRzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXM6IHJvdy5zdW1TdG9yYWdlRGVsZXRlcyAqIG11bHRpcGxpZXIsCiAgICAgICAgZGVsZXRlc0Nvc3Q6IHJvdy5kZWxldGVzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3RvcmFnZUdiOiByb3cuc3RvcmFnZUdiID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByb3cuc3RvcmFnZUdiICogbXVsdGlwbGllciwKICAgICAgICBzdG9yYWdlQ29zdDogcm93LnN0b3JhZ2VDb3N0ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByb3cuc3RvcmFnZUNvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHRvdGFsQ29zdDogcm93LnRvdGFsQ29zdCAqIG11bHRpcGxpZXIKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUVzdGltYXRlZDMwRGF5Um93KHJvd3MsIGV4Y2x1ZGVGcmVlVXNhZ2UsIG9wdHMpIHsKICAgIGlmIChyb3dzLmxlbmd0aCA8PSAxKSByZXR1cm4gdW5kZWZpbmVkOwogICAgY29uc3Qgc3VtID0gY29tcHV0ZVRvdGFsUm93KCcnLCByb3dzLnNsaWNlKDAsIC0xKSwgb3B0cyk7CiAgICBjb25zdCBkYXlzID0gcm93cy5sZW5ndGggLSAxOwogICAgY29uc3QgZXN0Um93ID0gbXVsdGlwbHlSb3coc3VtLCAzMCAvIGRheXMpOwogICAgY29uc3QgeyBzdW1SZXF1ZXN0cyAsIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCAsIHN1bVN1YnJlcXVlc3RzICwgc3VtU3RvcmFnZVJlYWRVbml0cyAsIHN1bVN0b3JhZ2VXcml0ZVVuaXRzICwgc3VtU3RvcmFnZURlbGV0ZXMgLCBzdW1BY3RpdmVUaW1lICwgbWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMgLCBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50ICwgc3RvcmFnZUdiICwgc3RvcmFnZUNvc3QgIH0gPSBlc3RSb3c7CiAgICBjb25zdCB7IHJlcXVlc3RzQ29zdCAsIHdlYnNvY2tldHNDb3N0ICwgc3VicmVxdWVzdHNDb3N0ICwgYWN0aXZlQ29zdCAsIHJlYWRVbml0c0Nvc3QgLCB3cml0ZVVuaXRzQ29zdCAsIGRlbGV0ZXNDb3N0ICwgdG90YWxDb3N0ICwgYWN0aXZlR2JTZWNvbmRzICwgbmV3U3RvcmFnZUNvc3QgIH0gPSBjb21wdXRlQ29zdHMoewogICAgICAgIHN1bVJlcXVlc3RzLAogICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICBzdW1TdWJyZXF1ZXN0cywKICAgICAgICBzdW1BY3RpdmVUaW1lLAogICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHMsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHMsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXMsCiAgICAgICAgZXhjbHVkZUZyZWVVc2FnZSwKICAgICAgICBzdG9yYWdlQ29zdAogICAgfSk7CiAgICByZXR1cm4gewogICAgICAgIGRhdGU6ICcnLAogICAgICAgIHN1bVJlcXVlc3RzLAogICAgICAgIHJlcXVlc3RzQ29zdCwKICAgICAgICBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucywKICAgICAgICBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQsCiAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICB3ZWJzb2NrZXRzQ29zdCwKICAgICAgICBzdW1TdWJyZXF1ZXN0cywKICAgICAgICBzdWJyZXF1ZXN0c0Nvc3QsCiAgICAgICAgc3VtQWN0aXZlVGltZSwKICAgICAgICBhY3RpdmVHYlNlY29uZHMsCiAgICAgICAgYWN0aXZlQ29zdCwKICAgICAgICBzdW1TdG9yYWdlUmVhZFVuaXRzLAogICAgICAgIHJlYWRVbml0c0Nvc3QsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHMsCiAgICAgICAgd3JpdGVVbml0c0Nvc3QsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXMsCiAgICAgICAgZGVsZXRlc0Nvc3QsCiAgICAgICAgc3RvcmFnZUdiLAogICAgICAgIHN0b3JhZ2VDb3N0OiBuZXdTdG9yYWdlQ29zdCwKICAgICAgICB0b3RhbENvc3QKICAgIH07Cn0KZnVuY3Rpb24gdXRjQ3VycmVudERhdGUoKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7Cn0KZnVuY3Rpb24gYWRkRGF5c1RvRGF0ZShkYXRlLCBkYXlzKSB7CiAgICBjb25zdCBkID0gbmV3IERhdGUoYCR7ZGF0ZX1UMDA6MDA6MDBaYCk7CiAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpICsgZGF5cywgZC5nZXRIb3VycygpLCBkLmdldE1pbnV0ZXMoKSwgZC5nZXRTZWNvbmRzKCksIGQuZ2V0TWlsbGlzZWNvbmRzKCkpLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDEwKTsKfQpjbGFzcyBNYXRlcmlhbCB7CiAgICBzdGF0aWMgaGlnaEVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44NyknOwogICAgc3RhdGljIG1lZGl1bUVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC42MCknOwp9CmNvbnN0IE1BVEVSSUFMX0NTUyA9IGNzc2AKCjpyb290IHsKICAtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcjogcmdiKDMwLjc1LCAzMC43NSwgMzAuNzUpOwogIC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNDAuOTUsIDQwLjk1LCA0MC45NSk7CiAgLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44Nyk7CiAgLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYwKTsKICAtLWRpc2FibGVkLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zOCk7CiAgLS1idXR0b24tYm9yZGVyLXJhZGl1czogMC4yNXJlbTsKICAtLXByaW1hcnktY29sb3I6ICNiYjg2ZmM7CiAgLS1iYWNrZ3JvdW5kLWNvbG9yOiAjMTIxMjEyOwogIC0tc2Fucy1zZXJpZi1mb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCBhdmVuaXIgbmV4dCwgYXZlbmlyLCBoZWx2ZXRpY2EgbmV1ZSwgaGVsdmV0aWNhLCBVYnVudHUsIHJvYm90bywgbm90bywgc2Vnb2UgdWksIGFyaWFsLCBzYW5zLXNlcmlmOwogIC0tbW9ub3NwYWNlLWZvbnQtZmFtaWx5OiBNZW5sbywgQ29uc29sYXMsIHVpLW1vbm9zcGFjZSwgbW9ub3NwYWNlOwp9CgovKiogdGV4dCBzaXplIGNsYXNzZXMgKi8KCi5oNiB7CiAgICBmb250LXNpemU6IDEuMjVyZW07CiAgICBsZXR0ZXItc3BhY2luZzogMC4wMDc1MHJlbTsKICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7Cn0KCi5ib2R5MiwgZmllbGRzZXQgbGFiZWwsIGZpZWxkc2V0IG91dHB1dCwgZmllbGRzZXQgZGV0YWlscyB7CiAgICBmb250LXNpemU6IDAuODc1cmVtOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDE3ODZyZW07CiAgICBmb250LXdlaWdodDogbm9ybWFsOwogICAgbGluZS1oZWlnaHQ6IDEuMjVyZW07Cn0KCi5idXR0b24sIGJ1dHRvbiwgLmFjdGlvbi1pY29uIHsKICAgIGZvbnQtc2l6ZTogMC44NzVyZW07CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDg5MjlyZW07CiAgICBmb250LXdlaWdodDogYm9sZGVyOwp9Cgoub3ZlcmxpbmUsIHRoIHsKICAgIGZvbnQtc2l6ZTogMC42MjVyZW07CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMTUwMDByZW07CiAgICBmb250LXdlaWdodDogbm9ybWFsOwp9CgouY2FwdGlvbiB7CiAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICBsZXR0ZXItc3BhY2luZzogMC4wMzMzM3JlbTsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7Cn0KCi8qIGxpZ2h0IHRleHQgb24gZGFyayBiYWNrZ3JvdW5kIGNvbG9ycyAqLwoKLmhpZ2gtZW1waGFzaXMtdGV4dCB7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKLm1lZGl1bS1lbXBoYXNpcy10ZXh0LCBmaWVsZHNldCBsYWJlbCwgdGggewogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKLmRpc2FibGVkLWVtcGhhc2lzLXRleHQgewogICAgY29sb3I6IHZhcigtLWRpc2FibGVkLXRleHQtY29sb3IpOwp9CgovKiogZWxldmF0aW9uIGJhY2tncm91bmRzICovCgouc3VyZmFjZS0wMSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwp9Cgouc3VyZmFjZS0wNCB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTA0LWJhY2tncm91bmQtY29sb3IpOwp9CgovKiogYWN0aW9uLWljb24gKi8KCi5hY3Rpb24taWNvbiB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgbWluLWhlaWdodDogMnJlbTsKICAgIG1pbi13aWR0aDogMnJlbTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgb3BhY2l0eTogMC42OTsgIC8qKiBtZWRpdW0tZW1waGFzaXMgLyBoaWdoLWVtcGhhc2lzICovCiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKQG1lZGlhIChob3ZlcjogaG92ZXIpIHsKICAgIC5hY3Rpb24taWNvbjpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICBvcGFjaXR5OiAxOwogICAgfQp9CgovKiogYnV0dG9uICovCgpidXR0b24gewogICAgYm9yZGVyOiBub25lOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wMS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgbWluLXdpZHRoOiA4cmVtOwogICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYnV0dG9uLWJvcmRlci1yYWRpdXMpOwp9CgpidXR0b24uc2VsZWN0ZWQgewogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgpAbWVkaWEgKGhvdmVyKSB7CiAgICBidXR0b246aG92ZXIgewogICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcik7CiAgICAgICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICB9Cn0KCmJ1dHRvbjpkaXNhYmxlZCB7CiAgICBjb2xvcjogdmFyKC0tZGlzYWJsZWQtdGV4dC1jb2xvcik7Cn0KCkBtZWRpYSAoaG92ZXIpIHsKICAgIGJ1dHRvbjpkaXNhYmxlZDpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wMS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICBjdXJzb3I6IGRlZmF1bHQ7CiAgICB9Cn0KCi8qKiBhbmNob3JzICovCgphIHsKICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsKICAgIHRleHQtdW5kZXJsaW5lLW9mZnNldDogMC4ycmVtOwogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwp9CgpAbWVkaWEgKGhvdmVyOiBob3ZlcikgewogICAgYTpob3ZlciB7CiAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgICB9Cn0KCi8qKiBmb3JtcyAqLwoKZmllbGRzZXQgewogICAgYm9yZGVyOiBzb2xpZCAxcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYwKTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXJvdy1nYXA6IDFyZW07CiAgICBncmlkLWNvbHVtbi1nYXA6IDFyZW07CiAgICBwYWRkaW5nOiAxcmVtOwp9CgpsYWJlbCB7CiAgICBncmlkLWNvbHVtbjogMTsKICAgIHBhZGRpbmc6IDAuNXJlbSAwOwp9CgouZm9ybS1saHMgewogICAgZ3JpZC1jb2x1bW46IDE7Cn0KCmlucHV0LCAuZm9ybS1yaHMgewogICAgZ3JpZC1jb2x1bW46IDI7CiAgICBtaW4td2lkdGg6IDA7Cn0KCi5mb3JtLXJvdyB7CiAgICBncmlkLWNvbHVtbjogMSAvIHNwYW4gMjsKfQoKZmllbGRzZXQgaW5wdXRbdHlwZT10ZXh0XSB7CiAgICBwYWRkaW5nOiAwLjVyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwogICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBib3JkZXI6IHNvbGlkIDFweCB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1idXR0b24tYm9yZGVyLXJhZGl1cyk7Cn0KCmZpZWxkc2V0IG91dHB1dCB7CiAgICBwYWRkaW5nOiAwLjVyZW0gMDsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCmZpZWxkc2V0IGRldGFpbHMgewogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKYDsKY29uc3QgSEVBREVSX0hUTUwgPSBodG1sYAo8aGVhZGVyIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQiPgogICAgPGRpdiBpZD0iaGVhZGVyLWNvbnRlbnQiPgogICAgICAgIFdlYnRhaWwKICAgICAgICA8c3BhbiBpZD0iaGVhZGVyLXZlcnNpb24iIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9zcGFuPgogICAgICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9za3ltZXRob2QvZGVub2ZsYXJlIiB0YXJnZXQ9Il9ibGFuayIgaWQ9ImdpdGh1Yi1sb2dvLWFuY2hvciI+PGltZyBpZD0iZ2l0aHViLWxvZ28iPjwvYT4KICAgIDwvZGl2Pgo8L2hlYWRlcj4KYDsKY29uc3QgSEVBREVSX0NTUyA9IGNzc2AKaGVhZGVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxcmVtIDA7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKI2hlYWRlci1jb250ZW50IHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogYmFzZWxpbmU7CiAgICBwYWRkaW5nLXJpZ2h0OiAyLjJyZW07Cn0KCiNoZWFkZXItdmVyc2lvbiB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNnaXRodWItbG9nby1hbmNob3IgewogICAgbGluZS1oZWlnaHQ6IDA7CiAgICBvcGFjaXR5OiAwLjU7Cn0KCkBtZWRpYSAoaG92ZXI6IGhvdmVyKSB7CiAgICAjZ2l0aHViLWxvZ28tYW5jaG9yOmhvdmVyIHsKICAgICAgICBvcGFjaXR5OiAwLjc1OwogICAgfQp9CgojZ2l0aHViLWxvZ28gewogICAgd2lkdGg6IDFyZW07CiAgICBtYXJnaW4tYm90dG9tOiAtMC4xcmVtOwp9CgpgOwpmdW5jdGlvbiBpbml0SGVhZGVyKGRvY3VtZW50LCB2bTEsIGRhdGEzKSB7CiAgICBjb25zdCBoZWFkZXJDb250ZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItY29udGVudCcpOwogICAgaWYgKChkYXRhMy5mbGFncyB8fCAnJykuaW5jbHVkZXMoJ2RlbW8tdG9nZ2xlJykpIHsKICAgICAgICBoZWFkZXJDb250ZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIChlKT0+ewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZtMS50b2dnbGVEZW1vTW9kZSgpOwogICAgICAgIH0pOwogICAgfQogICAgY29uc3QgaGVhZGVyVmVyc2lvblNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhZGVyLXZlcnNpb24nKTsKICAgIGNvbnN0IHsgdmVyc2lvbiAgfSA9IGRhdGEzOwogICAgaGVhZGVyVmVyc2lvblNwYW4udGV4dENvbnRlbnQgPSB2ZXJzaW9uID8gYHYke3ZlcnNpb259YCA6ICcnOwogICAgY29uc3QgZ2l0aHViTG9nb0ltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnaXRodWItbG9nbycpOwogICAgZ2l0aHViTG9nb0ltZy5zcmMgPSBjb21wdXRlR2l0aHViTG9nb0RhdGFVcmwoKTsKICAgIHJldHVybiAoKT0+e307Cn0KZnVuY3Rpb24gY29tcHV0ZUdpdGh1YkxvZ29EYXRhVXJsKCkgewogICAgY29uc3Qgc3ZnMSA9IEdJVEhVQl9MT0dPLnJlcGxhY2UoJ2ZpbGw6d2hpdGU7JywgYGZpbGw6JHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9O2ApOwogICAgcmV0dXJuICdkYXRhOmltYWdlL3N2Zyt4bWw7dXRmOCwnICsgc3ZnMTsKfQpjb25zdCBHSVRIVUJfTE9HTyA9IGA8c3ZnIHdpZHRoPSJhdXRvIiBoZWlnaHQ9ImF1dG8iIHZpZXdCb3g9IjAgMCAxMzYgMTMzIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MjsiPgo8ZyB0cmFuc2Zvcm09Im1hdHJpeCg0LjE2NjY3LDAsMCw0LjE2NjY3LC01NjgsLTEzODEuMDYpIj4KICAgIDxwYXRoIGQ9Ik0xNTIuNjA4LDMzMS40NTVDMTQzLjYxNCwzMzEuNDU1IDEzNi4zMiwzMzguNzQ4IDEzNi4zMiwzNDcuNzQ1QzEzNi4zMiwzNTQuOTQyIDE0MC45ODcsMzYxLjA0NyAxNDcuNDYsMzYzLjIwMUMxNDguMjc1LDM2My4zNTEgMTQ4LjU3MiwzNjIuODQ4IDE0OC41NzIsMzYyLjQxNkMxNDguNTcyLDM2Mi4wMjkgMTQ4LjU1OCwzNjEuMDA1IDE0OC41NSwzNTkuNjQ2QzE0NC4wMTksMzYwLjYzIDE0My4wNjMsMzU3LjQ2MiAxNDMuMDYzLDM1Ny40NjJDMTQyLjMyMiwzNTUuNTggMTQxLjI1NCwzNTUuMDc5IDE0MS4yNTQsMzU1LjA3OUMxMzkuNzc1LDM1NC4wNjkgMTQxLjM2NiwzNTQuMDg5IDE0MS4zNjYsMzU0LjA4OUMxNDMuMDAxLDM1NC4yMDQgMTQzLjg2MSwzNTUuNzY4IDE0My44NjEsMzU1Ljc2OEMxNDUuMzE0LDM1OC4yNTcgMTQ3LjY3NCwzNTcuNTM4IDE0OC42MDIsMzU3LjEyMUMxNDguNzUsMzU2LjA2OSAxNDkuMTcxLDM1NS4zNTEgMTQ5LjYzNiwzNTQuOTQ0QzE0Ni4wMTksMzU0LjUzMyAxNDIuMjE2LDM1My4xMzUgMTQyLjIxNiwzNDYuODkzQzE0Mi4yMTYsMzQ1LjExNSAxNDIuODUxLDM0My42NiAxNDMuODkzLDM0Mi41MjJDMTQzLjcyNSwzNDIuMTEgMTQzLjE2NiwzNDAuNDUzIDE0NC4wNTMsMzM4LjIxMUMxNDQuMDUzLDMzOC4yMTEgMTQ1LjQyLDMzNy43NzMgMTQ4LjUzMiwzMzkuODgxQzE0OS44MzEsMzM5LjUxOSAxNTEuMjI1LDMzOS4zMzkgMTUyLjYxLDMzOS4zMzJDMTUzLjk5NCwzMzkuMzM5IDE1NS4zODcsMzM5LjUxOSAxNTYuNjg4LDMzOS44ODFDMTU5Ljc5OCwzMzcuNzczIDE2MS4xNjMsMzM4LjIxMSAxNjEuMTYzLDMzOC4yMTFDMTYyLjA1MiwzNDAuNDUzIDE2MS40OTMsMzQyLjExIDE2MS4zMjYsMzQyLjUyMkMxNjIuMzcsMzQzLjY2IDE2MywzNDUuMTE1IDE2MywzNDYuODkzQzE2MywzNTMuMTUxIDE1OS4xOTEsMzU0LjUyOCAxNTUuNTYzLDM1NC45MzFDMTU2LjE0NywzNTUuNDM0IDE1Ni42NjgsMzU2LjQyOCAxNTYuNjY4LDM1Ny45NDdDMTU2LjY2OCwzNjAuMTI1IDE1Ni42NDgsMzYxLjg4MiAxNTYuNjQ4LDM2Mi40MTZDMTU2LjY0OCwzNjIuODUyIDE1Ni45NDIsMzYzLjM1OSAxNTcuNzY4LDM2My4yQzE2NC4yMzYsMzYxLjA0MSAxNjguODk5LDM1NC45NCAxNjguODk5LDM0Ny43NDVDMTY4Ljg5OSwzMzguNzQ4IDE2MS42MDUsMzMxLjQ1NSAxNTIuNjA4LDMzMS40NTVaIiBzdHlsZT0iZmlsbDp3aGl0ZTsiLz4KPC9nPgo8L3N2Zz5gOwpmdW5jdGlvbiBhY3Rpb25JY29uKGljb24sIG9wdHMgPSB7fSkgewogICAgY29uc3QgeyB0ZXh0ICwgb25jbGljayAgfSA9IG9wdHM7CiAgICByZXR1cm4gaHRtbGA8ZGl2IGNsYXNzPSJhY3Rpb24taWNvbiIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIG9uY2xpY2sgJiYgb25jbGljaygpOwogICAgfX0+JHtpY29ufSR7dGV4dCB8fCAnJ308L2Rpdj5gOwp9CmNvbnN0IENMRUFSX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik01IDEzaDE0di0ySDV2MnptLTIgNGgxNHYtMkgzdjJ6TTcgN3YyaDE0VjdIN3oiLz48L3N2Zz5gOwpjb25zdCBFRElUX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xNC4wNiA5LjAybC45Mi45Mkw1LjkyIDE5SDV2LS45Mmw5LjA2LTkuMDZNMTcuNjYgM2MtLjI1IDAtLjUxLjEtLjcuMjlsLTEuODMgMS44MyAzLjc1IDMuNzUgMS44My0xLjgzYy4zOS0uMzkuMzktMS4wMiAwLTEuNDFsLTIuMzQtMi4zNGMtLjItLjItLjQ1LS4yOS0uNzEtLjI5em0tMy42IDMuMTlMMyAxNy4yNVYyMWgzLjc1TDE3LjgxIDkuOTRsLTMuNzUtMy43NXoiLz48L3N2Zz5gOwpjb25zdCBBRERfSUNPTiA9IHN2Z2A8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjQiIGZpbGw9IiR7TWF0ZXJpYWwuaGlnaEVtcGhhc2lzVGV4dENvbG9yfSI+PjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xOSAxM2gtNnY2aC0ydi02SDV2LTJoNlY1aDJ2Nmg2djJ6Ii8+PC9zdmc+YDsKY29uc3QgQ0hFQ0tfQk9YX1VOQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgNXYxNEg1VjVoMTRtMC0ySDVjLTEuMSAwLTIgLjktMiAydjE0YzAgMS4xLjkgMiAyIDJoMTRjMS4xIDAgMi0uOSAyLTJWNWMwLTEuMS0uOS0yLTItMnoiLz48L3N2Zz5gOwpjb25zdCBDSEVDS19CT1hfQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bTAgMTZINVY1aDE0djE0ek0xNy45OSA5bC0xLjQxLTEuNDItNi41OSA2LjU5LTIuNTgtMi41Ny0xLjQyIDEuNDEgNCAzLjk5eiIvPjwvc3ZnPmA7CmNvbnN0IFNJREVCQVJfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9InNpZGViYXIiPgogICAgJHtIRUFERVJfSFRNTH0KICAgIDxhIGlkPSJzaWRlYmFyLWFib3V0IiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiIGhyZWY9IiMiPkFib3V0PC9hPgogICAgPGRpdiBpZD0icHJvZmlsZXMiPjwvZGl2PgogICAgPGRpdiBpZD0ic2lkZWJhci1hbmFseXRpY3MiPjwvZGl2PgogICAgPGRpdiBpZD0ic2NyaXB0cyI+PC9kaXY+CjwvZGl2PgpgOwpjb25zdCBTSURFQkFSX0NTUyA9IGNzc2AKCiNzaWRlYmFyIHsKICAgIG1hcmdpbi1sZWZ0OiAxcmVtOwogICAgaGVpZ2h0OiAxMDB2aDsKICAgIG1pbi13aWR0aDogMTVyZW07Cn0KCiNzaWRlYmFyLWFib3V0IHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgbWFyZ2luLWJvdHRvbTogMXJlbTsKfQoKI3NpZGViYXIgLmJ1dHRvbi1ncmlkIHsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAycmVtOwogICAgZ3JpZC1nYXA6IDFweDsKICAgIG1hcmdpbi1sZWZ0OiAxcHg7CiAgICBtYXJnaW4tdG9wOiAxcmVtOwp9Cgojc2lkZWJhciAuYnV0dG9uLWdyaWQtbmV3IHsKICAgIGdyaWQtY29sdW1uOiAxOwogICAgbWluLXdpZHRoOiA4cmVtOwp9Cgojc2lkZWJhciBidXR0b24gewogICAgZ3JpZC1jb2x1bW46IDE7Cn0KCiNzaWRlYmFyIC5idXR0b24tZ3JpZCAuaGludCB7CiAgICBncmlkLWNvbHVtbjogMTsgCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNzY3JpcHRzLXNjcm9sbGVyIHsKICAgIGhlaWdodDogY2FsYygxMDB2aCAtIDI4cmVtKTsKfQoKI3NpZGViYXIgLmV4dHJhLXRvcC1tYXJnaW4gewogICAgbWFyZ2luLXRvcDogMXJlbTsKfQoKYDsKZnVuY3Rpb24gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtMiwgZGF0YTQpIHsKICAgIGNvbnN0IHVwZGF0ZUhlYWRlciA9IGluaXRIZWFkZXIoZG9jdW1lbnQsIHZtMiwgZGF0YTQpOwogICAgY29uc3QgYWJvdXRBbmNob3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhci1hYm91dCcpOwogICAgY29uc3QgcHJvZmlsZXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZXMnKTsKICAgIGNvbnN0IGFuYWx5dGljc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyLWFuYWx5dGljcycpOwogICAgY29uc3Qgc2NyaXB0c0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JpcHRzJyk7CiAgICBhYm91dEFuY2hvci5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMi5zaG93QWJvdXQoKTsKICAgIH07CiAgICByZXR1cm4gKCk9PnsKICAgICAgICB1cGRhdGVIZWFkZXIoKTsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihQUk9GSUxFU19IVE1MKHZtMiksIHByb2ZpbGVzRGl2KTsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihBTkFMWVRJQ1NfSFRNTCh2bTIpLCBhbmFseXRpY3NEaXYpOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKFNDUklQVFNfSFRNTCh2bTIpLCBzY3JpcHRzRGl2KTsKICAgIH07Cn0KY29uc3QgUFJPRklMRVNfSFRNTCA9ICh2bTMpPT5odG1sYAogICAgPGRpdiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPlByb2ZpbGVzPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJidXR0b24tZ3JpZCI+CiAgICAgICAgJHt2bTMucHJvZmlsZXMubWFwKChwcm9maWxlKT0+aHRtbGA8YnV0dG9uIAogICAgICAgICAgICBjbGFzcz0iJHtwcm9maWxlLmlkID09PSB2bTMuc2VsZWN0ZWRQcm9maWxlSWQgPyAnc2VsZWN0ZWQnIDogJyd9IiAKICAgICAgICAgICAgQGNsaWNrPSR7KCk9PnsKICAgICAgICAgICAgdm0zLnNlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZS5pZDsKICAgICAgICB9fQogICAgICAgICAgICA/ZGlzYWJsZWQ9IiR7dm0zLnByb2ZpbGVGb3JtLnNob3dpbmd9Ij4ke3Byb2ZpbGUudGV4dH08L2J1dHRvbj4KICAgICAgICAke3Byb2ZpbGUuaWQgPT09IHZtMy5zZWxlY3RlZFByb2ZpbGVJZCA/IGh0bWxgJHthY3Rpb25JY29uKEVESVRfSUNPTiwgewogICAgICAgICAgICBvbmNsaWNrOiAoKT0+dm0zLmVkaXRQcm9maWxlKHByb2ZpbGUuaWQpCiAgICAgICAgfSl9YCA6ICcnfWApfQogICAgICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncmlkLW5ldyI+JHthY3Rpb25JY29uKEFERF9JQ09OLCB7CiAgICAgICAgdGV4dDogJ05ldycsCiAgICAgICAgb25jbGljazogKCk9PnZtMy5uZXdQcm9maWxlKCkKICAgIH0pfTwvZGl2PgogICAgPC9kaXY+CmA7CmNvbnN0IEFOQUxZVElDU19IVE1MID0gKHZtNCk9Pmh0bWxgCiAgICA8ZGl2IGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCBleHRyYS10b3AtbWFyZ2luIj5BbmFseXRpY3M8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncmlkIj4KICAgICAgICAke3ZtNC5hbmFseXRpY3MubWFwKChhbmFseXRpYyk9Pmh0bWxgPGJ1dHRvbgogICAgICAgICAgICAgICAgY2xhc3M9IiR7dm00LnNlbGVjdGVkQW5hbHl0aWNJZCA9PT0gYW5hbHl0aWMuaWQgPyAnc2VsZWN0ZWQnIDogJyd9IiAKICAgICAgICAgICAgICAgIEBjbGljaz0keygpPT52bTQuc2hvd0FuYWx5dGljKGFuYWx5dGljLmlkKX0gCiAgICAgICAgICAgICAgICA/ZGlzYWJsZWQ9IiR7dm00LnByb2ZpbGVGb3JtLnNob3dpbmd9Ij4ke2FuYWx5dGljLnRleHR9PC9idXR0b24+CiAgICAgICAgYCl9CiAgICA8L2Rpdj4KYDsKY29uc3QgU0NSSVBUU19IVE1MID0gKHZtNSk9Pmh0bWxgCiAgICA8ZGl2IGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCBleHRyYS10b3AtbWFyZ2luIj5TY3JpcHRzPC9kaXY+CiAgICA8ZGl2IGlkPSJzY3JpcHRzLXNjcm9sbGVyIiBjbGFzcz0iaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCI+CiAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQiPgogICAgICAgICAgICAke3ZtNS5zY3JpcHRzLm1hcCgoc2NyaXB0KT0+aHRtbGA8YnV0dG9uCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9IiR7dm01LnNlbGVjdGVkU2NyaXB0SWRzLmhhcyhzY3JpcHQuaWQpID8gJ3NlbGVjdGVkJyA6ICcnfSIgCiAgICAgICAgICAgICAgICAgICAgQGNsaWNrPSR7KGUpPT5oYW5kbGVTY3JpcHRDbGljayhlLCBzY3JpcHQuaWQsIHZtNSl9IAogICAgICAgICAgICAgICAgICAgID9kaXNhYmxlZD0iJHt2bTUucHJvZmlsZUZvcm0uc2hvd2luZ30iPiR7c2NyaXB0LnRleHR9PC9idXR0b24+CiAgICAgICAgICAgIGApfQogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJidXR0b24tZ3JpZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FwdGlvbiBtZWRpdW0tZW1waGFzaXMtdGV4dCBoaW50Ij4ke2NvbXB1dGVNdWx0aXNlbGVjdEtleUNoYXIoKX0tY2xpY2sgdG8gbXVsdGlzZWxlY3Q8L2Rpdj4KICAgIDwvZGl2PgpgOwpmdW5jdGlvbiBjb21wdXRlTXVsdGlzZWxlY3RLZXlDaGFyKCkgewogICAgcmV0dXJuIGlzTWFjaW50b3NoKCkgPyAn4oyYJyA6ICdjdHJsJzsKfQpmdW5jdGlvbiBpc01hY2ludG9zaCgpIHsKICAgIHJldHVybiBuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZignTWFjJykgPiAtMTsKfQpmdW5jdGlvbiBoYW5kbGVTY3JpcHRDbGljayhlLCBzY3JpcHRJZCwgdm02KSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBuZXdTY3JpcHRJZHMgPSBuZXcgU2V0KFsKICAgICAgICBzY3JpcHRJZAogICAgXSk7CiAgICBjb25zdCBtdWx0aSA9IGlzTWFjaW50b3NoKCkgPyBlLm1ldGFLZXkgOiBlLmN0cmxLZXk7CiAgICB2bTYuc2VsZWN0ZWRTY3JpcHRJZHMgPSBtdWx0aSA/IHZtNi5zZWxlY3RlZFNjcmlwdElkcy5oYXMoc2NyaXB0SWQpID8gc2V0U3VidHJhY3Qodm02LnNlbGVjdGVkU2NyaXB0SWRzLCBuZXdTY3JpcHRJZHMpIDogc2V0VW5pb24odm02LnNlbGVjdGVkU2NyaXB0SWRzLCBuZXdTY3JpcHRJZHMpIDogbmV3U2NyaXB0SWRzOwp9CmNsYXNzIEFwcENvbnN0YW50cyB7CiAgICBzdGF0aWMgV0VCU09DS0VUX1BJTkdfSU5URVJWQUxfU0VDT05EUyA9IDEwOwogICAgc3RhdGljIElOQUNUSVZFX1RBSUxfU0VDT05EUyA9IDU7Cn0KY2xhc3MgVGFpbENvbnRyb2xsZXIgewogICAgY2FsbGJhY2tzOwogICAgcmVjb3JkcyA9IG5ldyBNYXAoKTsKICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM7CiAgICBpbmFjdGl2ZVRhaWxTZWNvbmRzOwogICAgdGFpbE9wdGlvbnMgPSB7CiAgICAgICAgZmlsdGVyczogW10KICAgIH07CiAgICBvbmxpbmU7CiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja3MsIG9wdHMpewogICAgICAgIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzOwogICAgICAgIHRoaXMud2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA9IG9wdHMud2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kczsKICAgICAgICB0aGlzLmluYWN0aXZlVGFpbFNlY29uZHMgPSBvcHRzLmluYWN0aXZlVGFpbFNlY29uZHM7CiAgICAgICAgY29uc3QgbmF2aWdhdG9yQXNBbnkgPSBnbG9iYWxUaGlzLm5hdmlnYXRvcjsKICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvckFzQW55Lm9uTGluZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIHRoaXMuc2V0T25saW5lKG5hdmlnYXRvckFzQW55Lm9uTGluZSk7CiAgICAgICAgfQogICAgICAgIGdsb2JhbFRoaXMuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKCk9PnRoaXMuc2V0T25saW5lKHRydWUpKTsKICAgICAgICBnbG9iYWxUaGlzLmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCAoKT0+dGhpcy5zZXRPbmxpbmUoZmFsc2UpKTsKICAgIH0KICAgIHNldFRhaWxPcHRpb25zKHRhaWxPcHRpb25zKSB7CiAgICAgICAgY29uc29sZS5sb2coYFRhaWxDb250cm9sbGVyLnNldFRhaWxPcHRpb25zICR7SlNPTi5zdHJpbmdpZnkodGFpbE9wdGlvbnMpfWApOwogICAgICAgIHRoaXMudGFpbE9wdGlvbnMgPSB0YWlsT3B0aW9uczsKICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiB0aGlzLnJlY29yZHMudmFsdWVzKCkpewogICAgICAgICAgICBpZiAocmVjb3JkLmNvbm5lY3Rpb24pIHsKICAgICAgICAgICAgICAgIHJlY29yZC5jb25uZWN0aW9uLnNldE9wdGlvbnModGFpbE9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgc2V0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbiwgc2NyaXB0SWRzKSB7CiAgICAgICAgY29uc3Qgc3RvcEtleXMgPSBzZXRTdWJ0cmFjdCh0aGlzLmNvbXB1dGVTdGFydGluZ09yU3RhcnRlZFRhaWxLZXlzKCksIG5ldyBTZXQoWwogICAgICAgICAgICAuLi5zY3JpcHRJZHMKICAgICAgICBdLm1hcCgodik9PnBhY2tUYWlsS2V5KGFjY291bnRJZCwgdikpKSk7CiAgICAgICAgZm9yIChjb25zdCBzdG9wS2V5IG9mIHN0b3BLZXlzKXsKICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gdGhpcy5yZWNvcmRzLmdldChzdG9wS2V5KTsKICAgICAgICAgICAgcmVjb3JkLnN0YXRlID0gJ2luYWN0aXZlJzsKICAgICAgICAgICAgcmVjb3JkLnN0b3BSZXF1ZXN0ZWRUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ2luYWN0aXZlJyAmJiByZWNvcmQuc3RvcFJlcXVlc3RlZFRpbWUgJiYgRGF0ZS5ub3coKSAtIHJlY29yZC5zdG9wUmVxdWVzdGVkVGltZSA+PSB0aGlzLmluYWN0aXZlVGFpbFNlY29uZHMpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmQuc3RhdGUgPSAnc3RvcHBpbmcnOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTdG9wcGluZyAke3JlY29yZC5zY3JpcHRJZH0sIGluYWN0aXZlIGZvciAke0RhdGUubm93KCkgLSByZWNvcmQuc3RvcFJlcXVlc3RlZFRpbWV9bXNgKTsKICAgICAgICAgICAgICAgICAgICByZWNvcmQuY29ubmVjdGlvbj8uY2xvc2UoMTAwMCwgJ25vIGxvbmdlciBpbnRlcmVzdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvcmRzLmRlbGV0ZShyZWNvcmQudGFpbEtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMuaW5hY3RpdmVUYWlsU2Vjb25kcyAqIDEwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc3RvcEtleXMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaFRhaWxzQ2hhbmdlZCgpOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IHNjcmlwdElkIG9mIHNjcmlwdElkcyl7CiAgICAgICAgICAgIGNvbnN0IHRhaWxLZXkgPSBwYWNrVGFpbEtleShhY2NvdW50SWQsIHNjcmlwdElkKTsKICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdSZWNvcmQgPSB0aGlzLnJlY29yZHMuZ2V0KHRhaWxLZXkpOwogICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmQpIHsKICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1JlY29yZC5zdGF0ZSA9PT0gJ2luYWN0aXZlJykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXZpdmluZyBpbmFjdGl2ZSAke3NjcmlwdElkfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhpc3RpbmdSZWNvcmQuc3RhdGUgPSAnc3RhcnRlZCc7CiAgICAgICAgICAgICAgICBleGlzdGluZ1JlY29yZC5zdG9wUmVxdWVzdGVkVGltZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ3N0YXJ0aW5nJywKICAgICAgICAgICAgICAgICAgICB0YWlsS2V5LAogICAgICAgICAgICAgICAgICAgIGFwaVRva2VuLAogICAgICAgICAgICAgICAgICAgIGFjY291bnRJZCwKICAgICAgICAgICAgICAgICAgICBzY3JpcHRJZCwKICAgICAgICAgICAgICAgICAgICByZXRyeUNvdW50QWZ0ZXJDbG9zZTogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb3Jkcy5zZXQodGFpbEtleSwgcmVjb3JkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpOwogICAgICAgICAgICAgICAgcmVjb3JkLnN0YXRlID0gJ3N0YXJ0ZWQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hUYWlsc0NoYW5nZWQoKTsKICAgICAgICB9CiAgICB9CiAgICBkaXNwYXRjaFRhaWxzQ2hhbmdlZCgpIHsKICAgICAgICBjb25zdCB0YWlsS2V5cyA9IG5ldyBTZXQoWwogICAgICAgICAgICAuLi50aGlzLnJlY29yZHMudmFsdWVzKCkKICAgICAgICBdLmZpbHRlcigodik9PnYuc3RhdGUgPT09ICdzdGFydGVkJykubWFwKCh2KT0+di50YWlsS2V5KSk7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsc0NoYW5nZWQodGFpbEtleXMpOwogICAgfQogICAgY29tcHV0ZVN0YXJ0aW5nT3JTdGFydGVkVGFpbEtleXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXQoWwogICAgICAgICAgICAuLi50aGlzLnJlY29yZHMudmFsdWVzKCkKICAgICAgICBdLmZpbHRlcigodik9PnYuc3RhdGUgPT09ICdzdGFydGluZycgfHwgdi5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnKS5tYXAoKHYpPT52LnRhaWxLZXkpKTsKICAgIH0KICAgIHNldE9ubGluZShvbmxpbmUpIHsKICAgICAgICBpZiAob25saW5lID09PSB0aGlzLm9ubGluZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IG9sZE9ubGluZSA9IHRoaXMub25saW5lOwogICAgICAgIHRoaXMub25saW5lID0gb25saW5lOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uTmV0d29ya1N0YXR1c0NoYW5nZWQob25saW5lKTsKICAgICAgICBpZiAodHlwZW9mIG9sZE9ubGluZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIGlmIChvbmxpbmUpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHRoaXMucmVjb3Jkcy52YWx1ZXMoKSl7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgYWNjb3VudElkICwgc2NyaXB0SWQgIH0gPSByZWNvcmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpLmNhdGNoKChlKT0+dGhpcy5jYWxsYmFja3Mub25UYWlsRmFpbGVkVG9TdGFydChhY2NvdW50SWQsIHNjcmlwdElkLCAncmVzdGFydC1hZnRlci1jb21pbmctb25saW5lJywgZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHRoaXMucmVjb3Jkcy52YWx1ZXMoKSl7CiAgICAgICAgICAgICAgICAgICAgcmVjb3JkLmNvbm5lY3Rpb24/LmNsb3NlKDEwMDAsICdvZmZsaW5lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhc3luYyBzdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCkgewogICAgICAgIGNvbnN0IGFsbG93ZWRUb1N0YXJ0ID0gcmVjb3JkLnN0YXRlID09PSAnc3RhcnRpbmcnIHx8IHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnOwogICAgICAgIGlmICghYWxsb3dlZFRvU3RhcnQpIHJldHVybjsKICAgICAgICBjb25zdCB7IGFjY291bnRJZCAsIHNjcmlwdElkICB9ID0gdW5wYWNrVGFpbEtleShyZWNvcmQudGFpbEtleSk7CiAgICAgICAgY29uc3QgeyBhcGlUb2tlbiAgfSA9IHJlY29yZDsKICAgICAgICBpZiAoIXJlY29yZC50YWlsIHx8IERhdGUubm93KCkgPiBuZXcgRGF0ZShyZWNvcmQudGFpbC5leHBpcmVzX2F0KS5nZXRUaW1lKCkgLSAxMDAwICogNjAgKiA1KSB7CiAgICAgICAgICAgIGNvbnN0IHRhaWxDcmVhdGluZ1RpbWUgPSBEYXRlLm5vdygpOwogICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDcmVhdGluZyhhY2NvdW50SWQsIHNjcmlwdElkKTsKICAgICAgICAgICAgY29uc3QgdGFpbCA9IGF3YWl0IGNyZWF0ZVRhaWwoYWNjb3VudElkLCBzY3JpcHRJZCwgYXBpVG9rZW4pOwogICAgICAgICAgICByZWNvcmQudGFpbCA9IHRhaWw7CiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENyZWF0ZWQoYWNjb3VudElkLCBzY3JpcHRJZCwgRGF0ZS5ub3coKSAtIHRhaWxDcmVhdGluZ1RpbWUsIHRhaWwpOwogICAgICAgIH0KICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnaW5hY3RpdmUnKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBjYWxsYmFja3MgLCB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzICB9ID0gdGhpczsKICAgICAgICBjb25zdCBkaXMgPSB0aGlzOwogICAgICAgIGNvbnN0IG9wZW5pbmdUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICBjb25zdCB0YWlsQ29ubmVjdGlvbkNhbGxiYWNrcyA9IHsKICAgICAgICAgICAgb25PcGVuIChfY24sIHRpbWVTdGFtcCkgewogICAgICAgICAgICAgICAgcmVjb3JkLnJldHJ5Q291bnRBZnRlckNsb3NlID0gMDsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uT3BlbihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIERhdGUubm93KCkgLSBvcGVuaW5nVGltZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2xvc2UgKF9jbiwgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbkNsb3NlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbik7CiAgICAgICAgICAgICAgICByZWNvcmQuY2xvc2VUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuc3RhdGUgPT09ICdzdGFydGVkJyAmJiBkaXMub25saW5lICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSsrOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlbGF5U2Vjb25kcyA9IE1hdGgubWluKHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSAqIDUsIDYwKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgV2lsbCBhdHRlbXB0IHRvIHJlc3RhcnQgJHtzY3JpcHRJZH0gaW4gJHtkZWxheVNlY29uZHN9IHNlY29uZHNgKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnc3RhcnRlZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRpcy5zdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBkZWxheVNlY29uZHMgKiAxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25FcnJvciAoX2NuLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25FcnJvcihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVGFpbE1lc3NhZ2UgKF9jbiwgdGltZVN0YW1wLCBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlICE9PSAnc3RhcnRlZCcpIHJldHVybjsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblVucGFyc2VkTWVzc2FnZSAoX2NuLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblVucGFyc2VkTWVzc2FnZScsIHRpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcik7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZWNvcmQuY29ubmVjdGlvbiA9IG5ldyBUYWlsQ29ubmVjdGlvbihyZWNvcmQudGFpbC51cmwsIHRhaWxDb25uZWN0aW9uQ2FsbGJhY2tzLCB7CiAgICAgICAgICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMKICAgICAgICB9KS5zZXRPcHRpb25zKHRoaXMudGFpbE9wdGlvbnMpOwogICAgfQp9CmZ1bmN0aW9uIHVucGFja1RhaWxLZXkodGFpbEtleSkgewogICAgY29uc3QgbSA9IC9eKFteXHMtXSspLShbXlxzXSspJC8uZXhlYyh0YWlsS2V5KTsKICAgIGlmICghbSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGFpbEtleTogJHt0YWlsS2V5fWApOwogICAgcmV0dXJuIHsKICAgICAgICBhY2NvdW50SWQ6IG1bMV0sCiAgICAgICAgc2NyaXB0SWQ6IG1bMl0KICAgIH07Cn0KZnVuY3Rpb24gcGFja1RhaWxLZXkoYWNjb3VudElkLCBzY3JpcHRJZCkgewogICAgcmV0dXJuIGAke2FjY291bnRJZH0tJHtzY3JpcHRJZH1gOwp9CmNsYXNzIFN3aXRjaGFibGVUYWlsQ29udHJvbGxlckNhbGxiYWNrcyB7CiAgICBjYWxsYmFja3M7CiAgICBlbmFibGVkRm47CiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja3MsIGVuYWJsZWRGbil7CiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7CiAgICAgICAgdGhpcy5lbmFibGVkRm4gPSBlbmFibGVkRm47CiAgICB9CiAgICBvblRhaWxDcmVhdGluZyhhY2NvdW50SWQsIHNjcmlwdElkKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ3JlYXRpbmcoYWNjb3VudElkLCBzY3JpcHRJZCk7CiAgICB9CiAgICBvblRhaWxDcmVhdGVkKGFjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDcmVhdGVkKGFjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpOwogICAgfQogICAgb25UYWlsQ29ubmVjdGlvbk9wZW4oYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCB0b29rTWlsbGlzKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk9wZW4oYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCB0b29rTWlsbGlzKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25DbG9zZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uQ2xvc2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25FcnJvcihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25FcnJvcihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbyk7CiAgICB9CiAgICBvblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UpOwogICAgfQogICAgb25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uVW5wYXJzZWRNZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcik7CiAgICB9CiAgICBvblRhaWxzQ2hhbmdlZCh0YWlscykgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbHNDaGFuZ2VkKHRhaWxzKTsKICAgIH0KICAgIG9uTmV0d29ya1N0YXR1c0NoYW5nZWQob25saW5lKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXR3b3JrU3RhdHVzQ2hhbmdlZChvbmxpbmUpOwogICAgfQogICAgb25UYWlsRmFpbGVkVG9TdGFydChhY2NvdW50SWQsIHNjcmlwdElkLCB0cmlnZ2VyLCBlcnJvcikgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbEZhaWxlZFRvU3RhcnQoYWNjb3VudElkLCBzY3JpcHRJZCwgdHJpZ2dlciwgZXJyb3IpOwogICAgfQp9CmNsYXNzIERlbW9Nb2RlIHsKICAgIHN0YXRpYyBwcm9maWxlcyA9IFsKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAncHJvZmlsZTEnLAogICAgICAgICAgICB0ZXh0OiAnY29ycC1wcm9maWxlJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3Byb2ZpbGUyJywKICAgICAgICAgICAgdGV4dDogJ3BlcnMtcHJvZmlsZScKICAgICAgICB9LCAKICAgIF07CiAgICBzdGF0aWMgc2VsZWN0ZWRQcm9maWxlSWQgPSAncHJvZmlsZTEnOwogICAgc3RhdGljIHNldFNlbGVjdGVkUHJvZmlsZUlkKF92YWx1ZSkge30KICAgIHN0YXRpYyBzY3JpcHRzID0gWwogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQxJywKICAgICAgICAgICAgdGV4dDogJ3dvcmtlcjEtZGV2JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDInLAogICAgICAgICAgICB0ZXh0OiAnd29ya2VyMS1wcm9kJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDMnLAogICAgICAgICAgICB0ZXh0OiAnd29ya2VyMi1kZXYnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0NCcsCiAgICAgICAgICAgIHRleHQ6ICd3b3JrZXIyLWJldGEnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0NScsCiAgICAgICAgICAgIHRleHQ6ICd3b3JrZXIyLXByb2QnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0NicsCiAgICAgICAgICAgIHRleHQ6ICdkdXJhYmxlLW9iamVjdC1kZW1vJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDcnLAogICAgICAgICAgICB0ZXh0OiAnc2VjcmV0LWFwcCcKICAgICAgICB9LCAKICAgIF07CiAgICBzdGF0aWMgc2VsZWN0ZWRTY3JpcHRJZHMgPSBuZXcgU2V0KFsKICAgICAgICAnc2NyaXB0NycsCiAgICAgICAgJ3NjcmlwdDQnCiAgICBdKTsKICAgIHN0YXRpYyBzZXRTZWxlY3RlZFNjcmlwdElkcyhfc2NyaXB0SWRzKSB7fQogICAgc3RhdGljIHRhaWxzID0gbmV3IFNldCgpOwogICAgc3RhdGljIGxvZ0Zha2VPdXRwdXQoY2FsbGJhY2tzKSB7CiAgICAgICAgY29uc3QgYWNjb3VudElkID0gJzE1YTdmYTNhMzcyNTRmZTRhN2NhZGQxYmIyNzYyODc5JzsKICAgICAgICBjb25zdCBzY3JpcHRJZCA9ICdzZWNyZXQtYXBwJzsKICAgICAgICBjYWxsYmFja3Mub25UYWlsQ3JlYXRpbmcoYWNjb3VudElkLCBzY3JpcHRJZCk7CiAgICAgICAgY29uc3QgdGFpbCA9IHsKICAgICAgICAgICAgaWQ6ICdkYjE5ZWI4YmU5ZjQ0NDNhYWI5MWE5MDQyYzBkMzUxNycsCiAgICAgICAgICAgIHVybDogJ3dzczovL3RhaWwuZGV2ZWxvcGVycy53b3JrZXJzLmRldi9kYjE5ZWI4YmU5ZjQ0NDNhYWI5MWE5MDQyYzBkMzUxNycsCiAgICAgICAgICAgICdleHBpcmVzX2F0JzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgfTsKICAgICAgICBjYWxsYmFja3Mub25UYWlsQ3JlYXRlZChhY2NvdW50SWQsIHNjcmlwdElkLCAxNTUsIHRhaWwpOwogICAgICAgIGNhbGxiYWNrcy5vblRhaWxzQ2hhbmdlZChuZXcgU2V0KFsKICAgICAgICAgICAgcGFja1RhaWxLZXkoYWNjb3VudElkLCBzY3JpcHRJZCkKICAgICAgICBdKSk7CiAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25PcGVuKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCksIDQyKTsKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgMjsgaSsrKXsKICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25NZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCksIGNvbXB1dGVGYWtlUmVxdWVzdCgpKTsKICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25NZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCksIGNvbXB1dGVGYWtlRG9SZXF1ZXN0KCkpOwogICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgRGF0ZS5ub3coKSwgY29tcHV0ZUZha2VSZXF1ZXN0V2l0aExvZ3MoKSk7CiAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCBjb21wdXRlRmFrZVJlcXVlc3RFeGNlZWRpbmdUaW1lTGltaXQoKSk7CiAgICAgICAgfQogICAgfQp9CmNvbnN0IFVTRVJfQUdFTlQgPSAnTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTAuMTU7IHJ2OjkxLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvOTEuMCc7CmZ1bmN0aW9uIGNvbXB1dGVGYWtlUmVxdWVzdCgpIHsKICAgIGNvbnN0IHJ0ID0gewogICAgICAgIGV2ZW50OiB7CiAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vZW5kcG9pbnQnLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnY2YtY29ubmVjdGluZy1pcCc6ICcyMDMuMC4xMTMuMTInLAogICAgICAgICAgICAgICAgICAgICd1c2VyLWFnZW50JzogVVNFUl9BR0VOVAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNmOiB7CiAgICAgICAgICAgICAgICAgICAgY29sbzogJ0RGVycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nczogW10sCiAgICAgICAgZXhjZXB0aW9uczogW10sCiAgICAgICAgZXZlbnRUaW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgb3V0Y29tZTogJ29rJwogICAgfTsKICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBjb21wdXRlRmFrZURvUmVxdWVzdCgpIHsKICAgIGNvbnN0IHJ0ID0gewogICAgICAgIGV2ZW50OiB7CiAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vZmFrZS1ob3N0L3B1dCcsCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQVVQnLAogICAgICAgICAgICAgICAgaGVhZGVyczoge30KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nczogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2xvZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ2xvZ3Byb3BzOicsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvOiAnRVdSJywKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYWJsZU9iamVjdENsYXNzOiAnTG9nZ2VyRE8nLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhYmxlT2JqZWN0SWQ6ICc1MzhmYzdjZTU1YjE0ZTUzYjZiODU1MmJlZmViOWFmNCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmFibGVPYmplY3ROYW1lOiAnbG9nMScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sIAogICAgICAgIF0sCiAgICAgICAgZXhjZXB0aW9uczogW10sCiAgICAgICAgZXZlbnRUaW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgb3V0Y29tZTogJ29rJwogICAgfTsKICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3RXaXRoTG9ncygpIHsKICAgIGNvbnN0IHJ0ID0gewogICAgICAgIGV2ZW50OiB7CiAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vbXktd29ya2VyLnN1YmRvbWFpbi53b3JrZXJzLmRldi90ZXN0P2xvZz10cnVlJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ2NmLWNvbm5lY3RpbmctaXAnOiAnMjAzLjAuMTEzLjEyJywKICAgICAgICAgICAgICAgICAgICAndXNlci1hZ2VudCc6IFVTRVJfQUdFTlQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZjogewogICAgICAgICAgICAgICAgICAgIGNvbG86ICdERlcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdsb2cnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgbWVzc2FnZTogWwogICAgICAgICAgICAgICAgICAgICdMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzY2luZyBlbGl0JwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2Vycm9yJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdpbmZvJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sIAogICAgICAgIF0sCiAgICAgICAgZXhjZXB0aW9uczogW10sCiAgICAgICAgZXZlbnRUaW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgb3V0Y29tZTogJ29rJwogICAgfTsKICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3RFeGNlZWRpbmdUaW1lTGltaXQoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL215LXdvcmtlci5zdWJkb21haW4ud29ya2Vycy5kZXYvY29tcHV0ZS1kaWdpdHMtb2YtcGknLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnY2YtY29ubmVjdGluZy1pcCc6ICcyMDMuMC4xMTMuMTInLAogICAgICAgICAgICAgICAgICAgICd1c2VyLWFnZW50JzogVVNFUl9BR0VOVAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNmOiB7CiAgICAgICAgICAgICAgICAgICAgY29sbzogJ0RGVycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nczogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2xvZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ2J1cm5pbmcgY3B1JwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV4Y2VwdGlvbnM6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ0Vycm9yJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdXb3JrZXIgZXhjZWVkZWQgQ1BVIHRpbWUgbGltaXQuJwogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdleGNlZWRlZENwdScKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KY2xhc3MgUXBzQ29udHJvbGxlciB7CiAgICBzb3J0ZWRFdmVudFRpbWVzID0gW107CiAgICBjYWxsYmFja3M7CiAgICBuOwogICAgX3FwcyA9IDA7CiAgICBnZXQgcXBzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9xcHM7CiAgICB9CiAgICBjb25zdHJ1Y3RvcihuLCBjYWxsYmFja3MpewogICAgICAgIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzOwogICAgICAgIHRoaXMubiA9IG47CiAgICB9CiAgICBhZGRFdmVudChldmVudFRpbWUpIHsKICAgICAgICBjb25zdCBxcHMgPSBjb21wdXRlUXBzKHRoaXMubiwgdGhpcy5zb3J0ZWRFdmVudFRpbWVzLCBldmVudFRpbWUpOwogICAgICAgIGlmIChxcHMgPT09IHRoaXMuX3FwcykgcmV0dXJuOwogICAgICAgIHRoaXMuX3FwcyA9IHFwczsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblFwc0NoYW5nZWQocXBzKTsKICAgIH0KfQpmdW5jdGlvbiBjb21wdXRlUXBzKG4sIHNvcnRlZEV2ZW50VGltZXMsIGV2ZW50VGltZSkgewogICAgYWRkKGV2ZW50VGltZSwgc29ydGVkRXZlbnRUaW1lcyk7CiAgICB3aGlsZShzb3J0ZWRFdmVudFRpbWVzLmxlbmd0aCA+IG4pewogICAgICAgIHNvcnRlZEV2ZW50VGltZXMuc2hpZnQoKTsKICAgIH0KICAgIGNvbnN0IG51bSA9IHNvcnRlZEV2ZW50VGltZXMubGVuZ3RoOwogICAgaWYgKG51bSA8IDIpIHJldHVybiAwOwogICAgY29uc3QgdGltZURpZmZTZWNvbmRzID0gKHNvcnRlZEV2ZW50VGltZXNbc29ydGVkRXZlbnRUaW1lcy5sZW5ndGggLSAxXSAtIHNvcnRlZEV2ZW50VGltZXNbMF0pIC8gMTAwMDsKICAgIHJldHVybiAobnVtIC0gMSkgLyB0aW1lRGlmZlNlY29uZHM7Cn0KZnVuY3Rpb24gYWRkKGVsLCBhcnIpIHsKICAgIGFyci5zcGxpY2UoZmluZExvYyhlbCwgYXJyKSArIDEsIDAsIGVsKTsKICAgIHJldHVybiBhcnI7Cn0KZnVuY3Rpb24gZmluZExvYyhlbCwgYXJyLCBzdCwgZW4pIHsKICAgIHN0ID0gc3QgfHwgMDsKICAgIGVuID0gZW4gfHwgYXJyLmxlbmd0aDsKICAgIGZvcihsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspewogICAgICAgIGlmIChhcnJbaV0gPiBlbCkgewogICAgICAgICAgICByZXR1cm4gaSAtIDE7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGVuOwp9CmNsYXNzIFdlYnRhaWxBcHBWTSB7CiAgICBfcHJvZmlsZXMgPSBbXTsKICAgIGdldCBwcm9maWxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZW1vTW9kZSA/IERlbW9Nb2RlLnByb2ZpbGVzIDogdGhpcy5fcHJvZmlsZXM7CiAgICB9CiAgICBnZXQgcmVhbFByb2ZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9maWxlczsKICAgIH0KICAgIF9zZWxlY3RlZFByb2ZpbGVJZDsKICAgIGdldCBzZWxlY3RlZFByb2ZpbGVJZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZW1vTW9kZSA/IERlbW9Nb2RlLnNlbGVjdGVkUHJvZmlsZUlkIDogdGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQ7CiAgICB9CiAgICBzZXQgc2VsZWN0ZWRQcm9maWxlSWQodmFsdWUpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgewogICAgICAgICAgICBEZW1vTW9kZS5zZXRTZWxlY3RlZFByb2ZpbGVJZCh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkID09PSB2YWx1ZSkgcmV0dXJuOwogICAgICAgIHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkID0gdmFsdWU7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRQcm9maWxlSWQgPSB2YWx1ZTsKICAgICAgICBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgdGhpcy5maW5kU2NyaXB0cygpOwogICAgfQogICAgX2FuYWx5dGljcyA9IFsKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnZHVyYWJsZS1vYmplY3RzJywKICAgICAgICAgICAgdGV4dDogJ0R1cmFibGUgT2JqZWN0cycsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGFpbHkgbWV0cmljcyBhbmQgYXNzb2NpYXRlZCBjb3N0cycKICAgICAgICB9CiAgICBdOwogICAgZ2V0IGFuYWx5dGljcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYW5hbHl0aWNzOwogICAgfQogICAgX3NlbGVjdGVkQW5hbHl0aWNJZDsKICAgIGdldCBzZWxlY3RlZEFuYWx5dGljSWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkQW5hbHl0aWNJZDsKICAgIH0KICAgIGFuYWx5dGljc1N0YXRlID0gewogICAgICAgIHF1ZXJ5aW5nOiBmYWxzZQogICAgfTsKICAgIF9zY3JpcHRzID0gW107CiAgICBnZXQgc2NyaXB0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZW1vTW9kZSA/IERlbW9Nb2RlLnNjcmlwdHMgOiB0aGlzLl9zY3JpcHRzOwogICAgfQogICAgX3NlbGVjdGVkU2NyaXB0SWRzID0gbmV3IFNldCgpOwogICAgZ2V0IHNlbGVjdGVkU2NyaXB0SWRzKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlbW9Nb2RlID8gRGVtb01vZGUuc2VsZWN0ZWRTY3JpcHRJZHMgOiB0aGlzLl9zZWxlY3RlZFNjcmlwdElkczsKICAgIH0KICAgIHNldCBzZWxlY3RlZFNjcmlwdElkcyhzY3JpcHRJZHMpIHsKICAgICAgICBpZiAodGhpcy5fc2VsZWN0ZWRBbmFseXRpY0lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5fc2VsZWN0ZWRBbmFseXRpY0lkID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSB7CiAgICAgICAgICAgIERlbW9Nb2RlLnNldFNlbGVjdGVkU2NyaXB0SWRzKHNjcmlwdElkcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNldEVxdWFsKHRoaXMuX3NlbGVjdGVkU2NyaXB0SWRzLCBzY3JpcHRJZHMpKSByZXR1cm47CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHMgPSBuZXcgU2V0KHNjcmlwdElkcyk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnNlbGVjdGVkUHJvZmlsZUlkICYmIHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgaWYgKHByb2ZpbGUpIHsKICAgICAgICAgICAgcHJvZmlsZS5zZWxlY3RlZFNjcmlwdElkcyA9IFsKICAgICAgICAgICAgICAgIC4uLnNjcmlwdElkcwogICAgICAgICAgICBdOwogICAgICAgICAgICBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuc2V0VGFpbHMoKTsKICAgIH0KICAgIHByb2ZpbGVGb3JtID0gbmV3IFByb2ZpbGVGb3JtVk0oKTsKICAgIGZpbHRlckZvcm0gPSBuZXcgRmlsdGVyRm9ybVZNKCk7CiAgICBmaWx0ZXIgPSB7fTsKICAgIGV4dHJhRmllbGRzID0gW107CiAgICBfdGFpbHMgPSBuZXcgU2V0KCk7CiAgICBnZXQgdGFpbHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVtb01vZGUgPyBEZW1vTW9kZS50YWlscyA6IHRoaXMuX3RhaWxzOwogICAgfQogICAgc2V0IHRhaWxzKHRhaWxzKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIERlbW9Nb2RlLnRhaWxzID0gdGFpbHM7CiAgICAgICAgdGhpcy5fdGFpbHMgPSB0YWlsczsKICAgIH0KICAgIHdlbGNvbWVTaG93aW5nID0gZmFsc2U7CiAgICBhYm91dFNob3dpbmcgPSBmYWxzZTsKICAgIHN0YXRlID0gbG9hZFN0YXRlKCk7CiAgICB0YWlsQ29udHJvbGxlcjsKICAgIHRhaWxDb250cm9sbGVyQ2FsbGJhY2tzOwogICAgcXBzQ29udHJvbGxlcjsKICAgIGRlbW9Nb2RlID0gZmFsc2U7CiAgICBvbkNoYW5nZSA9ICgpPT57fTsKICAgIGxvZ2dlciA9ICgpPT57fTsKICAgIG9uUmVzZXRPdXRwdXQgPSAoKT0+e307CiAgICBvblFwc0NoYW5nZSA9ICgpPT57fTsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgY29uc3QgZGlzID0gdGhpczsKICAgICAgICB0aGlzLnFwc0NvbnRyb2xsZXIgPSBuZXcgUXBzQ29udHJvbGxlcigyMCwgewogICAgICAgICAgICBvblFwc0NoYW5nZWQgKHFwcykgewogICAgICAgICAgICAgICAgaWYgKGRpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgZGlzLm9uUXBzQ2hhbmdlKHFwcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjb25zdCBsb2dUYWlsc0NoYW5nZSA9IChhY3Rpb24sIHRhaWxLZXlzKT0+ewogICAgICAgICAgICBpZiAodGFpbEtleXMuc2l6ZSA+IDApIHRoaXMubG9nV2l0aFByZWZpeChgJHthY3Rpb259ICR7WwogICAgICAgICAgICAgICAgLi4udGFpbEtleXMKICAgICAgICAgICAgXS5tYXAoKHYpPT51bnBhY2tUYWlsS2V5KHYpLnNjcmlwdElkKS5zb3J0KCkuam9pbignLCAnKX1gKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGxvZ1dpdGhQcmVmaXggPSB0aGlzLmxvZ1dpdGhQcmVmaXguYmluZCh0aGlzKTsKICAgICAgICBjb25zdCB2ZXJib3NlV2l0aFByZWZpeCA9IHRoaXMudmVyYm9zZVdpdGhQcmVmaXguYmluZCh0aGlzKTsKICAgICAgICBjb25zdCBjYWxsYmFja3MgPSB7CiAgICAgICAgICAgIG9uVGFpbENyZWF0aW5nIChfYWNjb3VudElkLCBzY3JpcHRJZCkgewogICAgICAgICAgICAgICAgdmVyYm9zZVdpdGhQcmVmaXgoYENyZWF0aW5nIHRhaWwgZm9yICR7c2NyaXB0SWR9Li4uYCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVGFpbENyZWF0ZWQgKF9hY2NvdW50SWQsIHNjcmlwdElkLCB0b29rTWlsbGlzLCB0YWlsKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgQ3JlYXRlZCB0YWlsIGZvciAke3NjcmlwdElkfSBpbiAke3Rvb2tNaWxsaXN9bXMsICR7SlNPTi5zdHJpbmdpZnkodGFpbCl9YCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVGFpbENvbm5lY3Rpb25PcGVuIChfYWNjb3VudElkLCBzY3JpcHRJZCwgX3RpbWVTdGFtcCwgdG9va01pbGxpcykgewogICAgICAgICAgICAgICAgdmVyYm9zZVdpdGhQcmVmaXgoYE9wZW5lZCB0YWlsIGZvciAke3NjcmlwdElkfSBpbiAke3Rvb2tNaWxsaXN9bXNgKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbkNsb3NlIChhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblRhaWxDb25uZWN0aW9uQ2xvc2UnLCB7CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkLAogICAgICAgICAgICAgICAgICAgIHNjcmlwdElkLAogICAgICAgICAgICAgICAgICAgIHRpbWVTdGFtcCwKICAgICAgICAgICAgICAgICAgICBjb2RlLAogICAgICAgICAgICAgICAgICAgIHJlYXNvbiwKICAgICAgICAgICAgICAgICAgICB3YXNDbGVhbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgQ2xvc2VkIHRhaWwgZm9yICR7c2NyaXB0SWR9LCAke0pTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICBjb2RlLAogICAgICAgICAgICAgICAgICAgIHJlYXNvbiwKICAgICAgICAgICAgICAgICAgICB3YXNDbGVhbgogICAgICAgICAgICAgICAgfSl9YCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVGFpbENvbm5lY3Rpb25FcnJvciAoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblRhaWxDb25uZWN0aW9uRXJyb3InLCB7CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkLAogICAgICAgICAgICAgICAgICAgIHNjcmlwdElkLAogICAgICAgICAgICAgICAgICAgIHRpbWVTdGFtcCwKICAgICAgICAgICAgICAgICAgICBlcnJvckluZm8KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeChgRXJyb3IgaW4gdGFpbCBmb3IgJHtzY3JpcHRJZH1gLCB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JJbmZvCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UgKF9hY2NvdW50SWQsIF9zY3JpcHRJZCwgX3RpbWVTdGFtcCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgaWYgKGNvbXB1dGVNZXNzYWdlUGFzc2VzRmlsdGVyKG1lc3NhZ2UsIGRpcy5maWx0ZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgZHVtcE1lc3NhZ2VQcmV0dHkobWVzc2FnZSwgZGlzLmxvZ2dlciwgZGlzLmNvbXB1dGVBZGRpdGlvbmFsTG9ncyhtZXNzYWdlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgICAgICAgICBkaXMucXBzQ29udHJvbGxlci5hZGRFdmVudChtZXNzYWdlLmV2ZW50VGltZXN0YW1wKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZSAoX2FjY291bnRJZCwgc2NyaXB0SWQsIF90aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeChgVW5wYXJzZWQgbWVzc2FnZSBpbiB0YWlsIGZvciAke3NjcmlwdElkfWAsIHBhcnNlRXJyb3Iuc3RhY2sgfHwgcGFyc2VFcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsc0NoYW5nZWQgKHRhaWxzKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0RXF1YWwoZGlzLnRhaWxzLCB0YWlscykpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZWQgPSBzZXRTdWJ0cmFjdChkaXMudGFpbHMsIHRhaWxzKTsKICAgICAgICAgICAgICAgIGxvZ1RhaWxzQ2hhbmdlKCdVbnRhaWxpbmcnLCByZW1vdmVkKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFkZGVkID0gc2V0U3VidHJhY3QodGFpbHMsIGRpcy50YWlscyk7CiAgICAgICAgICAgICAgICBsb2dUYWlsc0NoYW5nZSgnVGFpbGluZycsIGFkZGVkKTsKICAgICAgICAgICAgICAgIGRpcy50YWlscyA9IHRhaWxzOwogICAgICAgICAgICAgICAgZGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uTmV0d29ya1N0YXR1c0NoYW5nZWQgKG9ubGluZSkgewogICAgICAgICAgICAgICAgaWYgKG9ubGluZSkgewogICAgICAgICAgICAgICAgICAgIGxvZ1dpdGhQcmVmaXgoJyVjT05MSU5FJWMnLCAnY29sb3I6IGdyZWVuJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZ1dpdGhQcmVmaXgoJyVjT0ZGTElORSVjJywgJ2NvbG9yOiByZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsRmFpbGVkVG9TdGFydCAoX2FjY291bnRJZCwgc2NyaXB0SWQsIHRyaWdnZXIsIGVycm9yKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgVGFpbCBmb3IgJHtzY3JpcHRJZH0gZmFpbGVkIHRvIHN0YXJ0ICgke3RyaWdnZXJ9KTogJHtlcnJvci5uYW1lfSAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMgPSBBcHBDb25zdGFudHMuV0VCU09DS0VUX1BJTkdfSU5URVJWQUxfU0VDT05EUzsKICAgICAgICBjb25zdCBpbmFjdGl2ZVRhaWxTZWNvbmRzID0gQXBwQ29uc3RhbnRzLklOQUNUSVZFX1RBSUxfU0VDT05EUzsKICAgICAgICB0aGlzLnRhaWxDb250cm9sbGVyID0gbmV3IFRhaWxDb250cm9sbGVyKG5ldyBTd2l0Y2hhYmxlVGFpbENvbnRyb2xsZXJDYWxsYmFja3MoY2FsbGJhY2tzLCAoKT0+IXRoaXMuZGVtb01vZGUpLCB7CiAgICAgICAgICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMsCiAgICAgICAgICAgIGluYWN0aXZlVGFpbFNlY29uZHMKICAgICAgICB9KTsKICAgICAgICB0aGlzLnRhaWxDb250cm9sbGVyQ2FsbGJhY2tzID0gY2FsbGJhY2tzOwogICAgICAgIHRoaXMuZXh0cmFGaWVsZHMgPSBbCiAgICAgICAgICAgIC4uLnRoaXMuc3RhdGUuZXh0cmFGaWVsZHMgfHwgW10KICAgICAgICBdOwogICAgICAgIHRoaXMuZmlsdGVyID0gdGhpcy5zdGF0ZS5maWx0ZXIgfHwge307CiAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgIHNhdmU6IGZhbHNlCiAgICAgICAgfSk7CiAgICB9CiAgICBzdGFydCgpIHsKICAgICAgICB0aGlzLnJlbG9hZFByb2ZpbGVzKCk7CiAgICAgICAgdGhpcy5yZWNvbXB1dGVXZWxjb21lU2hvd2luZygpOwogICAgICAgIHRoaXMucGVyZm9ybUluaXRpYWxTZWxlY3Rpb24oKTsKICAgIH0KICAgIG5ld1Byb2ZpbGUoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHsKICAgICAgICAgICAgaWYgKHRoaXMud2VsY29tZVNob3dpbmcpIHt9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ucHJvZmlsZUlkID0gZ2VuZXJhdGVVdWlkKCk7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnRpdGxlID0gJ05ldyBQcm9maWxlJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSB0aGlzLl9wcm9maWxlcy5sZW5ndGggPT09IDAgPyAnZGVmYXVsdCcgOiBgcHJvZmlsZSR7dGhpcy5fcHJvZmlsZXMubGVuZ3RoICsgMX1gOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYWNjb3VudElkID0gJyc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5hcGlUb2tlbiA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uZGVsZXRlVmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJyc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5jb21wdXRlU2F2ZUVuYWJsZWQoKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0UHJvZmlsZShwcm9maWxlSWQpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnN0YXRlLnByb2ZpbGVzW3Byb2ZpbGVJZF07CiAgICAgICAgaWYgKCFwcm9maWxlKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgJHtwcm9maWxlSWR9IG5vdCBmb3VuZGApOwogICAgICAgIHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZUlkOwogICAgICAgIGNvbnN0IHsgbmFtZSAsIGFjY291bnRJZCAsIGFwaVRva2VuICB9ID0gcHJvZmlsZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnByb2ZpbGVJZCA9IHByb2ZpbGVJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0udGl0bGUgPSAnRWRpdCBQcm9maWxlJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYWNjb3VudElkID0gYWNjb3VudElkOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSBhcGlUb2tlbjsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJyc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5jb21wdXRlU2F2ZUVuYWJsZWQoKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBkZWxldGVQcm9maWxlKHByb2ZpbGVJZCkgewogICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGUgcHJvZmlsZScsIHByb2ZpbGVJZCk7CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBpZiAoIXByb2ZpbGUpIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSAke3Byb2ZpbGVJZH0gbm90IGZvdW5kYCk7CiAgICAgICAgZGVsZXRlIHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5yZWxvYWRQcm9maWxlcygpOwogICAgICAgIHRoaXMucmVjb21wdXRlV2VsY29tZVNob3dpbmcoKTsKICAgICAgICB0aGlzLnBlcmZvcm1Jbml0aWFsU2VsZWN0aW9uKCk7CiAgICB9CiAgICBjYW5jZWxQcm9maWxlKCkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVOYW1lKG5hbWUpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2V0UHJvZmlsZUFjY291bnRJZChhY2NvdW50SWQpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9IGFjY291bnRJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVBcGlUb2tlbihhcGlUb2tlbikgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSBhcGlUb2tlbjsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNhdmVQcm9maWxlKCkgewogICAgICAgIGNvbnN0IHsgcHJvZmlsZUZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHsgcHJvZmlsZUlkICB9ID0gcHJvZmlsZUZvcm07CiAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHsKICAgICAgICAgICAgbmFtZTogcHJvZmlsZUZvcm0ubmFtZS50cmltKCksCiAgICAgICAgICAgIGFjY291bnRJZDogcHJvZmlsZUZvcm0uYWNjb3VudElkLnRyaW0oKSwKICAgICAgICAgICAgYXBpVG9rZW46IHByb2ZpbGVGb3JtLmFwaVRva2VuLnRyaW0oKQogICAgICAgIH07CiAgICAgICAgdGhpcy50cnlTYXZlUHJvZmlsZShwcm9maWxlSWQsIG5ld1Byb2ZpbGUpOwogICAgfQogICAgZWRpdEV2ZW50RmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnRXZlbnQgdHlwZTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnYWxsJywKICAgICAgICAgICAgICAgIHRleHQ6ICdBbGwnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnY3JvbicsCiAgICAgICAgICAgICAgICB0ZXh0OiAnQ1JPTiB0cmlnZ2VyJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZDogJ2h0dHAnLAogICAgICAgICAgICAgICAgdGV4dDogJ0hUVFAgcmVxdWVzdCcKICAgICAgICAgICAgfSwgCiAgICAgICAgXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmlsdGVyLmV2ZW50MSA9PT0gJ2h0dHAnID8gJ2h0dHAnIDogZmlsdGVyLmV2ZW50MSA9PT0gJ2Nyb24nID8gJ2Nyb24nIDogJ2FsbCc7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdDaG9vc2Ugd2hpY2ggdHlwZXMgb2YgZXZlbnRzIHRvIHNob3cnOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGlmIChmaWx0ZXIuZXZlbnQxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLmV2ZW50MSA9IGZpbHRlckZvcm0uZmllbGRWYWx1ZTsKICAgICAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgICAgICBzYXZlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZENob2ljZVRleHQgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzLmZpbmQoKHYpPT52LmlkID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpLnRleHQ7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgRXZlbnQgdHlwZSBmaWx0ZXIgY2hhbmdlZCB0bzogJHtzZWxlY3RlZENob2ljZVRleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U3RhdHVzRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnU3RhdHVzOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdhbGwnLAogICAgICAgICAgICAgICAgdGV4dDogJ0FsbCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgIHRleHQ6ICdTdWNjZXNzJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZDogJ2Vycm9yJywKICAgICAgICAgICAgICAgIHRleHQ6ICdFcnJvcicKICAgICAgICAgICAgfSwgCiAgICAgICAgXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmlsdGVyLnN0YXR1czEgPT09ICdzdWNjZXNzJyA/ICdzdWNjZXNzJyA6IGZpbHRlci5zdGF0dXMxID09PSAnZXJyb3InID8gJ2Vycm9yJyA6ICdhbGwnOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnU2hvdyBldmVudHMgdGhpcyB0aGlzIHN0YXR1cyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5zdGF0dXMxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLnN0YXR1czEgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRDaG9pY2VUZXh0ID0gZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcy5maW5kKCh2KT0+di5pZCA9PT0gZmlsdGVyRm9ybS5maWVsZFZhbHVlKS50ZXh0OwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFN0YXR1cyBmaWx0ZXIgY2hhbmdlZCB0bzogJHtzZWxlY3RlZENob2ljZVRleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0SXBBZGRyZXNzRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBjb25zdCBpc1ZhbGlkSXBBZGRyZXNzID0gKGlwQWRkcmVzcyk9PnsKICAgICAgICAgICAgcmV0dXJuIC9eKHNlbGZ8W1xkXC46YS1mXXszLH0pJC8udGVzdChpcEFkZHJlc3MpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgY2hlY2tWYWxpZElwQWRkcmVzcyA9IChpcEFkZHJlc3MpPT57CiAgICAgICAgICAgIGlmICghaXNWYWxpZElwQWRkcmVzcyhpcEFkZHJlc3MpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBpcCBhZGRyZXNzOiAke2lwQWRkcmVzc31gKTsKICAgICAgICAgICAgcmV0dXJuIGlwQWRkcmVzczsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHBhcnNlRmlsdGVySXBBZGRyZXNzZXNGcm9tRmllbGRWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHsgZmllbGRWYWx1ZSAgfSA9IGZpbHRlckZvcm07CiAgICAgICAgICAgIGNvbnN0IHYxID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYxID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QodjEuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKS50b0xvd2VyQ2FzZSgpKS5maWx0ZXIoKHYpPT52ICE9PSAnJykubWFwKGNoZWNrVmFsaWRJcEFkZHJlc3MpKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUZpbHRlcklwQWRkcmVzc2VzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5pcEFkZHJlc3MxIHx8IFtdKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0lQIGFkZHJlc3Mocyk6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUZpbHRlcklwQWRkcmVzc2VzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9IGAnc2VsZicgdG8gZmlsdGVyIHlvdXIgb3duIGFkZHJlc3MsIGNvbW1hLXNlcGFyYXRlZCBpZiBtdWx0aXBsZSwgZS5nLiBzZWxmLCAxLjEuMS4xYDsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmlsdGVySXBBZGRyZXNzZXNGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldChmaWx0ZXIuaXBBZGRyZXNzMSB8fCBbXSksIG5ldyBTZXQobmV3VmFsdWUpKSkgcmV0dXJuOwogICAgICAgICAgICBmaWx0ZXIuaXBBZGRyZXNzMSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBuZXdWYWx1ZS5sZW5ndGggPT09IDAgPyAnYW55IElQIGFkZHJlc3MnIDogbmV3VmFsdWUuam9pbignLCAnKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBJUCBhZGRyZXNzIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0TWV0aG9kRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBjb25zdCBwYXJzZUZpbHRlck1ldGhvZHNGcm9tRmllbGRWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHsgZmllbGRWYWx1ZSAgfSA9IGZpbHRlckZvcm07CiAgICAgICAgICAgIGNvbnN0IHYyID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYyID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QodjIuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKS50b1VwcGVyQ2FzZSgpKS5maWx0ZXIoKHYpPT52ICE9PSAnJykpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgY29tcHV0ZUZpZWxkVmFsdWVGcm9tRmlsdGVyTWV0aG9kcyA9ICgpPT57CiAgICAgICAgICAgIHJldHVybiBkaXN0aW5jdChmaWx0ZXIubWV0aG9kMSB8fCBbXSkubWFwKCh2KT0+di50b1VwcGVyQ2FzZSgpKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0hUVFAgTWV0aG9kKHMpOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJNZXRob2RzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdjb21tYS1zZXBhcmF0ZWQgaWYgbXVsdGlwbGUsIGUuZy4gR0VULCBQT1NUJzsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmlsdGVyTWV0aG9kc0Zyb21GaWVsZFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzZXRFcXVhbChuZXcgU2V0KGZpbHRlci5tZXRob2QxIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZSkpKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5tZXRob2QxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlLmxlbmd0aCA9PT0gMCA/ICdhbnkgbWV0aG9kJyA6IG5ld1ZhbHVlLmpvaW4oJywgJyk7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgTWV0aG9kIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2FtcGxpbmdSYXRlRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgcGFyc2VTYW1wbGVSYXRlRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2ID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYgPT09ICcnKSByZXR1cm4gMTsKICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2KTsKICAgICAgICAgICAgaWYgKCFpc1ZhbGlkU2FtcGxpbmdSYXRlKG51bSkpIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCByYXRlOiAke3Z9YCk7CiAgICAgICAgICAgIHJldHVybiBudW07CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGZpbHRlckZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkTmFtZSA9ICdTYW1wbGluZyByYXRlOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSAodHlwZW9mIGZpbHRlci5zYW1wbGluZ1JhdGUxID09PSAnbnVtYmVyJyAmJiBpc1ZhbGlkU2FtcGxpbmdSYXRlKGZpbHRlci5zYW1wbGluZ1JhdGUxKSA/IGZpbHRlci5zYW1wbGluZ1JhdGUxIDogMSkudG9GaXhlZCgyKTsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gJ0NhbiByYW5nZSBmcm9tIDAgKDAlKSB0byAxICgxMDAlKSc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZVNhbXBsZVJhdGVGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoZmlsdGVyLnNhbXBsaW5nUmF0ZTEgPT09IG5ld1ZhbHVlKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5zYW1wbGluZ1JhdGUxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlID09PSAxID8gJ25vIHNhbXBsaW5nJyA6IGAke25ld1ZhbHVlfSAoJHsobmV3VmFsdWUgKiAxMDApLnRvRml4ZWQoMil9JSlgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNhbXBsZSByYXRlIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2VhcmNoRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnU2VhcmNoIHRleHQ6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGZpbHRlci5zZWFyY2gxIHx8ICcnOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnRmlsdGVyIGJ5IGEgdGV4dCBtYXRjaCBpbiBjb25zb2xlLmxvZyBtZXNzYWdlcyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5zZWFyY2gxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLnNlYXJjaDEgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IChmaWx0ZXIuc2VhcmNoMSB8fCAnJykubGVuZ3RoID09PSAwID8gJ25vIHNlYXJjaCBmaWx0ZXInIDogYCcke2ZpbHRlci5zZWFyY2gxfSdgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNlYXJjaCBmaWx0ZXIgY2hhbmdlZCB0bzogJHt0ZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdEhlYWRlckZpbHRlcigpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyICwgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgcGFyc2VGaWx0ZXJIZWFkZXJzRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2MyA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2MyA9PT0gJycpIHJldHVybiBbXTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KHYzLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkpLmZpbHRlcigodik9PnYgIT09ICcnKSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJIZWFkZXJzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5oZWFkZXIxIHx8IFtdKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0hlYWRlcihzKTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gY29tcHV0ZUZpZWxkVmFsdWVGcm9tRmlsdGVySGVhZGVycygpOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSBgJ2tleScsIG9yICdrZXk6cXVlcnknLCBjb21tYS1zZXBhcmF0ZWQgaWYgbXVsdGlwbGVgOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGFyc2VGaWx0ZXJIZWFkZXJzRnJvbUZpZWxkVmFsdWUoKTsKICAgICAgICAgICAgaWYgKHNldEVxdWFsKG5ldyBTZXQoZmlsdGVyLmhlYWRlcjEgfHwgW10pLCBuZXcgU2V0KG5ld1ZhbHVlKSkpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLmhlYWRlcjEgPSBuZXdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgICAgICBzYXZlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gbmV3VmFsdWUubGVuZ3RoID09PSAwID8gJ25vIGhlYWRlciBmaWx0ZXInIDogbmV3VmFsdWUuam9pbignLCAnKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBIZWFkZXIgZmlsdGVyIGNoYW5nZWQgdG86ICR7dGV4dH1gKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGVkaXRMb2dwcm9wRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBjb25zdCBwYXJzZUxvZ3Byb3BGaWx0ZXJzRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2NCA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2NCA9PT0gJycpIHJldHVybiBbXTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KHY0LnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkpLmZpbHRlcigodik9PnYgIT09ICcnKSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wdXRlRmllbGRWYWx1ZUZyb21Mb2dQcm9wRmlsdGVycyA9ICgpPT57CiAgICAgICAgICAgIHJldHVybiBkaXN0aW5jdChmaWx0ZXIubG9ncHJvcDEgfHwgW10pLmpvaW4oJywgJyk7CiAgICAgICAgfTsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnTG9ncHJvcChzKTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gY29tcHV0ZUZpZWxkVmFsdWVGcm9tTG9nUHJvcEZpbHRlcnMoKTsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gYCdrZXknLCBvciAna2V5OnZhbHVlJywgY29tbWEtc2VwYXJhdGVkIGlmIG11bHRpcGxlLCB2YWx1ZSBtYXkgaW5jbHVkZSAqYDsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlTG9ncHJvcEZpbHRlcnNGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICB0aGlzLnNldExvZ3Byb3BGaWx0ZXIobmV3VmFsdWUpOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2V0TG9ncHJvcEZpbHRlcihsb2dwcm9wRmlsdGVycykgewogICAgICAgIGNvbnN0IHsgZmlsdGVyICB9ID0gdGhpczsKICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldChmaWx0ZXIubG9ncHJvcDEgfHwgW10pLCBuZXcgU2V0KGxvZ3Byb3BGaWx0ZXJzKSkpIHJldHVybjsKICAgICAgICBmaWx0ZXIubG9ncHJvcDEgPSBsb2dwcm9wRmlsdGVyczsKICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHRleHQgPSBsb2dwcm9wRmlsdGVycy5sZW5ndGggPT09IDAgPyAnbm8gbG9ncHJvcCBmaWx0ZXInIDogbG9ncHJvcEZpbHRlcnMuam9pbignLCAnKTsKICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYExvZ3Byb3AgZmlsdGVyIGNoYW5nZWQgdG86ICR7dGV4dH1gKTsKICAgIH0KICAgIGhhc0FueUZpbHRlcnMoKSB7CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHsgZXZlbnQxICB9ID0gZmlsdGVyOwogICAgICAgIHJldHVybiBjb21wdXRlVGFpbE9wdGlvbnNGb3JGaWx0ZXIoZmlsdGVyKS5maWx0ZXJzLmxlbmd0aCA+IDAgfHwgdHlwZW9mIGV2ZW50MSA9PT0gJ3N0cmluZycgJiYgZXZlbnQxICE9PSAnJyAmJiBldmVudDEgIT09ICdhbGwnOwogICAgfQogICAgcmVzZXRGaWx0ZXJzKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5maWx0ZXIgPSB7fTsKICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgRmlsdGVycyByZXNldGApOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGNhbmNlbEZpbHRlcigpIHsKICAgICAgICBjb25zb2xlLmxvZygnY2FuY2VsRmlsdGVyJyk7CiAgICAgICAgdGhpcy5maWx0ZXJGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBzYXZlRmlsdGVyKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdzYXZlRmlsdGVyJyk7CiAgICAgICAgY29uc3QgeyBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICBmaWx0ZXJGb3JtLm91dHB1dE1lc3NhZ2UgPSAnQ2hlY2tpbmcgZmlsdGVyLi4uJzsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlKCk7CiAgICAgICAgICAgIGZpbHRlckZvcm0ub3V0cHV0TWVzc2FnZSA9IGBgOwogICAgICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGZpbHRlckZvcm0ub3V0cHV0TWVzc2FnZSA9IGBFcnJvcjogJHtlLm1lc3NhZ2V9YDsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICBzZWxlY3RGaWx0ZXJDaG9pY2UoaWQpIHsKICAgICAgICBpZiAodGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPT09IGlkKSByZXR1cm47CiAgICAgICAgdGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBpZDsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2VsZWN0aW9uRmllbGRzKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnQWRkaXRpb25hbCBmaWVsZHM6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IEVYVFJBX0ZJRUxEU19PUFRJT05TOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9ICh0aGlzLmV4dHJhRmllbGRzIHx8IFtdKS5qb2luKCcsJyk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdTZWxlY3QgYWRkaXRpb25hbCBmaWVsZHMgdG8gc2hvdyBpbiB0aGUgb3V0cHV0JzsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZXMgPSBkaXN0aW5jdCgoZmlsdGVyRm9ybS5maWVsZFZhbHVlIHx8ICcnKS5zcGxpdCgnLCcpLm1hcCgodik9PnYudHJpbSgpKS5maWx0ZXIoKHYpPT52ICE9PSAnJykpOwogICAgICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldCh0aGlzLmV4dHJhRmllbGRzIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZXMpKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmV4dHJhRmllbGRzID0gbmV3VmFsdWVzOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGV4dHJhRmllbGRzVGV4dCA9IHRoaXMuY29tcHV0ZVNlbGVjdGlvbkZpZWxkc1RleHQoKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBPdXRwdXQgZmllbGRzIGNoYW5nZWQgdG86ICR7ZXh0cmFGaWVsZHNUZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgY29tcHV0ZVNlbGVjdGlvbkZpZWxkc1RleHQoKSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJ3N0YW5kYXJkIGZpZWxkcycsCiAgICAgICAgICAgIC4uLnRoaXMuZXh0cmFGaWVsZHMubWFwKChpZCk9PkVYVFJBX0ZJRUxEU19PUFRJT05TLmZpbmQoKHYpPT52LmlkID09PSBpZCk/LnRleHQgfHwgaWQpCiAgICAgICAgXS5qb2luKCcsICcpOwogICAgfQogICAgdG9nZ2xlRmlsdGVyT3B0aW9uKGlkKSB7CiAgICAgICAgY29uc3QgZXh0cmFGaWVsZHMgPSBkaXN0aW5jdCgodGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgfHwgJycpLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkpLmZpbHRlcigodik9PnYgIT09ICcnKSk7CiAgICAgICAgY29uc3QgaSA9IGV4dHJhRmllbGRzLmluZGV4T2YoaWQpOwogICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgZXh0cmFGaWVsZHMuc3BsaWNlKGksIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4dHJhRmllbGRzLnB1c2goaWQpOwogICAgICAgIH0KICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gZXh0cmFGaWVsZHMuam9pbignLCcpOwogICAgICAgIGlmICh0aGlzLmZpbHRlckZvcm0uZmllbGRWYWx1ZSA9PT0gZmllbGRWYWx1ZSkgcmV0dXJuOwogICAgICAgIHRoaXMuZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmllbGRWYWx1ZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICB0b2dnbGVEZW1vTW9kZSgpIHsKICAgICAgICB0aGlzLnNldERlbW9Nb2RlKCF0aGlzLmRlbW9Nb2RlKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICByZXNldE91dHB1dCgpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIHRoaXMub25SZXNldE91dHB1dCgpOwogICAgfQogICAgc2hvd0Fib3V0KCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5hYm91dFNob3dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGNsb3NlQWJvdXQoKSB7CiAgICAgICAgdGhpcy5hYm91dFNob3dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBzaG93QW5hbHl0aWMoYW5hbHl0aWNJZCkgewogICAgICAgIGNvbnN0IGFuYWx5dGljID0gdGhpcy5hbmFseXRpY3MuZmluZCgodik9PnYuaWQgPT09IGFuYWx5dGljSWQpOwogICAgICAgIGlmICghYW5hbHl0aWMgfHwgYW5hbHl0aWMuaWQgPT09IHRoaXMuX3NlbGVjdGVkQW5hbHl0aWNJZCkgcmV0dXJuOwogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9maWxlc1t0aGlzLnNlbGVjdGVkUHJvZmlsZUlkXTsKICAgICAgICBpZiAocHJvZmlsZSA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRBbmFseXRpY0lkID0gYW5hbHl0aWNJZDsKICAgICAgICB0aGlzLmFuYWx5dGljc1N0YXRlLnF1ZXJ5aW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmFuYWx5dGljc1N0YXRlLmR1cmFibGVPYmplY3RzQ29zdHMgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5hbmFseXRpY3NTdGF0ZS5lcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENmR3FsQ2xpZW50KHsKICAgICAgICAgICAgYWNjb3VudElkLAogICAgICAgICAgICBhcGlUb2tlbgogICAgICAgIH0pOwogICAgICAgIHRoaXMucXVlcnlEdXJhYmxlT2JqZWN0c0Nvc3RzKGNsaWVudCk7CiAgICB9CiAgICBzZXREZW1vTW9kZShkZW1vTW9kZSkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlID09PSBkZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIHRoaXMuZGVtb01vZGUgPSBkZW1vTW9kZTsKICAgICAgICBpZiAoZGVtb01vZGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0VuYWJsZSBkZW1vIG1vZGUnKTsKICAgICAgICAgICAgdGhpcy5vblFwc0NoYW5nZSgxMi4zNCk7CiAgICAgICAgICAgIHRoaXMub25SZXNldE91dHB1dCgpOwogICAgICAgICAgICBEZW1vTW9kZS5sb2dGYWtlT3V0cHV0KHRoaXMudGFpbENvbnRyb2xsZXJDYWxsYmFja3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEaXNhYmxlIGRlbW8gbW9kZScpOwogICAgICAgICAgICB0aGlzLm9uUXBzQ2hhbmdlKHRoaXMucXBzQ29udHJvbGxlci5xcHMpOwogICAgICAgICAgICB0aGlzLm9uUmVzZXRPdXRwdXQoKTsKICAgICAgICB9CiAgICB9CiAgICBhcHBseUZpbHRlcihvcHRzKSB7CiAgICAgICAgY29uc3QgeyBzYXZlICB9ID0gb3B0czsKICAgICAgICB0aGlzLnN0YXRlLmZpbHRlciA9IHRoaXMuZmlsdGVyOwogICAgICAgIHRoaXMuc3RhdGUuZXh0cmFGaWVsZHMgPSB0aGlzLmV4dHJhRmllbGRzOwogICAgICAgIGlmIChzYXZlKSBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgY29uc3QgdGFpbE9wdGlvbnMgPSBjb21wdXRlVGFpbE9wdGlvbnNGb3JGaWx0ZXIodGhpcy5maWx0ZXIpOwogICAgICAgIHRoaXMudGFpbENvbnRyb2xsZXIuc2V0VGFpbE9wdGlvbnModGFpbE9wdGlvbnMpOwogICAgfQogICAgbG9nV2l0aFByZWZpeCguLi5kYXRhNSkgewogICAgICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpOwogICAgICAgIGlmIChkYXRhNS5sZW5ndGggPiAwICYmIHR5cGVvZiBkYXRhNVswXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgZGF0YTUgPSBbCiAgICAgICAgICAgICAgICBgWyVjJHt0aW1lfSVjXSAke2RhdGE1WzBdfWAsCiAgICAgICAgICAgICAgICAnY29sb3I6IGdyYXknLAogICAgICAgICAgICAgICAgJycsCiAgICAgICAgICAgICAgICAuLi5kYXRhNS5zbGljZSgxKQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZ2dlciguLi5kYXRhNSk7CiAgICB9CiAgICB2ZXJib3NlV2l0aFByZWZpeChtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgdGltZSA9IGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUoKSk7CiAgICAgICAgdGhpcy5sb2dnZXIoYFslYyR7dGltZX0lY10gJWMke21lc3NhZ2V9JWNgLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5Jyk7CiAgICB9CiAgICBwZXJmb3JtSW5pdGlhbFNlbGVjdGlvbigpIHsKICAgICAgICBjb25zdCBpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZCA9IGNvbXB1dGVJbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZCh0aGlzLnN0YXRlLCB0aGlzLl9wcm9maWxlcyk7CiAgICAgICAgaWYgKGluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbml0aWFsbHkgc2VsZWN0aW5nIHByb2ZpbGU6ICR7dGhpcy5zdGF0ZS5wcm9maWxlc1tpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZF0ubmFtZX1gKTsKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9IGluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyB0cnlTYXZlUHJvZmlsZShwcm9maWxlSWQsIHByb2ZpbGUpIHsKICAgICAgICBjb25zdCB7IHByb2ZpbGVGb3JtICB9ID0gdGhpczsKICAgICAgICBwcm9maWxlRm9ybS5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgcHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlID0gdHJ1ZTsKICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJ0NoZWNraW5nIHByb2ZpbGUuLi4nOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBjYW5MaXN0VGFpbHMgPSBhd2FpdCBjb21wdXRlQ2FuTGlzdFRhaWxzKHByb2ZpbGUuYWNjb3VudElkLCBwcm9maWxlLmFwaVRva2VuKTsKICAgICAgICAgICAgaWYgKGNhbkxpc3RUYWlscykgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdID0gcHJvZmlsZTsKICAgICAgICAgICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkUHJvZmlsZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb21wdXRlV2VsY29tZVNob3dpbmcoKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgPSBwcm9maWxlSWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gYFRoZXNlIGNyZWRlbnRpYWxzIGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gdGFpbGA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSBgRXJyb3I6ICR7ZS5tZXNzYWdlfWA7CiAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICBwcm9maWxlRm9ybS5wcm9ncmVzc1Zpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgcHJvZmlsZUZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICByZWxvYWRQcm9maWxlcygpIHsKICAgICAgICBjb25zdCB7IHN0YXRlICB9ID0gdGhpczsKICAgICAgICB0aGlzLl9wcm9maWxlcy5zcGxpY2UoMCk7CiAgICAgICAgZm9yIChjb25zdCBbcHJvZmlsZUlkLCBwcm9maWxlXSBvZiBPYmplY3QuZW50cmllcyhzdGF0ZS5wcm9maWxlcykpewogICAgICAgICAgICBjb25zdCBuYW1lID0gcHJvZmlsZS5uYW1lIHx8ICcodW5uYW1lZCknOwogICAgICAgICAgICB0aGlzLl9wcm9maWxlcy5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBwcm9maWxlSWQsCiAgICAgICAgICAgICAgICB0ZXh0OiBuYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGZpbmRTY3JpcHRzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgICAgIGlmIChwcm9maWxlID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICAgICAgICAgIHRoaXMudmVyYm9zZVdpdGhQcmVmaXgoYEZpbmRpbmcgc2NyaXB0cyBmb3IgJHtwcm9maWxlLm5hbWUudG9VcHBlckNhc2UoKX0uLi5gKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjb25zdCBzY3JpcHRzID0gYXdhaXQgbGlzdFNjcmlwdHMoYWNjb3VudElkLCBhcGlUb2tlbik7CiAgICAgICAgICAgIGlmICghdGhpcy5kZW1vTW9kZSkgdGhpcy52ZXJib3NlV2l0aFByZWZpeChgRm91bmQgJHtzY3JpcHRzLmxlbmd0aH0gc2NyaXB0cyBpbiAke0RhdGUubm93KCkgLSBzdGFydH1tc2ApOwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNwbGljZSgwKTsKICAgICAgICAgICAgZm9yIChjb25zdCBzY3JpcHQgb2Ygc2NyaXB0cyl7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBzY3JpcHQuaWQsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogc2NyaXB0LmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNvcnQoKGxocywgcmhzKT0+bGhzLnRleHQubG9jYWxlQ29tcGFyZShyaHMudGV4dCkpOwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZFNjcmlwdElkcyA9IHRoaXMuY29tcHV0ZVNlbGVjdGVkU2NyaXB0SWRzQWZ0ZXJGaW5kU2NyaXB0cygpOwogICAgICAgICAgICBpZiAoc2VsZWN0ZWRTY3JpcHRJZHMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTY3JpcHRJZHMgPSBzZWxlY3RlZFNjcmlwdElkczsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuZGVtb01vZGUpIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZW1vTW9kZSkgdGhpcy5sb2dnZXIoYEVycm9yIGluIGZpbmRTY3JpcHRzOiAke2Uuc3RhY2t9YCk7CiAgICAgICAgfQogICAgfQogICAgY29tcHV0ZVNlbGVjdGVkU2NyaXB0SWRzQWZ0ZXJGaW5kU2NyaXB0cygpIHsKICAgICAgICBpZiAodGhpcy5fc2NyaXB0cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0luaXRpYWxseSBzZWxlY3Rpbmcgbm8gc2NyaXB0cywgbm8gc2NyaXB0cyB0byBzZWxlY3QnKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTZXQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgJiYgdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCAmJiB0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB0aGlzLnN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkKSB7CiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxQcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9maWxlc1t0aGlzLnNlbGVjdGVkUHJvZmlsZUlkXTsKICAgICAgICAgICAgaWYgKGluaXRpYWxQcm9maWxlICYmIGluaXRpYWxQcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzICYmIGluaXRpYWxQcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY3JpcHRJZHMgPSBuZXcgU2V0KHRoaXMuX3NjcmlwdHMubWFwKCh2KT0+di5pZCkpOwogICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IHNldEludGVyc2VjdChjdXJyZW50U2NyaXB0SWRzLCBuZXcgU2V0KGluaXRpYWxQcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzKSk7CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlcy5zaXplID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbml0aWFsbHkgc2VsZWN0aW5nIHNjcmlwdCR7Y2FuZGlkYXRlcy5zaXplID09PSAxID8gJycgOiAncyd9ICR7WwogICAgICAgICAgICAgICAgICAgICAgICAuLi5jYW5kaWRhdGVzCiAgICAgICAgICAgICAgICAgICAgXS5zb3J0KCkuam9pbignLCAnKX06IHJlbWVtYmVyZWQgZnJvbSBsYXN0IHRpbWVgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBmaXJzdFNjcmlwdElkID0gdGhpcy5fc2NyaXB0c1swXS5pZDsKICAgICAgICBjb25zb2xlLmxvZyhgSW5pdGlhbGx5IHNlbGVjdGluZyBzY3JpcHQgJHtmaXJzdFNjcmlwdElkfTogZmlyc3Qgb25lIGluIHRoZSBsaXN0YCk7CiAgICAgICAgcmV0dXJuIG5ldyBTZXQoWwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzWzBdLmlkCiAgICAgICAgXSk7CiAgICB9CiAgICBhc3luYyBzZXRUYWlscygpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgaWYgKHByb2ZpbGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMudGFpbENvbnRyb2xsZXIuc2V0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbiwgdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHMpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5sb2dnZXIoJ0Vycm9yIGluIHNldFRhaWxzJywgZS5zdGFjayB8fCBlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVBZGRpdGlvbmFsTG9ncyhtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgcnQgPSBbXTsKICAgICAgICBjb25zdCBpbmNsdWRlSXBBZGRyZXNzID0gdGhpcy5leHRyYUZpZWxkcy5pbmNsdWRlcygnaXAtYWRkcmVzcycpOwogICAgICAgIGNvbnN0IGluY2x1ZGVVc2VyQWdlbnQgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCd1c2VyLWFnZW50Jyk7CiAgICAgICAgY29uc3QgaW5jbHVkZVJlZmVyZXIgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCdyZWZlcmVyJyk7CiAgICAgICAgaWYgKGluY2x1ZGVJcEFkZHJlc3MgfHwgaW5jbHVkZVVzZXJBZ2VudCB8fCBpbmNsdWRlUmVmZXJlcikgewogICAgICAgICAgICBpZiAobWVzc2FnZS5ldmVudCAhPT0gbnVsbCAmJiAhaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlLmV2ZW50KSkgewogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVJcEFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpcEFkZHJlc3MgPSBtZXNzYWdlLmV2ZW50LnJlcXVlc3QuaGVhZGVyc1snY2YtY29ubmVjdGluZy1pcCddIHx8IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBpZiAoaXBBZGRyZXNzKSBydC5wdXNoKGNvbXB1dGVBZGRpdGlvbmFsTG9nRm9yRXh0cmFGaWVsZCgnSVAgYWRkcmVzcycsIGlwQWRkcmVzcykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVVc2VyQWdlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyQWdlbnQgPSBtZXNzYWdlLmV2ZW50LnJlcXVlc3QuaGVhZGVyc1sndXNlci1hZ2VudCddIHx8IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlckFnZW50KSBydC5wdXNoKGNvbXB1dGVBZGRpdGlvbmFsTG9nRm9yRXh0cmFGaWVsZCgnVXNlciBhZ2VudCcsIHVzZXJBZ2VudCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVSZWZlcmVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmZXJlciA9IG1lc3NhZ2UuZXZlbnQucmVxdWVzdC5oZWFkZXJzWydyZWZlcmVyJ10gfHwgdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWZlcmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZmVyZXJVcmwgPSB0cnlQYXJzZVVybChyZWZlcmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxvZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWZlcmVyVXJsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RVcmwgPSB0cnlQYXJzZVVybChtZXNzYWdlLmV2ZW50LnJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0VXJsICYmIHJlcXVlc3RVcmwub3JpZ2luID09PSByZWZlcmVyVXJsLm9yaWdpbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2cpIHJ0LnB1c2goY29tcHV0ZUFkZGl0aW9uYWxMb2dGb3JFeHRyYUZpZWxkKCdSZWZlcmVyJywgcmVmZXJlcikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcnQ7CiAgICB9CiAgICByZWNvbXB1dGVXZWxjb21lU2hvd2luZygpIHsKICAgICAgICBjb25zdCBzaG91bGRTaG93ID0gdGhpcy5wcm9maWxlcy5sZW5ndGggPT09IDA7CiAgICAgICAgaWYgKHNob3VsZFNob3cgPT09IHRoaXMud2VsY29tZVNob3dpbmcpIHJldHVybjsKICAgICAgICB0aGlzLnNldERlbW9Nb2RlKHNob3VsZFNob3cpOwogICAgICAgIHRoaXMud2VsY29tZVNob3dpbmcgPSBzaG91bGRTaG93OwogICAgfQogICAgYXN5bmMgcXVlcnlEdXJhYmxlT2JqZWN0c0Nvc3RzKGNsaWVudCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuYW5hbHl0aWNzU3RhdGUuZHVyYWJsZU9iamVjdHNDb3N0cyA9IGF3YWl0IGNvbXB1dGVEdXJhYmxlT2JqZWN0c0Nvc3RzVGFibGUoY2xpZW50LCB7CiAgICAgICAgICAgICAgICBsb29rYmFja0RheXM6IDI4CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodGhpcy5hbmFseXRpY3NTdGF0ZS5kdXJhYmxlT2JqZWN0c0Nvc3RzLmFjY291bnRUYWJsZS5yb3dzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5hbmFseXRpY3NTdGF0ZS5kdXJhYmxlT2JqZWN0c0Nvc3RzID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBkdXJhYmxlIG9iamVjdCBhbmFseXRpY3MgZm91bmQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGUpOwogICAgICAgICAgICBsZXQgZXJyb3IgPSBgJHtlfWA7CiAgICAgICAgICAgIGlmIChlcnJvci5pbmNsdWRlcygnKGNvZGU9YXV0aHopJykpIHsKICAgICAgICAgICAgICAgIGVycm9yID0gYFRoZSBhdXRoIHRva2VuIGZvciB0aGlzIHByb2ZpbGUgZG9lcyBub3QgaGF2ZSB0aGUgQWNjb3VudCBBbmFseXRpY3M6UmVhZCBwZXJtaXNzaW9uLmA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5hbmFseXRpY3NTdGF0ZS5lcnJvciA9IGVycm9yOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5hbmFseXRpY3NTdGF0ZS5xdWVyeWluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGNvbXB1dGVBZGRpdGlvbmFsTG9nRm9yRXh0cmFGaWVsZChuYW1lLCB2YWx1ZSkgewogICAgcmV0dXJuIHsKICAgICAgICBkYXRhOiBbCiAgICAgICAgICAgIGAgJWN8JWMgWyVjJHtuYW1lfSVjXSAke3ZhbHVlfWAsCiAgICAgICAgICAgICdjb2xvcjpncmF5JywKICAgICAgICAgICAgJycsCiAgICAgICAgICAgICdjb2xvcjpncmF5JwogICAgICAgIF0KICAgIH07Cn0KY2xhc3MgUHJvZmlsZUZvcm1WTSB7CiAgICBzaG93aW5nID0gZmFsc2U7CiAgICBlbmFibGVkID0gZmFsc2U7CiAgICBuYW1lID0gJyc7CiAgICBhY2NvdW50SWQgPSAnJzsKICAgIGFwaVRva2VuID0gJyc7CiAgICBkZWxldGVWaXNpYmxlID0gZmFsc2U7CiAgICBzYXZlRW5hYmxlZCA9IGZhbHNlOwogICAgcHJvZmlsZUlkID0gJyc7CiAgICB0aXRsZSA9ICcnOwogICAgcHJvZ3Jlc3NWaXNpYmxlID0gZmFsc2U7CiAgICBvdXRwdXRNZXNzYWdlID0gJyc7CiAgICBjb21wdXRlU2F2ZUVuYWJsZWQoKSB7CiAgICAgICAgdGhpcy5zYXZlRW5hYmxlZCA9IHRoaXMubmFtZS50cmltKCkubGVuZ3RoID4gMCAmJiB0aGlzLmFwaVRva2VuLnRyaW0oKS5sZW5ndGggPiAwICYmIHRoaXMuYWNjb3VudElkLnRyaW0oKS5sZW5ndGggPiAwOwogICAgfQp9CmNsYXNzIEZpbHRlckZvcm1WTSB7CiAgICBzaG93aW5nID0gZmFsc2U7CiAgICBlbmFibGVkID0gZmFsc2U7CiAgICBmaWVsZE5hbWUgPSAnJzsKICAgIGZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICBmaWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgZmllbGRWYWx1ZTsKICAgIGhlbHBUZXh0ID0gJyc7CiAgICBvdXRwdXRNZXNzYWdlID0gJyc7CiAgICBhcHBseVZhbHVlID0gKCk9Pnt9Owp9CmNvbnN0IEVYVFJBX0ZJRUxEU19PUFRJT05TID0gWwogICAgewogICAgICAgIGlkOiAnaXAtYWRkcmVzcycsCiAgICAgICAgdGV4dDogJ0lQIGFkZHJlc3MnCiAgICB9LAogICAgewogICAgICAgIGlkOiAndXNlci1hZ2VudCcsCiAgICAgICAgdGV4dDogJ1VzZXIgYWdlbnQnCiAgICB9LAogICAgewogICAgICAgIGlkOiAncmVmZXJlcicsCiAgICAgICAgdGV4dDogJ1JlZmVyZXInCiAgICB9LCAKXTsKY29uc3QgU1RBVEVfS0VZID0gJ3N0YXRlMSc7CmZ1bmN0aW9uIGxvYWRTdGF0ZSgpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QganNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUQVRFX0tFWSkgfHwgdW5kZWZpbmVkOwogICAgICAgIGlmIChqc29uKSB7CiAgICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UoanNvbik7CiAgICAgICAgICAgIGNvbnN0IHJ0ID0gcGFyc2VTdGF0ZShvYmopOwogICAgICAgICAgICByZXR1cm4gcnQ7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignbG9hZFN0YXRlOiBFcnJvciBsb2FkaW5nIHN0YXRlJywgZS5zdGFjayB8fCBlKTsKICAgIH0KICAgIGNvbnNvbGUubG9nKCdsb2FkU3RhdGU6IHJldHVybmluZyBuZXcgc3RhdGUnKTsKICAgIHJldHVybiB7CiAgICAgICAgcHJvZmlsZXM6IHt9CiAgICB9Owp9CmZ1bmN0aW9uIHBhcnNlU3RhdGUocGFyc2VkKSB7CiAgICBpZiAodHlwZW9mIHBhcnNlZCAhPT0gJ29iamVjdCcpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgb2JqZWN0YCk7CiAgICBjb25zdCB7IHByb2ZpbGVzICB9ID0gcGFyc2VkOwogICAgaWYgKHR5cGVvZiBwcm9maWxlcyAhPT0gJ29iamVjdCcpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgcHJvZmlsZXMgb2JqZWN0YCk7CiAgICBmb3IgKGNvbnN0IFtwcm9maWxlSWQsIHByb2ZpbGVTdGF0ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvZmlsZXMpKXsKICAgICAgICBpZiAodHlwZW9mIHByb2ZpbGVJZCAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignUHJvZmlsZSBpZCBtdXN0IGJlIHN0cmluZycpOwogICAgICAgIHBhcnNlUHJvZmlsZVN0YXRlKHByb2ZpbGVTdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcGFyc2VkOwp9CmZ1bmN0aW9uIHBhcnNlUHJvZmlsZVN0YXRlKHBhcnNlZCkgewogICAgaWYgKHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnIHx8IHBhcnNlZCA9PT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKCdQcm9maWxlIHN0YXRlIG11c3QgYmUgb2JqZWN0Jyk7CiAgICBjb25zdCB7IG5hbWUgLCBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHBhcnNlZDsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgbmFtZS50cmltKCkubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgc3RhdGUgbmFtZSBtdXN0IGV4aXN0YCk7CiAgICBpZiAodHlwZW9mIGFjY291bnRJZCAhPT0gJ3N0cmluZycgfHwgYWNjb3VudElkLnRyaW0oKS5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSBzdGF0ZSBhY2NvdW50SWQgbXVzdCBleGlzdGApOwogICAgaWYgKHR5cGVvZiBhcGlUb2tlbiAhPT0gJ3N0cmluZycgfHwgYXBpVG9rZW4udHJpbSgpLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlIHN0YXRlIGFwaVRva2VuIG11c3QgZXhpc3RgKTsKICAgIHJldHVybiBwYXJzZWQ7Cn0KZnVuY3Rpb24gc2F2ZVN0YXRlKHN0YXRlKSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVEFURV9LRVksIEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7Cn0KYXN5bmMgZnVuY3Rpb24gY29tcHV0ZUNhbkxpc3RUYWlscyhhY2NvdW50SWQsIGFwaVRva2VuKSB7CiAgICB0cnkgewogICAgICAgIGF3YWl0IGxpc3RUYWlscyhhY2NvdW50SWQsICcnLCBhcGlUb2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBDbG91ZGZsYXJlQXBpRXJyb3IgJiYgZS5zdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2Uge30KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KZnVuY3Rpb24gaXNWYWxpZFNhbXBsaW5nUmF0ZShzYW1wbGluZ1JhdGUpIHsKICAgIHJldHVybiAhaXNOYU4oc2FtcGxpbmdSYXRlKSAmJiBzYW1wbGluZ1JhdGUgPj0gMCAmJiBzYW1wbGluZ1JhdGUgPD0gMTsKfQpmdW5jdGlvbiBjb21wdXRlSW5pdGlhbGx5U2VsZWN0ZWRQcm9maWxlSWQoc3RhdGUsIHByb2ZpbGVzKSB7CiAgICBpZiAoc3RhdGUuc2VsZWN0ZWRQcm9maWxlSWQgJiYgc3RhdGUucHJvZmlsZXNbc3RhdGUuc2VsZWN0ZWRQcm9maWxlSWRdKSByZXR1cm4gc3RhdGUuc2VsZWN0ZWRQcm9maWxlSWQ7CiAgICBpZiAocHJvZmlsZXMubGVuZ3RoID4gMCkgcmV0dXJuIHByb2ZpbGVzWzBdLmlkOwogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBjb21wdXRlVGFpbE9wdGlvbnNGb3JGaWx0ZXIoZmlsdGVyKSB7CiAgICBjb25zdCBmaWx0ZXJzID0gW107CiAgICBpZiAoZmlsdGVyLnN0YXR1czEgPT09ICdlcnJvcicpIHsKICAgICAgICBmaWx0ZXJzLnB1c2goewogICAgICAgICAgICBvdXRjb21lOiBbCiAgICAgICAgICAgICAgICAnZXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICdleGNlZWRlZENwdScsCiAgICAgICAgICAgICAgICAnY2FuY2VsZWQnLAogICAgICAgICAgICAgICAgJ3Vua25vd24nCiAgICAgICAgICAgIF0KICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAoZmlsdGVyLnN0YXR1czEgPT09ICdzdWNjZXNzJykgewogICAgICAgIGZpbHRlcnMucHVzaCh7CiAgICAgICAgICAgIG91dGNvbWU6IFsKICAgICAgICAgICAgICAgICdvaycKICAgICAgICAgICAgXQogICAgICAgIH0pOwogICAgfQogICAgaWYgKGZpbHRlci5zYW1wbGluZ1JhdGUxICE9PSB1bmRlZmluZWQgJiYgaXNWYWxpZFNhbXBsaW5nUmF0ZShmaWx0ZXIuc2FtcGxpbmdSYXRlMSkgJiYgZmlsdGVyLnNhbXBsaW5nUmF0ZTEgPCAxKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgc2FtcGxpbmdfcmF0ZTogZmlsdGVyLnNhbXBsaW5nUmF0ZTEKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIuc2VhcmNoMSAhPT0gdW5kZWZpbmVkICYmIGZpbHRlci5zZWFyY2gxLmxlbmd0aCA+IDApIHsKICAgICAgICBmaWx0ZXJzLnB1c2goewogICAgICAgICAgICBxdWVyeTogZmlsdGVyLnNlYXJjaDEKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIubWV0aG9kMSAmJiBmaWx0ZXIubWV0aG9kMS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgbWV0aG9kOiBmaWx0ZXIubWV0aG9kMQogICAgICAgIH0pOwogICAgfQogICAgaWYgKGZpbHRlci5pcEFkZHJlc3MxICYmIGZpbHRlci5pcEFkZHJlc3MxLmxlbmd0aCA+IDApIHsKICAgICAgICBmaWx0ZXJzLnB1c2goewogICAgICAgICAgICBjbGllbnRfaXA6IGZpbHRlci5pcEFkZHJlc3MxCiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZmlsdGVyLmhlYWRlcjEgJiYgZmlsdGVyLmhlYWRlcjEubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAoY29uc3QgaGVhZGVyIG9mIGZpbHRlci5oZWFkZXIxKXsKICAgICAgICAgICAgZmlsdGVycy5wdXNoKHBhcnNlSGVhZGVyRmlsdGVyKGhlYWRlcikpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgZmlsdGVycwogICAgfTsKfQpmdW5jdGlvbiBjb21wdXRlTWVzc2FnZVBhc3Nlc0ZpbHRlcihtZXNzYWdlLCBmaWx0ZXIpIHsKICAgIGlmICghY29tcHV0ZU1lc3NhZ2VQYXNzZXNMb2dQcm9wRmlsdGVyKG1lc3NhZ2UsIGZpbHRlci5sb2dwcm9wMSkpIHJldHVybiBmYWxzZTsKICAgIGlmIChmaWx0ZXIuZXZlbnQxID09PSAnY3JvbicgfHwgZmlsdGVyLmV2ZW50MSA9PT0gJ2h0dHAnKSB7CiAgICAgICAgY29uc3QgaXNDcm9uID0gaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlKTsKICAgICAgICByZXR1cm4gaXNDcm9uICYmIGZpbHRlci5ldmVudDEgPT09ICdjcm9uJyB8fCAhaXNDcm9uICYmIGZpbHRlci5ldmVudDEgPT09ICdodHRwJzsKICAgIH0KICAgIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGNvbXB1dGVNZXNzYWdlUGFzc2VzTG9nUHJvcEZpbHRlcihtZXNzYWdlLCBsb2dwcm9wMSkgewogICAgaWYgKGxvZ3Byb3AxID09PSB1bmRlZmluZWQgfHwgbG9ncHJvcDEubGVuZ3RoID09PSAwKSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IGxvZ3Byb3BGaWx0ZXJzID0gbG9ncHJvcDEubWFwKHBhcnNlSGVhZGVyRmlsdGVyKTsKICAgIGNvbnN0IHsgcHJvcHMgIH0gPSBwYXJzZUxvZ1Byb3BzKG1lc3NhZ2UubG9ncyk7CiAgICBmb3IgKGNvbnN0IGxvZ3Byb3BGaWx0ZXIgb2YgbG9ncHJvcEZpbHRlcnMpewogICAgICAgIGlmIChjb21wdXRlUHJvcHNQYXNzTG9ncHJvcEZpbHRlcihwcm9wcywgbG9ncHJvcEZpbHRlcikpIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGNvbXB1dGVQcm9wc1Bhc3NMb2dwcm9wRmlsdGVyKHByb3BzLCBsb2dwcm9wRmlsdGVyKSB7CiAgICBjb25zdCB2YWwgPSBwcm9wc1tsb2dwcm9wRmlsdGVyLmtleV07CiAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHJldHVybiBmYWxzZTsKICAgIGlmIChsb2dwcm9wRmlsdGVyLnF1ZXJ5ID09PSB1bmRlZmluZWQpIHJldHVybiB0cnVlOwogICAgY29uc3QgcSA9IGxvZ3Byb3BGaWx0ZXIucXVlcnkudHJpbSgpLnJlcGxhY2VBbGwoL1wqKy9nLCAnKicpOwogICAgaWYgKCFxLmluY2x1ZGVzKCcqJykpIHJldHVybiBxID09PSB2YWw7CiAgICBpZiAocSA9PT0gJyonKSByZXR1cm4gdHJ1ZTsKICAgIGlmICh0eXBlb2YgdmFsICE9PSAnc3RyaW5nJykgcmV0dXJuIGZhbHNlOwogICAgY29uc3QgcGF0dGVybiA9ICdeJyArIGVzY2FwZUZvclJlZ2V4KHEpLnJlcGxhY2VBbGwoJ1xcKicsICcuKicpICsgJyQnOwogICAgcmV0dXJuIG5ldyBSZWdFeHAocGF0dGVybikudGVzdCh2YWwpOwp9CmZ1bmN0aW9uIGVzY2FwZUZvclJlZ2V4KHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLVwvXFxeJCorPy4oKXxbXF17fV0vZywgJ1xcJCYnKTsKfQpmdW5jdGlvbiBkaXN0aW5jdCh2YWx1ZXMpIHsKICAgIGNvbnN0IHJ0ID0gW107CiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlcyl7CiAgICAgICAgaWYgKCFydC5pbmNsdWRlcyh2YWx1ZSkpIHsKICAgICAgICAgICAgcnQucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJ0Owp9CmZ1bmN0aW9uIHRyeVBhcnNlVXJsKHVybCkgewogICAgdHJ5IHsKICAgICAgICByZXR1cm4gbmV3IFVSTCh1cmwpOwogICAgfSBjYXRjaCAgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9Cn0KY29uc3QgRklMVEVSX0VESVRPUl9IVE1MID0gaHRtbGAKPGZvcm0gaWQ9ImZpbHRlci1mb3JtIiBhdXRvY29tcGxldGU9Im9mZiI+CjxmaWVsZHNldCBpZD0iZmlsdGVyLWZpZWxkc2V0Ij4KICA8ZGl2IGlkPSJmaWx0ZXItZm9ybS10aXRsZSIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCBmb3JtLXJvdyI+RWRpdCBmaWx0ZXI8L2Rpdj4KCiAgPGxhYmVsIGlkPSJmaWx0ZXItZmllbGQtbGFiZWwiPkZpbHRlciBmaWVsZDo8L2xhYmVsPgogIDxpbnB1dCBpZD0iZmlsdGVyLWZpZWxkLXRleHQiIHR5cGU9InRleHQiPgogIDxkaXYgaWQ9ImZpbHRlci1maWVsZC1jaG9pY2UiPjwvZGl2PgogIDxkaXYgaWQ9ImZpbHRlci1maWVsZC1vcHRpb25zIj48L2Rpdj4KCiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0taGVscCIgY2xhc3M9ImJvZHkyIG1lZGl1bS1lbXBoYXNpcy10ZXh0Ij4KICA8L2Rpdj4gIAoKICA8ZGl2IGlkPSJmaWx0ZXItZm9ybS1vdXRwdXQtcm93IiBjbGFzcz0iZm9ybS1yb3ciPgogICAgPG91dHB1dCBpZD0iZmlsdGVyLWZvcm0tb3V0cHV0Ij48L291dHB1dD4KICA8L2Rpdj4KCiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0tYnV0dG9ucyIgY2xhc3M9ImZvcm0tcmhzIj4KICAgIDxidXR0b24gaWQ9ImZpbHRlci1hcHBseSIgdHlwZT0ic3VibWl0Ij5BcHBseTwvYnV0dG9uPjwhLS0gZmlyc3Qgc28gaXQgaXMgZGVmYXVsdCBidXR0b24gb24gcmV0dXJuIC0tPgogICAgPGJ1dHRvbiBpZD0iZmlsdGVyLWNhbmNlbCI+Q2FuY2VsPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgRklMVEVSX0VESVRPUl9DU1MgPSBjc3NgCgogICAgI2ZpbHRlci1mb3JtLWJ1dHRvbnMgewogICAgICAgIGp1c3RpZnktc2VsZjogZW5kOwogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IHJvdy1yZXZlcnNlOwogICAgICAgIGdhcDogMXJlbTsKICAgIH0KCiAgICAjZmlsdGVyLWZpZWxkLWNob2ljZSB7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBnYXA6IDFweDsKICAgIH0KCiAgICAjZmlsdGVyLWZpZWxkLW9wdGlvbnMgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAgIGdhcDogMXB4OwogICAgfQoKICAgICNmaWx0ZXItZmllbGQtb3B0aW9ucyBidXR0b24gewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBnYXA6IDAuNXJlbTsKICAgIH0KCiAgICAjZmlsdGVyLWZvcm0taGVscCB7CiAgICAgICAgZ3JpZC1jb2x1bW46IDI7CiAgICB9CgogICAgI2ZpbHRlci1mb3JtLW91dHB1dC1yb3cgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgbWluLWhlaWdodDogMi41cmVtOwogICAgfQoKICAgICNmaWx0ZXItZm9ybS1vdXRwdXQtcm93IG91dHB1dCB7CiAgICAgICAgZmxleC1ncm93OiAxOwogICAgfQoKYDsKZnVuY3Rpb24gaW5pdEZpbHRlckVkaXRvcihkb2N1bWVudCwgdm03KSB7CiAgICBjb25zdCBmaWx0ZXJGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1mb3JtJyk7CiAgICBjb25zdCBmaWx0ZXJGaWVsZHNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZmllbGRzZXQnKTsKICAgIGNvbnN0IGZpbHRlckZpZWxkTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkLWxhYmVsJyk7CiAgICBjb25zdCBmaWx0ZXJGaWVsZFRleHRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZmllbGQtdGV4dCcpOwogICAgY29uc3QgZmlsdGVyRmllbGRDaG9pY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkLWNob2ljZScpOwogICAgY29uc3QgZmlsdGVyRmllbGRPcHRpb25zRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1maWVsZC1vcHRpb25zJyk7CiAgICBjb25zdCBmaWx0ZXJDYW5jZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWNhbmNlbCcpOwogICAgY29uc3QgZmlsdGVyQXBwbHlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWFwcGx5Jyk7CiAgICBjb25zdCBmaWx0ZXJGb3JtT3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1mb3JtLW91dHB1dCcpOwogICAgY29uc3QgZmlsdGVyRm9ybUhlbHBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZvcm0taGVscCcpOwogICAgZmlsdGVyQ2FuY2VsQnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm03LmNhbmNlbEZpbHRlcigpOwogICAgfTsKICAgIGZpbHRlckFwcGx5QnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc3QgdHlwZSA9IGNvbXB1dGVUeXBlKHZtNyk7CiAgICAgICAgaWYgKHR5cGUgPT09ICd0ZXh0JykgewogICAgICAgICAgICB2bTcuZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmlsdGVyRmllbGRUZXh0SW5wdXQudmFsdWU7CiAgICAgICAgfQogICAgICAgIHZtNy5zYXZlRmlsdGVyKCk7CiAgICB9OwogICAgcmV0dXJuICgpPT57CiAgICAgICAgY29uc3Qgd2FzSGlkZGVuID0gZmlsdGVyRm9ybS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZSc7CiAgICAgICAgZmlsdGVyRm9ybS5zdHlsZS5kaXNwbGF5ID0gdm03LmZpbHRlckZvcm0uc2hvd2luZyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgZmlsdGVyRmllbGRzZXQuZGlzYWJsZWQgPSAhdm03LmZpbHRlckZvcm0uZW5hYmxlZDsKICAgICAgICBjb25zdCB0eXBlID0gY29tcHV0ZVR5cGUodm03KTsKICAgICAgICBmaWx0ZXJGaWVsZExhYmVsLnRleHRDb250ZW50ID0gdm03LmZpbHRlckZvcm0uZmllbGROYW1lOwogICAgICAgIGZpbHRlckZpZWxkTGFiZWwuaHRtbEZvciA9IHR5cGUgPT0gJ2Nob2ljZScgPyBmaWx0ZXJGaWVsZENob2ljZURpdi5pZCA6IHR5cGUgPT0gJ29wdGlvbnMnID8gZmlsdGVyRmllbGRPcHRpb25zRGl2LmlkIDogZmlsdGVyRmllbGRUZXh0SW5wdXQuaWQ7CiAgICAgICAgZmlsdGVyRmllbGRUZXh0SW5wdXQuc3R5bGUuZGlzcGxheSA9IHR5cGUgPT0gJ3RleHQnID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBmaWx0ZXJGaWVsZENob2ljZURpdi5zdHlsZS5kaXNwbGF5ID0gdHlwZSA9PSAnY2hvaWNlJyA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihDSE9JQ0VTX0hUTUwodm03KSwgZmlsdGVyRmllbGRDaG9pY2VEaXYpOwogICAgICAgIGZpbHRlckZpZWxkT3B0aW9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gdHlwZSA9PSAnb3B0aW9ucycgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoT1BUSU9OU19IVE1MKHZtNyksIGZpbHRlckZpZWxkT3B0aW9uc0Rpdik7CiAgICAgICAgZmlsdGVyRm9ybUhlbHBEaXYudGV4dENvbnRlbnQgPSB2bTcuZmlsdGVyRm9ybS5oZWxwVGV4dDsKICAgICAgICBmaWx0ZXJGb3JtT3V0cHV0LnRleHRDb250ZW50ID0gdm03LmZpbHRlckZvcm0ub3V0cHV0TWVzc2FnZTsKICAgICAgICBpZiAod2FzSGlkZGVuICYmIHZtNy5maWx0ZXJGb3JtLnNob3dpbmcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZpbHRlciBmb3JtIG9wZW4nKTsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd0ZXh0JyAmJiB2bTcuZmlsdGVyRm9ybS5maWVsZFZhbHVlKSBmaWx0ZXJGaWVsZFRleHRJbnB1dC52YWx1ZSA9IHZtNy5maWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkVGV4dElucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZFRleHRJbnB1dC5zZWxlY3QoKTsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgfQogICAgfTsKfQpmdW5jdGlvbiBjb21wdXRlVHlwZSh2bTgpIHsKICAgIHJldHVybiB2bTguZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcy5sZW5ndGggPiAwID8gJ2Nob2ljZScgOiB2bTguZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucy5sZW5ndGggPyAnb3B0aW9ucycgOiAndGV4dCc7Cn0KY29uc3QgQ0hPSUNFU19IVE1MID0gKHZtOSk9PnsKICAgIHJldHVybiB2bTkuZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcy5tYXAoKGNob2ljZSk9Pmh0bWxgPGJ1dHRvbiBjbGFzcz0iJHtjaG9pY2UuaWQgPT09IHZtOS5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPyAnc2VsZWN0ZWQnIDogJyd9IiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2bTkuc2VsZWN0RmlsdGVyQ2hvaWNlKGNob2ljZS5pZCk7CiAgICAgICAgfX0gP2Rpc2FibGVkPSIkeyF2bTkuZmlsdGVyRm9ybS5zaG93aW5nfSI+JHtjaG9pY2UudGV4dH08L2J1dHRvbj5gKTsKfTsKY29uc3QgT1BUSU9OU19IVE1MID0gKHZtMTApPT57CiAgICByZXR1cm4gdm0xMC5maWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zLm1hcCgob3B0aW9uKT0+ewogICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZmllbGRWYWx1ZVNldCh2bTEwKS5oYXMob3B0aW9uLmlkKTsKICAgICAgICByZXR1cm4gaHRtbGA8YnV0dG9uIGNsYXNzPSIke3NlbGVjdGVkID8gJ3NlbGVjdGVkJyA6ICcnfSIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdm0xMC50b2dnbGVGaWx0ZXJPcHRpb24ob3B0aW9uLmlkKTsKICAgICAgICB9fSA/ZGlzYWJsZWQ9IiR7IXZtMTAuZmlsdGVyRm9ybS5zaG93aW5nfSI+JHtzZWxlY3RlZCA/IENIRUNLX0JPWF9DSEVDS0VEX0lDT04gOiBDSEVDS19CT1hfVU5DSEVDS0VEX0lDT059ICR7b3B0aW9uLnRleHR9PC9idXR0b24+YDsKICAgIH0pOwp9OwpmdW5jdGlvbiBmaWVsZFZhbHVlU2V0KHZtMTEpIHsKICAgIHJldHVybiBuZXcgU2V0KCh2bTExLmZpbHRlckZvcm0uZmllbGRWYWx1ZSB8fCAnJykuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKSkuZmlsdGVyKCh2KT0+di5sZW5ndGggPiAwKSk7Cn0KY29uc3QgUFJPRklMRV9FRElUT1JfSFRNTCA9IGh0bWxgCjxmb3JtIGlkPSJwcm9maWxlLWZvcm0iIGF1dG9jb21wbGV0ZT0ib2ZmIj4KPGZpZWxkc2V0IGlkPSJwcm9maWxlLWZpZWxkc2V0Ij4KICA8ZGl2IGlkPSJwcm9maWxlLWZvcm0tdGl0bGUiIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQgZm9ybS1yb3ciPlByb2ZpbGU8L2Rpdj4KCiAgPGxhYmVsIGZvcj0icHJvZmlsZS1uYW1lIj5Qcm9maWxlIG5hbWU6PC9sYWJlbD4KICA8aW5wdXQgaWQ9InByb2ZpbGUtbmFtZSIgdHlwZT0idGV4dCI+CgogIDxsYWJlbCBmb3I9ImFjY291bnQtaWQiPkNsb3VkZmxhcmUgQWNjb3VudCBJRDo8L2xhYmVsPgogIDxpbnB1dCBpZD0icHJvZmlsZS1hY2NvdW50LWlkIiB0eXBlPSJ0ZXh0Ij4KCiAgPGxhYmVsIGZvcj0iYXBpLXRva2VuIj5DbG91ZGZsYXJlIEFQSSBUb2tlbjo8L2xhYmVsPgogIDxpbnB1dCBpZD0icHJvZmlsZS1hcGktdG9rZW4iIHR5cGU9InRleHQiPgoKICA8ZGV0YWlscyBpZD0icHJvZmlsZS1mb3JtLWhlbHAtcm93IiBjbGFzcz0iZm9ybS1yb3ciPgogICAgPHN1bW1hcnk+VXNlIGEgPGEgaHJlZj0iaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUHJpbmNpcGxlX29mX2xlYXN0X3ByaXZpbGVnZSIgdGFyZ2V0PSJfYmxhbmsiPmxlYXN0IHByaXZpbGVnZTwvYT4gdG9rZW4gd2l0aCBwZXJtaXNzaW9uOiA8Y29kZT5BY2NvdW50ICZndDsgV29ya2VycyBUYWlsICZndDsgUmVhZDwvY29kZT48L3N1bW1hcnk+CiAgICA8b2w+CiAgICAgICAgPGxpPlNlbGVjdCA8c3BhbiBjbGFzcz0iY2YtYnV0dG9uIj5DcmVhdGUgVG9rZW48L3NwYW4+IG9uIHlvdXIgQ2xvdWRmbGFyZSA8YSBocmVmPSJodHRwczovL2Rhc2guY2xvdWRmbGFyZS5jb20vcHJvZmlsZS9hcGktdG9rZW5zIiB0YXJnZXQ9Il9ibGFuayI+QVBJIFRva2VuczwvYT4gcGFnZS48L2xpPgogICAgICAgIDxsaT5TY3JvbGwgZG93biB0byA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+Q3JlYXRlIEN1c3RvbSBUb2tlbjwvc3Bhbj4sIHRoZW4gPHNwYW4gY2xhc3M9ImNmLWJ1dHRvbiI+R2V0IHN0YXJ0ZWQ8L3NwYW4+PC9saT4KICAgICAgICA8bGk+VW5kZXIgPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPlBlcm1pc3Npb25zPC9zcGFuPiwgZ3JhbnQgeW91ciB0b2tlbiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+QWNjb3VudDwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPldvcmtlcnMgVGFpbDwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPlJlYWQ8L3NwYW4+PC9saT4KICAgICAgICA8bGk+QWxzbyAoZm9yIGFuYWx5dGljcyksIGdyYW50IHlvdXIgdG9rZW4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPkFjY291bnQ8L3NwYW4+IDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5BY2NvdW50IEFuYWx5dGljczwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPlJlYWQ8L3NwYW4+PC9saT4KICAgICAgICA8bGk+QWxzbyAoZm9yIERPIG5hbWVzKSwgZ3JhbnQgeW91ciB0b2tlbiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+QWNjb3VudDwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPldvcmtlciBTY3JpcHRzPC9zcGFuPiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+UmVhZDwvc3Bhbj48L2xpPgogICAgPC9vbD4KICA8L2RldGFpbHM+ICAKCiAgPGRpdiBpZD0icHJvZmlsZS1mb3JtLW91dHB1dC1yb3ciIGNsYXNzPSJmb3JtLXJvdyI+CiAgICA8b3V0cHV0IGlkPSJwcm9maWxlLWZvcm0tb3V0cHV0Ij48L291dHB1dD4KICAgIDxwcm9ncmVzcyBpZD0icHJvZmlsZS1mb3JtLXByb2dyZXNzIiBjbGFzcz0icHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciI+PC9wcm9ncmVzcz4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iZm9ybS1saHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1kZWxldGUiPkRlbGV0ZTwvYnV0dG9uPgogIDwvZGl2PgogIDxkaXYgaWQ9InByb2ZpbGUtZm9ybS1idXR0b25zIiBjbGFzcz0iZm9ybS1yaHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1jYW5jZWwiPkNhbmNlbDwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1zYXZlIj5TYXZlPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgUFJPRklMRV9FRElUT1JfQ1NTID0gY3NzYAoKICAgICNwcm9maWxlLWZvcm0tYnV0dG9ucyB7CiAgICAgICAganVzdGlmeS1zZWxmOiBlbmQ7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBnYXA6IDFyZW07CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1oZWxwLXJvdyB7CiAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgc3VtbWFyeSB7CiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1oZWxwLXJvdyBvbCB7CiAgICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgbGkgewogICAgICAgIHBhZGRpbmc6IDAuNXJlbSAwOwogICAgfQoKICAgIC5jZi1idXR0b24gewogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibHVlOwogICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICBwYWRkaW5nOiAwLjI1cmVtIDAuNXJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOwogICAgfQoKICAgIC5jZi1zZWN0aW9uIHsKICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgICAgICAgY29sb3I6IGJsYWNrOwogICAgICAgIHBhZGRpbmc6IDAuMjVyZW0gMC41cmVtOwogICAgICAgIG91dGxpbmU6IHNvbGlkIDFweCBncmF5OwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tb3V0cHV0LXJvdyB7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIGdhcDogMXJlbTsKICAgICAgICBtaW4taGVpZ2h0OiAyLjVyZW07CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1vdXRwdXQtcm93IG91dHB1dCB7CiAgICAgICAgZmxleC1ncm93OiAxOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tcHJvZ3Jlc3MgewogICAgICAgIGZvbnQtc2l6ZTogMC41cmVtOyAvKiBkZWZhdWx0IDNlbSA9PiAxLjVyZW0gKi8KICAgIH0KCmA7CmZ1bmN0aW9uIGluaXRQcm9maWxlRWRpdG9yKGRvY3VtZW50LCB2bTEyKSB7CiAgICBjb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0nKTsKICAgIGNvbnN0IHByb2ZpbGVGb3JtVGl0bGVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtLXRpdGxlJyk7CiAgICBjb25zdCBwcm9maWxlRmllbGRzZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1maWVsZHNldCcpOwogICAgY29uc3QgcHJvZmlsZU5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLW5hbWUnKTsKICAgIGNvbnN0IHByb2ZpbGVBY2NvdW50SWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWFjY291bnQtaWQnKTsKICAgIGNvbnN0IHByb2ZpbGVBcGlUb2tlbklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtYXBpLXRva2VuJyk7CiAgICBjb25zdCBwcm9maWxlRGVsZXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZGVsZXRlJyk7CiAgICBjb25zdCBwcm9maWxlQ2FuY2VsQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtY2FuY2VsJyk7CiAgICBjb25zdCBwcm9maWxlU2F2ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLXNhdmUnKTsKICAgIGNvbnN0IHByb2ZpbGVGb3JtUHJvZ3Jlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtLXByb2dyZXNzJyk7CiAgICBjb25zdCBwcm9maWxlRm9ybU91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0tb3V0cHV0Jyk7CiAgICBjb25zdCBwcm9maWxlRm9ybUhlbHBEZXRhaWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS1oZWxwLXJvdycpOwogICAgcHJvZmlsZUNhbmNlbEJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTIuY2FuY2VsUHJvZmlsZSgpOwogICAgfTsKICAgIHByb2ZpbGVOYW1lSW5wdXQub25pbnB1dCA9ICgpPT57CiAgICAgICAgdm0xMi5zZXRQcm9maWxlTmFtZShwcm9maWxlTmFtZUlucHV0LnZhbHVlKTsKICAgIH07CiAgICBwcm9maWxlQWNjb3VudElkSW5wdXQub25pbnB1dCA9ICgpPT57CiAgICAgICAgdm0xMi5zZXRQcm9maWxlQWNjb3VudElkKHByb2ZpbGVBY2NvdW50SWRJbnB1dC52YWx1ZSk7CiAgICB9OwogICAgcHJvZmlsZUFwaVRva2VuSW5wdXQub25pbnB1dCA9ICgpPT57CiAgICAgICAgdm0xMi5zZXRQcm9maWxlQXBpVG9rZW4ocHJvZmlsZUFwaVRva2VuSW5wdXQudmFsdWUpOwogICAgfTsKICAgIHByb2ZpbGVTYXZlQnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xMi5zYXZlUHJvZmlsZSgpOwogICAgfTsKICAgIHByb2ZpbGVEZWxldGVCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTEyLmRlbGV0ZVByb2ZpbGUodm0xMi5wcm9maWxlRm9ybS5wcm9maWxlSWQpOwogICAgfTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIGNvbnN0IHdhc0hpZGRlbiA9IHByb2ZpbGVGb3JtLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJzsKICAgICAgICBwcm9maWxlRm9ybS5zdHlsZS5kaXNwbGF5ID0gdm0xMi5wcm9maWxlRm9ybS5zaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBwcm9maWxlRmllbGRzZXQuZGlzYWJsZWQgPSAhdm0xMi5wcm9maWxlRm9ybS5lbmFibGVkOwogICAgICAgIHByb2ZpbGVGb3JtVGl0bGVEaXYudGV4dENvbnRlbnQgPSB2bTEyLnByb2ZpbGVGb3JtLnRpdGxlOwogICAgICAgIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSB2bTEyLnByb2ZpbGVGb3JtLm5hbWU7CiAgICAgICAgcHJvZmlsZUFjY291bnRJZElucHV0LnZhbHVlID0gdm0xMi5wcm9maWxlRm9ybS5hY2NvdW50SWQ7CiAgICAgICAgcHJvZmlsZUFwaVRva2VuSW5wdXQudmFsdWUgPSB2bTEyLnByb2ZpbGVGb3JtLmFwaVRva2VuOwogICAgICAgIHByb2ZpbGVEZWxldGVCdXR0b24uc3R5bGUuZGlzcGxheSA9IHZtMTIucHJvZmlsZUZvcm0uZGVsZXRlVmlzaWJsZSA/ICdpbmxpbmUtYmxvY2snIDogJ25vbmUnOwogICAgICAgIHByb2ZpbGVTYXZlQnV0dG9uLmRpc2FibGVkID0gIXZtMTIucHJvZmlsZUZvcm0uc2F2ZUVuYWJsZWQ7CiAgICAgICAgcHJvZmlsZUZvcm1Qcm9ncmVzcy5zdHlsZS5kaXNwbGF5ID0gdm0xMi5wcm9maWxlRm9ybS5wcm9ncmVzc1Zpc2libGUgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIHByb2ZpbGVGb3JtT3V0cHV0LnRleHRDb250ZW50ID0gdm0xMi5wcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlOwogICAgICAgIGlmICh3YXNIaWRkZW4gJiYgdm0xMi5wcm9maWxlRm9ybS5zaG93aW5nKSB7CiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxEZXRhaWxzT3BlbiA9IHZtMTIucmVhbFByb2ZpbGVzLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgcHJvZmlsZUZvcm1IZWxwRGV0YWlscy5vcGVuID0gaW5pdGlhbERldGFpbHNPcGVuOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgICAgICAgICBwcm9maWxlTmFtZUlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICBwcm9maWxlTmFtZUlucHV0LnNlbGVjdCgpOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICB9CiAgICB9Owp9CmNvbnN0IFdFTENPTUVfUEFORUxfSFRNTCA9IGh0bWxgCjxmb3JtIGlkPSJ3ZWxjb21lLXBhbmVsIiBhdXRvY29tcGxldGU9Im9mZiI+CjxmaWVsZHNldCBpZD0id2VsY29tZS1wYW5lbC1maWVsZHNldCI+CiAgPGRpdiBpZD0id2VsY29tZS1wYW5lbC1mb3JtLXRpdGxlIiBjbGFzcz0iaDYgaGlnaC1lbXBoYXNpcy10ZXh0IGZvcm0tcm93Ij50aXRsZTwvZGl2PgoKICA8ZGl2IGNsYXNzPSJmb3JtLXJvdyBib2R5MiBtZWRpdW0tZW1waGFzaXMtdGV4dCI+CiAgICBXZWxjb21lIHRvIDxzcGFuIGNsYXNzPSJoaWdoLWVtcGhhc2lzLXRleHQiPldlYnRhaWwgZm9yIENsb3VkZmxhcmUgV29ya2Vyczwvc3Bhbj4hCiAgICA8cD5WaWV3IGxpdmUgcmVxdWVzdHMgYW5kIGxvZ3MgZnJvbSA8YSBocmVmPSJodHRwczovL3dvcmtlcnMuY2xvdWRmbGFyZS5jb20vIiB0YXJnZXQ9Il9ibGFuayI+Q2xvdWRmbGFyZSBXb3JrZXJzPC9hPiBmcm9tIHRoZSBjb21mb3J0IG9mIHlvdXIgYnJvd3Nlci4gCiAgICBBIGZldyBlbmhhbmNlbWVudHMgb3ZlciB3aGF0J3MgcHJvdmlkZWQgPGEgaHJlZj0iaHR0cHM6Ly9ibG9nLmNsb3VkZmxhcmUuY29tL2ludHJvZHVjaW5nLXdvcmtlcnMtZGFzaGJvYXJkLWxvZ3MvIiB0YXJnZXQ9Il9ibGFuayI+YnkgZGVmYXVsdDwvYT4gaW4gdGhlIENsb3VkZmxhcmUgZGFzaGJvYXJkOjwvcD4KICAgIDx1bD4KICAgICAgICA8bGk+VGFpbCBtdWx0aXBsZSB3b3JrZXJzIGF0IHRoZSBzYW1lIHRpbWU8L2xpPgogICAgICAgIDxsaT5BZHZhbmNlZCBmaWx0ZXJpbmcgYW5kIG11bHRpLWNvbG9yIG91dHB1dCBzaW1pbGFyIHRvIDxhIGhyZWY9Imh0dHBzOi8vZGV2ZWxvcGVycy5jbG91ZGZsYXJlLmNvbS93b3JrZXJzL2NsaS13cmFuZ2xlci9jb21tYW5kcyN0YWlsIiB0YXJnZXQ9Il9ibGFuayI+d3JhbmdsZXIgdGFpbDwvYT48L2xpPgogICAgICAgIDxsaT5EdXJhYmxlIG9iamVjdCBjbGFzcy9uYW1lL2lkIGFuZCBjb2xvIGluZm9ybWF0aW9uIGNhbiBiZSBzdXJmYWNlZCB3aXRoIDxhIGhyZWY9Imh0dHBzOi8vZGVub2ZsYXJlLmRldi9leGFtcGxlcy93ZWJ0YWlsI2xvZ3Byb3BzIiB0YXJnZXQ9Il9ibGFuayI+bG9ncHJvcHM8L2E+PC9saT4KICAgICAgICA8bGk+TXVsdGlwbGUgcHJvZmlsZXMsIHN3aXRjaCBlYXNpbHkgYmV0d2VlbiBtdWx0aXBsZSBhY2NvdW50czwvbGk+CiAgICAgICAgPGxpPk5vIG5lZWQgdG8gbG9nIGluIHdpdGggeW91ciBmdWxsIENsb3VkZmxhcmUgY3JlZGVudGlhbHMuICBQcm9maWxlcyBhcmUgc3RvcmVkIGxvY2FsbHkgaW4gdGhlIGJyb3dzZXIsIGFuZCBjYW4gYmUgcGVybWlzc2lvbmVkIG9ubHkgZm9yIHRhaWxpbmcgd29ya2VyczwvbGk+CiAgICAgICAgPGxpPkltcGxlbWVudGVkIGFzIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9za3ltZXRob2QvZGVub2ZsYXJlL3RyZWUvbWFzdGVyL2V4YW1wbGVzL3dlYnRhaWwtd29ya2VyIiB0YXJnZXQ9Il9ibGFuayI+YW4gb3Blbi1zb3VyY2UgQ2xvdWRmbGFyZSBXb3JrZXI8L2E+LCAKICAgICAgICAgICA8YSBocmVmPSJodHRwczovL2Rlbm9mbGFyZS5kZXYvZXhhbXBsZXMvd2VidGFpbCNkZXBsb3ktaXQtdG8teW91ci1vd24tYWNjb3VudCIgdGFyZ2V0PSJfYmxhbmsiPmRlcGxveSBpdCB0byB5b3VyIG93biBhY2NvdW50PC9hPiwgCiAgICAgICAgICAgIG9yIDxhIGhyZWY9Imh0dHBzOi8vZGVub2ZsYXJlLmRldi9leGFtcGxlcy93ZWJ0YWlsI2hvc3QtaXQtbG9jYWxseSIgdGFyZ2V0PSJfYmxhbmsiPmhvc3QgaXQgbG9jYWxseTwvYT4gd2l0aCA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2t5bWV0aG9kL2Rlbm9mbGFyZSIgdGFyZ2V0PSJfYmxhbmsiPjxjb2RlPmRlbm9mbGFyZTwvY29kZT48L2E+PC9saT4KICAgIDwvdWw+CiAgICA8cCBpZD0id2VsY29tZS1wYW5lbC10cmFpbGVyIj5DcmVhdGUgYSBuZXcgcHJvZmlsZSB0byBnZXQgc3RhcnRlZCE8L3A+CiAgICA8cCBpZD0iYWJvdXQtcGFuZWwtdHJhaWxlciI+SGVhZCBvdmVyIHRvIHRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2t5bWV0aG9kL2Rlbm9mbGFyZSIgdGFyZ2V0PSJfYmxhbmsiPkRlbm9mbGFyZSBHaXRIdWIgcmVwbzwvYT4gdG8gcmVxdWVzdCBmZWF0dXJlcywgcmVwb3J0IGJ1Z3MsIG9yIGNoZWNrIG91dCB0aGUgY29kZSE8L3A+CiAgPC9kaXY+CgogIDxkaXYgY2xhc3M9ImZvcm0tcmhzIj4KICAgIDxidXR0b24gaWQ9IndlbGNvbWUtcGFuZWwtbmV3LXByb2ZpbGUiIHR5cGU9InN1Ym1pdCI+TmV3IHByb2ZpbGU8L2J1dHRvbj4KICAgIDxidXR0b24gaWQ9IndlbGNvbWUtcGFuZWwtY2xvc2UiIHR5cGU9InN1Ym1pdCI+Q2xvc2U8L2J1dHRvbj4KICA8L2Rpdj4KPC9maWVsZHNldD4KPC9mb3JtPgpgOwpjb25zdCBXRUxDT01FX1BBTkVMX0NTUyA9IGNzc2AKCiAgICAjd2VsY29tZS1wYW5lbC1mb3JtLXRpdGxlIHsKICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICAgIH0KCmA7CmZ1bmN0aW9uIGluaXRXZWxjb21lUGFuZWwoZG9jdW1lbnQsIHZtMTMpIHsKICAgIGNvbnN0IHdlbGNvbWVQYW5lbEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1wYW5lbCcpOwogICAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlbGNvbWUtcGFuZWwtZm9ybS10aXRsZScpOwogICAgY29uc3Qgd2VsY29tZVRyYWlsZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlbGNvbWUtcGFuZWwtdHJhaWxlcicpOwogICAgY29uc3QgYWJvdXRUcmFpbGVyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhYm91dC1wYW5lbC10cmFpbGVyJyk7CiAgICBjb25zdCBuZXdQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlbGNvbWUtcGFuZWwtbmV3LXByb2ZpbGUnKTsKICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlbGNvbWUtcGFuZWwtY2xvc2UnKTsKICAgIG5ld1Byb2ZpbGVCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTEzLm5ld1Byb2ZpbGUoKTsKICAgIH07CiAgICBjbG9zZUJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTMuY2xvc2VBYm91dCgpOwogICAgfTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIGNvbnN0IHdhc0hpZGRlbiA9IHdlbGNvbWVQYW5lbEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnOwogICAgICAgIGNvbnN0IHNob3cgPSB2bTEzLndlbGNvbWVTaG93aW5nICYmICF2bTEzLnByb2ZpbGVGb3JtLnNob3dpbmcgfHwgdm0xMy5hYm91dFNob3dpbmc7CiAgICAgICAgd2VsY29tZVBhbmVsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgY29uc3Qgd2VsY29tZSA9IHZtMTMud2VsY29tZVNob3dpbmc7CiAgICAgICAgdGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gd2VsY29tZSA/ICdIZWxsbyDwn5GLJyA6ICdBYm91dCc7CiAgICAgICAgd2VsY29tZVRyYWlsZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSB3ZWxjb21lID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBhYm91dFRyYWlsZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSB3ZWxjb21lID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICBuZXdQcm9maWxlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB3ZWxjb21lID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBjbG9zZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gd2VsY29tZSA/ICdub25lJyA6ICdibG9jayc7CiAgICAgICAgaWYgKHdhc0hpZGRlbiAmJiBzaG93KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3dlbGNvbWUgPyAnd2VsY29tZScgOiAnYWJvdXQnfSBwYW5lbCBvcGVuYCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgICh3ZWxjb21lID8gbmV3UHJvZmlsZUJ1dHRvbiA6IGNsb3NlQnV0dG9uKS5mb2N1cygpOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICB9CiAgICB9Owp9CmNvbnN0IE1PREFMX0hUTUwgPSBodG1sYAo8ZGl2IGlkPSJtb2RhbCIgY2xhc3M9Im1vZGFsIGhpZGRlbi12ZXJ0aWNhbC1zY3JvbGwiPgogICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCI+CiAgICAke1dFTENPTUVfUEFORUxfSFRNTH0KICAgICR7UFJPRklMRV9FRElUT1JfSFRNTH0KICAgICR7RklMVEVSX0VESVRPUl9IVE1MfQogICAgPC9kaXY+CjwvZGl2PgpgOwpjb25zdCBNT0RBTF9DU1MgPSBjc3NgCi5tb2RhbCB7CiAgICBkaXNwbGF5OiBub25lOwogICAgcG9zaXRpb246IGZpeGVkOwogICAgei1pbmRleDogMTsKICAgIGxlZnQ6IDA7CiAgICB0b3A6IDA7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC40KTsKfQoKLm1vZGFsLWNvbnRlbnQgewogICAgbWFyZ2luOiAxMCUgYXV0bzsKICAgIHdpZHRoOiA4MCU7CiAgICBtYXgtd2lkdGg6IDQwcmVtOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDYwMHB4KSB7CiAgICAubW9kYWwtY29udGVudCB7CiAgICAgICAgbWFyZ2luOiAxMCUgMDsKICAgICAgICB3aWR0aDogMTAwJTsKICAgIH0KfQoKYDsKZnVuY3Rpb24gaW5pdE1vZGFsKGRvY3VtZW50LCB2bTE0KSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbCcpOwogICAgY29uc3QgdXBkYXRlUHJvZmlsZUVkaXRvciA9IGluaXRQcm9maWxlRWRpdG9yKGRvY3VtZW50LCB2bTE0KTsKICAgIGNvbnN0IHVwZGF0ZUZpbHRlckVkaXRvciA9IGluaXRGaWx0ZXJFZGl0b3IoZG9jdW1lbnQsIHZtMTQpOwogICAgY29uc3QgdXBkYXRlV2VsY29tZVBhbmVsID0gaW5pdFdlbGNvbWVQYW5lbChkb2N1bWVudCwgdm0xNCk7CiAgICBjb25zdCBjbG9zZU1vZGFsID0gKCk9PnsKICAgICAgICBpZiAoIXZtMTQucHJvZmlsZUZvcm0uc2hvd2luZyAmJiAhdm0xNC5maWx0ZXJGb3JtLnNob3dpbmcgJiYgIXZtMTQud2VsY29tZVNob3dpbmcgJiYgIXZtMTQuYWJvdXRTaG93aW5nKSByZXR1cm47CiAgICAgICAgaWYgKHZtMTQucHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlKSByZXR1cm47CiAgICAgICAgdm0xNC5wcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdm0xNC5maWx0ZXJGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB2bTE0LmFib3V0U2hvd2luZyA9IGZhbHNlOwogICAgICAgIHZtMTQub25DaGFuZ2UoKTsKICAgIH07CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpPT57CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PSBtb2RhbCkgewogICAgICAgICAgICBjbG9zZU1vZGFsKCk7CiAgICAgICAgfQogICAgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2ZW50KT0+ewogICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50OwogICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7CiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIHVwZGF0ZVByb2ZpbGVFZGl0b3IoKTsKICAgICAgICB1cGRhdGVGaWx0ZXJFZGl0b3IoKTsKICAgICAgICB1cGRhdGVXZWxjb21lUGFuZWwoKTsKICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gdm0xNC5wcm9maWxlRm9ybS5zaG93aW5nIHx8IHZtMTQuZmlsdGVyRm9ybS5zaG93aW5nIHx8IHZtMTQud2VsY29tZVNob3dpbmcgfHwgdm0xNC5hYm91dFNob3dpbmcgPyAnYmxvY2snIDogJ25vbmUnOwogICAgfTsKfQpjb25zdCBDSVJDVUxBUl9QUk9HUkVTU19DU1MgPSBjc3NgCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyIHsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgIC1tb3otYXBwZWFyYW5jZTogbm9uZTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgYm9yZGVyOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgcGFkZGluZzogMC4yNWVtOwogICAgd2lkdGg6IDNlbTsKICAgIGhlaWdodDogM2VtOwogICAgY29sb3I6IHZhcigtLXB1cmUtbWF0ZXJpYWwtcHJpbWFyeS1yZ2IsIHJnYigzMywgMTUwLCAyNDMpKTsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZm9udC1zaXplOiAxNnB4OwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6Oi13ZWJraXQtcHJvZ3Jlc3MtYmFyIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Owp9CgovKiBJbmRldGVybWluYXRlICovCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGUgewogICAgLXdlYmtpdC1tYXNrLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodHJhbnNwYXJlbnQgNTAlLCBibGFjayA1MCUpLCBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsIHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKTsKICAgIG1hc2staW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0cmFuc3BhcmVudCA1MCUsIGJsYWNrIDUwJSksIGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgdHJhbnNwYXJlbnQgNTAlLCBibGFjayA1MCUpOwogICAgYW5pbWF0aW9uOiBwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyIDZzIGluZmluaXRlIGN1YmljLWJlemllcigwLjMsIDAuNiwgMSwgMSk7Cn0KCjotbXMtbGFuZyh4KSwgLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZSB7CiAgICBhbmltYXRpb246IG5vbmU7Cn0KCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGU6OmJlZm9yZSwKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6LXdlYmtpdC1wcm9ncmVzcy12YWx1ZSB7CiAgICBjb250ZW50OiAiIjsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIG1hcmdpbi1ib3R0b206IDAuMjVlbTsKICAgIGJvcmRlcjogc29saWQgMC4yNWVtIHRyYW5zcGFyZW50OwogICAgYm9yZGVyLXRvcC1jb2xvcjogY3VycmVudENvbG9yOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgYW5pbWF0aW9uOiBwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyLXBzZXVkbyAwLjc1cyBpbmZpbml0ZSBsaW5lYXIgYWx0ZXJuYXRlOwp9CgoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlOjotbW96LXByb2dyZXNzLWJhciB7CiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgYm9yZGVyOiBzb2xpZCAwLjI1ZW0gdHJhbnNwYXJlbnQ7CiAgICBib3JkZXItdG9wLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgYW5pbWF0aW9uOiBwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyLXBzZXVkbyAwLjc1cyBpbmZpbml0ZSBsaW5lYXIgYWx0ZXJuYXRlOwp9CgoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlOjotbXMtZmlsbCB7CiAgICBhbmltYXRpb24tbmFtZTogLW1zLXJpbmc7Cn0KCkBrZXlmcmFtZXMgcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciB7CiAgICAwJSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7CiAgICB9CiAgICAxMi41JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMTgwZGVnKTsKICAgICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7CiAgICB9CiAgICAyNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDYzMGRlZyk7CiAgICB9CiAgICAzNy41JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoODEwZGVnKTsKICAgICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7CiAgICB9CiAgICA1MCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDEyNjBkZWcpOwogICAgfQogICAgNjIuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDE0NDBkZWcpOwogICAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjsKICAgIH0KICAgIDc1JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMTg5MGRlZyk7CiAgICB9CiAgICA4Ny41JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMjA3MGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgMTAwJSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMjUyMGRlZyk7CiAgICB9Cn0KCkBrZXlmcmFtZXMgcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhci1wc2V1ZG8gewogICAgMCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zMGRlZyk7CiAgICB9CiAgICAyOS40JSB7CiAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgfQogICAgMjkuNDElIHsKICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogY3VycmVudENvbG9yOwogICAgfQogICAgNjQuNyUgewogICAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHRyYW5zcGFyZW50OwogICAgfQogICAgNjQuNzElIHsKICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICB9CiAgICAxMDAlIHsKICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogY3VycmVudENvbG9yOwogICAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgyMjVkZWcpOwogICAgfQp9CmA7CmNvbnN0IENPTlNPTEVfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9ImNvbnNvbGUiPgogICAgPGRpdiBpZD0iY29uc29sZS1oZWFkZXIiPgogICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLWZpbHRlcnMiIGNsYXNzPSJib2R5MiI+PC9kaXY+CiAgICAgICAgPGRpdiBpZD0iY29uc29sZS1oZWFkZXItc3RhdHVzIj4KICAgICAgICAgICAgPGRpdiBpZD0iY29uc29sZS1oZWFkZXItdGFpbHMiIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLXFwcyIgY2xhc3M9Im92ZXJsaW5lIG1lZGl1bS1lbXBoYXNpcy10ZXh0Ij48L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0iY29uc29sZS1oZWFkZXItY2xlYXIiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8Y29kZSBpZD0iY29uc29sZS1sYXN0LWxpbmUiIGNsYXNzPSJsaW5lIj5zcGFjZXI8L2NvZGU+CjwvZGl2PgpgOwpjb25zdCBDT05TT0xFX0NTUyA9IGNzc2AKCiNjb25zb2xlIHsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgaGVpZ2h0OiAxMDB2aDsKICAgIHdpZHRoOiAxMDAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7CiAgICBvdmVyZmxvdy15OiBzY3JvbGw7CiAgICBvdmVyZmxvdy14OiBoaWRkZW47CiAgICBmbGV4LWdyb3c6IDE7Cn0KCiNjb25zb2xlOjotd2Via2l0LXNjcm9sbGJhciB7CiAgICB3aWR0aDogMXJlbTsKICAgIGhlaWdodDogM3JlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwp9CgojY29uc29sZTo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIgewogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgojY29uc29sZS1oZWFkZXIgewogICAgcG9zaXRpb246IHN0aWNreTsKICAgIHRvcDogMDsKICAgIGhlaWdodDogMy43NXJlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwogICAgZGlzcGxheTogZmxleDsKICAgIHBhZGRpbmc6IDEuMjVyZW0gMXJlbSAxcmVtIDA7Cn0KCiNjb25zb2xlLWhlYWRlci1maWx0ZXJzIHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBmb250LWZhbWlseTogdmFyKC0tc2Fucy1zZXJpZi1mb250LWZhbWlseSk7CgogICAgZGlzcGxheTogLXdlYmtpdC1ib3g7CiAgICAtd2Via2l0LWxpbmUtY2xhbXA6IDM7CiAgICAtd2Via2l0LWJveC1vcmllbnQ6IHZlcnRpY2FsOyAgCiAgICBvdmVyZmxvdzogaGlkZGVuOwp9CgojY29uc29sZS1oZWFkZXItc3RhdHVzIHsKICAgIGhlaWdodDogMXJlbTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgbWluLXdpZHRoOiA2cmVtOwogICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICBwYWRkaW5nLXRvcDogMC4yNXJlbTsKICAgIHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwp9CgojY29uc29sZS1oZWFkZXItdGFpbHMgewogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQoKI2NvbnNvbGUtaGVhZGVyLWNsZWFyIHsKICAgIG1hcmdpbi1yaWdodDogLTAuNXJlbTsKICAgIG1hcmdpbi1sZWZ0OiAxcmVtOwogICAgdmlzaWJpbGl0eTogaGlkZGVuOwp9CgojY29uc29sZS1oZWFkZXItY2xlYXIgLmFjdGlvbi1pY29uIHsKICAgIHBhZGRpbmctcmlnaHQ6IDAuNXJlbTsKICAgIHBhZGRpbmctbGVmdDogMC41cmVtOwp9CgojY29uc29sZSAubGluZSB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGZvbnQtc2l6ZTogMC43NXJlbTsgLyogMTJweCAqLwogICAgbGluZS1oZWlnaHQ6IDEuMXJlbTsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1tb25vc3BhY2UtZm9udC1mYW1pbHkpOwogICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOwp9CgojY29uc29sZS1sYXN0LWxpbmUgewogICAgdmlzaWJpbGl0eTogaGlkZGVuOwp9CgpgOwpmdW5jdGlvbiBpbml0Q29uc29sZShkb2N1bWVudCwgdm0xNSkgewogICAgY29uc3QgY29uc29sZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlJyk7CiAgICBjb25zdCBjb25zb2xlSGVhZGVyRmlsdGVyc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlLWhlYWRlci1maWx0ZXJzJyk7CiAgICBjb25zdCBjb25zb2xlSGVhZGVyVGFpbHNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtaGVhZGVyLXRhaWxzJyk7CiAgICBjb25zdCBjb25zb2xlSGVhZGVyUXBzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlLWhlYWRlci1xcHMnKTsKICAgIGNvbnN0IGNvbnNvbGVIZWFkZXJDbGVhckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZS1oZWFkZXItY2xlYXInKTsKICAgIGNvbnN0IGNvbnNvbGVMYXN0TGluZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZS1sYXN0LWxpbmUnKTsKICAgIGxldCBzaG93aW5nQ2xlYXJCdXR0b24gPSBmYWxzZTsKICAgIHZtMTUubG9nZ2VyID0gKC4uLmRhdGE2KT0+ewogICAgICAgIGNvbnN0IGxpbmVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOwogICAgICAgIGxpbmVFbGVtZW50LmNsYXNzTmFtZSA9ICdsaW5lJzsKICAgICAgICBsZXQgcG9zID0gMDsKICAgICAgICB3aGlsZShwb3MgPCBkYXRhNi5sZW5ndGgpewogICAgICAgICAgICBpZiAocG9zID4gMCkgewogICAgICAgICAgICAgICAgbGluZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJywgJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGRhdGE2W3Bvc107CiAgICAgICAgICAgIGlmICh0eXBlb2YgbXNnID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgY29uc3QgdG9rZW5zID0gbXNnLnNwbGl0KCclYycpOwogICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgICAgICBsZXQgcmVuZGVyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgaSA8IHRva2Vucy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gZGF0YTZbcG9zICsgaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdHlsZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZS5pbmNsdWRlcygneC0nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSAveC1kdXJhYmxlLW9iamVjdC0oY2xhc3N8bmFtZXxpZClccyo6XHMqJyguKj8pJy8uZXhlYyhzdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IG1bMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbVsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9ncHJvcE5hbWUgPSAnZHVyYWJsZU9iamVjdCcgKyB0eXBlLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaHJlZiA9ICcjJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5vbmNsaWNrID0gKCk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtMTUuc2V0TG9ncHJvcEZpbHRlcihbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9ncHJvcE5hbWUgKyAnOicgKyB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bTE1Lm9uQ2hhbmdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodG9rZW5zW2ldKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZW5kZXJlZCkgcmVuZGVyVGV4dEludG9TcGFuKHRva2Vuc1tpXSwgc3Bhbik7CiAgICAgICAgICAgICAgICAgICAgbGluZUVsZW1lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3MgKz0gMSArIHRva2Vucy5sZW5ndGggLSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGluZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoSlNPTi5zdHJpbmdpZnkobXNnKSkpOwogICAgICAgICAgICAgICAgcG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc29sZURpdi5pbnNlcnRCZWZvcmUobGluZUVsZW1lbnQsIGNvbnNvbGVMYXN0TGluZUVsZW1lbnQpOwogICAgICAgIGNvbnN0IHsgc2Nyb2xsSGVpZ2h0ICwgc2Nyb2xsVG9wICwgY2xpZW50SGVpZ2h0ICB9ID0gY29uc29sZURpdjsKICAgICAgICBjb25zdCBkaWZmID0gc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wOwogICAgICAgIGNvbnN0IGF1dG9zY3JvbGwgPSBkaWZmIC0gMTYgKiA0IDw9IGNsaWVudEhlaWdodDsKICAgICAgICBpZiAoYXV0b3Njcm9sbCkgewogICAgICAgICAgICBjb25zb2xlTGFzdExpbmVFbGVtZW50LnNjcm9sbEludG9WaWV3KGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaG93aW5nQ2xlYXJCdXR0b24pIHsKICAgICAgICAgICAgY29uc29sZUhlYWRlckNsZWFyRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgICAgICBzaG93aW5nQ2xlYXJCdXR0b24gPSB0cnVlOwogICAgICAgIH0KICAgIH07CiAgICB2bTE1Lm9uUmVzZXRPdXRwdXQgPSAoKT0+ewogICAgICAgIGNvbnN0IGxpbmVzID0gY29uc29sZURpdi5xdWVyeVNlbGVjdG9yQWxsKCcubGluZScpOwogICAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUpPT57CiAgICAgICAgICAgIGlmIChsaW5lLmlkICE9PSAnY29uc29sZS1sYXN0LWxpbmUnKSBjb25zb2xlRGl2LnJlbW92ZUNoaWxkKGxpbmUpOwogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGVIZWFkZXJDbGVhckVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgICAgIHNob3dpbmdDbGVhckJ1dHRvbiA9IGZhbHNlOwogICAgfTsKICAgIGNvbnNvbGVIZWFkZXJRcHNFbGVtZW50LnRleHRDb250ZW50ID0gY29tcHV0ZVFwc1RleHQoMCk7CiAgICB2bTE1Lm9uUXBzQ2hhbmdlID0gKHFwcyk9PnsKICAgICAgICBjb25zb2xlSGVhZGVyUXBzRWxlbWVudC50ZXh0Q29udGVudCA9IGNvbXB1dGVRcHNUZXh0KHFwcyk7CiAgICB9OwogICAgTGl0RWxlbWVudC5yZW5kZXIoYWN0aW9uSWNvbihDTEVBUl9JQ09OLCB7CiAgICAgICAgdGV4dDogJ0NsZWFyJywKICAgICAgICBvbmNsaWNrOiAoKT0+dm0xNS5yZXNldE91dHB1dCgpCiAgICB9KSwgY29uc29sZUhlYWRlckNsZWFyRWxlbWVudCk7CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBjb25zb2xlRGl2LnN0eWxlLmRpc3BsYXkgPSB2bTE1LnNlbGVjdGVkQW5hbHl0aWNJZCA/ICdub25lJyA6ICdibG9jayc7CiAgICAgICAgY29uc29sZUhlYWRlckZpbHRlcnNEaXYuc3R5bGUudmlzaWJpbGl0eSA9IHZtMTUucHJvZmlsZXMubGVuZ3RoID4gMCA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nOwogICAgICAgIGNvbnNvbGVIZWFkZXJUYWlsc0VsZW1lbnQudGV4dENvbnRlbnQgPSBjb21wdXRlVGFpbHNUZXh0KHZtMTUudGFpbHMuc2l6ZSk7CiAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoRklMVEVSU19IVE1MKHZtMTUpLCBjb25zb2xlSGVhZGVyRmlsdGVyc0Rpdik7CiAgICB9Owp9CmNvbnN0IEZJTFRFUlNfSFRNTCA9ICh2bTE2KT0+ewogICAgcmV0dXJuIGh0bWxgU2hvd2luZyA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0U2VsZWN0aW9uRmllbGRzKCk7CiAgICB9fT4ke3ZtMTYuY29tcHV0ZVNlbGVjdGlvbkZpZWxkc1RleHQoKX08L2E+CiAgICAgZm9yIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LmVkaXRFdmVudEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlRXZlbnRGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+CiAgICAgd2l0aCA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0U3RhdHVzRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVTdGF0dXNGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+LAogICAgIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LmVkaXRJcEFkZHJlc3NGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZUlwQWRkcmVzc0ZpbHRlclRleHQodm0xNi5maWx0ZXIpfTwvYT4sCiAgICAgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYuZWRpdE1ldGhvZEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlTWV0aG9kRmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPiwKICAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0U2FtcGxpbmdSYXRlRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVTYW1wbGluZ1JhdGVGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+LCAKICAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0U2VhcmNoRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVTZWFyY2hGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+LCAKICAgIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LmVkaXRIZWFkZXJGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZUhlYWRlckZpbHRlclRleHQodm0xNi5maWx0ZXIpfTwvYT4sCiAgICAgYW5kIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LmVkaXRMb2dwcm9wRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVMb2dwcm9wRmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPi4KICAgICAke3ZtMTYuaGFzQW55RmlsdGVycygpID8gaHRtbGAoPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYucmVzZXRGaWx0ZXJzKCk7CiAgICB9fT5yZXNldDwvYT4pYCA6ICcnfWA7Cn07CmZ1bmN0aW9uIGNvbXB1dGVFdmVudEZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCB7IGV2ZW50MSAgfSA9IGZpbHRlcjsKICAgIHJldHVybiBldmVudDEgPT09ICdjcm9uJyA/ICdDUk9OIHRyaWdnZXIgZXZlbnRzJyA6IGV2ZW50MSA9PT0gJ2h0dHAnID8gJ0hUVFAgcmVxdWVzdCBldmVudHMnIDogJ2FsbCBldmVudHMnOwp9CmZ1bmN0aW9uIGNvbXB1dGVTdGF0dXNGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgeyBzdGF0dXMxICB9ID0gZmlsdGVyOwogICAgcmV0dXJuIHN0YXR1czEgPT09ICdlcnJvcicgPyAnZXJyb3Igc3RhdHVzJyA6IHN0YXR1czEgPT09ICdzdWNjZXNzJyA/ICdzdWNjZXNzIHN0YXR1cycgOiAnYW55IHN0YXR1cyc7Cn0KZnVuY3Rpb24gY29tcHV0ZUlwQWRkcmVzc0ZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCBpcEFkZHJlc3MxID0gZmlsdGVyLmlwQWRkcmVzczEgfHwgW107CiAgICByZXR1cm4gaXBBZGRyZXNzMS5sZW5ndGggPT09IDAgPyAnYW55IElQIGFkZHJlc3MnIDogaXBBZGRyZXNzMS5sZW5ndGggPT09IDEgPyBgSVAgYWRkcmVzcyBvZiAke2lwQWRkcmVzczFbMF19YCA6IGBJUCBhZGRyZXNzIGluIFske2lwQWRkcmVzczEuam9pbignLCAnKX1dYDsKfQpmdW5jdGlvbiBjb21wdXRlTWV0aG9kRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IG1ldGhvZDEgPSBmaWx0ZXIubWV0aG9kMSB8fCBbXTsKICAgIHJldHVybiBtZXRob2QxLmxlbmd0aCA9PT0gMCA/ICdhbnkgbWV0aG9kJyA6IG1ldGhvZDEubGVuZ3RoID09PSAxID8gYG1ldGhvZCBvZiAke21ldGhvZDFbMF19YCA6IGBtZXRob2QgaW4gWyR7bWV0aG9kMS5qb2luKCcsICcpfV1gOwp9CmZ1bmN0aW9uIGNvbXB1dGVTYW1wbGluZ1JhdGVGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3Qgc2FtcGxpbmdSYXRlMSA9IHR5cGVvZiBmaWx0ZXIuc2FtcGxpbmdSYXRlMSA9PT0gJ251bWJlcicgPyBmaWx0ZXIuc2FtcGxpbmdSYXRlMSA6IDE7CiAgICByZXR1cm4gc2FtcGxpbmdSYXRlMSA+PSAxID8gJ25vIHNhbXBsaW5nJyA6IGAkeyhNYXRoLm1heCgwLCBzYW1wbGluZ1JhdGUxKSAqIDEwMCkudG9GaXhlZCgyKX0lIHNhbXBsaW5nIHJhdGVgOwp9CmZ1bmN0aW9uIGNvbXB1dGVTZWFyY2hGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgeyBzZWFyY2gxICB9ID0gZmlsdGVyOwogICAgcmV0dXJuIHR5cGVvZiBzZWFyY2gxID09PSAnc3RyaW5nJyAmJiBzZWFyY2gxLmxlbmd0aCA+IDAgPyBgY29uc29sZSBsb2dzIGNvbnRhaW5pbmcgIiR7c2VhcmNoMX0iYCA6ICdubyBzZWFyY2ggZmlsdGVyJzsKfQpmdW5jdGlvbiBjb21wdXRlSGVhZGVyRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IGhlYWRlcjEgPSBmaWx0ZXIuaGVhZGVyMSB8fCBbXTsKICAgIHJldHVybiBoZWFkZXIxLmxlbmd0aCA9PT0gMCA/ICdubyBoZWFkZXIgZmlsdGVyJyA6IGhlYWRlcjEubGVuZ3RoID09PSAxID8gYGhlYWRlciBmaWx0ZXIgb2YgJHtoZWFkZXIxWzBdfWAgOiBgaGVhZGVyIGZpbHRlcnMgb2YgWyR7aGVhZGVyMS5qb2luKCcsICcpfV1gOwp9CmZ1bmN0aW9uIGNvbXB1dGVMb2dwcm9wRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IGxvZ3Byb3AxID0gZmlsdGVyLmxvZ3Byb3AxIHx8IFtdOwogICAgcmV0dXJuIGxvZ3Byb3AxLmxlbmd0aCA9PT0gMCA/ICdubyBsb2dwcm9wIGZpbHRlcicgOiBsb2dwcm9wMS5sZW5ndGggPT09IDEgPyBgbG9ncHJvcCBmaWx0ZXIgb2YgJHtsb2dwcm9wMVswXX1gIDogYGxvZ3Byb3AgZmlsdGVycyBvZiBbJHtsb2dwcm9wMS5qb2luKCcsICcpfV1gOwp9CmZ1bmN0aW9uIGNvbXB1dGVUYWlsc1RleHQodGFpbENvdW50KSB7CiAgICByZXR1cm4gdGFpbENvdW50ID09PSAwID8gJ25vIHRhaWxzJyA6IHRhaWxDb3VudCA9PT0gMSA/ICcxIHRhaWwnIDogYCR7dGFpbENvdW50fSB0YWlsc2A7Cn0KZnVuY3Rpb24gY29tcHV0ZVFwc1RleHQocXBzKSB7CiAgICByZXR1cm4gYCR7cXBzLnRvRml4ZWQoMil9IHFwc2A7Cn0KZnVuY3Rpb24gcmVuZGVyVGV4dEludG9TcGFuKHRleHQsIHNwYW4pIHsKICAgIGNvbnN0IHBhdHRlcm4gPSAvKGh0dHBzOlwvXC9bXlxzKV0rfFxkezEsM31cLlxkezEsM31cLlxkezEsM31cLlxkezEsM318W1xkMC1mXSsoOihbXGQwLWZdezAsNH0pPyl7NSw3fSkvZzsKICAgIGxldCBtOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUobnVsbCAhPT0gKG0gPSBwYXR0ZXJuLmV4ZWModGV4dCkpKXsKICAgICAgICBpZiAobS5pbmRleCA+IGkpIHsKICAgICAgICAgICAgc3Bhbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnN1YnN0cmluZyhpLCBtLmluZGV4KSkpOwogICAgICAgIH0KICAgICAgICBjb25zdCB1cmxPcklwID0gbVswXTsKICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGEuaHJlZiA9IHVybE9ySXAuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSA/IHVybE9ySXAgOiBgaHR0cHM6Ly9pcGluZm8uaW8vJHt1cmxPcklwfWA7CiAgICAgICAgYS50YXJnZXQgPSAnX2JsYW5rJzsKICAgICAgICBhLnJlbCA9ICdub3JlZmVycmVyIG5vb3BlbmVyIG5vZm9sbG93JzsKICAgICAgICBhLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHVybE9ySXApKTsKICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGEpOwogICAgICAgIGkgPSBtLmluZGV4ICsgdXJsT3JJcC5sZW5ndGg7CiAgICB9CiAgICBpZiAoaSA8IHRleHQubGVuZ3RoKSB7CiAgICAgICAgc3Bhbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnN1YnN0cmluZyhpKSkpOwogICAgfQp9CmNvbnN0IEFOQUxZVElDU19IVE1MMSA9IGh0bWxgCjxkaXYgaWQ9ImFuYWx5dGljcyI+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtaGVhZGVyIj4KICAgICAgICA8ZGl2IGlkPSJhbmFseXRpY3MtaGVhZGluZyIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICAgICAgPGRpdiBpZD0iYW5hbHl0aWNzLXN1YmhlYWRpbmciIGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgaWQ9ImFuYWx5dGljcy1xdWVyeWluZyI+PHByb2dyZXNzIGlkPSJhbmFseXRpY3MtcHJvZ3Jlc3MiIGNsYXNzPSJwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyIj48L3Byb2dyZXNzPjxkaXYgY2xhc3M9Im1lZGl1bS1lbXBoYXNpcy10ZXh0Ij5GZXRjaGluZyBhbmFseXRpY3MuLi48L2Rpdj48L2Rpdj4KICAgIDxkaXYgaWQ9ImFuYWx5dGljcy1lcnJvciIgY2xhc3M9Im1lZGl1bS1lbXBoYXNpcy10ZXh0Ij48L2Rpdj4KICAgIDxkaXYgaWQ9ImFuYWx5dGljcy10YWJsZSIgY2xhc3M9Im1lZGl1bS1lbXBoYXNpcy10ZXh0Ij48L2Rpdj4KICAgIDxkaXYgaWQ9ImFuYWx5dGljcy1uYW1lc3BhY2VzLXRhYmxlIiAgY2xhc3M9Im1lZGl1bS1lbXBoYXNpcy10ZXh0Ij48L2Rpdj4KICAgIDxkaXYgaWQ9ImFuYWx5dGljcy1mb290bm90ZSIgY2xhc3M9Im1lZGl1bS1lbXBoYXNpcy10ZXh0Ij48c3VwPio8L3N1cD4gRXN0aW1hdGVkIGJhc2VkIG9uIHJlY2VudCB1c2FnZTwvZGl2Pgo8L2Rpdj4KYDsKY29uc3QgQU5BTFlUSUNTX0NTUyA9IGNzc2AKCiNhbmFseXRpY3MgewogICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBoZWlnaHQ6IDEwMHZoOwogICAgd2lkdGg6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIG92ZXJmbG93LXk6IHNjcm9sbDsKICAgIG92ZXJmbG93LXg6IGhpZGRlbjsKICAgIGZsZXgtZ3JvdzogMTsKICAgIGRpc3BsYXk6IG5vbmU7Cn0KCiNhbmFseXRpY3M6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgIHdpZHRoOiAxcmVtOwogICAgaGVpZ2h0OiAzcmVtOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7Cn0KCiNhbmFseXRpY3M6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKI2FuYWx5dGljcy1oZWFkZXIgewogICAgcG9zaXRpb246IHN0aWNreTsKICAgIHRvcDogMDsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwogICAgcGFkZGluZzogMXJlbSAwOwogICAgaGVpZ2h0OiAzcmVtOwp9CgojYW5hbHl0aWNzLXN1YmhlYWRpbmcgewogICAgcGFkZGluZzogMC41cmVtIDA7Cn0KCiNhbmFseXRpY3MtcHJvZ3Jlc3MgewogICAgZm9udC1zaXplOiAwLjVyZW07IC8qIGRlZmF1bHQgM2VtID0+IDEuNXJlbSAqLwp9CgojYW5hbHl0aWNzLXF1ZXJ5aW5nIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgZ2FwOiAwLjVyZW07Cn0KCiNhbmFseXRpY3MgdGFibGUgewogICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICBib3JkZXItc3BhY2luZzogMC4zNzVyZW07CiAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9CgojYW5hbHl0aWNzIHRoIHsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKI2FuYWx5dGljcyAuc3BhY2VyIHsKICAgIHdpZHRoOiAwLjc1cmVtOwp9CgojYW5hbHl0aWNzLXRhYmxlIC5lc3RpbWF0ZSB0ZCB7CiAgICBwYWRkaW5nLXRvcDogMXJlbTsKfQoKI2FuYWx5dGljcyAubW9ubyB7CiAgICBmb250LWZhbWlseTogdmFyKC0tbW9ub3NwYWNlLWZvbnQtZmFtaWx5KTsKfQoKI2FuYWx5dGljcy1uYW1lc3BhY2VzLXRhYmxlIHsKICAgIG1hcmdpbi10b3A6IDJyZW07Cn0KCiNhbmFseXRpY3MtbmFtZXNwYWNlcy10YWJsZSBhLnVuc2VsZWN0ZWQgewogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKQG1lZGlhIChob3ZlcjogaG92ZXIpIHsKICAgICNhbmFseXRpY3MtbmFtZXNwYWNlcy10YWJsZSBhLnVuc2VsZWN0ZWQ6aG92ZXIgewogICAgICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsKICAgIH0KfQoKI2FuYWx5dGljcyAubGVmdC1hbGlnbmVkIHsKICAgIHRleHQtYWxpZ246IGxlZnQ7Cn0KCiNhbmFseXRpY3MtZm9vdG5vdGUgewogICAgbWFyZ2luLXRvcDogMXJlbTsKICAgIGZvbnQtc2l6ZTogMC43NXJlbTsKICAgIGRpc3BsYXk6IG5vbmU7Cn0KCmA7CmZ1bmN0aW9uIGluaXRBbmFseXRpY3MoZG9jdW1lbnQsIHZtMTcpIHsKICAgIGNvbnN0IGFuYWx5dGljc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXRpY3MnKTsKICAgIGNvbnN0IGFuYWx5dGljc0hlYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLWhlYWRpbmcnKTsKICAgIGNvbnN0IGFuYWx5dGljc1N1YmhlYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLXN1YmhlYWRpbmcnKTsKICAgIGNvbnN0IGFuYWx5dGljc1F1ZXJ5aW5nRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXRpY3MtcXVlcnlpbmcnKTsKICAgIGNvbnN0IGFuYWx5dGljc0Vycm9yRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXRpY3MtZXJyb3InKTsKICAgIGNvbnN0IGFuYWx5dGljc1RhYmxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXRpY3MtdGFibGUnKTsKICAgIGNvbnN0IGFuYWx5dGljc05hbWVzcGFjZXNUYWJsZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLW5hbWVzcGFjZXMtdGFibGUnKTsKICAgIGNvbnN0IGFuYWx5dGljc0Zvb3Rub3RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmFseXRpY3MtZm9vdG5vdGUnKTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIGFuYWx5dGljc0Rpdi5zdHlsZS5kaXNwbGF5ID0gdm0xNy5zZWxlY3RlZEFuYWx5dGljSWQgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGlmICghdm0xNy5zZWxlY3RlZEFuYWx5dGljSWQpIHJldHVybjsKICAgICAgICBjb25zdCBzZWxlY3RlZEFuYWx5dGljID0gdm0xNy5hbmFseXRpY3MuZmluZCgodik9PnYuaWQgPT09IHZtMTcuc2VsZWN0ZWRBbmFseXRpY0lkKTsKICAgICAgICBpZiAoIXNlbGVjdGVkQW5hbHl0aWMpIHJldHVybjsKICAgICAgICBhbmFseXRpY3NIZWFkaW5nLnRleHRDb250ZW50ID0gc2VsZWN0ZWRBbmFseXRpYy50ZXh0OwogICAgICAgIGFuYWx5dGljc1N1YmhlYWRpbmcudGV4dENvbnRlbnQgPSBzZWxlY3RlZEFuYWx5dGljLmRlc2NyaXB0aW9uIHx8ICcnOwogICAgICAgIGNvbnN0IHsgZHVyYWJsZU9iamVjdHNDb3N0cyAsIHF1ZXJ5aW5nICwgZXJyb3IgIH0gPSB2bTE3LmFuYWx5dGljc1N0YXRlOwogICAgICAgIGFuYWx5dGljc1F1ZXJ5aW5nRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gcXVlcnlpbmcgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAgICAgYW5hbHl0aWNzRXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3IgfHwgJyc7CiAgICAgICAgYW5hbHl0aWNzRm9vdG5vdGVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBkdXJhYmxlT2JqZWN0c0Nvc3RzID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBpZiAoZHVyYWJsZU9iamVjdHNDb3N0cykgewogICAgICAgICAgICBjb25zdCByZW5kZXJDb3N0cyA9IChuYW1lc3BhY2VJZCk9PnsKICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZHVyYWJsZU9iamVjdHNDb3N0cy5uYW1lc3BhY2VUYWJsZXNbbmFtZXNwYWNlSWQgfHwgJyddIHx8IGR1cmFibGVPYmplY3RzQ29zdHMuYWNjb3VudFRhYmxlOwogICAgICAgICAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoQ09TVFNfSFRNTCh0YWJsZSwgbmFtZXNwYWNlSWQpLCBhbmFseXRpY3NUYWJsZUVsZW1lbnQpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZW5kZXJDb3N0cyh1bmRlZmluZWQpOwogICAgICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihOQU1FU1BBQ0VTX0hUTUwoZHVyYWJsZU9iamVjdHNDb3N0cywgcmVuZGVyQ29zdHMpLCBhbmFseXRpY3NOYW1lc3BhY2VzVGFibGVFbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBMaXRFbGVtZW50LnJlbmRlcih1bmRlZmluZWQsIGFuYWx5dGljc1RhYmxlRWxlbWVudCk7CiAgICAgICAgICAgIExpdEVsZW1lbnQucmVuZGVyKHVuZGVmaW5lZCwgYW5hbHl0aWNzTmFtZXNwYWNlc1RhYmxlRWxlbWVudCk7CiAgICAgICAgfQogICAgfTsKfQpjb25zdCBGSVhFRF8xID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdlbi1VUycsIHsKICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMSwKICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMQp9KTsKY29uc3QgRklYRURfMiA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZW4tVVMnLCB7CiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIsCiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIKfSk7CmZ1bmN0aW9uIGZvcm1hdDEodmFsKSB7CiAgICBpZiAodmFsIDwgMTAwMCkgcmV0dXJuIHZhbC50b1N0cmluZygpOwogICAgcmV0dXJuIGAke0ZJWEVEXzEuZm9ybWF0KHZhbCAvIDEwMDApfWtgOwp9CmZ1bmN0aW9uIGZvcm1hdDIodmFsKSB7CiAgICBpZiAodmFsIDwgMTAwMCkgcmV0dXJuIHZhbC50b0ZpeGVkKDIpOwogICAgcmV0dXJuIGAke0ZJWEVEXzIuZm9ybWF0KHZhbCAvIDEwMDApfWtgOwp9CmZ1bmN0aW9uIGZvcm1hdEdiKHZhbCkgewogICAgaWYgKHZhbCA8IDEpIHJldHVybiBgJHtmb3JtYXQyKHZhbCAqIDEwMjQpfW1iYDsKICAgIHJldHVybiBgJHtmb3JtYXQyKHZhbCl9Z2JgOwp9CmZ1bmN0aW9uIGNsaWNrTmFtZXNwYWNlKGUsIHJlbmRlckNvc3RzKSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCB0ZXh0ID0gZS50YXJnZXQudGV4dENvbnRlbnQgfHwgJyc7CiAgICBjb25zb2xlLmxvZygnY2xpY2tOYW1lc3BhY2UnLCB0ZXh0KTsKICAgIHJlbmRlckNvc3RzKHRleHQuc3RhcnRzV2l0aCgnQWxsJykgPyB1bmRlZmluZWQgOiB0ZXh0KTsKICAgIGNvbnN0IGFuY2hvcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjYW5hbHl0aWNzLW5hbWVzcGFjZXMtdGFibGUgYScpOwogICAgYW5jaG9ycy5mb3JFYWNoKChhKT0+ewogICAgICAgIGEuY2xhc3NOYW1lID0gYSA9PT0gZS50YXJnZXQgPyAnJyA6ICd1bnNlbGVjdGVkJzsKICAgIH0pOwp9CmNvbnN0IE5BTUVTUEFDRVNfSFRNTCA9ICh0YWJsZSwgcmVuZGVyQ29zdHMpPT5odG1sYAogICAgPHRhYmxlPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPk5hbWVzcGFjZSBJRDwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aD5TY3JpcHQ8L3RoPgogICAgICAgICAgICA8dGg+Q2xhc3M8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGg+VG90YWw8L3RoPgogICAgICAgIDwvdHI+CiAgICAgICAgPHRyPgogICAgICAgICAgICA8dGQgY2xhc3M9ImxlZnQtYWxpZ25lZCBtb25vIj48YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PmNsaWNrTmFtZXNwYWNlKGUsIHJlbmRlckNvc3RzKX0+QWxsIGR1cmFibGUgb2JqZWN0czwvYT48L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHsodGFibGUuYWNjb3VudFRhYmxlLmVzdGltYXRlZDMwRGF5Um93Py50b3RhbENvc3QgfHwgMCkudG9GaXhlZCgyKX08L3RkPgogICAgICAgIDwvdHI+CiAgICAke1sKICAgICAgICAuLi5PYmplY3QuZW50cmllcyh0YWJsZS5uYW1lc3BhY2VUYWJsZXMpCiAgICBdLnNvcnQoKGEsIGIpPT4oYlsxXS5lc3RpbWF0ZWQzMERheVJvdz8udG90YWxDb3N0IHx8IDApIC0gKGFbMV0uZXN0aW1hdGVkMzBEYXlSb3c/LnRvdGFsQ29zdCB8fCAwKSkubWFwKCh2KT0+ewogICAgICAgIGNvbnN0IFtuYW1lc3BhY2VJZCwgdF0gPSB2OwogICAgICAgIHJldHVybiBodG1sYDx0cj4KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZWZ0LWFsaWduZWQgbW9ubyI+PGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT5jbGlja05hbWVzcGFjZShlLCByZW5kZXJDb3N0cyl9IGNsYXNzPSJ1bnNlbGVjdGVkIj4ke25hbWVzcGFjZUlkfTwvYT48L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImxlZnQtYWxpZ25lZCI+JHt0Lm5hbWVzcGFjZT8uc2NyaXB0IHx8ICcnfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGVmdC1hbGlnbmVkIj4ke3QubmFtZXNwYWNlPy5jbGFzcyB8fCAnJ308L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7KHQuZXN0aW1hdGVkMzBEYXlSb3c/LnRvdGFsQ29zdCB8fCAwKS50b0ZpeGVkKDIpfTwvdGQ+CiAgICAgICAgICAgIDwvdHI+YDsKICAgIH0pfQogICAgPC90YWJsZT4KYDsKY29uc3QgQ09TVFNfSFRNTCA9ICh0YWJsZSwgbmFtZXNwYWNlSWQpPT5odG1sYAogICAgPHRhYmxlPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPlVUQyBEYXk8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+UmVxdWVzdHM8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iNCI+V2Vic29ja2V0czwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5TdWJyZXF1ZXN0czwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5EdXJhdGlvbjwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5SZWFkczwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5Xcml0ZXM8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+RGVsZXRlczwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5TdG9yYWdlPC90aD48dGggY2xhc3M9InNwYWNlciI+PC90aD4KICAgICAgICAgICAgPHRoPlRvdGFsPC90aD4KICAgICAgICA8L3RyPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPjwvdGg+PHRoPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGg+TWF4PC90aD4KICAgICAgICAgICAgPHRoPkluPC90aD4KICAgICAgICAgICAgPHRoPk91dDwvdGg+CiAgICAgICAgICAgIDx0aD48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoPkdCLXNlYzwvdGg+CiAgICAgICAgICAgIDx0aD48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoIGNvbHNwYW49IjIiPjwvdGg+PHRoPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoPjwvdGg+CiAgICAgICAgPC90cj4KICAgICAgICAke3RhYmxlLnJvd3MubWFwKCh2KT0+aHRtbGA8dHI+CiAgICAgICAgICAgIDx0ZD4ke3YuZGF0ZX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYuc3VtUmVxdWVzdHMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHYucmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYubWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQpfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50KX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LndlYnNvY2tldHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYuc3VtU3VicmVxdWVzdHMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHYuc3VicmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQyKHYuYWN0aXZlR2JTZWNvbmRzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LmFjdGl2ZUNvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1TdG9yYWdlUmVhZFVuaXRzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LnJlYWRVbml0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1TdG9yYWdlV3JpdGVVbml0cyl9PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodi53cml0ZVVuaXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJoaWdoLWVtcGhhc2lzLXRleHQiPiR7Zm9ybWF0MSh2LnN1bVN0b3JhZ2VEZWxldGVzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LmRlbGV0ZXNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHt2LnN0b3JhZ2VHYiA9PT0gdW5kZWZpbmVkID8gJz8nIDogZm9ybWF0R2Iodi5zdG9yYWdlR2IpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3Yuc3RvcmFnZUNvc3QgPT09IHVuZGVmaW5lZCA/ICcnIDogYCQke2Zvcm1hdDIodi5zdG9yYWdlQ29zdCl9YH08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LnRvdGFsQ29zdCl9PC90ZD4KICAgICAgICA8L3RyPmApfQoKICAgICAgICAke3RhYmxlLmVzdGltYXRlZDMwRGF5Um93ID8gaHRtbGA8dHIgY2xhc3M9ImVzdGltYXRlIj4KICAgICAgICAgICAgPHRkPjMwLWRheSBiaWxsPHN1cD4qPC9zdXA+PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LnJlcXVlc3RzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3cud2Vic29ja2V0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy5zdWJyZXF1ZXN0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy5hY3RpdmVDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3cucmVhZFVuaXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LndyaXRlVW5pdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3cuZGVsZXRlc0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy5zdG9yYWdlQ29zdCB8fCAwKX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy50b3RhbENvc3QpfTwvdGQ+CiAgICAgICAgPC90cj5gIDogJyd9CiAgICAgICAgJHt0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZSA/IGh0bWxgPHRyPgogICAgICAgICAgICA8dGQ+4oiSIGZyZWUgdXNhZ2U8L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUucmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZS53ZWJzb2NrZXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLnN1YnJlcXVlc3RzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLmFjdGl2ZUNvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZS5yZWFkVW5pdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUud3JpdGVVbml0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZS5kZWxldGVzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLnN0b3JhZ2VDb3N0IHx8IDApfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLnRvdGFsQ29zdCl9PC90ZD4KICAgICAgICA8L3RyPmAgOiAnJ30KICAgIDwvdGFibGU+CmA7CmNvbnN0IGFwcE1vZHVsZVNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAtbW9kdWxlLXNjcmlwdCcpOwpmdW5jdGlvbiBzZXRBcHBTdGF0ZShhcHBTdGF0ZSkgewogICAgYXBwTW9kdWxlU2NyaXB0LmRhdGFzZXQuc3RhdGUgPSBhcHBTdGF0ZTsKfQpzZXRBcHBTdGF0ZSgnc3RhcnRpbmcnKTsKY29uc3QgYXBwQ3NzID0gY3NzYAoKbWFpbiB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZ2FwOiAwLjVyZW07Cn0KCjpyb290IHsKICAgIC0tcHVyZS1tYXRlcmlhbC1wcmltYXJ5LXJnYjogcmdiKDE4NywgMTM0LCAyNTIpOwp9CgouaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCB7CiAgICBzY3JvbGxiYXItd2lkdGg6IG5vbmU7IC1tcy1vdmVyZmxvdy1zdHlsZTogbm9uZTsKICAgIG92ZXJmbG93LXk6IHNjcm9sbDsKfQoKLmhpZGRlbi12ZXJ0aWNhbC1zY3JvbGw6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIGZvciBDaHJvbWUsIFNhZmFyaSwgYW5kIE9wZXJhICovCn0KCmA7CmNvbnN0IGFwcEh0bWwgPSBodG1sYAo8bWFpbj4KJHtTSURFQkFSX0hUTUx9CiR7Q09OU09MRV9IVE1MfQoke0FOQUxZVElDU19IVE1MMX0KJHtNT0RBTF9IVE1MfQo8L21haW4+YDsKZnVuY3Rpb24gYXBwZW5kU3R5bGVzaGVldHMoY3NzVGV4dHMpIHsKICAgIGNvbnN0IHN0eWxlU2hlZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgc3R5bGVTaGVldC50eXBlID0gJ3RleHQvY3NzJzsKICAgIHN0eWxlU2hlZXQudGV4dENvbnRlbnQgPSBjc3NUZXh0cy5qb2luKCdcblxuJyk7CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlU2hlZXQpOwp9CmFwcGVuZFN0eWxlc2hlZXRzKFsKICAgIE1BVEVSSUFMX0NTUy5jc3NUZXh0LAogICAgYXBwQ3NzLmNzc1RleHQsCiAgICBIRUFERVJfQ1NTLmNzc1RleHQsCiAgICBTSURFQkFSX0NTUy5jc3NUZXh0LAogICAgQ09OU09MRV9DU1MuY3NzVGV4dCwKICAgIEFOQUxZVElDU19DU1MuY3NzVGV4dCwKICAgIE1PREFMX0NTUy5jc3NUZXh0LAogICAgV0VMQ09NRV9QQU5FTF9DU1MuY3NzVGV4dCwKICAgIFBST0ZJTEVfRURJVE9SX0NTUy5jc3NUZXh0LAogICAgRklMVEVSX0VESVRPUl9DU1MuY3NzVGV4dCwKICAgIENJUkNVTEFSX1BST0dSRVNTX0NTUy5jc3NUZXh0LCAKXSk7CkxpdEVsZW1lbnQucmVuZGVyKGFwcEh0bWwsIGRvY3VtZW50LmJvZHkpOwpmdW5jdGlvbiBwYXJzZVN0YXRpY0RhdGEoKSB7CiAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdGljLWRhdGEtc2NyaXB0Jyk7CiAgICBjb25zdCBkYXRhMSA9IEpTT04ucGFyc2Uoc2NyaXB0LnRleHQpOwogICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBkYXRhMS52ZXJzaW9uID09PSAnc3RyaW5nJyA/IGRhdGExLnZlcnNpb24gOiB1bmRlZmluZWQ7CiAgICBjb25zdCBmbGFncyA9IHR5cGVvZiBkYXRhMS5mbGFncyA9PT0gJ3N0cmluZycgPyBkYXRhMS5mbGFncyA6IHVuZGVmaW5lZDsKICAgIHJldHVybiB7CiAgICAgICAgdmVyc2lvbiwKICAgICAgICBmbGFncwogICAgfTsKfQpjb25zdCBkYXRhID0gcGFyc2VTdGF0aWNEYXRhKCk7CmNvbnN0IHZtID0gbmV3IFdlYnRhaWxBcHBWTSgpOwpjb25zdCB1cGRhdGVTaWRlYmFyID0gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtLCBkYXRhKTsKY29uc3QgdXBkYXRlQ29uc29sZSA9IGluaXRDb25zb2xlKGRvY3VtZW50LCB2bSk7CmNvbnN0IHVwZGF0ZUFuYWx5dGljcyA9IGluaXRBbmFseXRpY3MoZG9jdW1lbnQsIHZtKTsKY29uc3QgdXBkYXRlTW9kYWwgPSBpbml0TW9kYWwoZG9jdW1lbnQsIHZtKTsKdm0ub25DaGFuZ2UgPSAoKT0+ewogICAgdXBkYXRlU2lkZWJhcigpOwogICAgdXBkYXRlQ29uc29sZSgpOwogICAgdXBkYXRlQW5hbHl0aWNzKCk7CiAgICB1cGRhdGVNb2RhbCgpOwp9OwpDbG91ZGZsYXJlQXBpLlVSTF9UUkFOU0ZPUk1FUiA9IENmR3FsQ2xpZW50LlVSTF9UUkFOU0ZPUk1FUiA9ICh2KT0+YC9mZXRjaC8ke3Yuc3Vic3RyaW5nKCdodHRwczovLycubGVuZ3RoKX1gOwp2bS5zdGFydCgpOwpzZXRBcHBTdGF0ZSgnc3RhcnRlZCcpOwoK';