export const TAILWEB_APP_DATA = 'data:text/javascript;base64,YXN5bmMgZnVuY3Rpb24gbGlzdFRhaWxzKGFjY291bnRJZCwgc2NyaXB0TmFtZSwgYXBpVG9rZW4pIHsKICAgIGNvbnN0IHVybCA9IGAke2NvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpfS93b3JrZXJzL3NjcmlwdHMvJHtzY3JpcHROYW1lfS90YWlsc2A7CiAgICByZXR1cm4gKGF3YWl0IGV4ZWN1dGUoJ2xpc3RUYWlscycsICdHRVQnLCB1cmwsIGFwaVRva2VuKSkucmVzdWx0Owp9CmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhaWwoYWNjb3VudElkLCBzY3JpcHROYW1lLCBhcGlUb2tlbikgewogICAgY29uc3QgdXJsID0gYCR7Y29tcHV0ZUFjY291bnRCYXNlVXJsKGFjY291bnRJZCl9L3dvcmtlcnMvc2NyaXB0cy8ke3NjcmlwdE5hbWV9L3RhaWxzYDsKICAgIHJldHVybiAoYXdhaXQgZXhlY3V0ZSgnY3JlYXRlVGFpbCcsICdQT1NUJywgdXJsLCBhcGlUb2tlbikpLnJlc3VsdDsKfQpjbGFzcyBDbG91ZGZsYXJlQXBpIHsKICAgIHN0YXRpYyBERUJVRyA9IGZhbHNlOwogICAgc3RhdGljIFVSTF9UUkFOU0ZPUk1FUiA9ICh2KT0+dgogICAgOwp9CmNvbnN0IEFQUExJQ0FUSU9OX0pTT04gPSAnYXBwbGljYXRpb24vanNvbic7CmNvbnN0IEFQUExJQ0FUSU9OX0pTT05fVVRGOCA9ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04JzsKY29uc3QgQVBQTElDQVRJT05fT0NURVRfU1RSRUFNID0gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CmZ1bmN0aW9uIGNvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpIHsKICAgIHJldHVybiBDbG91ZGZsYXJlQXBpLlVSTF9UUkFOU0ZPUk1FUihgaHR0cHM6Ly9hcGkuY2xvdWRmbGFyZS5jb20vY2xpZW50L3Y0L2FjY291bnRzLyR7YWNjb3VudElkfWApOwp9CmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGUob3AsIG1ldGhvZCwgdXJsLCBhcGlUb2tlbiwgYm9keSwgcmVzcG9uc2VUeXBlID0gJ2pzb24nKSB7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoewogICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2FwaVRva2VufWAKICAgIH0pOwogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykgewogICAgICAgIGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBBUFBMSUNBVElPTl9KU09OX1VURjgpOwogICAgICAgIGlmIChDbG91ZGZsYXJlQXBpLkRFQlVHKSBjb25zb2xlLmxvZyhib2R5KTsKICAgIH0KICAgIGNvbnN0IGZldGNoUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2QsCiAgICAgICAgaGVhZGVycywKICAgICAgICBib2R5CiAgICB9KTsKICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gZmV0Y2hSZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgfHwgJyc7CiAgICBpZiAoKHJlc3BvbnNlVHlwZSA9PT0gJ2J5dGVzJyB8fCByZXNwb25zZVR5cGUgPT09ICdieXRlcz8nKSAmJiBjb250ZW50VHlwZSA9PT0gQVBQTElDQVRJT05fT0NURVRfU1RSRUFNKSB7CiAgICAgICAgY29uc3QgYnVmZmVyID0gYXdhaXQgZmV0Y2hSZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShidWZmZXIpOwogICAgfQogICAgaWYgKCFbCiAgICAgICAgQVBQTElDQVRJT05fSlNPTl9VVEY4LAogICAgICAgIEFQUExJQ0FUSU9OX0pTT04KICAgIF0uaW5jbHVkZXMoY29udGVudFR5cGUpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGNvbnRlbnQtdHlwZTogJHtjb250ZW50VHlwZX0sICBmZXRjaFJlc3BvbnNlPSR7ZmV0Y2hSZXNwb25zZX0sIGJvZHk9JHthd2FpdCBmZXRjaFJlc3BvbnNlLnRleHQoKX1gKTsKICAgIH0KICAgIGNvbnN0IGFwaVJlc3BvbnNlID0gYXdhaXQgZmV0Y2hSZXNwb25zZS5qc29uKCk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaS5ERUJVRykgY29uc29sZS5sb2coYXBpUmVzcG9uc2UpOwogICAgaWYgKCFhcGlSZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgaWYgKGZldGNoUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQgJiYgcmVzcG9uc2VUeXBlID09PSAnYnl0ZXM/JykgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB0aHJvdyBuZXcgQ2xvdWRmbGFyZUFwaUVycm9yKGAke29wfSBmYWlsZWQ6IHN0YXR1cz0ke2ZldGNoUmVzcG9uc2Uuc3RhdHVzfSwgZXJyb3JzPSR7YXBpUmVzcG9uc2UuZXJyb3JzLm1hcCgodik9PmAke3YuY29kZX0gJHt2Lm1lc3NhZ2V9YAogICAgICAgICkuam9pbignLCAnKX1gLCBmZXRjaFJlc3BvbnNlLnN0YXR1cywgYXBpUmVzcG9uc2UuZXJyb3JzKTsKICAgIH0KICAgIHJldHVybiBhcGlSZXNwb25zZTsKfQpjbGFzcyBDbG91ZGZsYXJlQXBpRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICBzdGF0dXM7CiAgICBlcnJvcnM7CiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlMSwgc3RhdHVzLCBlcnJvcnMpewogICAgICAgIHN1cGVyKG1lc3NhZ2UxKTsKICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsKICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczsKICAgIH0KfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfS0VZUyA9IG5ldyBTZXQoWwogICAgJ291dGNvbWUnLAogICAgJ3NjcmlwdE5hbWUnLAogICAgJ2V4Y2VwdGlvbnMnLAogICAgJ2xvZ3MnLAogICAgJ2V2ZW50VGltZXN0YW1wJywKICAgICdldmVudCcKXSk7CmNvbnN0IEtOT1dOX09VVENPTUVTID0gbmV3IFNldChbCiAgICAnb2snLAogICAgJ2V4Y2VwdGlvbicsCiAgICAnZXhjZWVkZWRDcHUnLAogICAgJ2NhbmNlbGVkJywKICAgICd1bmtub3duJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZShvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZTogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IHsgb3V0Y29tZSAsIHNjcmlwdE5hbWUgLCBldmVudFRpbWVzdGFtcCAgfSA9IG9iakFzQW55OwogICAgaWYgKCFLTk9XTl9PVVRDT01FUy5oYXMob3V0Y29tZSkpIHRocm93IG5ldyBFcnJvcihgQmFkIG91dGNvbWU6IGV4cGVjdGVkIG9uZSBvZiBbJHtbCiAgICAgICAgLi4uS05PV05fT1VUQ09NRVMKICAgIF0uam9pbignLCAnKX1dLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG91dGNvbWUpfWApOwogICAgaWYgKHNjcmlwdE5hbWUgIT09IG51bGwpIHRocm93IG5ldyBFcnJvcihgQmFkIHNjcmlwdE5hbWU6IGV4cGVjdGVkIG51bGwsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkoc2NyaXB0TmFtZSl9YCk7CiAgICBjb25zdCBsb2dzID0gcGFyc2VMb2dzKG9iakFzQW55LmxvZ3MpOwogICAgY29uc3QgZXhjZXB0aW9ucyA9IHBhcnNlRXhjZXB0aW9ucyhvYmpBc0FueS5leGNlcHRpb25zKTsKICAgIGlmICghKHR5cGVvZiBldmVudFRpbWVzdGFtcCA9PT0gJ251bWJlcicgJiYgZXZlbnRUaW1lc3RhbXAgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgZXZlbnRUaW1lc3RhbXA6IGV4cGVjdGVkIHBvc2l0aXZlIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShldmVudFRpbWVzdGFtcCl9YCk7CiAgICBjb25zdCBldmVudCA9IG9iakFzQW55LmV2ZW50ICYmIG9iakFzQW55LmV2ZW50LnJlcXVlc3QgPyBwYXJzZVRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50KG9iakFzQW55LmV2ZW50KSA6IHBhcnNlVGFpbE1lc3NhZ2VDcm9uRXZlbnQob2JqQXNBbnkuZXZlbnQpOwogICAgcmV0dXJuIHsKICAgICAgICBvdXRjb21lLAogICAgICAgIHNjcmlwdE5hbWUsCiAgICAgICAgZXhjZXB0aW9ucywKICAgICAgICBsb2dzLAogICAgICAgIGV2ZW50VGltZXN0YW1wLAogICAgICAgIGV2ZW50CiAgICB9Owp9CmZ1bmN0aW9uIHBhcnNlTG9ncyhvYmopIHsKICAgIGlmICghQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBsb2dzOiBleHBlY3RlZCBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5vYmoKICAgIF0ubWFwKHBhcnNlVGFpbE1lc3NhZ2VMb2cpOwp9CmZ1bmN0aW9uIHBhcnNlRXhjZXB0aW9ucyhvYmopIHsKICAgIGlmICghQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBleGNlcHRpb25zOiBleHBlY3RlZCBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5vYmoKICAgIF0ubWFwKHBhcnNlVGFpbE1lc3NhZ2VFeGNlcHRpb24pOwp9CmNvbnN0IFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9MT0dfS0VZUyA9IG5ldyBTZXQoWwogICAgJ21lc3NhZ2UnLAogICAgJ2xldmVsJywKICAgICd0aW1lc3RhbXAnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlTG9nKG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlTG9nOiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9MT0dfS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IG1lc3NhZ2UxID0gcGFyc2VTdHJpbmdBcnJheShvYmpBc0FueS5tZXNzYWdlLCAnbWVzc2FnZScpOwogICAgY29uc3QgeyBsZXZlbCAsIHRpbWVzdGFtcCAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIGxldmVsID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIGxldmVsOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobGV2ZWwpfWApOwogICAgaWYgKCEodHlwZW9mIHRpbWVzdGFtcCA9PT0gJ251bWJlcicgJiYgdGltZXN0YW1wID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIHRpbWVzdGFtcDogZXhwZWN0ZWQgcG9zaXRpdmUgbnVtYmVyLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHRpbWVzdGFtcCl9YCk7CiAgICByZXR1cm4gewogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UxLAogICAgICAgIGxldmVsLAogICAgICAgIHRpbWVzdGFtcAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVhDRVBUSU9OX0tFWVMgPSBuZXcgU2V0KFsKICAgICduYW1lJywKICAgICdtZXNzYWdlJywKICAgICd0aW1lc3RhbXAnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXhjZXB0aW9uKG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlRXhjZXB0aW9uOiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FWENFUFRJT05fS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IHsgbmFtZSAsIG1lc3NhZ2U6IG1lc3NhZ2UxICwgdGltZXN0YW1wICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBuYW1lOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobmFtZSl9YCk7CiAgICBpZiAoISh0eXBlb2YgbWVzc2FnZTEgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbWVzc2FnZTogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG1lc3NhZ2UxKX1gKTsKICAgIGlmICghKHR5cGVvZiB0aW1lc3RhbXAgPT09ICdudW1iZXInICYmIHRpbWVzdGFtcCA+IDApKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0aW1lc3RhbXA6IGV4cGVjdGVkIHBvc2l0aXZlIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeSh0aW1lc3RhbXApfWApOwogICAgcmV0dXJuIHsKICAgICAgICBuYW1lLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UxLAogICAgICAgIHRpbWVzdGFtcAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTID0gbmV3IFNldChbCiAgICAnY3JvbicsCiAgICAnc2NoZWR1bGVkVGltZScKXSk7CmZ1bmN0aW9uIGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIGZhbHNlOwogICAgY29uc3Qga2V5cyA9IG5ldyBTZXQoT2JqZWN0LmtleXMob2JqKSk7CiAgICByZXR1cm4gc2V0RXF1YWwoa2V5cywgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0NST05fRVZFTlRfS0VZUyk7Cn0KZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUNyb25FdmVudChvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUNyb25FdmVudDogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyBjcm9uICwgc2NoZWR1bGVkVGltZSAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIGNyb24gPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY3JvbjogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KGNyb24pfWApOwogICAgaWYgKCEodHlwZW9mIHNjaGVkdWxlZFRpbWUgPT09ICdudW1iZXInICYmIHNjaGVkdWxlZFRpbWUgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgc2NoZWR1bGVkVGltZTogZXhwZWN0ZWQgcG9zaXRpdmUgbnVtYmVyLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHNjaGVkdWxlZFRpbWUpfWApOwogICAgcmV0dXJuIHsKICAgICAgICBjcm9uLAogICAgICAgIHNjaGVkdWxlZFRpbWUKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX1JFUVVFU1RfRVZFTlRfS0VZUyA9IG5ldyBTZXQoWwogICAgJ3JlcXVlc3QnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCByZXF1ZXN0ID0gcGFyc2VUYWlsTWVzc2FnZUV2ZW50UmVxdWVzdChvYmpBc0FueS5yZXF1ZXN0KTsKICAgIHJldHVybiB7CiAgICAgICAgcmVxdWVzdAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAndXJsJywKICAgICdtZXRob2QnLAogICAgJ2hlYWRlcnMnCl0pOwpjb25zdCBPUFRJT05BTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAnY2YnCl0pOwpjb25zdCBBTExfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyA9IHNldFVuaW9uKFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIE9QVElPTkFMX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMpOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIEFMTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyB1cmwgLCBtZXRob2QgIH0gPSBvYmpBc0FueTsKICAgIGlmICghKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdXJsOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodXJsKX1gKTsKICAgIGlmICghKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbWV0aG9kOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobWV0aG9kKX1gKTsKICAgIGNvbnN0IGhlYWRlcnMgPSBwYXJzZVN0cmluZ1JlY29yZChvYmpBc0FueS5oZWFkZXJzLCAnaGVhZGVycycpOwogICAgY29uc3QgY2YgPSBvYmpBc0FueS5jZiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqQXNBbnkuY2YpOwogICAgcmV0dXJuIHsKICAgICAgICB1cmwsCiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgY2YKICAgIH07Cn0KZnVuY3Rpb24gY2hlY2tLZXlzKG9iaiwgcmVxdWlyZWRLZXlzLCBhbGxLZXlzKSB7CiAgICBjb25zdCBrZXlzID0gbmV3IFNldChPYmplY3Qua2V5cyhvYmopKTsKICAgIGNvbnN0IG1pc3NpbmdLZXlzID0gc2V0U3VidHJhY3QocmVxdWlyZWRLZXlzLCBrZXlzKTsKICAgIGlmIChtaXNzaW5nS2V5cy5zaXplID4gMCkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGtleXM6ICR7WwogICAgICAgIC4uLm1pc3NpbmdLZXlzCiAgICBdLmpvaW4oJywgJyl9YCk7CiAgICBjb25zdCBleHRyYUtleXMgPSBzZXRTdWJ0cmFjdChrZXlzLCBhbGxLZXlzIHx8IHJlcXVpcmVkS2V5cyk7CiAgICBpZiAoZXh0cmFLZXlzLnNpemUgPiAwKSB0aHJvdyBuZXcgRXJyb3IoYEV4dHJhIGtleXM6ICR7WwogICAgICAgIC4uLmV4dHJhS2V5cwogICAgXS5qb2luKCcsICcpfWApOwp9CmZ1bmN0aW9uIHBhcnNlU3RyaW5nUmVjb3JkKG9iaiwgbmFtZSkgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIHN0cmluZyByZWNvcmQsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGZvciAoY29uc3QgW18sIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYmopKXsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lfTogRXhwZWN0ZWQgc3RyaW5nIHJlY29yZCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgfQogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBwYXJzZVN0cmluZ0FycmF5KG9iaiwgbmFtZSkgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8ICFBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIHN0cmluZyBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgZm9yIChjb25zdCB2YWx1ZSBvZiBvYmopewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCAke25hbWV9OiBFeHBlY3RlZCBzdHJpbmcgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIH0KICAgIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY2Y6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBzZXRTdWJ0cmFjdChsaHMsIHJocykgewogICAgY29uc3QgcnQgPSBuZXcgU2V0KGxocyk7CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmhzKXsKICAgICAgICBydC5kZWxldGUoaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gc2V0VW5pb24obGhzLCByaHMpIHsKICAgIGNvbnN0IHJ0ID0gbmV3IFNldChsaHMpOwogICAgZm9yIChjb25zdCBpdGVtIG9mIHJocyl7CiAgICAgICAgcnQuYWRkKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJ0Owp9CmZ1bmN0aW9uIHNldEVxdWFsKGxocywgcmhzKSB7CiAgICByZXR1cm4gbGhzLnNpemUgPT09IHJocy5zaXplICYmIFsKICAgICAgICAuLi5saHMKICAgIF0uZXZlcnkoKHYpPT5yaHMuaGFzKHYpCiAgICApOwp9CmNsYXNzIFRhaWxDb25uZWN0aW9uIHsKICAgIHN0YXRpYyBWRVJCT1NFID0gZmFsc2U7CiAgICB3czsKICAgIGNhbGxiYWNrczsKICAgIG9wdGlvbnM7CiAgICBjb25zdHJ1Y3Rvcih3ZWJTb2NrZXRVcmwsIGNhbGxiYWNrcyl7CiAgICAgICAgdGhpcy53cyA9IG5ldyBXZWJTb2NrZXQod2ViU29ja2V0VXJsLCAndHJhY2UtdjEnKTsKICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrczsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIHRoaXMuc2VuZE9wdGlvbnNJZk9wZW4oKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbk9wZW4pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vbk9wZW4odGhpcywgdGltZVN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgY29kZSAsIHJlYXNvbiAsIHdhc0NsZWFuICwgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIGlmIChjYWxsYmFja3Mub25DbG9zZSkgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uQ2xvc2UodGhpcywgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIGNvbnN0IGVycm9ySW5mbyA9IGNvbXB1dGVFcnJvckluZm8oZXZlbnQpOwogICAgICAgICAgICBpZiAoY2FsbGJhY2tzLm9uRXJyb3IpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vbkVycm9yKHRoaXMsIHRpbWVTdGFtcCwgZXJyb3JJbmZvKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGFzeW5jIChldmVudCk9PnsKICAgICAgICAgICAgY29uc3QgeyB0aW1lU3RhbXAgIH0gPSBldmVudDsKICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEgaW5zdGFuY2VvZiBCbG9iKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZXZlbnQuZGF0YS50ZXh0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKHRleHQpOwogICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UxOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlMSA9IHBhcnNlVGFpbE1lc3NhZ2Uob2JqKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25VbnBhcnNlZE1lc3NhZ2UodGhpcywgdGltZVN0YW1wLCBvYmosIGUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxNZXNzYWdlKHRoaXMsIHRpbWVTdGFtcCwgbWVzc2FnZTEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVW5wYXJzZWRNZXNzYWdlKHRoaXMsIHRpbWVTdGFtcCwgZXZlbnQuZGF0YSwgbmV3IEVycm9yKGBFeHBlY3RlZCBldmVudC5kYXRhIHRvIGJlIEJsb2JgKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgdGhpcy5zZW5kT3B0aW9uc0lmT3BlbigpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvc2UoY29kZSwgcmVhc29uKSB7CiAgICAgICAgdGhpcy53cy5jbG9zZShjb2RlLCByZWFzb24pOwogICAgfQogICAgc2VuZE9wdGlvbnNJZk9wZW4oKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLndzLnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnN0cmluZ2lmeSh0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICBpZiAoVGFpbENvbm5lY3Rpb24uVkVSQk9TRSkgY29uc29sZS5sb2coYHNlbmRPcHRpb25zSWZPcGVuOiBzZW5kaW5nICR7cGF5bG9hZH1gKTsKICAgICAgICAgICAgdGhpcy53cy5zZW5kKHBheWxvYWQpOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBjb21wdXRlRXJyb3JJbmZvKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2Vycm9yJykgewogICAgICAgIGNvbnN0IHsgbWVzc2FnZTogbWVzc2FnZTEgLCBmaWxlbmFtZSAsIGxpbmVubyAsIGNvbG5vICwgZXJyb3IgIH0gPSBldmVudDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlMSwKICAgICAgICAgICAgZmlsZW5hbWUsCiAgICAgICAgICAgIGxpbmVubywKICAgICAgICAgICAgY29sbm8sCiAgICAgICAgICAgIGVycm9yCiAgICAgICAgfTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7Cn0KZnVuY3Rpb24gZHVtcE1lc3NhZ2VQcmV0dHkobWVzc2FnZTEsIGxvZ2dlcikgewogICAgY29uc3QgdGltZSA9IGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUobWVzc2FnZTEuZXZlbnRUaW1lc3RhbXApKTsKICAgIGNvbnN0IG91dGNvbWUgPSBQUkVUVFlfT1VUQ09NRVMuZ2V0KG1lc3NhZ2UxLm91dGNvbWUpIHx8IG1lc3NhZ2UxLm91dGNvbWU7CiAgICBjb25zdCBvdXRjb21lQ29sb3IgPSBtZXNzYWdlMS5vdXRjb21lID09PSAnb2snID8gJ2dyZWVuJyA6ICdyZWQnOwogICAgaWYgKGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQobWVzc2FnZTEuZXZlbnQpKSB7CiAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyQ/Pz8lY10gWyVjJHtvdXRjb21lfSVjXSAlYyR7bWVzc2FnZTEuZXZlbnQuY3Jvbn1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IG1ldGhvZCAsIHVybCAsIGNmICB9ID0gbWVzc2FnZTEuZXZlbnQucmVxdWVzdDsKICAgICAgICBjb25zdCBjb2xvID0gY2Y/LmNvbG8gfHwgJz8/Pyc7CiAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyR7Y29sb30lY10gWyVjJHtvdXRjb21lfSVjXSAke21ldGhvZH0gJWMke3VybH1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgfQogICAgZm9yIChjb25zdCB7IGxldmVsICwgbWVzc2FnZTogbG9nTWVzc2FnZSAgfSBvZiBtZXNzYWdlMS5sb2dzKXsKICAgICAgICBjb25zdCBsZXZlbENvbG9yID0gTE9HX0xFVkVMX0NPTE9SUy5nZXQobGV2ZWwpIHx8ICdncmF5JzsKICAgICAgICBsb2dnZXIoYCAlY3wlYyBbJWMke2xldmVsfSVjXSAke2xvZ01lc3NhZ2V9YCwgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtsZXZlbENvbG9yfWAsICcnKTsKICAgIH0KICAgIGZvciAoY29uc3QgeyBuYW1lICwgbWVzc2FnZTogZXhjZXB0aW9uTWVzc2FnZSAgfSBvZiBtZXNzYWdlMS5leGNlcHRpb25zKXsKICAgICAgICBsb2dnZXIoYCAlY3wlYyBbJWMke25hbWV9JWNdICVjJHtleGNlcHRpb25NZXNzYWdlfWAsICdjb2xvcjogZ3JheScsICcnLCBgY29sb3I6IHJlZDsgZm9udC1zdHlsZTogYm9sZGAsICcnLCAnY29sb3I6IHJlZCcpOwogICAgfQp9CmZ1bmN0aW9uIHBhZDIobnVtKSB7CiAgICByZXR1cm4gbnVtLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKfQpmdW5jdGlvbiBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKGRhdGUpIHsKICAgIHJldHVybiBbCiAgICAgICAgZGF0ZS5nZXRGdWxsWWVhcigpLAogICAgICAgICctJywKICAgICAgICBwYWQyKGRhdGUuZ2V0TW9udGgoKSArIDEpLAogICAgICAgICctJywKICAgICAgICBwYWQyKGRhdGUuZ2V0RGF0ZSgpKSwKICAgICAgICAnICcsCiAgICAgICAgcGFkMihkYXRlLmdldEhvdXJzKCkpLAogICAgICAgICc6JywKICAgICAgICBwYWQyKGRhdGUuZ2V0TWludXRlcygpKSwKICAgICAgICAnOicsCiAgICAgICAgcGFkMihkYXRlLmdldFNlY29uZHMoKSkKICAgIF0uam9pbignJyk7Cn0KY29uc3QgUFJFVFRZX09VVENPTUVTID0gbmV3IE1hcChbCiAgICBbCiAgICAgICAgJ29rJywKICAgICAgICAnT2snCiAgICBdLAogICAgWwogICAgICAgICdleGNlcHRpb24nLAogICAgICAgICdFcnJvcicKICAgIF0sCiAgICBbCiAgICAgICAgJ2V4Y2VlZGVkQ3B1JywKICAgICAgICAnRXhjZWVkZWQgTGltaXQnCiAgICBdLAogICAgWwogICAgICAgICdjYW5jZWxlZCcsCiAgICAgICAgJ0NhbmNlbGVkJwogICAgXSwKICAgIFsKICAgICAgICAndW5rbm93bicsCiAgICAgICAgJ1Vua25vd24nCiAgICBdLCAKXSk7CmNvbnN0IExPR19MRVZFTF9DT0xPUlMgPSBuZXcgTWFwKFsKICAgIFsKICAgICAgICAndHJhY2UnLAogICAgICAgICdncmF5JwogICAgXSwKICAgIFsKICAgICAgICAnZGVidWcnLAogICAgICAgICdwdXJwbGUnCiAgICBdLAogICAgWwogICAgICAgICdsb2cnLAogICAgICAgICdncmF5JwogICAgXSwKICAgIFsKICAgICAgICAnaW5mbycsCiAgICAgICAgJ2dyYXknCiAgICBdLAogICAgWwogICAgICAgICd3YXJuJywKICAgICAgICAncmVkJwogICAgXSwKICAgIFsKICAgICAgICAnZXJyb3InLAogICAgICAgICdyZWQnCiAgICBdLCAKXSk7CmNvbnN0IGRpcmVjdGl2ZXMgPSBuZXcgV2Vha01hcCgpOwpjb25zdCBkaXJlY3RpdmUgPSAoZik9PiguLi5hcmdzKT0+ewogICAgICAgIGNvbnN0IGQgPSBmKC4uLmFyZ3MpOwogICAgICAgIGRpcmVjdGl2ZXMuc2V0KGQsIHRydWUpOwogICAgICAgIHJldHVybiBkOwogICAgfQo7CmNvbnN0IGlzRGlyZWN0aXZlID0gKG8pPT57CiAgICByZXR1cm4gdHlwZW9mIG8gPT09ICJmdW5jdGlvbiIgJiYgZGlyZWN0aXZlcy5oYXMobyk7Cn07CmNvbnN0IGlzQ0VQb2x5ZmlsbCA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5jdXN0b21FbGVtZW50cyAhPSBudWxsICYmIHdpbmRvdy5jdXN0b21FbGVtZW50cy5wb2x5ZmlsbFdyYXBGbHVzaENhbGxiYWNrICE9PSB2b2lkIDA7CmNvbnN0IHJlcGFyZW50Tm9kZXMgPSAoY29udGFpbmVyLCBzdGFydCwgZW5kID0gbnVsbCwgYmVmb3JlID0gbnVsbCk9PnsKICAgIHdoaWxlKHN0YXJ0ICE9PSBlbmQpewogICAgICAgIGNvbnN0IG4gPSBzdGFydC5uZXh0U2libGluZzsKICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHN0YXJ0LCBiZWZvcmUpOwogICAgICAgIHN0YXJ0ID0gbjsKICAgIH0KfTsKY29uc3QgcmVtb3ZlTm9kZXMgPSAoY29udGFpbmVyLCBzdGFydCwgZW5kID0gbnVsbCk9PnsKICAgIHdoaWxlKHN0YXJ0ICE9PSBlbmQpewogICAgICAgIGNvbnN0IG4gPSBzdGFydC5uZXh0U2libGluZzsKICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoc3RhcnQpOwogICAgICAgIHN0YXJ0ID0gbjsKICAgIH0KfTsKY29uc3Qgbm9DaGFuZ2UgPSB7Cn07CmNvbnN0IG5vdGhpbmcgPSB7Cn07CmNvbnN0IG1hcmtlciA9IGB7e2xpdC0ke1N0cmluZyhNYXRoLnJhbmRvbSgpKS5zbGljZSgyKX19fWA7CmNvbnN0IG5vZGVNYXJrZXIgPSBgPCEtLSR7bWFya2VyfS0tPmA7CmNvbnN0IG1hcmtlclJlZ2V4ID0gbmV3IFJlZ0V4cChgJHttYXJrZXJ9fCR7bm9kZU1hcmtlcn1gKTsKY29uc3QgYm91bmRBdHRyaWJ1dGVTdWZmaXggPSAiJGxpdCQiOwpjbGFzcyBUZW1wbGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihyZXN1bHQsIGVsZW1lbnQ1KXsKICAgICAgICB0aGlzLnBhcnRzID0gW107CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDU7CiAgICAgICAgY29uc3Qgbm9kZXNUb1JlbW92ZSA9IFtdOwogICAgICAgIGNvbnN0IHN0YWNrID0gW107CiAgICAgICAgY29uc3Qgd2Fsa2VyID0gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihlbGVtZW50NS5jb250ZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgbGFzdFBhcnRJbmRleCA9IDA7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgbGV0IHBhcnRJbmRleCA9IDA7CiAgICAgICAgY29uc3QgeyBzdHJpbmdzOiBzdHJpbmdzNSAsIHZhbHVlczogeyBsZW5ndGggIH0gIH0gPSByZXN1bHQ7CiAgICAgICAgd2hpbGUocGFydEluZGV4IDwgbGVuZ3RoKXsKICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpOwogICAgICAgICAgICBpZiAobm9kZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGxlbmd0aDogbGVuZ3RoMiAgfSA9IGF0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoMjsgaSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZHNXaXRoKGF0dHJpYnV0ZXNbaV0ubmFtZSwgYm91bmRBdHRyaWJ1dGVTdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlKGNvdW50LS0gPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nRm9yUGFydCA9IHN0cmluZ3M1W3BhcnRJbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBsYXN0QXR0cmlidXRlTmFtZVJlZ2V4LmV4ZWMoc3RyaW5nRm9yUGFydClbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZUxvb2t1cE5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCkgKyBib3VuZEF0dHJpYnV0ZVN1ZmZpeDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlVmFsdWUgPSBub2RlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVMb29rdXBOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlTG9va3VwTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRpY3MgPSBhdHRyaWJ1dGVWYWx1ZS5zcGxpdChtYXJrZXJSZWdleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiYXR0cmlidXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IHN0YXRpY3MKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCArPSBzdGF0aWNzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gIlRFTVBMQVRFIikgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gbm9kZS5jb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBub2RlLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKG1hcmtlcikgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdzMiA9IGRhdGEuc3BsaXQobWFya2VyUmVnZXgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHN0cmluZ3MyLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxhc3RJbmRleDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluc2VydDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHMgPSBzdHJpbmdzMltpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQgPSBjcmVhdGVNYXJrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gbGFzdEF0dHJpYnV0ZU5hbWVSZWdleC5leGVjKHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoICE9PSBudWxsICYmIGVuZHNXaXRoKG1hdGNoWzJdLCBib3VuZEF0dHJpYnV0ZVN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcy5zbGljZSgwLCBtYXRjaC5pbmRleCkgKyBtYXRjaFsxXSArIG1hdGNoWzJdLnNsaWNlKDAsIC1ib3VuZEF0dHJpYnV0ZVN1ZmZpeC5sZW5ndGgpICsgbWF0Y2hbM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGluc2VydCwgbm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAibm9kZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogKytpbmRleAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZ3MyW2xhc3RJbmRleF0gPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY3JlYXRlTWFya2VyKCksIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmVtb3ZlLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhID0gc3RyaW5nczJbbGFzdEluZGV4XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4ICs9IGxhc3RJbmRleDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSA4KSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhID09PSBtYXJrZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUucHJldmlvdXNTaWJsaW5nID09PSBudWxsIHx8IGluZGV4ID09PSBsYXN0UGFydEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY3JlYXRlTWFya2VyKCksIG5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsYXN0UGFydEluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm5leHRTaWJsaW5nID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YSA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzVG9SZW1vdmUucHVzaChub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgtLTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCBpID0gLTE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoKGkgPSBub2RlLmRhdGEuaW5kZXhPZihtYXJrZXIsIGkgKyAxKSkgIT09IC0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiAtMQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgbiBvZiBub2Rlc1RvUmVtb3ZlKXsKICAgICAgICAgICAgbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBlbmRzV2l0aCA9IChzdHIsIHN1ZmZpeCk9PnsKICAgIGNvbnN0IGluZGV4MSA9IHN0ci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoOwogICAgcmV0dXJuIGluZGV4MSA+PSAwICYmIHN0ci5zbGljZShpbmRleDEpID09PSBzdWZmaXg7Cn07CmNvbnN0IGlzVGVtcGxhdGVQYXJ0QWN0aXZlID0gKHBhcnQpPT5wYXJ0LmluZGV4ICE9PSAtMQo7CmNvbnN0IGNyZWF0ZU1hcmtlciA9ICgpPT5kb2N1bWVudC5jcmVhdGVDb21tZW50KCIiKQo7CmNvbnN0IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXggPSAvKFsgXHgwOVx4MGFceDBjXHgwZF0pKFteXDAtXHgxRlx4N0YtXHg5RiAiJz49L10rKShbIFx4MDlceDBhXHgwY1x4MGRdKj1bIFx4MDlceDBhXHgwY1x4MGRdKig/OlteIFx4MDlceDBhXHgwY1x4MGQiJ2A8Pj1dKnwiW14iXSp8J1teJ10qKSkkLzsKY2xhc3MgVGVtcGxhdGVJbnN0YW5jZSB7CiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZTEsIHByb2Nlc3Nvciwgb3B0aW9uczIpewogICAgICAgIHRoaXMuX19wYXJ0cyA9IFtdOwogICAgICAgIHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZTE7CiAgICAgICAgdGhpcy5wcm9jZXNzb3IgPSBwcm9jZXNzb3I7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczI7CiAgICB9CiAgICB1cGRhdGUodmFsdWVzKSB7CiAgICAgICAgbGV0IGkgPSAwOwogICAgICAgIGZvciAoY29uc3QgcGFydCBvZiB0aGlzLl9fcGFydHMpewogICAgICAgICAgICBpZiAocGFydCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBwYXJ0LnNldFZhbHVlKHZhbHVlc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IHBhcnQxIG9mIHRoaXMuX19wYXJ0cyl7CiAgICAgICAgICAgIGlmIChwYXJ0MSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBwYXJ0MS5jb21taXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9jbG9uZSgpIHsKICAgICAgICBjb25zdCBmcmFnbWVudCA9IGlzQ0VQb2x5ZmlsbCA/IHRoaXMudGVtcGxhdGUuZWxlbWVudC5jb250ZW50LmNsb25lTm9kZSh0cnVlKSA6IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZS5lbGVtZW50LmNvbnRlbnQsIHRydWUpOwogICAgICAgIGNvbnN0IHN0YWNrMSA9IFtdOwogICAgICAgIGNvbnN0IHBhcnRzMiA9IHRoaXMudGVtcGxhdGUucGFydHM7CiAgICAgICAgY29uc3Qgd2Fsa2VyMSA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIoZnJhZ21lbnQsIDEzMywgbnVsbCwgZmFsc2UpOwogICAgICAgIGxldCBwYXJ0SW5kZXgxID0gMDsKICAgICAgICBsZXQgbm9kZUluZGV4ID0gMDsKICAgICAgICBsZXQgcGFydDsKICAgICAgICBsZXQgbm9kZSA9IHdhbGtlcjEubmV4dE5vZGUoKTsKICAgICAgICB3aGlsZShwYXJ0SW5kZXgxIDwgcGFydHMyLmxlbmd0aCl7CiAgICAgICAgICAgIHBhcnQgPSBwYXJ0czJbcGFydEluZGV4MV07CiAgICAgICAgICAgIGlmICghaXNUZW1wbGF0ZVBhcnRBY3RpdmUocGFydCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19wYXJ0cy5wdXNoKHZvaWQgMCk7CiAgICAgICAgICAgICAgICBwYXJ0SW5kZXgxKys7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZShub2RlSW5kZXggPCBwYXJ0LmluZGV4KXsKICAgICAgICAgICAgICAgIG5vZGVJbmRleCsrOwogICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICJURU1QTEFURSIpIHsKICAgICAgICAgICAgICAgICAgICBzdGFjazEucHVzaChub2RlKTsKICAgICAgICAgICAgICAgICAgICB3YWxrZXIxLmN1cnJlbnROb2RlID0gbm9kZS5jb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChub2RlID0gd2Fsa2VyMS5uZXh0Tm9kZSgpKSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHdhbGtlcjEuY3VycmVudE5vZGUgPSBzdGFjazEucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHdhbGtlcjEubmV4dE5vZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFydC50eXBlID09PSAibm9kZSIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnQyID0gdGhpcy5wcm9jZXNzb3IuaGFuZGxlVGV4dEV4cHJlc3Npb24odGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIHBhcnQyLmluc2VydEFmdGVyTm9kZShub2RlLnByZXZpb3VzU2libGluZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaChwYXJ0Mik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaCguLi50aGlzLnByb2Nlc3Nvci5oYW5kbGVBdHRyaWJ1dGVFeHByZXNzaW9ucyhub2RlLCBwYXJ0Lm5hbWUsIHBhcnQuc3RyaW5ncywgdGhpcy5vcHRpb25zKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFydEluZGV4MSsrOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDRVBvbHlmaWxsKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmFkb3B0Tm9kZShmcmFnbWVudCk7CiAgICAgICAgICAgIGN1c3RvbUVsZW1lbnRzLnVwZ3JhZGUoZnJhZ21lbnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZnJhZ21lbnQ7CiAgICB9Cn0KY29uc3QgcG9saWN5ID0gd2luZG93LnRydXN0ZWRUeXBlcyAmJiB0cnVzdGVkVHlwZXMuY3JlYXRlUG9saWN5KCJsaXQtaHRtbCIsIHsKICAgIGNyZWF0ZUhUTUw6IChzKT0+cwp9KTsKY29uc3QgY29tbWVudE1hcmtlciA9IGAgJHttYXJrZXJ9IGA7CmNsYXNzIFRlbXBsYXRlUmVzdWx0IHsKICAgIGNvbnN0cnVjdG9yKHN0cmluZ3MxLCB2YWx1ZXMsIHR5cGUxLCBwcm9jZXNzb3IxKXsKICAgICAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzMTsKICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlczsKICAgICAgICB0aGlzLnR5cGUgPSB0eXBlMTsKICAgICAgICB0aGlzLnByb2Nlc3NvciA9IHByb2Nlc3NvcjE7CiAgICB9CiAgICBnZXRIVE1MKCkgewogICAgICAgIGNvbnN0IGwgPSB0aGlzLnN0cmluZ3MubGVuZ3RoIC0gMTsKICAgICAgICBsZXQgaHRtbDIgPSAiIjsKICAgICAgICBsZXQgaXNDb21tZW50QmluZGluZyA9IGZhbHNlOwogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsOyBpKyspewogICAgICAgICAgICBjb25zdCBzID0gdGhpcy5zdHJpbmdzW2ldOwogICAgICAgICAgICBjb25zdCBjb21tZW50T3BlbiA9IHMubGFzdEluZGV4T2YoIjwhLS0iKTsKICAgICAgICAgICAgaXNDb21tZW50QmluZGluZyA9IChjb21tZW50T3BlbiA+IC0xIHx8IGlzQ29tbWVudEJpbmRpbmcpICYmIHMuaW5kZXhPZigiLS0+IiwgY29tbWVudE9wZW4gKyAxKSA9PT0gLTE7CiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZU1hdGNoID0gbGFzdEF0dHJpYnV0ZU5hbWVSZWdleC5leGVjKHMpOwogICAgICAgICAgICBpZiAoYXR0cmlidXRlTWF0Y2ggPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGh0bWwyICs9IHMgKyAoaXNDb21tZW50QmluZGluZyA/IGNvbW1lbnRNYXJrZXIgOiBub2RlTWFya2VyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGh0bWwyICs9IHMuc3Vic3RyKDAsIGF0dHJpYnV0ZU1hdGNoLmluZGV4KSArIGF0dHJpYnV0ZU1hdGNoWzFdICsgYXR0cmlidXRlTWF0Y2hbMl0gKyBib3VuZEF0dHJpYnV0ZVN1ZmZpeCArIGF0dHJpYnV0ZU1hdGNoWzNdICsgbWFya2VyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGh0bWwyICs9IHRoaXMuc3RyaW5nc1tsXTsKICAgICAgICByZXR1cm4gaHRtbDI7CiAgICB9CiAgICBnZXRUZW1wbGF0ZUVsZW1lbnQoKSB7CiAgICAgICAgY29uc3QgdGVtcGxhdGUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmdldEhUTUwoKTsKICAgICAgICBpZiAocG9saWN5ICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdmFsdWUgPSBwb2xpY3kuY3JlYXRlSFRNTCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHRlbXBsYXRlMS5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGVtcGxhdGUxOwogICAgfQp9CmNsYXNzIFNWR1RlbXBsYXRlUmVzdWx0IGV4dGVuZHMgVGVtcGxhdGVSZXN1bHQgewogICAgZ2V0SFRNTCgpIHsKICAgICAgICByZXR1cm4gYDxzdmc+JHtzdXBlci5nZXRIVE1MKCl9PC9zdmc+YDsKICAgIH0KICAgIGdldFRlbXBsYXRlRWxlbWVudCgpIHsKICAgICAgICBjb25zdCB0ZW1wbGF0ZTEgPSBzdXBlci5nZXRUZW1wbGF0ZUVsZW1lbnQoKTsKICAgICAgICBjb25zdCBjb250ZW50ID0gdGVtcGxhdGUxLmNvbnRlbnQ7CiAgICAgICAgY29uc3Qgc3ZnRWxlbWVudCA9IGNvbnRlbnQuZmlyc3RDaGlsZDsKICAgICAgICBjb250ZW50LnJlbW92ZUNoaWxkKHN2Z0VsZW1lbnQpOwogICAgICAgIHJlcGFyZW50Tm9kZXMoY29udGVudCwgc3ZnRWxlbWVudC5maXJzdENoaWxkKTsKICAgICAgICByZXR1cm4gdGVtcGxhdGUxOwogICAgfQp9CmNvbnN0IGlzUHJpbWl0aXZlID0gKHZhbHVlKT0+ewogICAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8ICEodHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiB8fCB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpOwp9Owpjb25zdCBpc0l0ZXJhYmxlID0gKHZhbHVlKT0+ewogICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpIHx8ICEhKHZhbHVlICYmIHZhbHVlW1N5bWJvbC5pdGVyYXRvcl0pOwp9OwpjbGFzcyBBdHRyaWJ1dGVDb21taXR0ZXIgewogICAgY29uc3RydWN0b3IoZWxlbWVudDEsIG5hbWUzLCBzdHJpbmdzMil7CiAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDE7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTM7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczI7CiAgICAgICAgdGhpcy5wYXJ0cyA9IFtdOwogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzdHJpbmdzMi5sZW5ndGggLSAxOyBpKyspewogICAgICAgICAgICB0aGlzLnBhcnRzW2ldID0gdGhpcy5fY3JlYXRlUGFydCgpOwogICAgICAgIH0KICAgIH0KICAgIF9jcmVhdGVQYXJ0KCkgewogICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlUGFydCh0aGlzKTsKICAgIH0KICAgIF9nZXRWYWx1ZSgpIHsKICAgICAgICBjb25zdCBzdHJpbmdzMyA9IHRoaXMuc3RyaW5nczsKICAgICAgICBjb25zdCBsID0gc3RyaW5nczMubGVuZ3RoIC0gMTsKICAgICAgICBjb25zdCBwYXJ0czIgPSB0aGlzLnBhcnRzOwogICAgICAgIGlmIChsID09PSAxICYmIHN0cmluZ3MzWzBdID09PSAiIiAmJiBzdHJpbmdzM1sxXSA9PT0gIiIpIHsKICAgICAgICAgICAgY29uc3QgdiA9IHBhcnRzMlswXS52YWx1ZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAic3ltYm9sIikgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJzdHJpbmciIHx8ICFpc0l0ZXJhYmxlKHYpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgdGV4dCA9ICIiOwogICAgICAgIGZvcihsZXQgaTEgPSAwOyBpMSA8IGw7IGkxKyspewogICAgICAgICAgICB0ZXh0ICs9IHN0cmluZ3MzW2kxXTsKICAgICAgICAgICAgY29uc3QgcGFydCA9IHBhcnRzMltpMV07CiAgICAgICAgICAgIGlmIChwYXJ0ICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHYgPSBwYXJ0LnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKGlzUHJpbWl0aXZlKHYpIHx8ICFpc0l0ZXJhYmxlKHYpKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSB0eXBlb2YgdiA9PT0gInN0cmluZyIgPyB2IDogU3RyaW5nKHYpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygdil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gdHlwZW9mIHQgPT09ICJzdHJpbmciID8gdCA6IFN0cmluZyh0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGV4dCArPSBzdHJpbmdzM1tsXTsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUodGhpcy5uYW1lLCB0aGlzLl9nZXRWYWx1ZSgpKTsKICAgICAgICB9CiAgICB9Cn0KY2xhc3MgQXR0cmlidXRlUGFydCB7CiAgICBjb25zdHJ1Y3Rvcihjb21taXR0ZXIpewogICAgICAgIHRoaXMudmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5jb21taXR0ZXIgPSBjb21taXR0ZXI7CiAgICB9CiAgICBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSAhPT0gbm9DaGFuZ2UgJiYgKCFpc1ByaW1pdGl2ZSh2YWx1ZSkgfHwgdmFsdWUgIT09IHRoaXMudmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgaWYgKCFpc0RpcmVjdGl2ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29tbWl0dGVyLmRpcnR5ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICB3aGlsZShpc0RpcmVjdGl2ZSh0aGlzLnZhbHVlKSl7CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGl2ZTIgPSB0aGlzLnZhbHVlOwogICAgICAgICAgICB0aGlzLnZhbHVlID0gbm9DaGFuZ2U7CiAgICAgICAgICAgIGRpcmVjdGl2ZTIodGhpcyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnZhbHVlID09PSBub0NoYW5nZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuY29tbWl0dGVyLmNvbW1pdCgpOwogICAgfQp9CmNsYXNzIE5vZGVQYXJ0IHsKICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMxKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczE7CiAgICB9CiAgICBhcHBlbmRJbnRvKGNvbnRhaW5lcikgewogICAgICAgIHRoaXMuc3RhcnROb2RlID0gY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZU1hcmtlcigpKTsKICAgICAgICB0aGlzLmVuZE5vZGUgPSBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlTWFya2VyKCkpOwogICAgfQogICAgaW5zZXJ0QWZ0ZXJOb2RlKHJlZikgewogICAgICAgIHRoaXMuc3RhcnROb2RlID0gcmVmOwogICAgICAgIHRoaXMuZW5kTm9kZSA9IHJlZi5uZXh0U2libGluZzsKICAgIH0KICAgIGFwcGVuZEludG9QYXJ0KHBhcnQpIHsKICAgICAgICBwYXJ0Ll9faW5zZXJ0KHRoaXMuc3RhcnROb2RlID0gY3JlYXRlTWFya2VyKCkpOwogICAgICAgIHBhcnQuX19pbnNlcnQodGhpcy5lbmROb2RlID0gY3JlYXRlTWFya2VyKCkpOwogICAgfQogICAgaW5zZXJ0QWZ0ZXJQYXJ0KHJlZikgewogICAgICAgIHJlZi5fX2luc2VydCh0aGlzLnN0YXJ0Tm9kZSA9IGNyZWF0ZU1hcmtlcigpKTsKICAgICAgICB0aGlzLmVuZE5vZGUgPSByZWYuZW5kTm9kZTsKICAgICAgICByZWYuZW5kTm9kZSA9IHRoaXMuc3RhcnROb2RlOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuc3RhcnROb2RlLnBhcmVudE5vZGUgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB3aGlsZShpc0RpcmVjdGl2ZSh0aGlzLl9fcGVuZGluZ1ZhbHVlKSl7CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGl2ZTIgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICAgICAgICAgIGRpcmVjdGl2ZTIodGhpcyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICBpZiAodmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzUHJpbWl0aXZlKHZhbHVlKSkgewogICAgICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMudmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19jb21taXRUZXh0KHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlc3VsdCkgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0VGVtcGxhdGVSZXN1bHQodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBOb2RlKSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXROb2RlKHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKGlzSXRlcmFibGUodmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXRJdGVyYWJsZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gbm90aGluZykgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gbm90aGluZzsKICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXRUZXh0KHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBfX2luc2VydChub2RlKSB7CiAgICAgICAgdGhpcy5lbmROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIHRoaXMuZW5kTm9kZSk7CiAgICB9CiAgICBfX2NvbW1pdE5vZGUodmFsdWUpIHsKICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fX2luc2VydCh2YWx1ZSk7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgfQogICAgX19jb21taXRUZXh0KHZhbHVlKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuc3RhcnROb2RlLm5leHRTaWJsaW5nOwogICAgICAgIHZhbHVlID0gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWU7CiAgICAgICAgY29uc3QgdmFsdWVBc1N0cmluZyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZSA6IFN0cmluZyh2YWx1ZSk7CiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMuZW5kTm9kZS5wcmV2aW91c1NpYmxpbmcgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMykgewogICAgICAgICAgICBub2RlLmRhdGEgPSB2YWx1ZUFzU3RyaW5nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXROb2RlKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlQXNTdHJpbmcpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgfQogICAgX19jb21taXRUZW1wbGF0ZVJlc3VsdCh2YWx1ZSkgewogICAgICAgIGNvbnN0IHRlbXBsYXRlMSA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZUZhY3RvcnkodmFsdWUpOwogICAgICAgIGlmICh0aGlzLnZhbHVlIGluc3RhbmNlb2YgVGVtcGxhdGVJbnN0YW5jZSAmJiB0aGlzLnZhbHVlLnRlbXBsYXRlID09PSB0ZW1wbGF0ZTEpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZS51cGRhdGUodmFsdWUudmFsdWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBUZW1wbGF0ZUluc3RhbmNlKHRlbXBsYXRlMSwgdmFsdWUucHJvY2Vzc29yLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICBjb25zdCBmcmFnbWVudCA9IGluc3RhbmNlLl9jbG9uZSgpOwogICAgICAgICAgICBpbnN0YW5jZS51cGRhdGUodmFsdWUudmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdE5vZGUoZnJhZ21lbnQpOwogICAgICAgICAgICB0aGlzLnZhbHVlID0gaW5zdGFuY2U7CiAgICAgICAgfQogICAgfQogICAgX19jb21taXRJdGVyYWJsZSh2YWx1ZSkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gW107CiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXRlbVBhcnRzID0gdGhpcy52YWx1ZTsKICAgICAgICBsZXQgcGFydEluZGV4MSA9IDA7CiAgICAgICAgbGV0IGl0ZW1QYXJ0OwogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB2YWx1ZSl7CiAgICAgICAgICAgIGl0ZW1QYXJ0ID0gaXRlbVBhcnRzW3BhcnRJbmRleDFdOwogICAgICAgICAgICBpZiAoaXRlbVBhcnQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgaXRlbVBhcnQgPSBuZXcgTm9kZVBhcnQodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIGl0ZW1QYXJ0cy5wdXNoKGl0ZW1QYXJ0KTsKICAgICAgICAgICAgICAgIGlmIChwYXJ0SW5kZXgxID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbVBhcnQuYXBwZW5kSW50b1BhcnQodGhpcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGl0ZW1QYXJ0Lmluc2VydEFmdGVyUGFydChpdGVtUGFydHNbcGFydEluZGV4MSAtIDFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpdGVtUGFydC5zZXRWYWx1ZShpdGVtKTsKICAgICAgICAgICAgaXRlbVBhcnQuY29tbWl0KCk7CiAgICAgICAgICAgIHBhcnRJbmRleDErKzsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcnRJbmRleDEgPCBpdGVtUGFydHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGl0ZW1QYXJ0cy5sZW5ndGggPSBwYXJ0SW5kZXgxOwogICAgICAgICAgICB0aGlzLmNsZWFyKGl0ZW1QYXJ0ICYmIGl0ZW1QYXJ0LmVuZE5vZGUpOwogICAgICAgIH0KICAgIH0KICAgIGNsZWFyKHN0YXJ0Tm9kZSA9IHRoaXMuc3RhcnROb2RlKSB7CiAgICAgICAgcmVtb3ZlTm9kZXModGhpcy5zdGFydE5vZGUucGFyZW50Tm9kZSwgc3RhcnROb2RlLm5leHRTaWJsaW5nLCB0aGlzLmVuZE5vZGUpOwogICAgfQp9CmNsYXNzIEJvb2xlYW5BdHRyaWJ1dGVQYXJ0IHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQyLCBuYW1lMSwgc3RyaW5nczMpewogICAgICAgIHRoaXMudmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZvaWQgMDsKICAgICAgICBpZiAoc3RyaW5nczMubGVuZ3RoICE9PSAyIHx8IHN0cmluZ3MzWzBdICE9PSAiIiB8fCBzdHJpbmdzM1sxXSAhPT0gIiIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJCb29sZWFuIGF0dHJpYnV0ZXMgY2FuIG9ubHkgY29udGFpbiBhIHNpbmdsZSBleHByZXNzaW9uIik7CiAgICAgICAgfQogICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQyOwogICAgICAgIHRoaXMubmFtZSA9IG5hbWUxOwogICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3MzOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy5fX3BlbmRpbmdWYWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fX3BlbmRpbmdWYWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB2YWx1ZSA9ICEhdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKHRoaXMubmFtZSwgIiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSh0aGlzLm5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgfQp9CmNsYXNzIFByb3BlcnR5Q29tbWl0dGVyIGV4dGVuZHMgQXR0cmlidXRlQ29tbWl0dGVyIHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQzLCBuYW1lMiwgc3RyaW5nczQpewogICAgICAgIHN1cGVyKGVsZW1lbnQzLCBuYW1lMiwgc3RyaW5nczQpOwogICAgICAgIHRoaXMuc2luZ2xlID0gc3RyaW5nczQubGVuZ3RoID09PSAyICYmIHN0cmluZ3M0WzBdID09PSAiIiAmJiBzdHJpbmdzNFsxXSA9PT0gIiI7CiAgICB9CiAgICBfY3JlYXRlUGFydCgpIHsKICAgICAgICByZXR1cm4gbmV3IFByb3BlcnR5UGFydCh0aGlzKTsKICAgIH0KICAgIF9nZXRWYWx1ZSgpIHsKICAgICAgICBpZiAodGhpcy5zaW5nbGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFydHNbMF0udmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBlci5fZ2V0VmFsdWUoKTsKICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZWxlbWVudFt0aGlzLm5hbWVdID0gdGhpcy5fZ2V0VmFsdWUoKTsKICAgICAgICB9CiAgICB9Cn0KY2xhc3MgUHJvcGVydHlQYXJ0IGV4dGVuZHMgQXR0cmlidXRlUGFydCB7Cn0KbGV0IGV2ZW50T3B0aW9uc1N1cHBvcnRlZCA9IGZhbHNlOwooKCk9PnsKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgb3B0aW9uczIgPSB7CiAgICAgICAgICAgIGdldCBjYXB0dXJlICgpIHsKICAgICAgICAgICAgICAgIGV2ZW50T3B0aW9uc1N1cHBvcnRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0ZXN0Iiwgb3B0aW9uczIsIG9wdGlvbnMyKTsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigidGVzdCIsIG9wdGlvbnMyLCBvcHRpb25zMik7CiAgICB9IGNhdGNoIChfZSkgewogICAgfQp9KSgpOwpjbGFzcyBFdmVudFBhcnQgewogICAgY29uc3RydWN0b3IoZWxlbWVudDQsIGV2ZW50TmFtZSwgZXZlbnRDb250ZXh0KXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDQ7CiAgICAgICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7CiAgICAgICAgdGhpcy5ldmVudENvbnRleHQgPSBldmVudENvbnRleHQ7CiAgICAgICAgdGhpcy5fX2JvdW5kSGFuZGxlRXZlbnQgPSAoZSk9PnRoaXMuaGFuZGxlRXZlbnQoZSkKICAgICAgICA7CiAgICB9CiAgICBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICB3aGlsZShpc0RpcmVjdGl2ZSh0aGlzLl9fcGVuZGluZ1ZhbHVlKSl7CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGl2ZTIgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gbm9DaGFuZ2U7CiAgICAgICAgICAgIGRpcmVjdGl2ZTIodGhpcyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9fcGVuZGluZ1ZhbHVlID09PSBub0NoYW5nZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5ld0xpc3RlbmVyID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICBjb25zdCBvbGRMaXN0ZW5lciA9IHRoaXMudmFsdWU7CiAgICAgICAgY29uc3Qgc2hvdWxkUmVtb3ZlTGlzdGVuZXIgPSBuZXdMaXN0ZW5lciA9PSBudWxsIHx8IG9sZExpc3RlbmVyICE9IG51bGwgJiYgKG5ld0xpc3RlbmVyLmNhcHR1cmUgIT09IG9sZExpc3RlbmVyLmNhcHR1cmUgfHwgbmV3TGlzdGVuZXIub25jZSAhPT0gb2xkTGlzdGVuZXIub25jZSB8fCBuZXdMaXN0ZW5lci5wYXNzaXZlICE9PSBvbGRMaXN0ZW5lci5wYXNzaXZlKTsKICAgICAgICBjb25zdCBzaG91bGRBZGRMaXN0ZW5lciA9IG5ld0xpc3RlbmVyICE9IG51bGwgJiYgKG9sZExpc3RlbmVyID09IG51bGwgfHwgc2hvdWxkUmVtb3ZlTGlzdGVuZXIpOwogICAgICAgIGlmIChzaG91bGRSZW1vdmVMaXN0ZW5lcikgewogICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgdGhpcy5fX2JvdW5kSGFuZGxlRXZlbnQsIHRoaXMuX19vcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNob3VsZEFkZExpc3RlbmVyKSB7CiAgICAgICAgICAgIHRoaXMuX19vcHRpb25zID0gZ2V0T3B0aW9ucyhuZXdMaXN0ZW5lcik7CiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLl9fYm91bmRIYW5kbGVFdmVudCwgdGhpcy5fX29wdGlvbnMpOwogICAgICAgIH0KICAgICAgICB0aGlzLnZhbHVlID0gbmV3TGlzdGVuZXI7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgfQogICAgaGFuZGxlRXZlbnQoZXZlbnQpIHsKICAgICAgICBpZiAodHlwZW9mIHRoaXMudmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZS5jYWxsKHRoaXMuZXZlbnRDb250ZXh0IHx8IHRoaXMuZWxlbWVudCwgZXZlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUuaGFuZGxlRXZlbnQoZXZlbnQpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBnZXRPcHRpb25zID0gKG8pPT5vICYmIChldmVudE9wdGlvbnNTdXBwb3J0ZWQgPyB7CiAgICAgICAgY2FwdHVyZTogby5jYXB0dXJlLAogICAgICAgIHBhc3NpdmU6IG8ucGFzc2l2ZSwKICAgICAgICBvbmNlOiBvLm9uY2UKICAgIH0gOiBvLmNhcHR1cmUpCjsKY2xhc3MgRGVmYXVsdFRlbXBsYXRlUHJvY2Vzc29yIHsKICAgIGhhbmRsZUF0dHJpYnV0ZUV4cHJlc3Npb25zKGVsZW1lbnQsIG5hbWUsIHN0cmluZ3MsIG9wdGlvbnMpIHsKICAgICAgICBjb25zdCBwcmVmaXggPSBuYW1lWzBdOwogICAgICAgIGlmIChwcmVmaXggPT09ICIuIikgewogICAgICAgICAgICBjb25zdCBjb21taXR0ZXIyID0gbmV3IFByb3BlcnR5Q29tbWl0dGVyKGVsZW1lbnQsIG5hbWUuc2xpY2UoMSksIHN0cmluZ3MpOwogICAgICAgICAgICByZXR1cm4gY29tbWl0dGVyMi5wYXJ0czsKICAgICAgICB9CiAgICAgICAgaWYgKHByZWZpeCA9PT0gIkAiKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBuZXcgRXZlbnRQYXJ0KGVsZW1lbnQsIG5hbWUuc2xpY2UoMSksIG9wdGlvbnMuZXZlbnRDb250ZXh0KQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICBpZiAocHJlZml4ID09PSAiPyIpIHsKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgIG5ldyBCb29sZWFuQXR0cmlidXRlUGFydChlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBzdHJpbmdzKQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICBjb25zdCBjb21taXR0ZXIxID0gbmV3IEF0dHJpYnV0ZUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKTsKICAgICAgICByZXR1cm4gY29tbWl0dGVyMS5wYXJ0czsKICAgIH0KICAgIGhhbmRsZVRleHRFeHByZXNzaW9uKG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gbmV3IE5vZGVQYXJ0KG9wdGlvbnMpOwogICAgfQp9CmNvbnN0IGRlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvciA9IG5ldyBEZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IoKTsKZnVuY3Rpb24gdGVtcGxhdGVGYWN0b3J5KHJlc3VsdDEpIHsKICAgIGxldCB0ZW1wbGF0ZUNhY2hlID0gdGVtcGxhdGVDYWNoZXMuZ2V0KHJlc3VsdDEudHlwZSk7CiAgICBpZiAodGVtcGxhdGVDYWNoZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGVtcGxhdGVDYWNoZSA9IHsKICAgICAgICAgICAgc3RyaW5nc0FycmF5OiBuZXcgV2Vha01hcCgpLAogICAgICAgICAgICBrZXlTdHJpbmc6IG5ldyBNYXAoKQogICAgICAgIH07CiAgICAgICAgdGVtcGxhdGVDYWNoZXMuc2V0KHJlc3VsdDEudHlwZSwgdGVtcGxhdGVDYWNoZSk7CiAgICB9CiAgICBsZXQgdGVtcGxhdGUxID0gdGVtcGxhdGVDYWNoZS5zdHJpbmdzQXJyYXkuZ2V0KHJlc3VsdDEuc3RyaW5ncyk7CiAgICBpZiAodGVtcGxhdGUxICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gdGVtcGxhdGUxOwogICAgfQogICAgY29uc3Qga2V5ID0gcmVzdWx0MS5zdHJpbmdzLmpvaW4obWFya2VyKTsKICAgIHRlbXBsYXRlMSA9IHRlbXBsYXRlQ2FjaGUua2V5U3RyaW5nLmdldChrZXkpOwogICAgaWYgKHRlbXBsYXRlMSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGVtcGxhdGUxID0gbmV3IFRlbXBsYXRlKHJlc3VsdDEsIHJlc3VsdDEuZ2V0VGVtcGxhdGVFbGVtZW50KCkpOwogICAgICAgIHRlbXBsYXRlQ2FjaGUua2V5U3RyaW5nLnNldChrZXksIHRlbXBsYXRlMSk7CiAgICB9CiAgICB0ZW1wbGF0ZUNhY2hlLnN0cmluZ3NBcnJheS5zZXQocmVzdWx0MS5zdHJpbmdzLCB0ZW1wbGF0ZTEpOwogICAgcmV0dXJuIHRlbXBsYXRlMTsKfQpjb25zdCB0ZW1wbGF0ZUNhY2hlcyA9IG5ldyBNYXAoKTsKY29uc3QgcGFydHMgPSBuZXcgV2Vha01hcCgpOwpjb25zdCByZW5kZXIgPSAocmVzdWx0MSwgY29udGFpbmVyLCBvcHRpb25zMyk9PnsKICAgIGxldCBwYXJ0ID0gcGFydHMuZ2V0KGNvbnRhaW5lcik7CiAgICBpZiAocGFydCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVtb3ZlTm9kZXMoY29udGFpbmVyLCBjb250YWluZXIuZmlyc3RDaGlsZCk7CiAgICAgICAgcGFydHMuc2V0KGNvbnRhaW5lciwgcGFydCA9IG5ldyBOb2RlUGFydChPYmplY3QuYXNzaWduKHsKICAgICAgICAgICAgdGVtcGxhdGVGYWN0b3J5CiAgICAgICAgfSwgb3B0aW9uczMpKSk7CiAgICAgICAgcGFydC5hcHBlbmRJbnRvKGNvbnRhaW5lcik7CiAgICB9CiAgICBwYXJ0LnNldFZhbHVlKHJlc3VsdDEpOwogICAgcGFydC5jb21taXQoKTsKfTsKaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAod2luZG93WyJsaXRIdG1sVmVyc2lvbnMiXSB8fCAod2luZG93WyJsaXRIdG1sVmVyc2lvbnMiXSA9IFtdKSkucHVzaCgiMS40LjEiKTsKfQpjb25zdCBodG1sID0gKHN0cmluZ3M2LCAuLi52YWx1ZXMxKT0+bmV3IFRlbXBsYXRlUmVzdWx0KHN0cmluZ3M2LCB2YWx1ZXMxLCAiaHRtbCIsIGRlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvcikKOwpjb25zdCBzdmcgPSAoc3RyaW5nczYsIC4uLnZhbHVlczEpPT5uZXcgU1ZHVGVtcGxhdGVSZXN1bHQoc3RyaW5nczYsIHZhbHVlczEsICJzdmciLCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IpCjsKdmFyIF9hOwp3aW5kb3cuSlNDb21waWxlcl9yZW5hbWVQcm9wZXJ0eSA9IChwcm9wLCBfb2JqKT0+cHJvcAo7CmNvbnN0IGRlZmF1bHRDb252ZXJ0ZXIgPSB7CiAgICB0b0F0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/ICIiIDogbnVsbDsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZnJvbUF0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbDsKICAgICAgICAgICAgY2FzZSBOdW1iZXI6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgPyBudWxsIDogTnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KfTsKY29uc3Qgbm90RXF1YWwgPSAodmFsdWUsIG9sZCk9PnsKICAgIHJldHVybiBvbGQgIT09IHZhbHVlICYmIChvbGQgPT09IG9sZCB8fCB2YWx1ZSA9PT0gdmFsdWUpOwp9Owpjb25zdCBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbiA9IHsKICAgIGF0dHJpYnV0ZTogdHJ1ZSwKICAgIHR5cGU6IFN0cmluZywKICAgIGNvbnZlcnRlcjogZGVmYXVsdENvbnZlcnRlciwKICAgIHJlZmxlY3Q6IGZhbHNlLAogICAgaGFzQ2hhbmdlZDogbm90RXF1YWwKfTsKY29uc3QgU1RBVEVfSEFTX1VQREFURUQgPSAxOwpjb25zdCBTVEFURV9VUERBVEVfUkVRVUVTVEVEID0gMSA8PCAyOwpjb25zdCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURSA9IDEgPDwgMzsKY29uc3QgU1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWSA9IDEgPDwgNDsKY29uc3QgZmluYWxpemVkID0gImZpbmFsaXplZCI7CmNsYXNzIFVwZGF0aW5nRWxlbWVudCBleHRlbmRzIEhUTUxFbGVtZW50IHsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLmluaXRpYWxpemUoKTsKICAgIH0KICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gW107CiAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLmZvckVhY2goKHYsIHApPT57CiAgICAgICAgICAgIGNvbnN0IGF0dHIgPSB0aGlzLl9hdHRyaWJ1dGVOYW1lRm9yUHJvcGVydHkocCwgdik7CiAgICAgICAgICAgIGlmIChhdHRyICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJpYnV0ZVRvUHJvcGVydHlNYXAuc2V0KGF0dHIsIHApOwogICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKGF0dHIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXM7CiAgICB9CiAgICBzdGF0aWMgX2Vuc3VyZUNsYXNzUHJvcGVydGllcygpIHsKICAgICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoSlNDb21waWxlcl9yZW5hbWVQcm9wZXJ0eSgiX2NsYXNzUHJvcGVydGllcyIsIHRoaXMpKSkgewogICAgICAgICAgICB0aGlzLl9jbGFzc1Byb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IHN1cGVyUHJvcGVydGllcyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fY2xhc3NQcm9wZXJ0aWVzOwogICAgICAgICAgICBpZiAoc3VwZXJQcm9wZXJ0aWVzICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHN1cGVyUHJvcGVydGllcy5mb3JFYWNoKCh2LCBrKT0+dGhpcy5fY2xhc3NQcm9wZXJ0aWVzLnNldChrLCB2KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBjcmVhdGVQcm9wZXJ0eShuYW1lLCBvcHRpb25zID0gZGVmYXVsdFByb3BlcnR5RGVjbGFyYXRpb24pIHsKICAgICAgICB0aGlzLl9lbnN1cmVDbGFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB0aGlzLl9jbGFzc1Byb3BlcnRpZXMuc2V0KG5hbWUsIG9wdGlvbnMpOwogICAgICAgIGlmIChvcHRpb25zLm5vQWNjZXNzb3IgfHwgdGhpcy5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBrZXkgPSB0eXBlb2YgbmFtZSA9PT0gInN5bWJvbCIgPyBTeW1ib2woKSA6IGBfXyR7bmFtZX1gOwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSB0aGlzLmdldFByb3BlcnR5RGVzY3JpcHRvcihuYW1lLCBrZXksIG9wdGlvbnMpOwogICAgICAgIGlmIChkZXNjcmlwdG9yICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucHJvdG90eXBlLCBuYW1lLCBkZXNjcmlwdG9yKTsKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgZ2V0UHJvcGVydHlEZXNjcmlwdG9yKG5hbWUsIGtleSwgb3B0aW9ucykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldCAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1trZXldOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFVwZGF0ZUludGVybmFsKG5hbWUsIG9sZFZhbHVlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICAgICAgfTsKICAgIH0KICAgIHN0YXRpYyBnZXRQcm9wZXJ0eU9wdGlvbnMobmFtZSkgewogICAgICAgIHJldHVybiB0aGlzLl9jbGFzc1Byb3BlcnRpZXMgJiYgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLmdldChuYW1lKSB8fCBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbjsKICAgIH0KICAgIHN0YXRpYyBmaW5hbGl6ZSgpIHsKICAgICAgICBjb25zdCBzdXBlckN0b3IgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyk7CiAgICAgICAgaWYgKCFzdXBlckN0b3IuaGFzT3duUHJvcGVydHkoZmluYWxpemVkKSkgewogICAgICAgICAgICBzdXBlckN0b3IuZmluYWxpemUoKTsKICAgICAgICB9CiAgICAgICAgdGhpc1tmaW5hbGl6ZWRdID0gdHJ1ZTsKICAgICAgICB0aGlzLl9lbnN1cmVDbGFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB0aGlzLl9hdHRyaWJ1dGVUb1Byb3BlcnR5TWFwID0gbmV3IE1hcCgpOwogICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KEpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkoInByb3BlcnRpZXMiLCB0aGlzKSkpIHsKICAgICAgICAgICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BlcnRpZXM7CiAgICAgICAgICAgIGNvbnN0IHByb3BLZXlzID0gWwogICAgICAgICAgICAgICAgLi4uT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocHJvcHMpLAogICAgICAgICAgICAgICAgLi4udHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHByb3BzKSA6IFtdCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBwcm9wS2V5cyl7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVByb3BlcnR5KHAsIHByb3BzW3BdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfYXR0cmlidXRlTmFtZUZvclByb3BlcnR5KG5hbWUsIG9wdGlvbnMpIHsKICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBvcHRpb25zLmF0dHJpYnV0ZTsKICAgICAgICByZXR1cm4gYXR0cmlidXRlID09PSBmYWxzZSA/IHZvaWQgMCA6IHR5cGVvZiBhdHRyaWJ1dGUgPT09ICJzdHJpbmciID8gYXR0cmlidXRlIDogdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciID8gbmFtZS50b0xvd2VyQ2FzZSgpIDogdm9pZCAwOwogICAgfQogICAgc3RhdGljIF92YWx1ZUhhc0NoYW5nZWQodmFsdWUsIG9sZCwgaGFzQ2hhbmdlZCA9IG5vdEVxdWFsKSB7CiAgICAgICAgcmV0dXJuIGhhc0NoYW5nZWQodmFsdWUsIG9sZCk7CiAgICB9CiAgICBzdGF0aWMgX3Byb3BlcnR5VmFsdWVGcm9tQXR0cmlidXRlKHZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgdHlwZTIgPSBvcHRpb25zLnR5cGU7CiAgICAgICAgY29uc3QgY29udmVydGVyID0gb3B0aW9ucy5jb252ZXJ0ZXIgfHwgZGVmYXVsdENvbnZlcnRlcjsKICAgICAgICBjb25zdCBmcm9tQXR0cmlidXRlID0gdHlwZW9mIGNvbnZlcnRlciA9PT0gImZ1bmN0aW9uIiA/IGNvbnZlcnRlciA6IGNvbnZlcnRlci5mcm9tQXR0cmlidXRlOwogICAgICAgIHJldHVybiBmcm9tQXR0cmlidXRlID8gZnJvbUF0dHJpYnV0ZSh2YWx1ZSwgdHlwZTIpIDogdmFsdWU7CiAgICB9CiAgICBzdGF0aWMgX3Byb3BlcnR5VmFsdWVUb0F0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zLnJlZmxlY3QgPT09IHZvaWQgMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHR5cGUyID0gb3B0aW9ucy50eXBlOwogICAgICAgIGNvbnN0IGNvbnZlcnRlciA9IG9wdGlvbnMuY29udmVydGVyOwogICAgICAgIGNvbnN0IHRvQXR0cmlidXRlID0gY29udmVydGVyICYmIGNvbnZlcnRlci50b0F0dHJpYnV0ZSB8fCBkZWZhdWx0Q29udmVydGVyLnRvQXR0cmlidXRlOwogICAgICAgIHJldHVybiB0b0F0dHJpYnV0ZSh2YWx1ZSwgdHlwZTIpOwogICAgfQogICAgaW5pdGlhbGl6ZSgpIHsKICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IDA7CiAgICAgICAgdGhpcy5fdXBkYXRlUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMpPT50aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyID0gcmVzCiAgICAgICAgKTsKICAgICAgICB0aGlzLl9jaGFuZ2VkUHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLl9zYXZlSW5zdGFuY2VQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5yZXF1ZXN0VXBkYXRlSW50ZXJuYWwoKTsKICAgIH0KICAgIF9zYXZlSW5zdGFuY2VQcm9wZXJ0aWVzKCkgewogICAgICAgIHRoaXMuY29uc3RydWN0b3IuX2NsYXNzUHJvcGVydGllcy5mb3JFYWNoKChfdiwgcCk9PnsKICAgICAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkocCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1twXTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzW3BdOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMuc2V0KHAsIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgX2FwcGx5SW5zdGFuY2VQcm9wZXJ0aWVzKCkgewogICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcy5mb3JFYWNoKCh2LCBwKT0+dGhpc1twXSA9IHYKICAgICAgICApOwogICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcyA9IHZvaWQgMDsKICAgIH0KICAgIGNvbm5lY3RlZENhbGxiYWNrKCkgewogICAgICAgIHRoaXMuZW5hYmxlVXBkYXRpbmcoKTsKICAgIH0KICAgIGVuYWJsZVVwZGF0aW5nKCkgewogICAgICAgIGlmICh0aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlVXBkYXRpbmdSZXNvbHZlcigpOwogICAgICAgICAgICB0aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyID0gdm9pZCAwOwogICAgICAgIH0KICAgIH0KICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkgewogICAgfQogICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKG5hbWUsIG9sZCwgdmFsdWUpIHsKICAgICAgICBpZiAob2xkICE9PSB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLl9hdHRyaWJ1dGVUb1Byb3BlcnR5KG5hbWUsIHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBfcHJvcGVydHlUb0F0dHJpYnV0ZShuYW1lLCB2YWx1ZSwgb3B0aW9ucyA9IGRlZmF1bHRQcm9wZXJ0eURlY2xhcmF0aW9uKSB7CiAgICAgICAgY29uc3QgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgY29uc3QgYXR0ciA9IGN0b3IuX2F0dHJpYnV0ZU5hbWVGb3JQcm9wZXJ0eShuYW1lLCBvcHRpb25zKTsKICAgICAgICBpZiAoYXR0ciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnN0IGF0dHJWYWx1ZSA9IGN0b3IuX3Byb3BlcnR5VmFsdWVUb0F0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChhdHRyVmFsdWUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURTsKICAgICAgICAgICAgaWYgKGF0dHJWYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShhdHRyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGF0dHIsIGF0dHJWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSAmIH5TVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURTsKICAgICAgICB9CiAgICB9CiAgICBfYXR0cmlidXRlVG9Qcm9wZXJ0eShuYW1lLCB2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fQVRUUklCVVRFKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgY29uc3QgcHJvcE5hbWUgPSBjdG9yLl9hdHRyaWJ1dGVUb1Byb3BlcnR5TWFwLmdldChuYW1lKTsKICAgICAgICBpZiAocHJvcE5hbWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBvcHRpb25zMyA9IGN0b3IuZ2V0UHJvcGVydHlPcHRpb25zKHByb3BOYW1lKTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSB8IFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFk7CiAgICAgICAgICAgIHRoaXNbcHJvcE5hbWVdID0gY3Rvci5fcHJvcGVydHlWYWx1ZUZyb21BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMzKTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSAmIH5TVEFURV9JU19SRUZMRUNUSU5HX1RPX1BST1BFUlRZOwogICAgICAgIH0KICAgIH0KICAgIHJlcXVlc3RVcGRhdGVJbnRlcm5hbChuYW1lLCBvbGRWYWx1ZSwgb3B0aW9ucykgewogICAgICAgIGxldCBzaG91bGRSZXF1ZXN0VXBkYXRlID0gdHJ1ZTsKICAgICAgICBpZiAobmFtZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnN0IGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yOwogICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBjdG9yLmdldFByb3BlcnR5T3B0aW9ucyhuYW1lKTsKICAgICAgICAgICAgaWYgKGN0b3IuX3ZhbHVlSGFzQ2hhbmdlZCh0aGlzW25hbWVdLCBvbGRWYWx1ZSwgb3B0aW9ucy5oYXNDaGFuZ2VkKSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9jaGFuZ2VkUHJvcGVydGllcy5oYXMobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VkUHJvcGVydGllcy5zZXQobmFtZSwgb2xkVmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVmbGVjdCA9PT0gdHJ1ZSAmJiAhKHRoaXMuX3VwZGF0ZVN0YXRlICYgU1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMuc2V0KG5hbWUsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2hvdWxkUmVxdWVzdFVwZGF0ZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5faGFzUmVxdWVzdGVkVXBkYXRlICYmIHNob3VsZFJlcXVlc3RVcGRhdGUpIHsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlUHJvbWlzZSA9IHRoaXMuX2VucXVldWVVcGRhdGUoKTsKICAgICAgICB9CiAgICB9CiAgICByZXF1ZXN0VXBkYXRlKG5hbWUsIG9sZFZhbHVlKSB7CiAgICAgICAgdGhpcy5yZXF1ZXN0VXBkYXRlSW50ZXJuYWwobmFtZSwgb2xkVmFsdWUpOwogICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUNvbXBsZXRlOwogICAgfQogICAgYXN5bmMgX2VucXVldWVVcGRhdGUoKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSB8IFNUQVRFX1VQREFURV9SRVFVRVNURUQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fdXBkYXRlUHJvbWlzZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlc3VsdDEgPSB0aGlzLnBlcmZvcm1VcGRhdGUoKTsKICAgICAgICBpZiAocmVzdWx0MSAhPSBudWxsKSB7CiAgICAgICAgICAgIGF3YWl0IHJlc3VsdDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAhdGhpcy5faGFzUmVxdWVzdGVkVXBkYXRlOwogICAgfQogICAgZ2V0IF9oYXNSZXF1ZXN0ZWRVcGRhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZVN0YXRlICYgU1RBVEVfVVBEQVRFX1JFUVVFU1RFRDsKICAgIH0KICAgIGdldCBoYXNVcGRhdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVTdGF0ZSAmIDE7CiAgICB9CiAgICBwZXJmb3JtVXBkYXRlKCkgewogICAgICAgIGlmICghdGhpcy5faGFzUmVxdWVzdGVkVXBkYXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlUHJvcGVydGllcykgewogICAgICAgICAgICB0aGlzLl9hcHBseUluc3RhbmNlUHJvcGVydGllcygpOwogICAgICAgIH0KICAgICAgICBsZXQgc2hvdWxkVXBkYXRlID0gZmFsc2U7CiAgICAgICAgY29uc3QgY2hhbmdlZFByb3BlcnRpZXMgPSB0aGlzLl9jaGFuZ2VkUHJvcGVydGllczsKICAgICAgICB0cnkgewogICAgICAgICAgICBzaG91bGRVcGRhdGUgPSB0aGlzLnNob3VsZFVwZGF0ZShjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgICAgIGlmIChzaG91bGRVcGRhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX21hcmtVcGRhdGVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9tYXJrVXBkYXRlZCgpOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7CiAgICAgICAgICAgIGlmICghKHRoaXMuX3VwZGF0ZVN0YXRlICYgMSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9IQVNfVVBEQVRFRDsKICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RVcGRhdGVkKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZWQoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgIH0KICAgIH0KICAgIF9tYXJrVXBkYXRlZCgpIHsKICAgICAgICB0aGlzLl9jaGFuZ2VkUHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlICYgflNUQVRFX1VQREFURV9SRVFVRVNURUQ7CiAgICB9CiAgICBnZXQgdXBkYXRlQ29tcGxldGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFVwZGF0ZUNvbXBsZXRlKCk7CiAgICB9CiAgICBfZ2V0VXBkYXRlQ29tcGxldGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXBkYXRlQ29tcGxldGUoKTsKICAgIH0KICAgIGdldFVwZGF0ZUNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVQcm9taXNlOwogICAgfQogICAgc2hvdWxkVXBkYXRlKF9jaGFuZ2VkUHJvcGVydGllcykgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdXBkYXRlKF9jaGFuZ2VkUHJvcGVydGllcykgewogICAgICAgIGlmICh0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyAhPT0gdm9pZCAwICYmIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzLnNpemUgPiAwKSB7CiAgICAgICAgICAgIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzLmZvckVhY2goKHYsIGspPT50aGlzLl9wcm9wZXJ0eVRvQXR0cmlidXRlKGssIHRoaXNba10sIHYpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzID0gdm9pZCAwOwogICAgICAgIH0KICAgICAgICB0aGlzLl9tYXJrVXBkYXRlZCgpOwogICAgfQogICAgdXBkYXRlZChfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgIH0KICAgIGZpcnN0VXBkYXRlZChfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgIH0KfQpfYSA9IGZpbmFsaXplZDsKVXBkYXRpbmdFbGVtZW50W19hXSA9IHRydWU7CmNvbnN0IGxlZ2FjeUN1c3RvbUVsZW1lbnQgPSAodGFnTmFtZSwgY2xhenopPT57CiAgICB3aW5kb3cuY3VzdG9tRWxlbWVudHMuZGVmaW5lKHRhZ05hbWUsIGNsYXp6KTsKICAgIHJldHVybiBjbGF6ejsKfTsKY29uc3Qgc3RhbmRhcmRDdXN0b21FbGVtZW50ID0gKHRhZ05hbWUsIGRlc2NyaXB0b3IpPT57CiAgICBjb25zdCB7IGtpbmQgLCBlbGVtZW50cyAgfSA9IGRlc2NyaXB0b3I7CiAgICByZXR1cm4gewogICAgICAgIGtpbmQsCiAgICAgICAgZWxlbWVudHMsCiAgICAgICAgZmluaXNoZXIgKGNsYXp6KSB7CiAgICAgICAgICAgIHdpbmRvdy5jdXN0b21FbGVtZW50cy5kZWZpbmUodGFnTmFtZSwgY2xhenopOwogICAgICAgIH0KICAgIH07Cn07CmNvbnN0IHN0YW5kYXJkUHJvcGVydHkgPSAob3B0aW9uczMsIGVsZW1lbnQ2KT0+ewogICAgaWYgKGVsZW1lbnQ2LmtpbmQgPT09ICJtZXRob2QiICYmIGVsZW1lbnQ2LmRlc2NyaXB0b3IgJiYgISgidmFsdWUiIGluIGVsZW1lbnQ2LmRlc2NyaXB0b3IpKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7CiAgICAgICAgfSwgZWxlbWVudDYpLCB7CiAgICAgICAgICAgIGZpbmlzaGVyIChjbGF6eikgewogICAgICAgICAgICAgICAgY2xhenouY3JlYXRlUHJvcGVydHkoZWxlbWVudDYua2V5LCBvcHRpb25zMyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAga2luZDogImZpZWxkIiwKICAgICAgICAgICAga2V5OiBTeW1ib2woKSwKICAgICAgICAgICAgcGxhY2VtZW50OiAib3duIiwKICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICB9LAogICAgICAgICAgICBpbml0aWFsaXplciAoKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQ2LmluaXRpYWxpemVyID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1tlbGVtZW50Ni5rZXldID0gZWxlbWVudDYuaW5pdGlhbGl6ZXIuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZmluaXNoZXIgKGNsYXp6KSB7CiAgICAgICAgICAgICAgICBjbGF6ei5jcmVhdGVQcm9wZXJ0eShlbGVtZW50Ni5rZXksIG9wdGlvbnMzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn07CmNvbnN0IGxlZ2FjeVByb3BlcnR5ID0gKG9wdGlvbnMzLCBwcm90bywgbmFtZTQpPT57CiAgICBwcm90by5jb25zdHJ1Y3Rvci5jcmVhdGVQcm9wZXJ0eShuYW1lNCwgb3B0aW9uczMpOwp9Owpjb25zdCBsZWdhY3lRdWVyeSA9IChkZXNjcmlwdG9yLCBwcm90bywgbmFtZTQpPT57CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG8sIG5hbWU0LCBkZXNjcmlwdG9yKTsKfTsKY29uc3Qgc3RhbmRhcmRFdmVudE9wdGlvbnMgPSAob3B0aW9uczMsIGVsZW1lbnQ2KT0+ewogICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7CiAgICB9LCBlbGVtZW50NiksIHsKICAgICAgICBmaW5pc2hlciAoY2xhenopIHsKICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjbGF6ei5wcm90b3R5cGVbZWxlbWVudDYua2V5XSwgb3B0aW9uczMpOwogICAgICAgIH0KICAgIH0pOwp9Owpjb25zdCBsZWdhY3lFdmVudE9wdGlvbnMgPSAob3B0aW9uczMsIHByb3RvLCBuYW1lNCk9PnsKICAgIE9iamVjdC5hc3NpZ24ocHJvdG9bbmFtZTRdLCBvcHRpb25zMyk7Cn07CmNvbnN0IHN1cHBvcnRzQWRvcHRpbmdTdHlsZVNoZWV0cyA9IHdpbmRvdy5TaGFkb3dSb290ICYmICh3aW5kb3cuU2hhZHlDU1MgPT09IHZvaWQgMCB8fCB3aW5kb3cuU2hhZHlDU1MubmF0aXZlU2hhZG93KSAmJiAiYWRvcHRlZFN0eWxlU2hlZXRzIiBpbiBEb2N1bWVudC5wcm90b3R5cGUgJiYgInJlcGxhY2UiIGluIENTU1N0eWxlU2hlZXQucHJvdG90eXBlOwpjb25zdCBjb25zdHJ1Y3Rpb25Ub2tlbiA9IFN5bWJvbCgpOwpjbGFzcyBDU1NSZXN1bHQgewogICAgY29uc3RydWN0b3IoY3NzVGV4dCwgc2FmZVRva2VuKXsKICAgICAgICBpZiAoc2FmZVRva2VuICE9PSBjb25zdHJ1Y3Rpb25Ub2tlbikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNTU1Jlc3VsdCBpcyBub3QgY29uc3RydWN0YWJsZS4gVXNlIGB1bnNhZmVDU1NgIG9yIGBjc3NgIGluc3RlYWQuIik7CiAgICAgICAgfQogICAgICAgIHRoaXMuY3NzVGV4dCA9IGNzc1RleHQ7CiAgICB9CiAgICBnZXQgc3R5bGVTaGVldCgpIHsKICAgICAgICBpZiAodGhpcy5fc3R5bGVTaGVldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c0Fkb3B0aW5nU3R5bGVTaGVldHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3N0eWxlU2hlZXQgPSBuZXcgQ1NTU3R5bGVTaGVldCgpOwogICAgICAgICAgICAgICAgdGhpcy5fc3R5bGVTaGVldC5yZXBsYWNlU3luYyh0aGlzLmNzc1RleHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fc3R5bGVTaGVldCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0eWxlU2hlZXQ7CiAgICB9CiAgICB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jc3NUZXh0OwogICAgfQp9CmNvbnN0IHVuc2FmZUNTUyA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiBuZXcgQ1NTUmVzdWx0KFN0cmluZyh2YWx1ZSksIGNvbnN0cnVjdGlvblRva2VuKTsKfTsKY29uc3QgdGV4dEZyb21DU1NSZXN1bHQgPSAodmFsdWUpPT57CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBDU1NSZXN1bHQpIHsKICAgICAgICByZXR1cm4gdmFsdWUuY3NzVGV4dDsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAibnVtYmVyIikgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBWYWx1ZSBwYXNzZWQgdG8gJ2NzcycgZnVuY3Rpb24gbXVzdCBiZSBhICdjc3MnIGZ1bmN0aW9uIHJlc3VsdDogJHt2YWx1ZX0uIFVzZSAndW5zYWZlQ1NTJyB0byBwYXNzIG5vbi1saXRlcmFsIHZhbHVlcywgYnV0CiAgICAgICAgICAgIHRha2UgY2FyZSB0byBlbnN1cmUgcGFnZSBzZWN1cml0eS5gKTsKICAgIH0KfTsKY29uc3QgY3NzID0gKHN0cmluZ3M2LCAuLi52YWx1ZXMxKT0+ewogICAgY29uc3QgY3NzVGV4dDEgPSB2YWx1ZXMxLnJlZHVjZSgoYWNjLCB2LCBpZHgpPT5hY2MgKyB0ZXh0RnJvbUNTU1Jlc3VsdCh2KSArIHN0cmluZ3M2W2lkeCArIDFdCiAgICAsIHN0cmluZ3M2WzBdKTsKICAgIHJldHVybiBuZXcgQ1NTUmVzdWx0KGNzc1RleHQxLCBjb25zdHJ1Y3Rpb25Ub2tlbik7Cn07Cih3aW5kb3dbImxpdEVsZW1lbnRWZXJzaW9ucyJdIHx8ICh3aW5kb3dbImxpdEVsZW1lbnRWZXJzaW9ucyJdID0gW10pKS5wdXNoKCIyLjUuMSIpOwpjb25zdCByZW5kZXJOb3RJbXBsZW1lbnRlZCA9IHsKfTsKY2xhc3MgTGl0RWxlbWVudCBleHRlbmRzIFVwZGF0aW5nRWxlbWVudCB7CiAgICBzdGF0aWMgZ2V0U3R5bGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLnN0eWxlczsKICAgIH0KICAgIHN0YXRpYyBfZ2V0VW5pcXVlU3R5bGVzKCkgewogICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KEpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkoIl9zdHlsZXMiLCB0aGlzKSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB1c2VyU3R5bGVzID0gdGhpcy5nZXRTdHlsZXMoKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VyU3R5bGVzKSkgewogICAgICAgICAgICBjb25zdCBhZGRTdHlsZXMgPSAoc3R5bGVzMiwgc2V0Mik9PnN0eWxlczIucmVkdWNlUmlnaHQoKHNldDMsIHMpPT5BcnJheS5pc0FycmF5KHMpID8gYWRkU3R5bGVzKHMsIHNldDMpIDogKHNldDMuYWRkKHMpLCBzZXQzKQogICAgICAgICAgICAgICAgLCBzZXQyKQogICAgICAgICAgICA7CiAgICAgICAgICAgIGNvbnN0IHNldCA9IGFkZFN0eWxlcyh1c2VyU3R5bGVzLCBuZXcgU2V0KCkpOwogICAgICAgICAgICBjb25zdCBzdHlsZXMgPSBbXTsKICAgICAgICAgICAgc2V0LmZvckVhY2goKHYpPT5zdHlsZXMudW5zaGlmdCh2KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLl9zdHlsZXMgPSBzdHlsZXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fc3R5bGVzID0gdXNlclN0eWxlcyA9PT0gdm9pZCAwID8gW10gOiBbCiAgICAgICAgICAgICAgICB1c2VyU3R5bGVzCiAgICAgICAgICAgIF07CiAgICAgICAgfQogICAgICAgIHRoaXMuX3N0eWxlcyA9IHRoaXMuX3N0eWxlcy5tYXAoKHMpPT57CiAgICAgICAgICAgIGlmIChzIGluc3RhbmNlb2YgQ1NTU3R5bGVTaGVldCAmJiAhc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjc3NUZXh0MSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHMuY3NzUnVsZXMpLnJlZHVjZSgoY3NzMiwgcnVsZSk9PmNzczIgKyBydWxlLmNzc1RleHQKICAgICAgICAgICAgICAgICwgIiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHVuc2FmZUNTUyhjc3NUZXh0MSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfSk7CiAgICB9CiAgICBpbml0aWFsaXplKCkgewogICAgICAgIHN1cGVyLmluaXRpYWxpemUoKTsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLl9nZXRVbmlxdWVTdHlsZXMoKTsKICAgICAgICB0aGlzLnJlbmRlclJvb3QgPSB0aGlzLmNyZWF0ZVJlbmRlclJvb3QoKTsKICAgICAgICBpZiAod2luZG93LlNoYWRvd1Jvb3QgJiYgdGhpcy5yZW5kZXJSb290IGluc3RhbmNlb2Ygd2luZG93LlNoYWRvd1Jvb3QpIHsKICAgICAgICAgICAgdGhpcy5hZG9wdFN0eWxlcygpOwogICAgICAgIH0KICAgIH0KICAgIGNyZWF0ZVJlbmRlclJvb3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYXR0YWNoU2hhZG93KHRoaXMuY29uc3RydWN0b3Iuc2hhZG93Um9vdE9wdGlvbnMpOwogICAgfQogICAgYWRvcHRTdHlsZXMoKSB7CiAgICAgICAgY29uc3Qgc3R5bGVzID0gdGhpcy5jb25zdHJ1Y3Rvci5fc3R5bGVzOwogICAgICAgIGlmIChzdHlsZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHdpbmRvdy5TaGFkeUNTUyAhPT0gdm9pZCAwICYmICF3aW5kb3cuU2hhZHlDU1MubmF0aXZlU2hhZG93KSB7CiAgICAgICAgICAgIHdpbmRvdy5TaGFkeUNTUy5TY29waW5nU2hpbS5wcmVwYXJlQWRvcHRlZENzc1RleHQoc3R5bGVzLm1hcCgocyk9PnMuY3NzVGV4dAogICAgICAgICAgICApLCB0aGlzLmxvY2FsTmFtZSk7CiAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0c0Fkb3B0aW5nU3R5bGVTaGVldHMpIHsKICAgICAgICAgICAgdGhpcy5yZW5kZXJSb290LmFkb3B0ZWRTdHlsZVNoZWV0cyA9IHN0eWxlcy5tYXAoKHMpPT5zIGluc3RhbmNlb2YgQ1NTU3R5bGVTaGVldCA/IHMgOiBzLnN0eWxlU2hlZXQKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMgPSB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIGNvbm5lY3RlZENhbGxiYWNrKCkgewogICAgICAgIHN1cGVyLmNvbm5lY3RlZENhbGxiYWNrKCk7CiAgICAgICAgaWYgKHRoaXMuaGFzVXBkYXRlZCAmJiB3aW5kb3cuU2hhZHlDU1MgIT09IHZvaWQgMCkgewogICAgICAgICAgICB3aW5kb3cuU2hhZHlDU1Muc3R5bGVFbGVtZW50KHRoaXMpOwogICAgICAgIH0KICAgIH0KICAgIHVwZGF0ZShjaGFuZ2VkUHJvcGVydGllcykgewogICAgICAgIGNvbnN0IHRlbXBsYXRlUmVzdWx0ID0gdGhpcy5yZW5kZXIoKTsKICAgICAgICBzdXBlci51cGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgIGlmICh0ZW1wbGF0ZVJlc3VsdCAhPT0gcmVuZGVyTm90SW1wbGVtZW50ZWQpIHsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5yZW5kZXIodGVtcGxhdGVSZXN1bHQsIHRoaXMucmVuZGVyUm9vdCwgewogICAgICAgICAgICAgICAgc2NvcGVOYW1lOiB0aGlzLmxvY2FsTmFtZSwKICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dDogdGhpcwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX25lZWRzU2hpbUFkb3B0ZWRTdHlsZVNoZWV0cykgewogICAgICAgICAgICB0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5fc3R5bGVzLmZvckVhY2goKHMpPT57CiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICAgICAgICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9IHMuY3NzVGV4dDsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUm9vdC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIHJlbmRlcigpIHsKICAgICAgICByZXR1cm4gcmVuZGVyTm90SW1wbGVtZW50ZWQ7CiAgICB9Cn0KTGl0RWxlbWVudFsiZmluYWxpemVkIl0gPSB0cnVlOwpMaXRFbGVtZW50LnJlbmRlciA9IHJlbmRlcjsKTGl0RWxlbWVudC5zaGFkb3dSb290T3B0aW9ucyA9IHsKICAgIG1vZGU6ICJvcGVuIgp9OwpjbGFzcyBNYXRlcmlhbCB7CiAgICBzdGF0aWMgaGlnaEVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44NyknOwogICAgc3RhdGljIG1lZGl1bUVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC42MCknOwp9CmNvbnN0IE1BVEVSSUFMX0NTUyA9IGNzc2AKCjpyb290IHsKICAtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcjogcmdiKDMwLjc1LCAzMC43NSwgMzAuNzUpOwogIC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNDAuOTUsIDQwLjk1LCA0MC45NSk7CiAgLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44Nyk7CiAgLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYwKTsKICAtLWRpc2FibGVkLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zOCk7CiAgLS1idXR0b24tYm9yZGVyLXJhZGl1czogMC4yNXJlbTsKfQoKLyoqIHRleHQgc2l6ZSBjbGFzc2VzICovCgouaDYgewogICAgZm9udC1zaXplOiAxLjI1cmVtOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDA3NTByZW07CiAgICBmb250LXdlaWdodDogYm9sZGVyOwp9CgouYm9keTIsIGZpZWxkc2V0IGxhYmVsLCBmaWVsZHNldCBvdXRwdXQgewogICAgZm9udC1zaXplOiAwLjg3NXJlbTsKICAgIGxldHRlci1zcGFjaW5nOiAwLjAxNzg2cmVtOwogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKfQoKLmJ1dHRvbiwgYnV0dG9uLCAuYWN0aW9uLWljb24gewogICAgZm9udC1zaXplOiAwLjg3NXJlbTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMC4wODkyOXJlbTsKICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7Cn0KCi5vdmVybGluZSB7CiAgICBmb250LXNpemU6IDAuNjI1cmVtOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAwLjE1MDAwcmVtOwogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKfQoKLyogbGlnaHQgdGV4dCBvbiBkYXJrIGJhY2tncm91bmQgY29sb3JzICovCgouaGlnaC1lbXBoYXNpcy10ZXh0IHsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgoubWVkaXVtLWVtcGhhc2lzLXRleHQsIGZpZWxkc2V0IGxhYmVsIHsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCi5kaXNhYmxlZC1lbXBoYXNpcy10ZXh0IHsKICAgIGNvbG9yOiB2YXIoLS1kaXNhYmxlZC10ZXh0LWNvbG9yKTsKfQoKLyoqIGVsZXZhdGlvbiBiYWNrZ3JvdW5kcyAqLwoKLnN1cmZhY2UtMDEgewogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wMS1iYWNrZ3JvdW5kLWNvbG9yKTsKfQoKLnN1cmZhY2UtMDQgewogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKfQoKLyoqIGFjdGlvbi1pY29uICovCgouYWN0aW9uLWljb24gewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIG1pbi1oZWlnaHQ6IDJyZW07CiAgICBtaW4td2lkdGg6IDJyZW07CiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1idXR0b24tYm9yZGVyLXJhZGl1cyk7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIG9wYWNpdHk6IDAuNjk7ICAvKiogbWVkaXVtLWVtcGhhc2lzIC8gaGlnaC1lbXBoYXNpcyAqLwogICAgdXNlci1zZWxlY3Q6IG5vbmU7Cn0KCi5hY3Rpb24taWNvbjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTA0LWJhY2tncm91bmQtY29sb3IpOwogICAgb3BhY2l0eTogMTsKfQoKLyoqIGJ1dHRvbiAqLwoKYnV0dG9uIHsKICAgIGJvcmRlcjogbm9uZTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgcGFkZGluZzogMC41cmVtIDFyZW07CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgIG1pbi13aWR0aDogOHJlbTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKfQoKYnV0dG9uLnNlbGVjdGVkIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKYnV0dG9uOmhvdmVyIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKYnV0dG9uOmRpc2FibGVkIHsKICAgIGNvbG9yOiB2YXIoLS1kaXNhYmxlZC10ZXh0LWNvbG9yKTsKfQoKYnV0dG9uOmRpc2FibGVkOmhvdmVyIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjdXJzb3I6IGRlZmF1bHQ7Cn0KCi8qKiBmb3JtcyAqLwpmaWVsZHNldCB7CiAgICBib3JkZXI6IHNvbGlkIDFweCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNjApOwogICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYnV0dG9uLWJvcmRlci1yYWRpdXMpOwogICAgZGlzcGxheTogZ3JpZDsKICAgIGdyaWQtcm93LWdhcDogMXJlbTsKICAgIGdyaWQtY29sdW1uLWdhcDogMXJlbTsKICAgIHBhZGRpbmc6IDFyZW07Cn0KCmxhYmVsIHsKICAgIGdyaWQtY29sdW1uOiAxOwogICAgLyogYmFja2dyb3VuZC1jb2xvcjogcmVkOyAqLwogICAgcGFkZGluZzogMC41cmVtIDA7Cn0KCi5mb3JtLWxocyB7CiAgICBncmlkLWNvbHVtbjogMTsKfQoKaW5wdXQsIC5mb3JtLXJocyB7CiAgICBncmlkLWNvbHVtbjogMjsKfQoKLmZvcm0tcm93IHsKICAgIGdyaWQtY29sdW1uOiAxIC8gc3BhbiAyOwp9CgpmaWVsZHNldCBpbnB1dFt0eXBlPXRleHRdIHsKICAgIHBhZGRpbmc6IDAuNXJlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGJvcmRlcjogc29saWQgMXB4IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKfQoKZmllbGRzZXQgb3V0cHV0IHsKICAgIHBhZGRpbmc6IDAuNXJlbSAwOwogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKYDsKY29uc3QgU0lERUJBUl9IVE1MID0gaHRtbGAKPGRpdiBpZD0ic2lkZWJhciI+CjwvZGl2PgpgOwpjb25zdCBTSURFQkFSX0NTUyA9IGNzc2AKCiNzaWRlYmFyIHsKICAgIG1hcmdpbi1sZWZ0OiAxcmVtOwp9Cgojc2lkZWJhciAuYnV0dG9uLWdyaWQgewogICAgZGlzcGxheTogZ3JpZDsKICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDJyZW07CiAgICBncmlkLWdhcDogMXB4OwogICAgbWFyZ2luLWxlZnQ6IDFweDsKICAgIG1hcmdpbi10b3A6IDFyZW07Cn0KCiNzaWRlYmFyIC5idXR0b24tZ3JpZC1uZXcgewogICAgZ3JpZC1jb2x1bW46IDE7CiAgICBtaW4td2lkdGg6IDhyZW07Cn0KCiNzaWRlYmFyIGJ1dHRvbiB7CiAgICBncmlkLWNvbHVtbjogMTsKfQoKYDsKZnVuY3Rpb24gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtKSB7CiAgICBjb25zdCBzaWRlYmFyRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZGViYXInKTsKICAgIHJldHVybiAoKT0+TGl0RWxlbWVudC5yZW5kZXIodGVtcGxhdGUyKHZtKSwgc2lkZWJhckRpdikKICAgIDsKfQpjb25zdCB0ZW1wbGF0ZTIgPSAodm0pPT5odG1sYAogICAgPGRpdiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPlByb2ZpbGVzPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJidXR0b24tZ3JpZCI+CiAgICAke3ZtLnByb2ZpbGVzLm1hcCgocHJvZmlsZSk9Pmh0bWxgPGJ1dHRvbiBjbGFzcz0iJHtwcm9maWxlLmlkID09PSB2bS5zZWxlY3RlZFByb2ZpbGVJZCA/ICdzZWxlY3RlZCcgOiAnJ30iIEBjbGljaz0keygpPT57CiAgICAgICAgICAgIHZtLnNlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZS5pZDsKICAgICAgICB9fT4ke3Byb2ZpbGUudGV4dH08L2J1dHRvbj4KICAgICR7cHJvZmlsZS5pZCA9PT0gdm0uc2VsZWN0ZWRQcm9maWxlSWQgPyBodG1sYCR7YWN0aW9uSWNvbihlZGl0SWNvbiwgewogICAgICAgICAgICBvbmNsaWNrOiAoKT0+dm0uZWRpdFByb2ZpbGUocHJvZmlsZS5pZCkKICAgICAgICB9KX1gIDogJyd9YAogICAgKX0KICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncmlkLW5ldyI+JHthY3Rpb25JY29uKGFkZEljb24sIHsKICAgICAgICB0ZXh0OiAnTmV3JywKICAgICAgICBvbmNsaWNrOiAoKT0+dm0ubmV3UHJvZmlsZSgpCiAgICB9KX08L2Rpdj4KICAgIDwvZGl2PgpgCjsKZnVuY3Rpb24gYWN0aW9uSWNvbihpY29uLCBvcHRzID0gewp9KSB7CiAgICBjb25zdCB7IHRleHQgLCBvbmNsaWNrICB9ID0gb3B0czsKICAgIHJldHVybiBodG1sYDxkaXYgY2xhc3M9ImFjdGlvbi1pY29uIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgb25jbGljayAmJiBvbmNsaWNrKCk7CiAgICB9fT4ke2ljb259JHt0ZXh0IHx8ICcnfTwvZGl2PmA7Cn0KY29uc3QgZWRpdEljb24gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xNC4wNiA5LjAybC45Mi45Mkw1LjkyIDE5SDV2LS45Mmw5LjA2LTkuMDZNMTcuNjYgM2MtLjI1IDAtLjUxLjEtLjcuMjlsLTEuODMgMS44MyAzLjc1IDMuNzUgMS44My0xLjgzYy4zOS0uMzkuMzktMS4wMiAwLTEuNDFsLTIuMzQtMi4zNGMtLjItLjItLjQ1LS4yOS0uNzEtLjI5em0tMy42IDMuMTlMMyAxNy4yNVYyMWgzLjc1TDE3LjgxIDkuOTRsLTMuNzUtMy43NXoiLz48L3N2Zz5gOwpjb25zdCBhZGRJY29uID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij4+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE5IDEzaC02djZoLTJ2LTZINXYtMmg2VjVoMnY2aDZ2MnoiLz48L3N2Zz5gOwpmdW5jdGlvbiBnZW5lcmF0ZVV1aWQoKSB7CiAgICBjb25zdCBjcnlwdG9Bc0FueSA9IGNyeXB0bzsKICAgIGlmICh0eXBlb2YgY3J5cHRvQXNBbnkucmFuZG9tVVVJRCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBjcnlwdG9Bc0FueS5yYW5kb21VVUlEKCk7CiAgICB9CiAgICBjb25zdCBybmRzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxNikpOwogICAgcm5kc1s2XSA9IHJuZHNbNl0gJiAxNSB8IDY0OwogICAgcm5kc1s4XSA9IHJuZHNbOF0gJiA2MyB8IDEyODsKICAgIHJldHVybiBieXRlc1RvVXVpZChybmRzKTsKfQpmdW5jdGlvbiBieXRlc1RvVXVpZChieXRlcykgewogICAgY29uc3QgYml0cyA9IFsKICAgICAgICAuLi5ieXRlcwogICAgXS5tYXAoKGJpdCk9PnsKICAgICAgICBjb25zdCBzID0gYml0LnRvU3RyaW5nKDE2KTsKICAgICAgICByZXR1cm4gYml0IDwgMTYgPyAiMCIgKyBzIDogczsKICAgIH0pOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5iaXRzLnNsaWNlKDAsIDQpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDQsIDYpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDYsIDgpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDgsIDEwKSwKICAgICAgICAiLSIsCiAgICAgICAgLi4uYml0cy5zbGljZSgxMCwgMTYpLCAKICAgIF0uam9pbigiIik7Cn0KY2xhc3MgVGFpbHdlYkFwcFZNIHsKICAgIHByb2ZpbGVzID0gW107CiAgICBnZXQgc2VsZWN0ZWRQcm9maWxlSWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkOwogICAgfQogICAgc2V0IHNlbGVjdGVkUHJvZmlsZUlkKHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkID09PSB2YWx1ZSkgcmV0dXJuOwogICAgICAgIHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkID0gdmFsdWU7CiAgICAgICAgdGhpcy5vbmNoYW5nZSgpOwogICAgfQogICAgcHJvZmlsZUZvcm0gPSBuZXcgUHJvZmlsZUZvcm1WTSgpOwogICAgbWVzc2FnZSA9ICcnOwogICAgc3RhdGUgPSBsb2FkU3RhdGUoKTsKICAgIF9zZWxlY3RlZFByb2ZpbGVJZDsKICAgIG9uY2hhbmdlID0gKCk9PnsKICAgIH07CiAgICBjb25zdHJ1Y3RvcigpewogICAgfQogICAgc3RhcnQoKSB7CiAgICAgICAgdGhpcy5yZWxvYWRQcm9maWxlcygpOwogICAgICAgIGlmICh0aGlzLnByb2ZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQgPSB0aGlzLnByb2ZpbGVzWzBdLmlkOwogICAgICAgIH0KICAgICAgICB0aGlzLm9uY2hhbmdlKCk7CiAgICB9CiAgICBuZXdQcm9maWxlKCkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ucHJvZmlsZUlkID0gZ2VuZXJhdGVVdWlkKCk7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnRpdGxlID0gJ05ldyBQcm9maWxlJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSB0aGlzLnByb2ZpbGVzLmxlbmd0aCA9PT0gMCA/ICdkZWZhdWx0JyA6IGBwcm9maWxlJHt0aGlzLnByb2ZpbGVzLmxlbmd0aCArIDF9YDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSAnJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbmNoYW5nZSgpOwogICAgfQogICAgZWRpdFByb2ZpbGUocHJvZmlsZUlkKSB7CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBpZiAoIXByb2ZpbGUpIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSAke3Byb2ZpbGVJZH0gbm90IGZvdW5kYCk7CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQgPSBwcm9maWxlSWQ7CiAgICAgICAgY29uc3QgeyBuYW1lOiBuYW1lNCAsIGFjY291bnRJZCAsIGFwaVRva2VuICB9ID0gcHJvZmlsZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnByb2ZpbGVJZCA9IHByb2ZpbGVJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0udGl0bGUgPSAnRWRpdCBQcm9maWxlJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSBuYW1lNDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9IGFjY291bnRJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFwaVRva2VuID0gYXBpVG9rZW47CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5kZWxldGVWaXNpYmxlID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbmNoYW5nZSgpOwogICAgfQogICAgZGVsZXRlUHJvZmlsZShwcm9maWxlSWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnZGVsZXRlIHByb2ZpbGUnLCBwcm9maWxlSWQpOwogICAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnN0YXRlLnByb2ZpbGVzW3Byb2ZpbGVJZF07CiAgICAgICAgaWYgKCFwcm9maWxlKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgJHtwcm9maWxlSWR9IG5vdCBmb3VuZGApOwogICAgICAgIGRlbGV0ZSB0aGlzLnN0YXRlLnByb2ZpbGVzW3Byb2ZpbGVJZF07CiAgICAgICAgc2F2ZVN0YXRlKHRoaXMuc3RhdGUpOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMucmVsb2FkUHJvZmlsZXMoKTsKICAgICAgICB0aGlzLm9uY2hhbmdlKCk7CiAgICB9CiAgICBjYW5jZWxQcm9maWxlKCkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMub25jaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVOYW1lKG5hbWUpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbmNoYW5nZSgpOwogICAgfQogICAgc2V0UHJvZmlsZUFjY291bnRJZChhY2NvdW50SWQpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9IGFjY291bnRJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25jaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVBcGlUb2tlbihhcGlUb2tlbikgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSBhcGlUb2tlbjsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25jaGFuZ2UoKTsKICAgIH0KICAgIHNhdmVQcm9maWxlKCkgewogICAgICAgIGNvbnN0IHsgcHJvZmlsZUZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHsgcHJvZmlsZUlkICB9ID0gcHJvZmlsZUZvcm07CiAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHsKICAgICAgICAgICAgbmFtZTogcHJvZmlsZUZvcm0ubmFtZS50cmltKCksCiAgICAgICAgICAgIGFjY291bnRJZDogcHJvZmlsZUZvcm0uYWNjb3VudElkLnRyaW0oKSwKICAgICAgICAgICAgYXBpVG9rZW46IHByb2ZpbGVGb3JtLmFwaVRva2VuLnRyaW0oKQogICAgICAgIH07CiAgICAgICAgdGhpcy50cnlTYXZlUHJvZmlsZShwcm9maWxlSWQsIG5ld1Byb2ZpbGUpOwogICAgfQogICAgYXN5bmMgdHJ5U2F2ZVByb2ZpbGUocHJvZmlsZUlkLCBwcm9maWxlKSB7CiAgICAgICAgY29uc3QgeyBwcm9maWxlRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgcHJvZmlsZUZvcm0uZW5hYmxlZCA9IGZhbHNlOwogICAgICAgIHByb2ZpbGVGb3JtLnByb2dyZXNzVmlzaWJsZSA9IHRydWU7CiAgICAgICAgcHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9ICdDaGVja2luZyBwcm9maWxlLi4uJzsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBjYW5MaXN0VGFpbHMgPSBhd2FpdCBjb21wdXRlQ2FuTGlzdFRhaWxzKHByb2ZpbGUuYWNjb3VudElkLCBwcm9maWxlLmFwaVRva2VuKTsKICAgICAgICAgICAgaWYgKGNhbkxpc3RUYWlscykgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdID0gcHJvZmlsZTsKICAgICAgICAgICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkUHJvZmlsZXMoKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSBgVGhlc2UgY3JlZGVudGlhbHMgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byB0YWlsYDsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9IGBFcnJvcjogJHtlLm1lc3NhZ2V9YDsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIHByb2ZpbGVGb3JtLnByb2dyZXNzVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICBwcm9maWxlRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5vbmNoYW5nZSgpOwogICAgICAgIH0KICAgIH0KICAgIHJlbG9hZFByb2ZpbGVzKCkgewogICAgICAgIGNvbnN0IHsgc3RhdGUgIH0gPSB0aGlzOwogICAgICAgIHRoaXMucHJvZmlsZXMuc3BsaWNlKDApOwogICAgICAgIGZvciAoY29uc3QgW3Byb2ZpbGVJZCwgcHJvZmlsZV0gb2YgT2JqZWN0LmVudHJpZXMoc3RhdGUucHJvZmlsZXMpKXsKICAgICAgICAgICAgY29uc3QgbmFtZTQgPSBwcm9maWxlLm5hbWUgfHwgJyh1bm5hbWVkKSc7CiAgICAgICAgICAgIHRoaXMucHJvZmlsZXMucHVzaCh7CiAgICAgICAgICAgICAgICBpZDogcHJvZmlsZUlkLAogICAgICAgICAgICAgICAgdGV4dDogbmFtZTQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIFByb2ZpbGVGb3JtVk0gewogICAgc2hvd2luZyA9IGZhbHNlOwogICAgZW5hYmxlZCA9IGZhbHNlOwogICAgbmFtZSA9ICcnOwogICAgYWNjb3VudElkID0gJyc7CiAgICBhcGlUb2tlbiA9ICcnOwogICAgZGVsZXRlVmlzaWJsZSA9IGZhbHNlOwogICAgc2F2ZUVuYWJsZWQgPSBmYWxzZTsKICAgIHByb2ZpbGVJZCA9ICcnOwogICAgdGl0bGUgPSAnJzsKICAgIHByb2dyZXNzVmlzaWJsZSA9IGZhbHNlOwogICAgb3V0cHV0TWVzc2FnZSA9ICcnOwogICAgY29tcHV0ZVNhdmVFbmFibGVkKCkgewogICAgICAgIHRoaXMuc2F2ZUVuYWJsZWQgPSB0aGlzLm5hbWUudHJpbSgpLmxlbmd0aCA+IDAgJiYgdGhpcy5hcGlUb2tlbi50cmltKCkubGVuZ3RoID4gMCAmJiB0aGlzLmFjY291bnRJZC50cmltKCkubGVuZ3RoID4gMDsKICAgIH0KfQpjb25zdCBTVEFURV9LRVkgPSAnc3RhdGUxJzsKZnVuY3Rpb24gbG9hZFN0YXRlKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBqc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RBVEVfS0VZKSB8fCB1bmRlZmluZWQ7CiAgICAgICAgaWYgKGpzb24pIHsKICAgICAgICAgICAgY29uc3QgcnQgPSBKU09OLnBhcnNlKGpzb24pOwogICAgICAgICAgICByZXR1cm4gcGFyc2VTdGF0ZShydCk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignbG9hZFN0YXRlOiBFcnJvciBsb2FkaW5nIHN0YXRlJywgZSk7CiAgICB9CiAgICBjb25zb2xlLmxvZygnbG9hZFN0YXRlOiByZXR1cm5pbmcgbmV3IHN0YXRlJyk7CiAgICByZXR1cm4gewogICAgICAgIHByb2ZpbGVzOiB7CiAgICAgICAgfQogICAgfTsKfQpmdW5jdGlvbiBwYXJzZVN0YXRlKHBhcnNlZCkgewogICAgaWYgKHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIG9iamVjdGApOwogICAgY29uc3QgeyBwcm9maWxlcyAgfSA9IHBhcnNlZDsKICAgIGlmICh0eXBlb2YgcHJvZmlsZXMgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIHByb2ZpbGVzIG9iamVjdGApOwogICAgZm9yIChjb25zdCBbcHJvZmlsZUlkLCBwcm9maWxlU3RhdGVdIG9mIE9iamVjdC5lbnRyaWVzKHByb2ZpbGVzKSl7CiAgICAgICAgaWYgKHR5cGVvZiBwcm9maWxlSWQgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgRXJyb3IoJ1Byb2ZpbGUgaWQgbXVzdCBiZSBzdHJpbmcnKTsKICAgICAgICBwYXJzZVByb2ZpbGVTdGF0ZShwcm9maWxlU3RhdGUpOwogICAgfQogICAgcmV0dXJuIHBhcnNlZDsKfQpmdW5jdGlvbiBwYXJzZVByb2ZpbGVTdGF0ZShwYXJzZWQpIHsKICAgIGlmICh0eXBlb2YgcGFyc2VkICE9PSAnb2JqZWN0JyB8fCBwYXJzZWQgPT09IG51bGwpIHRocm93IG5ldyBFcnJvcignUHJvZmlsZSBzdGF0ZSBtdXN0IGJlIG9iamVjdCcpOwogICAgY29uc3QgeyBuYW1lOiBuYW1lNCAsIGFjY291bnRJZCAsIGFwaVRva2VuICB9ID0gcGFyc2VkOwogICAgaWYgKHR5cGVvZiBuYW1lNCAhPT0gJ3N0cmluZycgfHwgbmFtZTQudHJpbSgpLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlIHN0YXRlIG5hbWUgbXVzdCBleGlzdGApOwogICAgaWYgKHR5cGVvZiBhY2NvdW50SWQgIT09ICdzdHJpbmcnIHx8IGFjY291bnRJZC50cmltKCkubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgc3RhdGUgYWNjb3VudElkIG11c3QgZXhpc3RgKTsKICAgIGlmICh0eXBlb2YgYXBpVG9rZW4gIT09ICdzdHJpbmcnIHx8IGFwaVRva2VuLnRyaW0oKS5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSBzdGF0ZSBhcGlUb2tlbiBtdXN0IGV4aXN0YCk7CiAgICByZXR1cm4gcGFyc2VkOwp9CmZ1bmN0aW9uIHNhdmVTdGF0ZShzdGF0ZSkgewogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RBVEVfS0VZLCBKU09OLnN0cmluZ2lmeShzdGF0ZSkpOwp9CmFzeW5jIGZ1bmN0aW9uIGNvbXB1dGVDYW5MaXN0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbikgewogICAgdHJ5IHsKICAgICAgICBhd2FpdCBsaXN0VGFpbHMoYWNjb3VudElkLCAnJywgYXBpVG9rZW4pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChlIGluc3RhbmNlb2YgQ2xvdWRmbGFyZUFwaUVycm9yICYmIGUuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmNvbnN0IFBST0ZJTEVfRURJVE9SX0hUTUwgPSBodG1sYAo8Zm9ybSBpZD0icHJvZmlsZS1mb3JtIiBhdXRvY29tcGxldGU9Im9mZiI+CjxmaWVsZHNldCBpZD0icHJvZmlsZS1maWVsZHNldCI+CiAgPGRpdiBpZD0icHJvZmlsZS1mb3JtLXRpdGxlIiBjbGFzcz0iaDYgaGlnaC1lbXBoYXNpcy10ZXh0Ij5Qcm9maWxlPC9kaXY+CgogIDxsYWJlbCBmb3I9InByb2ZpbGUtbmFtZSI+UHJvZmlsZSBuYW1lOjwvbGFiZWw+CiAgPGlucHV0IGlkPSJwcm9maWxlLW5hbWUiIHR5cGU9InRleHQiPgoKICA8bGFiZWwgZm9yPSJhY2NvdW50LWlkIj5DbG91ZGZsYXJlIEFjY291bnQgSUQ6PC9sYWJlbD4KICA8aW5wdXQgaWQ9InByb2ZpbGUtYWNjb3VudC1pZCIgdHlwZT0idGV4dCI+CgogIDxsYWJlbCBmb3I9ImFwaS10b2tlbiI+Q2xvdWRmbGFyZSBBUEkgVG9rZW46PC9sYWJlbD4KICA8aW5wdXQgaWQ9InByb2ZpbGUtYXBpLXRva2VuIiB0eXBlPSJ0ZXh0Ij4KCiAgPGRpdiBpZD0icHJvZmlsZS1mb3JtLW91dHB1dC1yb3ciIGNsYXNzPSJmb3JtLXJvdyI+CiAgICA8b3V0cHV0IGlkPSJwcm9maWxlLWZvcm0tb3V0cHV0Ij48L291dHB1dD4KICAgIDxwcm9ncmVzcyBpZD0icHJvZmlsZS1mb3JtLXByb2dyZXNzIiBjbGFzcz0icHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciI+PC9wcm9ncmVzcz4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iZm9ybS1saHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1kZWxldGUiPkRlbGV0ZTwvYnV0dG9uPgogIDwvZGl2PgogIDxkaXYgaWQ9InByb2ZpbGUtZm9ybS1idXR0b25zIiBjbGFzcz0iZm9ybS1yaHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1jYW5jZWwiPkNhbmNlbDwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1zYXZlIj5TYXZlPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgUFJPRklMRV9FRElUT1JfQ1NTID0gY3NzYAogICAgI3Byb2ZpbGUtZm9ybS1idXR0b25zIHsKICAgICAgICBqdXN0aWZ5LXNlbGY6IGVuZDsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGdhcDogMXJlbTsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLW91dHB1dC1yb3cgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgbWluLWhlaWdodDogMi41cmVtOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tb3V0cHV0LXJvdyBvdXRwdXQgewogICAgICAgIGZsZXgtZ3JvdzogMTsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLXByb2dyZXNzIHsKICAgICAgICBmb250LXNpemU6IDAuNXJlbTsgLyogZGVmYXVsdCAzZW0gPT4gMS41cmVtICovCiAgICB9CgpgOwpmdW5jdGlvbiBpbml0UHJvZmlsZUVkaXRvcihkb2N1bWVudCwgdm0pIHsKICAgIGNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybScpOwogICAgY29uc3QgcHJvZmlsZUZvcm1UaXRsZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0tdGl0bGUnKTsKICAgIGNvbnN0IHByb2ZpbGVGaWVsZHNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZpZWxkc2V0Jyk7CiAgICBjb25zdCBwcm9maWxlTmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtbmFtZScpOwogICAgY29uc3QgcHJvZmlsZUFjY291bnRJZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtYWNjb3VudC1pZCcpOwogICAgY29uc3QgcHJvZmlsZUFwaVRva2VuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1hcGktdG9rZW4nKTsKICAgIGNvbnN0IHByb2ZpbGVEZWxldGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1kZWxldGUnKTsKICAgIGNvbnN0IHByb2ZpbGVDYW5jZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1jYW5jZWwnKTsKICAgIGNvbnN0IHByb2ZpbGVTYXZlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtc2F2ZScpOwogICAgY29uc3QgcHJvZmlsZUZvcm1Qcm9ncmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0tcHJvZ3Jlc3MnKTsKICAgIGNvbnN0IHByb2ZpbGVGb3JtT3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS1vdXRwdXQnKTsKICAgIHByb2ZpbGVDYW5jZWxCdXR0b24ub25jbGljayA9ICgpPT57CiAgICAgICAgdm0uY2FuY2VsUHJvZmlsZSgpOwogICAgfTsKICAgIHByb2ZpbGVOYW1lSW5wdXQub25pbnB1dCA9ICgpPT57CiAgICAgICAgdm0uc2V0UHJvZmlsZU5hbWUocHJvZmlsZU5hbWVJbnB1dC52YWx1ZSk7CiAgICB9OwogICAgcHJvZmlsZUFjY291bnRJZElucHV0Lm9uaW5wdXQgPSAoKT0+ewogICAgICAgIHZtLnNldFByb2ZpbGVBY2NvdW50SWQocHJvZmlsZUFjY291bnRJZElucHV0LnZhbHVlKTsKICAgIH07CiAgICBwcm9maWxlQXBpVG9rZW5JbnB1dC5vbmlucHV0ID0gKCk9PnsKICAgICAgICB2bS5zZXRQcm9maWxlQXBpVG9rZW4ocHJvZmlsZUFwaVRva2VuSW5wdXQudmFsdWUpOwogICAgfTsKICAgIHByb2ZpbGVTYXZlQnV0dG9uLm9uY2xpY2sgPSAoKT0+ewogICAgICAgIHZtLnNhdmVQcm9maWxlKCk7CiAgICB9OwogICAgcHJvZmlsZURlbGV0ZUJ1dHRvbi5vbmNsaWNrID0gKCk9PnsKICAgICAgICB2bS5kZWxldGVQcm9maWxlKHZtLnByb2ZpbGVGb3JtLnByb2ZpbGVJZCk7CiAgICB9OwogICAgcmV0dXJuICgpPT57CiAgICAgICAgcHJvZmlsZUZvcm0uc3R5bGUuZGlzcGxheSA9IHZtLnByb2ZpbGVGb3JtLnNob3dpbmcgPyAnZ3JpZCcgOiAnbm9uZSc7CiAgICAgICAgcHJvZmlsZUZpZWxkc2V0LmRpc2FibGVkID0gIXZtLnByb2ZpbGVGb3JtLmVuYWJsZWQ7CiAgICAgICAgcHJvZmlsZUZvcm1UaXRsZURpdi50ZXh0Q29udGVudCA9IHZtLnByb2ZpbGVGb3JtLnRpdGxlOwogICAgICAgIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSB2bS5wcm9maWxlRm9ybS5uYW1lOwogICAgICAgIHByb2ZpbGVBY2NvdW50SWRJbnB1dC52YWx1ZSA9IHZtLnByb2ZpbGVGb3JtLmFjY291bnRJZDsKICAgICAgICBwcm9maWxlQXBpVG9rZW5JbnB1dC52YWx1ZSA9IHZtLnByb2ZpbGVGb3JtLmFwaVRva2VuOwogICAgICAgIHByb2ZpbGVEZWxldGVCdXR0b24uc3R5bGUuZGlzcGxheSA9IHZtLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPyAnaW5saW5lLWJsb2NrJyA6ICdub25lJzsKICAgICAgICBwcm9maWxlU2F2ZUJ1dHRvbi5kaXNhYmxlZCA9ICF2bS5wcm9maWxlRm9ybS5zYXZlRW5hYmxlZDsKICAgICAgICBwcm9maWxlRm9ybVByb2dyZXNzLnN0eWxlLmRpc3BsYXkgPSB2bS5wcm9maWxlRm9ybS5wcm9ncmVzc1Zpc2libGUgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIHByb2ZpbGVGb3JtT3V0cHV0LnRleHRDb250ZW50ID0gdm0ucHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZTsKICAgIH07Cn0KY29uc3QgTU9EQUxfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9Im1vZGFsIiBjbGFzcz0ibW9kYWwiPgogICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCI+CiAgICAke1BST0ZJTEVfRURJVE9SX0hUTUx9CiAgICA8L2Rpdj4KPC9kaXY+CmA7CmNvbnN0IE1PREFMX0NTUyA9IGNzc2AKLm1vZGFsIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB6LWluZGV4OiAxOwogICAgbGVmdDogMDsKICAgIHRvcDogMDsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgb3ZlcmZsb3c6IGF1dG87CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNCk7Cn0KCi5tb2RhbC1jb250ZW50IHsKICAgIG1hcmdpbjogMTUlIGF1dG87CiAgICB3aWR0aDogODAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogIzEyMTIxMjsKfQpgOwpmdW5jdGlvbiBpbml0TW9kYWwoZG9jdW1lbnQsIHZtKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbCcpOwogICAgY29uc3QgdXBkYXRlUHJvZmlsZUVkaXRvciA9IGluaXRQcm9maWxlRWRpdG9yKGRvY3VtZW50LCB2bSk7CiAgICBjb25zdCBjbG9zZU1vZGFsID0gKCk9PnsKICAgICAgICBpZiAoIXZtLnByb2ZpbGVGb3JtLnNob3dpbmcpIHJldHVybjsKICAgICAgICBpZiAodm0ucHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlKSByZXR1cm47CiAgICAgICAgdm0ucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHZtLm9uY2hhbmdlKCk7CiAgICB9OwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KT0+ewogICAgICAgIGlmIChldmVudC50YXJnZXQgPT0gbW9kYWwpIHsKICAgICAgICAgICAgY2xvc2VNb2RhbCgpOwogICAgICAgIH0KICAgIH0pOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCk9PnsKICAgICAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDsKICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykgewogICAgICAgICAgICBjbG9zZU1vZGFsKCk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gKCk9PnsKICAgICAgICB1cGRhdGVQcm9maWxlRWRpdG9yKCk7CiAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9IHZtLnByb2ZpbGVGb3JtLnNob3dpbmcgPyAnYmxvY2snIDogJ25vbmUnOwogICAgfTsKfQpjb25zdCBIRUFERVJfSFRNTCA9IGh0bWxgCjxoZWFkZXIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCI+CiAgICA8ZGl2IHN0eWxlPSJmbGV4LWdyb3c6IDE7Ij5EZW5vZmxhcmUgVGFpbDwvZGl2PgogICAgPGRpdiBpZD0ibWVzc2FnZSI+U2F2aW5nIHByb2ZpbGUuLi48L2Rpdj4KPC9oZWFkZXI+CmA7CmNvbnN0IEhFQURFUl9DU1MgPSBjc3NgCmhlYWRlciB7CiAgICBwb3NpdGlvbjogc3RpY2t5OwogICAgZGlzcGxheTogZmxleDsKICAgIHBhZGRpbmc6IDFyZW07Cn0KYDsKZnVuY3Rpb24gaW5pdEhlYWRlcihkb2N1bWVudCwgdm0pIHsKICAgIGNvbnN0IG1lc3NhZ2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZScpOwogICAgcmV0dXJuICgpPT57CiAgICAgICAgbWVzc2FnZURpdi50ZXh0Q29udGVudCA9IHZtLm1lc3NhZ2U7CiAgICB9Owp9CmNvbnN0IENJUkNVTEFSX1BST0dSRVNTX0NTUyA9IGNzc2AKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXIgewogICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogICAgLW1vei1hcHBlYXJhbmNlOiBub25lOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBib3JkZXI6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBwYWRkaW5nOiAwLjI1ZW07CiAgICB3aWR0aDogM2VtOwogICAgaGVpZ2h0OiAzZW07CiAgICBjb2xvcjogdmFyKC0tcHVyZS1tYXRlcmlhbC1wcmltYXJ5LXJnYiwgcmdiKDMzLCAxNTAsIDI0MykpOwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmb250LXNpemU6IDE2cHg7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9CgoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjo6LXdlYmtpdC1wcm9ncmVzcy1iYXIgewogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KCi8qIEluZGV0ZXJtaW5hdGUgKi8KLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZSB7CiAgICAtd2Via2l0LW1hc2staW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0cmFuc3BhcmVudCA1MCUsIGJsYWNrIDUwJSksIGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgdHJhbnNwYXJlbnQgNTAlLCBibGFjayA1MCUpOwogICAgbWFzay1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKSwgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB0cmFuc3BhcmVudCA1MCUsIGJsYWNrIDUwJSk7CiAgICBhbmltYXRpb246IHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXIgNnMgaW5maW5pdGUgY3ViaWMtYmV6aWVyKDAuMywgMC42LCAxLCAxKTsKfQoKOi1tcy1sYW5nKHgpLCAucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlIHsKICAgIGFuaW1hdGlvbjogbm9uZTsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6YmVmb3JlLAoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlOjotd2Via2l0LXByb2dyZXNzLXZhbHVlIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgZGlzcGxheTogYmxvY2s7CiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgbWFyZ2luLWJvdHRvbTogMC4yNWVtOwogICAgYm9yZGVyOiBzb2xpZCAwLjI1ZW0gdHJhbnNwYXJlbnQ7CiAgICBib3JkZXItdG9wLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBhbmltYXRpb246IHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXItcHNldWRvIDAuNzVzIGluZmluaXRlIGxpbmVhciBhbHRlcm5hdGU7Cn0KCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGU6Oi1tb3otcHJvZ3Jlc3MtYmFyIHsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBib3JkZXI6IHNvbGlkIDAuMjVlbSB0cmFuc3BhcmVudDsKICAgIGJvcmRlci10b3AtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBhbmltYXRpb246IHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXItcHNldWRvIDAuNzVzIGluZmluaXRlIGxpbmVhciBhbHRlcm5hdGU7Cn0KCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGU6Oi1tcy1maWxsIHsKICAgIGFuaW1hdGlvbi1uYW1lOiAtbXMtcmluZzsKfQoKQGtleWZyYW1lcyBwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyIHsKICAgIDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsKICAgIH0KICAgIDEyLjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxODBkZWcpOwogICAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjsKICAgIH0KICAgIDI1JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoNjMwZGVnKTsKICAgIH0KICAgIDM3LjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSg4MTBkZWcpOwogICAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjsKICAgIH0KICAgIDUwJSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMTI2MGRlZyk7CiAgICB9CiAgICA2Mi41JSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMTQ0MGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgNzUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxODkwZGVnKTsKICAgIH0KICAgIDg3LjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgyMDcwZGVnKTsKICAgICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7CiAgICB9CiAgICAxMDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgyNTIwZGVnKTsKICAgIH0KfQoKQGtleWZyYW1lcyBwdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyLXBzZXVkbyB7CiAgICAwJSB7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoLTMwZGVnKTsKICAgIH0KICAgIDI5LjQlIHsKICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICB9CiAgICAyOS40MSUgewogICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICB9CiAgICA2NC43JSB7CiAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICB9CiAgICA2NC43MSUgewogICAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIH0KICAgIDEwMCUgewogICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogY3VycmVudENvbG9yOwogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDIyNWRlZyk7CiAgICB9Cn0KYDsKY29uc3QgYXBwQ3NzID0gY3NzYAoKbWFpbiB7CiAgICBkaXNwbGF5OiBmbGV4Owp9Cgo6cm9vdCB7CiAgICAtLXB1cmUtbWF0ZXJpYWwtcHJpbWFyeS1yZ2I6IHJnYigxODcsIDEzNCwgMjUyKTsKfQpgOwpjb25zdCBhcHBIdG1sID0gaHRtbGAKJHtIRUFERVJfSFRNTH0KPG1haW4+CiR7U0lERUJBUl9IVE1MfQo8ZGl2IGlkPSJjb250ZW50Ij4KPC9kaXY+CiR7TU9EQUxfSFRNTH0KPC9tYWluPmA7CmZ1bmN0aW9uIGFwcGVuZFN0eWxlc2hlZXRzKGNzc1RleHRzKSB7CiAgICBjb25zdCBzdHlsZVNoZWV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgIHN0eWxlU2hlZXQudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgICBzdHlsZVNoZWV0LnRleHRDb250ZW50ID0gY3NzVGV4dHMuam9pbignXG5cbicpOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZVNoZWV0KTsKfQphcHBlbmRTdHlsZXNoZWV0cyhbCiAgICBNQVRFUklBTF9DU1MuY3NzVGV4dCwKICAgIGFwcENzcy5jc3NUZXh0LAogICAgSEVBREVSX0NTUy5jc3NUZXh0LAogICAgU0lERUJBUl9DU1MuY3NzVGV4dCwKICAgIE1PREFMX0NTUy5jc3NUZXh0LAogICAgUFJPRklMRV9FRElUT1JfQ1NTLmNzc1RleHQsCiAgICBDSVJDVUxBUl9QUk9HUkVTU19DU1MuY3NzVGV4dCwgCl0pOwpMaXRFbGVtZW50LnJlbmRlcihhcHBIdG1sLCBkb2N1bWVudC5ib2R5KTsKY29uc3Qgdm0gPSBuZXcgVGFpbHdlYkFwcFZNKCk7CmNvbnN0IHVwZGF0ZUhlYWRlciA9IGluaXRIZWFkZXIoZG9jdW1lbnQsIHZtKTsKY29uc3QgdXBkYXRlU2lkZWJhciA9IGluaXRTaWRlYmFyKGRvY3VtZW50LCB2bSk7CmNvbnN0IHVwZGF0ZU1vZGFsID0gaW5pdE1vZGFsKGRvY3VtZW50LCB2bSk7CnZtLm9uY2hhbmdlID0gKCk9PnsKICAgIHVwZGF0ZUhlYWRlcigpOwogICAgdXBkYXRlU2lkZWJhcigpOwogICAgdXBkYXRlTW9kYWwoKTsKfTsKdm0uc3RhcnQoKTsKQ2xvdWRmbGFyZUFwaS5VUkxfVFJBTlNGT1JNRVIgPSAodik9PmAvZmV0Y2gvJHt2LnN1YnN0cmluZygnaHR0cHM6Ly8nLmxlbmd0aCl9YAo7CmlmIChmYWxzZSkgewogICAgY29uc3QgYWNjb3VudElkID0gJyc7CiAgICBjb25zdCBhcGlUb2tlbiA9ICcnOwogICAgY29uc3Qgc2NyaXB0TmFtZSA9ICcnOwogICAgdHJ5IHsKICAgICAgICBjb25zdCB0YWlsID0gYXdhaXQgY3JlYXRlVGFpbChhY2NvdW50SWQsIHNjcmlwdE5hbWUsIGFwaVRva2VuKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKEpTT04uc3RyaW5naWZ5KHRhaWwsIHVuZGVmaW5lZCwgMikpKTsKICAgICAgICBjb25zdCBsb2dnZXIgPSAoLi4uZGF0YSk9PnsKICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7CiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGRhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IHRva2VucyA9IG1zZy5zcGxpdCgnJWMnKTsKICAgICAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgdG9rZW5zLmxlbmd0aDsgaTErKyl7CiAgICAgICAgICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnU1BBTicpOwogICAgICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSBkYXRhW2kxXTsKICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTsKICAgICAgICAgICAgICAgIHNwYW4udGV4dENvbnRlbnQgPSB0b2tlbnNbaTFdOwogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKHNwYW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGNhbGxiYWNrczEgPSB7CiAgICAgICAgICAgIG9uT3BlbiAoX2NuLCB0aW1lU3RhbXApIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvcGVuJywgewogICAgICAgICAgICAgICAgICAgIHRpbWVTdGFtcAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2xvc2UgKF9jbiwgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2xvc2UnLCB7CiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgICAgcmVhc29uLAogICAgICAgICAgICAgICAgICAgIHdhc0NsZWFuCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25FcnJvciAoX2NuLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJywgewogICAgICAgICAgICAgICAgICAgIHRpbWVTdGFtcCwKICAgICAgICAgICAgICAgICAgICBlcnJvckluZm8KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxNZXNzYWdlIChfY24sIHRpbWVTdGFtcCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RhaWxNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICAgIHRpbWVTdGFtcCwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGR1bXBNZXNzYWdlUHJldHR5KG1lc3NhZ2UsIGxvZ2dlcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVW5wYXJzZWRNZXNzYWdlIChfY24sIHRpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VucGFyc2VkTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgICB0aW1lU3RhbXAsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBwYXJzZUVycm9yCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgX2NuID0gbmV3IFRhaWxDb25uZWN0aW9uKHRhaWwudXJsLCBjYWxsYmFja3MxKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGUuc3RhY2spKTsKICAgIH0KfQo=';