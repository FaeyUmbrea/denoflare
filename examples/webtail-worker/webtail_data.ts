

export const WEBTAIL_APP_HASH = 'a91c61b9f263b29bb937cfaa9cba01bfc326a99e';
export const WEBTAIL_APP_B64 = 'Y2xhc3MgQ2xvdWRmbGFyZUFwaSB7CiAgICBzdGF0aWMgREVCVUcgPSBmYWxzZTsKICAgIHN0YXRpYyBVUkxfVFJBTlNGT1JNRVIgPSAodik9PnYKICAgIDsKfQpjbGFzcyBDbG91ZGZsYXJlQXBpRXJyb3IxIGV4dGVuZHMgRXJyb3IgewogICAgc3RhdHVzOwogICAgZXJyb3JzOwogICAgY29uc3RydWN0b3IobWVzc2FnZTIsIHN0YXR1czEsIGVycm9yczEpewogICAgICAgIHN1cGVyKG1lc3NhZ2UyKTsKICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czE7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBlcnJvcnMxOwogICAgfQp9CmNvbnN0IGRpcmVjdGl2ZXMgPSBuZXcgV2Vha01hcCgpOwpjb25zdCBkaXJlY3RpdmUgPSAoZik9PiguLi5hcmdzKT0+ewogICAgICAgIGNvbnN0IGQgPSBmKC4uLmFyZ3MpOwogICAgICAgIGRpcmVjdGl2ZXMuc2V0KGQsIHRydWUpOwogICAgICAgIHJldHVybiBkOwogICAgfQo7CmNvbnN0IGlzRGlyZWN0aXZlID0gKG8pPT57CiAgICByZXR1cm4gdHlwZW9mIG8gPT09ICJmdW5jdGlvbiIgJiYgZGlyZWN0aXZlcy5oYXMobyk7Cn07CmNvbnN0IGlzQ0VQb2x5ZmlsbCA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5jdXN0b21FbGVtZW50cyAhPSBudWxsICYmIHdpbmRvdy5jdXN0b21FbGVtZW50cy5wb2x5ZmlsbFdyYXBGbHVzaENhbGxiYWNrICE9PSB2b2lkIDA7CmNvbnN0IHJlcGFyZW50Tm9kZXMgPSAoY29udGFpbmVyLCBzdGFydCwgZW5kID0gbnVsbCwgYmVmb3JlID0gbnVsbCk9PnsKICAgIHdoaWxlKHN0YXJ0ICE9PSBlbmQpewogICAgICAgIGNvbnN0IG4gPSBzdGFydC5uZXh0U2libGluZzsKICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHN0YXJ0LCBiZWZvcmUpOwogICAgICAgIHN0YXJ0ID0gbjsKICAgIH0KfTsKY29uc3QgcmVtb3ZlTm9kZXMgPSAoY29udGFpbmVyLCBzdGFydCwgZW5kID0gbnVsbCk9PnsKICAgIHdoaWxlKHN0YXJ0ICE9PSBlbmQpewogICAgICAgIGNvbnN0IG4gPSBzdGFydC5uZXh0U2libGluZzsKICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoc3RhcnQpOwogICAgICAgIHN0YXJ0ID0gbjsKICAgIH0KfTsKY29uc3Qgbm9DaGFuZ2UgPSB7Cn07CmNvbnN0IG5vdGhpbmcgPSB7Cn07CmNvbnN0IG1hcmtlciA9IGB7e2xpdC0ke1N0cmluZyhNYXRoLnJhbmRvbSgpKS5zbGljZSgyKX19fWA7CmNvbnN0IG5vZGVNYXJrZXIgPSBgPCEtLSR7bWFya2VyfS0tPmA7CmNvbnN0IG1hcmtlclJlZ2V4ID0gbmV3IFJlZ0V4cChgJHttYXJrZXJ9fCR7bm9kZU1hcmtlcn1gKTsKY29uc3QgYm91bmRBdHRyaWJ1dGVTdWZmaXggPSAiJGxpdCQiOwpjbGFzcyBUZW1wbGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihyZXN1bHQsIGVsZW1lbnQ1KXsKICAgICAgICB0aGlzLnBhcnRzID0gW107CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDU7CiAgICAgICAgY29uc3Qgbm9kZXNUb1JlbW92ZSA9IFtdOwogICAgICAgIGNvbnN0IHN0YWNrID0gW107CiAgICAgICAgY29uc3Qgd2Fsa2VyID0gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihlbGVtZW50NS5jb250ZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgbGFzdFBhcnRJbmRleCA9IDA7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgbGV0IHBhcnRJbmRleCA9IDA7CiAgICAgICAgY29uc3QgeyBzdHJpbmdzOiBzdHJpbmdzNSAsIHZhbHVlczogeyBsZW5ndGggIH0gIH0gPSByZXN1bHQ7CiAgICAgICAgd2hpbGUocGFydEluZGV4IDwgbGVuZ3RoKXsKICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpOwogICAgICAgICAgICBpZiAobm9kZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGxlbmd0aDogbGVuZ3RoMiAgfSA9IGF0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoMjsgaSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZHNXaXRoKGF0dHJpYnV0ZXNbaV0ubmFtZSwgYm91bmRBdHRyaWJ1dGVTdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlKGNvdW50LS0gPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nRm9yUGFydCA9IHN0cmluZ3M1W3BhcnRJbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBsYXN0QXR0cmlidXRlTmFtZVJlZ2V4LmV4ZWMoc3RyaW5nRm9yUGFydClbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZUxvb2t1cE5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCkgKyBib3VuZEF0dHJpYnV0ZVN1ZmZpeDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlVmFsdWUgPSBub2RlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVMb29rdXBOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlTG9va3VwTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRpY3MgPSBhdHRyaWJ1dGVWYWx1ZS5zcGxpdChtYXJrZXJSZWdleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiYXR0cmlidXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IHN0YXRpY3MKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCArPSBzdGF0aWNzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gIlRFTVBMQVRFIikgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gbm9kZS5jb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBub2RlLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKG1hcmtlcikgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdzMiA9IGRhdGEuc3BsaXQobWFya2VyUmVnZXgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHN0cmluZ3MyLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxhc3RJbmRleDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluc2VydDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHMgPSBzdHJpbmdzMltpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQgPSBjcmVhdGVNYXJrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gbGFzdEF0dHJpYnV0ZU5hbWVSZWdleC5leGVjKHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoICE9PSBudWxsICYmIGVuZHNXaXRoKG1hdGNoWzJdLCBib3VuZEF0dHJpYnV0ZVN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcy5zbGljZSgwLCBtYXRjaC5pbmRleCkgKyBtYXRjaFsxXSArIG1hdGNoWzJdLnNsaWNlKDAsIC1ib3VuZEF0dHJpYnV0ZVN1ZmZpeC5sZW5ndGgpICsgbWF0Y2hbM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGluc2VydCwgbm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAibm9kZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogKytpbmRleAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZ3MyW2xhc3RJbmRleF0gPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY3JlYXRlTWFya2VyKCksIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmVtb3ZlLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhID0gc3RyaW5nczJbbGFzdEluZGV4XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4ICs9IGxhc3RJbmRleDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSA4KSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhID09PSBtYXJrZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUucHJldmlvdXNTaWJsaW5nID09PSBudWxsIHx8IGluZGV4ID09PSBsYXN0UGFydEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY3JlYXRlTWFya2VyKCksIG5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsYXN0UGFydEluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm5leHRTaWJsaW5nID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YSA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzVG9SZW1vdmUucHVzaChub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgtLTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCBpID0gLTE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoKGkgPSBub2RlLmRhdGEuaW5kZXhPZihtYXJrZXIsIGkgKyAxKSkgIT09IC0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiAtMQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgbjEgb2Ygbm9kZXNUb1JlbW92ZSl7CiAgICAgICAgICAgIG4xLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobjEpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBlbmRzV2l0aCA9IChzdHIsIHN1ZmZpeCk9PnsKICAgIGNvbnN0IGluZGV4MSA9IHN0ci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoOwogICAgcmV0dXJuIGluZGV4MSA+PSAwICYmIHN0ci5zbGljZShpbmRleDEpID09PSBzdWZmaXg7Cn07CmNvbnN0IGlzVGVtcGxhdGVQYXJ0QWN0aXZlID0gKHBhcnQpPT5wYXJ0LmluZGV4ICE9PSAtMQo7CmNvbnN0IGNyZWF0ZU1hcmtlciA9ICgpPT5kb2N1bWVudC5jcmVhdGVDb21tZW50KCIiKQo7CmNvbnN0IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXggPSAvKFsgXHgwOVx4MGFceDBjXHgwZF0pKFteXDAtXHgxRlx4N0YtXHg5RiAiJz49L10rKShbIFx4MDlceDBhXHgwY1x4MGRdKj1bIFx4MDlceDBhXHgwY1x4MGRdKig/OlteIFx4MDlceDBhXHgwY1x4MGQiJ2A8Pj1dKnwiW14iXSp8J1teJ10qKSkkLzsKY2xhc3MgVGVtcGxhdGVJbnN0YW5jZSB7CiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZSwgcHJvY2Vzc29yLCBvcHRpb25zMil7CiAgICAgICAgdGhpcy5fX3BhcnRzID0gW107CiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlOwogICAgICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yOwogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMyOwogICAgfQogICAgdXBkYXRlKHZhbHVlcykgewogICAgICAgIGxldCBpID0gMDsKICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgdGhpcy5fX3BhcnRzKXsKICAgICAgICAgICAgaWYgKHBhcnQgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcGFydC5zZXRWYWx1ZSh2YWx1ZXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBwYXJ0MSBvZiB0aGlzLl9fcGFydHMpewogICAgICAgICAgICBpZiAocGFydDEgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcGFydDEuY29tbWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBfY2xvbmUoKSB7CiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBpc0NFUG9seWZpbGwgPyB0aGlzLnRlbXBsYXRlLmVsZW1lbnQuY29udGVudC5jbG9uZU5vZGUodHJ1ZSkgOiBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxhdGUuZWxlbWVudC5jb250ZW50LCB0cnVlKTsKICAgICAgICBjb25zdCBzdGFjazEgPSBbXTsKICAgICAgICBjb25zdCBwYXJ0czIgPSB0aGlzLnRlbXBsYXRlLnBhcnRzOwogICAgICAgIGNvbnN0IHdhbGtlcjEgPSBkb2N1bWVudC5jcmVhdGVUcmVlV2Fsa2VyKGZyYWdtZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgcGFydEluZGV4MSA9IDA7CiAgICAgICAgbGV0IG5vZGVJbmRleCA9IDA7CiAgICAgICAgbGV0IHBhcnQ7CiAgICAgICAgbGV0IG5vZGUgPSB3YWxrZXIxLm5leHROb2RlKCk7CiAgICAgICAgd2hpbGUocGFydEluZGV4MSA8IHBhcnRzMi5sZW5ndGgpewogICAgICAgICAgICBwYXJ0ID0gcGFydHMyW3BhcnRJbmRleDFdOwogICAgICAgICAgICBpZiAoIWlzVGVtcGxhdGVQYXJ0QWN0aXZlKHBhcnQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fcGFydHMucHVzaCh2b2lkIDApOwogICAgICAgICAgICAgICAgcGFydEluZGV4MSsrOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUobm9kZUluZGV4IDwgcGFydC5pbmRleCl7CiAgICAgICAgICAgICAgICBub2RlSW5kZXgrKzsKICAgICAgICAgICAgICAgIGlmIChub2RlLm5vZGVOYW1lID09PSAiVEVNUExBVEUiKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sxLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyMS5jdXJyZW50Tm9kZSA9IG5vZGUuY29udGVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgobm9kZSA9IHdhbGtlcjEubmV4dE5vZGUoKSkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB3YWxrZXIxLmN1cnJlbnROb2RlID0gc3RhY2sxLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIG5vZGUgPSB3YWxrZXIxLm5leHROb2RlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gIm5vZGUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0MiA9IHRoaXMucHJvY2Vzc29yLmhhbmRsZVRleHRFeHByZXNzaW9uKHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgICAgICBwYXJ0Mi5pbnNlcnRBZnRlck5vZGUobm9kZS5wcmV2aW91c1NpYmxpbmcpOwogICAgICAgICAgICAgICAgdGhpcy5fX3BhcnRzLnB1c2gocGFydDIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fX3BhcnRzLnB1c2goLi4udGhpcy5wcm9jZXNzb3IuaGFuZGxlQXR0cmlidXRlRXhwcmVzc2lvbnMobm9kZSwgcGFydC5uYW1lLCBwYXJ0LnN0cmluZ3MsIHRoaXMub3B0aW9ucykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcnRJbmRleDErKzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ0VQb2x5ZmlsbCkgewogICAgICAgICAgICBkb2N1bWVudC5hZG9wdE5vZGUoZnJhZ21lbnQpOwogICAgICAgICAgICBjdXN0b21FbGVtZW50cy51cGdyYWRlKGZyYWdtZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyYWdtZW50OwogICAgfQp9CmNvbnN0IHBvbGljeSA9IHdpbmRvdy50cnVzdGVkVHlwZXMgJiYgdHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSgibGl0LWh0bWwiLCB7CiAgICBjcmVhdGVIVE1MOiAocyk9PnMKfSk7CmNvbnN0IGNvbW1lbnRNYXJrZXIgPSBgICR7bWFya2VyfSBgOwpjbGFzcyBUZW1wbGF0ZVJlc3VsdCB7CiAgICBjb25zdHJ1Y3RvcihzdHJpbmdzMSwgdmFsdWVzLCB0eXBlMSwgcHJvY2Vzc29yMSl7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczE7CiAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgICAgdGhpcy50eXBlID0gdHlwZTE7CiAgICAgICAgdGhpcy5wcm9jZXNzb3IgPSBwcm9jZXNzb3IxOwogICAgfQogICAgZ2V0SFRNTCgpIHsKICAgICAgICBjb25zdCBsID0gdGhpcy5zdHJpbmdzLmxlbmd0aCAtIDE7CiAgICAgICAgbGV0IGh0bWwyID0gIiI7CiAgICAgICAgbGV0IGlzQ29tbWVudEJpbmRpbmcgPSBmYWxzZTsKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbDsgaSsrKXsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuc3RyaW5nc1tpXTsKICAgICAgICAgICAgY29uc3QgY29tbWVudE9wZW4gPSBzLmxhc3RJbmRleE9mKCI8IS0tIik7CiAgICAgICAgICAgIGlzQ29tbWVudEJpbmRpbmcgPSAoY29tbWVudE9wZW4gPiAtMSB8fCBpc0NvbW1lbnRCaW5kaW5nKSAmJiBzLmluZGV4T2YoIi0tPiIsIGNvbW1lbnRPcGVuICsgMSkgPT09IC0xOwogICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVNYXRjaCA9IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXguZXhlYyhzKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU1hdGNoID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBodG1sMiArPSBzICsgKGlzQ29tbWVudEJpbmRpbmcgPyBjb21tZW50TWFya2VyIDogbm9kZU1hcmtlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBodG1sMiArPSBzLnN1YnN0cigwLCBhdHRyaWJ1dGVNYXRjaC5pbmRleCkgKyBhdHRyaWJ1dGVNYXRjaFsxXSArIGF0dHJpYnV0ZU1hdGNoWzJdICsgYm91bmRBdHRyaWJ1dGVTdWZmaXggKyBhdHRyaWJ1dGVNYXRjaFszXSArIG1hcmtlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBodG1sMiArPSB0aGlzLnN0cmluZ3NbbF07CiAgICAgICAgcmV0dXJuIGh0bWwyOwogICAgfQogICAgZ2V0VGVtcGxhdGVFbGVtZW50KCkgewogICAgICAgIGNvbnN0IHRlbXBsYXRlMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5nZXRIVE1MKCk7CiAgICAgICAgaWYgKHBvbGljeSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHZhbHVlID0gcG9saWN5LmNyZWF0ZUhUTUwodmFsdWUpOwogICAgICAgIH0KICAgICAgICB0ZW1wbGF0ZTEuaW5uZXJIVE1MID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlMTsKICAgIH0KfQpjbGFzcyBTVkdUZW1wbGF0ZVJlc3VsdCBleHRlbmRzIFRlbXBsYXRlUmVzdWx0IHsKICAgIGdldEhUTUwoKSB7CiAgICAgICAgcmV0dXJuIGA8c3ZnPiR7c3VwZXIuZ2V0SFRNTCgpfTwvc3ZnPmA7CiAgICB9CiAgICBnZXRUZW1wbGF0ZUVsZW1lbnQoKSB7CiAgICAgICAgY29uc3QgdGVtcGxhdGUxID0gc3VwZXIuZ2V0VGVtcGxhdGVFbGVtZW50KCk7CiAgICAgICAgY29uc3QgY29udGVudCA9IHRlbXBsYXRlMS5jb250ZW50OwogICAgICAgIGNvbnN0IHN2Z0VsZW1lbnQgPSBjb250ZW50LmZpcnN0Q2hpbGQ7CiAgICAgICAgY29udGVudC5yZW1vdmVDaGlsZChzdmdFbGVtZW50KTsKICAgICAgICByZXBhcmVudE5vZGVzKGNvbnRlbnQsIHN2Z0VsZW1lbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlMTsKICAgIH0KfQpjb25zdCBpc1ByaW1pdGl2ZSA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCAhKHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iKTsKfTsKY29uc3QgaXNJdGVyYWJsZSA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSB8fCAhISh2YWx1ZSAmJiB2YWx1ZVtTeW1ib2wuaXRlcmF0b3JdKTsKfTsKY2xhc3MgQXR0cmlidXRlQ29tbWl0dGVyIHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQxLCBuYW1lMywgc3RyaW5nczIpewogICAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQxOwogICAgICAgIHRoaXMubmFtZSA9IG5hbWUzOwogICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3MyOwogICAgICAgIHRoaXMucGFydHMgPSBbXTsKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc3RyaW5nczIubGVuZ3RoIC0gMTsgaSsrKXsKICAgICAgICAgICAgdGhpcy5wYXJ0c1tpXSA9IHRoaXMuX2NyZWF0ZVBhcnQoKTsKICAgICAgICB9CiAgICB9CiAgICBfY3JlYXRlUGFydCgpIHsKICAgICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZVBhcnQodGhpcyk7CiAgICB9CiAgICBfZ2V0VmFsdWUoKSB7CiAgICAgICAgY29uc3Qgc3RyaW5nczMgPSB0aGlzLnN0cmluZ3M7CiAgICAgICAgY29uc3QgbCA9IHN0cmluZ3MzLmxlbmd0aCAtIDE7CiAgICAgICAgY29uc3QgcGFydHMyID0gdGhpcy5wYXJ0czsKICAgICAgICBpZiAobCA9PT0gMSAmJiBzdHJpbmdzM1swXSA9PT0gIiIgJiYgc3RyaW5nczNbMV0gPT09ICIiKSB7CiAgICAgICAgICAgIGNvbnN0IHYgPSBwYXJ0czJbMF0udmFsdWU7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gInN5bWJvbCIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAic3RyaW5nIiB8fCAhaXNJdGVyYWJsZSh2KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IHRleHQgPSAiIjsKICAgICAgICBmb3IobGV0IGkxID0gMDsgaTEgPCBsOyBpMSsrKXsKICAgICAgICAgICAgdGV4dCArPSBzdHJpbmdzM1tpMV07CiAgICAgICAgICAgIGNvbnN0IHBhcnQgPSBwYXJ0czJbaTFdOwogICAgICAgICAgICBpZiAocGFydCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2ID0gcGFydC52YWx1ZTsKICAgICAgICAgICAgICAgIGlmIChpc1ByaW1pdGl2ZSh2KSB8fCAhaXNJdGVyYWJsZSh2KSkgewogICAgICAgICAgICAgICAgICAgIHRleHQgKz0gdHlwZW9mIHYgPT09ICJzdHJpbmciID8gdiA6IFN0cmluZyh2KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHYpewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IHR5cGVvZiB0ID09PSAic3RyaW5nIiA/IHQgOiBTdHJpbmcodCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRleHQgKz0gc3RyaW5nczNbbF07CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKHRoaXMubmFtZSwgdGhpcy5fZ2V0VmFsdWUoKSk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIEF0dHJpYnV0ZVBhcnQgewogICAgY29uc3RydWN0b3IoY29tbWl0dGVyKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuY29tbWl0dGVyID0gY29tbWl0dGVyOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgIT09IG5vQ2hhbmdlICYmICghaXNQcmltaXRpdmUodmFsdWUpIHx8IHZhbHVlICE9PSB0aGlzLnZhbHVlKSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIGlmICghaXNEaXJlY3RpdmUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbW1pdHRlci5kaXJ0eSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy52YWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy52YWx1ZTsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmNvbW1pdHRlci5jb21taXQoKTsKICAgIH0KfQpjbGFzcyBOb2RlUGFydCB7CiAgICBjb25zdHJ1Y3RvcihvcHRpb25zMSl7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMxOwogICAgfQogICAgYXBwZW5kSW50byhjb250YWluZXIpIHsKICAgICAgICB0aGlzLnN0YXJ0Tm9kZSA9IGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVNYXJrZXIoKSk7CiAgICAgICAgdGhpcy5lbmROb2RlID0gY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZU1hcmtlcigpKTsKICAgIH0KICAgIGluc2VydEFmdGVyTm9kZShyZWYpIHsKICAgICAgICB0aGlzLnN0YXJ0Tm9kZSA9IHJlZjsKICAgICAgICB0aGlzLmVuZE5vZGUgPSByZWYubmV4dFNpYmxpbmc7CiAgICB9CiAgICBhcHBlbmRJbnRvUGFydChwYXJ0KSB7CiAgICAgICAgcGFydC5fX2luc2VydCh0aGlzLnN0YXJ0Tm9kZSA9IGNyZWF0ZU1hcmtlcigpKTsKICAgICAgICBwYXJ0Ll9faW5zZXJ0KHRoaXMuZW5kTm9kZSA9IGNyZWF0ZU1hcmtlcigpKTsKICAgIH0KICAgIGluc2VydEFmdGVyUGFydChyZWYpIHsKICAgICAgICByZWYuX19pbnNlcnQodGhpcy5zdGFydE5vZGUgPSBjcmVhdGVNYXJrZXIoKSk7CiAgICAgICAgdGhpcy5lbmROb2RlID0gcmVmLmVuZE5vZGU7CiAgICAgICAgcmVmLmVuZE5vZGUgPSB0aGlzLnN0YXJ0Tm9kZTsKICAgIH0KICAgIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZhbHVlOwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIGlmICh0aGlzLnN0YXJ0Tm9kZS5wYXJlbnROb2RlID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy5fX3BlbmRpbmdWYWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgaWYgKHZhbHVlID09PSBub0NoYW5nZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpc1ByaW1pdGl2ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLnZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fY29tbWl0VGV4dCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgVGVtcGxhdGVSZXN1bHQpIHsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdFRlbXBsYXRlUmVzdWx0KHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgTm9kZSkgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0Tm9kZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0l0ZXJhYmxlKHZhbHVlKSkgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0SXRlcmFibGUodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IG5vdGhpbmcpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG5vdGhpbmc7CiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0VGV4dCh2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgX19pbnNlcnQobm9kZSkgewogICAgICAgIHRoaXMuZW5kTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCB0aGlzLmVuZE5vZGUpOwogICAgfQogICAgX19jb21taXROb2RlKHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIHRoaXMuX19pbnNlcnQodmFsdWUpOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIF9fY29tbWl0VGV4dCh2YWx1ZSkgewogICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZS5uZXh0U2libGluZzsKICAgICAgICB2YWx1ZSA9IHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlOwogICAgICAgIGNvbnN0IHZhbHVlQXNTdHJpbmcgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciID8gdmFsdWUgOiBTdHJpbmcodmFsdWUpOwogICAgICAgIGlmIChub2RlID09PSB0aGlzLmVuZE5vZGUucHJldmlvdXNTaWJsaW5nICYmIG5vZGUubm9kZVR5cGUgPT09IDMpIHsKICAgICAgICAgICAgbm9kZS5kYXRhID0gdmFsdWVBc1N0cmluZzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9fY29tbWl0Tm9kZShkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZUFzU3RyaW5nKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIF9fY29tbWl0VGVtcGxhdGVSZXN1bHQodmFsdWUpIHsKICAgICAgICBjb25zdCB0ZW1wbGF0ZTEgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGVGYWN0b3J5KHZhbHVlKTsKICAgICAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIFRlbXBsYXRlSW5zdGFuY2UgJiYgdGhpcy52YWx1ZS50ZW1wbGF0ZSA9PT0gdGVtcGxhdGUxKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUudXBkYXRlKHZhbHVlLnZhbHVlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgVGVtcGxhdGVJbnN0YW5jZSh0ZW1wbGF0ZTEsIHZhbHVlLnByb2Nlc3NvciwgdGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBpbnN0YW5jZS5fY2xvbmUoKTsKICAgICAgICAgICAgaW5zdGFuY2UudXBkYXRlKHZhbHVlLnZhbHVlcyk7CiAgICAgICAgICAgIHRoaXMuX19jb21taXROb2RlKGZyYWdtZW50KTsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGluc3RhbmNlOwogICAgICAgIH0KICAgIH0KICAgIF9fY29tbWl0SXRlcmFibGUodmFsdWUpIHsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IFtdOwogICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGl0ZW1QYXJ0cyA9IHRoaXMudmFsdWU7CiAgICAgICAgbGV0IHBhcnRJbmRleDEgPSAwOwogICAgICAgIGxldCBpdGVtUGFydDsKICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdmFsdWUpewogICAgICAgICAgICBpdGVtUGFydCA9IGl0ZW1QYXJ0c1twYXJ0SW5kZXgxXTsKICAgICAgICAgICAgaWYgKGl0ZW1QYXJ0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIGl0ZW1QYXJ0ID0gbmV3IE5vZGVQYXJ0KHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgICAgICBpdGVtUGFydHMucHVzaChpdGVtUGFydCk7CiAgICAgICAgICAgICAgICBpZiAocGFydEluZGV4MSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGl0ZW1QYXJ0LmFwcGVuZEludG9QYXJ0KHRoaXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpdGVtUGFydC5pbnNlcnRBZnRlclBhcnQoaXRlbVBhcnRzW3BhcnRJbmRleDEgLSAxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXRlbVBhcnQuc2V0VmFsdWUoaXRlbSk7CiAgICAgICAgICAgIGl0ZW1QYXJ0LmNvbW1pdCgpOwogICAgICAgICAgICBwYXJ0SW5kZXgxKys7CiAgICAgICAgfQogICAgICAgIGlmIChwYXJ0SW5kZXgxIDwgaXRlbVBhcnRzLmxlbmd0aCkgewogICAgICAgICAgICBpdGVtUGFydHMubGVuZ3RoID0gcGFydEluZGV4MTsKICAgICAgICAgICAgdGhpcy5jbGVhcihpdGVtUGFydCAmJiBpdGVtUGFydC5lbmROb2RlKTsKICAgICAgICB9CiAgICB9CiAgICBjbGVhcihzdGFydE5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSkgewogICAgICAgIHJlbW92ZU5vZGVzKHRoaXMuc3RhcnROb2RlLnBhcmVudE5vZGUsIHN0YXJ0Tm9kZS5uZXh0U2libGluZywgdGhpcy5lbmROb2RlKTsKICAgIH0KfQpjbGFzcyBCb29sZWFuQXR0cmlidXRlUGFydCB7CiAgICBjb25zdHJ1Y3RvcihlbGVtZW50MiwgbmFtZTEsIHN0cmluZ3MzKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgaWYgKHN0cmluZ3MzLmxlbmd0aCAhPT0gMiB8fCBzdHJpbmdzM1swXSAhPT0gIiIgfHwgc3RyaW5nczNbMV0gIT09ICIiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQm9vbGVhbiBhdHRyaWJ1dGVzIGNhbiBvbmx5IGNvbnRhaW4gYSBzaW5nbGUgZXhwcmVzc2lvbiIpOwogICAgICAgIH0KICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50MjsKICAgICAgICB0aGlzLm5hbWUgPSBuYW1lMTsKICAgICAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzMzsKICAgIH0KICAgIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZhbHVlOwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIHdoaWxlKGlzRGlyZWN0aXZlKHRoaXMuX19wZW5kaW5nVmFsdWUpKXsKICAgICAgICAgICAgY29uc3QgZGlyZWN0aXZlMiA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgICAgICAgICAgZGlyZWN0aXZlMih0aGlzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX19wZW5kaW5nVmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWUgPSAhIXRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgaWYgKHRoaXMudmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSh0aGlzLm5hbWUsICIiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUodGhpcy5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgIH0KfQpjbGFzcyBQcm9wZXJ0eUNvbW1pdHRlciBleHRlbmRzIEF0dHJpYnV0ZUNvbW1pdHRlciB7CiAgICBjb25zdHJ1Y3RvcihlbGVtZW50MywgbmFtZTIsIHN0cmluZ3M0KXsKICAgICAgICBzdXBlcihlbGVtZW50MywgbmFtZTIsIHN0cmluZ3M0KTsKICAgICAgICB0aGlzLnNpbmdsZSA9IHN0cmluZ3M0Lmxlbmd0aCA9PT0gMiAmJiBzdHJpbmdzNFswXSA9PT0gIiIgJiYgc3RyaW5nczRbMV0gPT09ICIiOwogICAgfQogICAgX2NyZWF0ZVBhcnQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9wZXJ0eVBhcnQodGhpcyk7CiAgICB9CiAgICBfZ2V0VmFsdWUoKSB7CiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnRzWzBdLnZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwZXIuX2dldFZhbHVlKCk7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmVsZW1lbnRbdGhpcy5uYW1lXSA9IHRoaXMuX2dldFZhbHVlKCk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIFByb3BlcnR5UGFydCBleHRlbmRzIEF0dHJpYnV0ZVBhcnQgewp9CmxldCBldmVudE9wdGlvbnNTdXBwb3J0ZWQgPSBmYWxzZTsKKCgpPT57CiAgICB0cnkgewogICAgICAgIGNvbnN0IG9wdGlvbnMyID0gewogICAgICAgICAgICBnZXQgY2FwdHVyZSAoKSB7CiAgICAgICAgICAgICAgICBldmVudE9wdGlvbnNTdXBwb3J0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidGVzdCIsIG9wdGlvbnMyLCBvcHRpb25zMik7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInRlc3QiLCBvcHRpb25zMiwgb3B0aW9uczIpOwogICAgfSBjYXRjaCAoX2UpIHsKICAgIH0KfSkoKTsKY2xhc3MgRXZlbnRQYXJ0IHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ0LCBldmVudE5hbWUsIGV2ZW50Q29udGV4dCl7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ0OwogICAgICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lOwogICAgICAgIHRoaXMuZXZlbnRDb250ZXh0ID0gZXZlbnRDb250ZXh0OwogICAgICAgIHRoaXMuX19ib3VuZEhhbmRsZUV2ZW50ID0gKGUpPT50aGlzLmhhbmRsZUV2ZW50KGUpCiAgICAgICAgOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy5fX3BlbmRpbmdWYWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fX3BlbmRpbmdWYWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBuZXdMaXN0ZW5lciA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgY29uc3Qgb2xkTGlzdGVuZXIgPSB0aGlzLnZhbHVlOwogICAgICAgIGNvbnN0IHNob3VsZFJlbW92ZUxpc3RlbmVyID0gbmV3TGlzdGVuZXIgPT0gbnVsbCB8fCBvbGRMaXN0ZW5lciAhPSBudWxsICYmIChuZXdMaXN0ZW5lci5jYXB0dXJlICE9PSBvbGRMaXN0ZW5lci5jYXB0dXJlIHx8IG5ld0xpc3RlbmVyLm9uY2UgIT09IG9sZExpc3RlbmVyLm9uY2UgfHwgbmV3TGlzdGVuZXIucGFzc2l2ZSAhPT0gb2xkTGlzdGVuZXIucGFzc2l2ZSk7CiAgICAgICAgY29uc3Qgc2hvdWxkQWRkTGlzdGVuZXIgPSBuZXdMaXN0ZW5lciAhPSBudWxsICYmIChvbGRMaXN0ZW5lciA9PSBudWxsIHx8IHNob3VsZFJlbW92ZUxpc3RlbmVyKTsKICAgICAgICBpZiAoc2hvdWxkUmVtb3ZlTGlzdGVuZXIpIHsKICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIHRoaXMuX19ib3VuZEhhbmRsZUV2ZW50LCB0aGlzLl9fb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIGlmIChzaG91bGRBZGRMaXN0ZW5lcikgewogICAgICAgICAgICB0aGlzLl9fb3B0aW9ucyA9IGdldE9wdGlvbnMobmV3TGlzdGVuZXIpOwogICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgdGhpcy5fX2JvdW5kSGFuZGxlRXZlbnQsIHRoaXMuX19vcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52YWx1ZSA9IG5ld0xpc3RlbmVyOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgIH0KICAgIGhhbmRsZUV2ZW50KGV2ZW50KSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhbHVlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUuY2FsbCh0aGlzLmV2ZW50Q29udGV4dCB8fCB0aGlzLmVsZW1lbnQsIGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnZhbHVlLmhhbmRsZUV2ZW50KGV2ZW50KTsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgZ2V0T3B0aW9ucyA9IChvKT0+byAmJiAoZXZlbnRPcHRpb25zU3VwcG9ydGVkID8gewogICAgICAgIGNhcHR1cmU6IG8uY2FwdHVyZSwKICAgICAgICBwYXNzaXZlOiBvLnBhc3NpdmUsCiAgICAgICAgb25jZTogby5vbmNlCiAgICB9IDogby5jYXB0dXJlKQo7CmNsYXNzIERlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvciB7CiAgICBoYW5kbGVBdHRyaWJ1dGVFeHByZXNzaW9ucyhlbGVtZW50LCBuYW1lLCBzdHJpbmdzLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZVswXTsKICAgICAgICBpZiAocHJlZml4ID09PSAiLiIpIHsKICAgICAgICAgICAgY29uc3QgY29tbWl0dGVyMiA9IG5ldyBQcm9wZXJ0eUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBzdHJpbmdzKTsKICAgICAgICAgICAgcmV0dXJuIGNvbW1pdHRlcjIucGFydHM7CiAgICAgICAgfQogICAgICAgIGlmIChwcmVmaXggPT09ICJAIikgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgbmV3IEV2ZW50UGFydChlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBvcHRpb25zLmV2ZW50Q29udGV4dCkKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgaWYgKHByZWZpeCA9PT0gIj8iKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBuZXcgQm9vbGVhbkF0dHJpYnV0ZVBhcnQoZWxlbWVudCwgbmFtZS5zbGljZSgxKSwgc3RyaW5ncykKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29tbWl0dGVyMSA9IG5ldyBBdHRyaWJ1dGVDb21taXR0ZXIoZWxlbWVudCwgbmFtZSwgc3RyaW5ncyk7CiAgICAgICAgcmV0dXJuIGNvbW1pdHRlcjEucGFydHM7CiAgICB9CiAgICBoYW5kbGVUZXh0RXhwcmVzc2lvbihvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG5ldyBOb2RlUGFydChvcHRpb25zKTsKICAgIH0KfQpjb25zdCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IgPSBuZXcgRGVmYXVsdFRlbXBsYXRlUHJvY2Vzc29yKCk7CmZ1bmN0aW9uIHRlbXBsYXRlRmFjdG9yeShyZXN1bHQxKSB7CiAgICBsZXQgdGVtcGxhdGVDYWNoZSA9IHRlbXBsYXRlQ2FjaGVzLmdldChyZXN1bHQxLnR5cGUpOwogICAgaWYgKHRlbXBsYXRlQ2FjaGUgPT09IHZvaWQgMCkgewogICAgICAgIHRlbXBsYXRlQ2FjaGUgPSB7CiAgICAgICAgICAgIHN0cmluZ3NBcnJheTogbmV3IFdlYWtNYXAoKSwKICAgICAgICAgICAga2V5U3RyaW5nOiBuZXcgTWFwKCkKICAgICAgICB9OwogICAgICAgIHRlbXBsYXRlQ2FjaGVzLnNldChyZXN1bHQxLnR5cGUsIHRlbXBsYXRlQ2FjaGUpOwogICAgfQogICAgbGV0IHRlbXBsYXRlMSA9IHRlbXBsYXRlQ2FjaGUuc3RyaW5nc0FycmF5LmdldChyZXN1bHQxLnN0cmluZ3MpOwogICAgaWYgKHRlbXBsYXRlMSAhPT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlMTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHJlc3VsdDEuc3RyaW5ncy5qb2luKG1hcmtlcik7CiAgICB0ZW1wbGF0ZTEgPSB0ZW1wbGF0ZUNhY2hlLmtleVN0cmluZy5nZXQoa2V5KTsKICAgIGlmICh0ZW1wbGF0ZTEgPT09IHZvaWQgMCkgewogICAgICAgIHRlbXBsYXRlMSA9IG5ldyBUZW1wbGF0ZShyZXN1bHQxLCByZXN1bHQxLmdldFRlbXBsYXRlRWxlbWVudCgpKTsKICAgICAgICB0ZW1wbGF0ZUNhY2hlLmtleVN0cmluZy5zZXQoa2V5LCB0ZW1wbGF0ZTEpOwogICAgfQogICAgdGVtcGxhdGVDYWNoZS5zdHJpbmdzQXJyYXkuc2V0KHJlc3VsdDEuc3RyaW5ncywgdGVtcGxhdGUxKTsKICAgIHJldHVybiB0ZW1wbGF0ZTE7Cn0KY29uc3QgdGVtcGxhdGVDYWNoZXMgPSBuZXcgTWFwKCk7CmNvbnN0IHBhcnRzID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgcmVuZGVyID0gKHJlc3VsdDEsIGNvbnRhaW5lciwgb3B0aW9uczMpPT57CiAgICBsZXQgcGFydCA9IHBhcnRzLmdldChjb250YWluZXIpOwogICAgaWYgKHBhcnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbW92ZU5vZGVzKGNvbnRhaW5lciwgY29udGFpbmVyLmZpcnN0Q2hpbGQpOwogICAgICAgIHBhcnRzLnNldChjb250YWluZXIsIHBhcnQgPSBuZXcgTm9kZVBhcnQoT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICAgIHRlbXBsYXRlRmFjdG9yeQogICAgICAgIH0sIG9wdGlvbnMzKSkpOwogICAgICAgIHBhcnQuYXBwZW5kSW50byhjb250YWluZXIpOwogICAgfQogICAgcGFydC5zZXRWYWx1ZShyZXN1bHQxKTsKICAgIHBhcnQuY29tbWl0KCk7Cn07CmlmICh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIikgewogICAgKHdpbmRvd1sibGl0SHRtbFZlcnNpb25zIl0gfHwgKHdpbmRvd1sibGl0SHRtbFZlcnNpb25zIl0gPSBbXSkpLnB1c2goIjEuNC4xIik7Cn0KY29uc3QgaHRtbCA9IChzdHJpbmdzNiwgLi4udmFsdWVzMSk9Pm5ldyBUZW1wbGF0ZVJlc3VsdChzdHJpbmdzNiwgdmFsdWVzMSwgImh0bWwiLCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IpCjsKY29uc3Qgc3ZnID0gKHN0cmluZ3M2LCAuLi52YWx1ZXMxKT0+bmV3IFNWR1RlbXBsYXRlUmVzdWx0KHN0cmluZ3M2LCB2YWx1ZXMxLCAic3ZnIiwgZGVmYXVsdFRlbXBsYXRlUHJvY2Vzc29yKQo7CnZhciBfYTsKd2luZG93LkpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkgPSAocHJvcCwgX29iaik9PnByb3AKOwpjb25zdCBkZWZhdWx0Q29udmVydGVyID0gewogICAgdG9BdHRyaWJ1dGUgKHZhbHVlLCB0eXBlKSB7CiAgICAgICAgc3dpdGNoKHR5cGUpewogICAgICAgICAgICBjYXNlIEJvb2xlYW46CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPyAiIiA6IG51bGw7CiAgICAgICAgICAgIGNhc2UgT2JqZWN0OgogICAgICAgICAgICBjYXNlIEFycmF5OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSwKICAgIGZyb21BdHRyaWJ1dGUgKHZhbHVlLCB0eXBlKSB7CiAgICAgICAgc3dpdGNoKHR5cGUpewogICAgICAgICAgICBjYXNlIEJvb2xlYW46CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgIT09IG51bGw7CiAgICAgICAgICAgIGNhc2UgTnVtYmVyOgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsID8gbnVsbCA6IE51bWJlcih2YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgT2JqZWN0OgogICAgICAgICAgICBjYXNlIEFycmF5OgogICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9Cn07CmNvbnN0IG5vdEVxdWFsID0gKHZhbHVlLCBvbGQpPT57CiAgICByZXR1cm4gb2xkICE9PSB2YWx1ZSAmJiAob2xkID09PSBvbGQgfHwgdmFsdWUgPT09IHZhbHVlKTsKfTsKY29uc3QgZGVmYXVsdFByb3BlcnR5RGVjbGFyYXRpb24gPSB7CiAgICBhdHRyaWJ1dGU6IHRydWUsCiAgICB0eXBlOiBTdHJpbmcsCiAgICBjb252ZXJ0ZXI6IGRlZmF1bHRDb252ZXJ0ZXIsCiAgICByZWZsZWN0OiBmYWxzZSwKICAgIGhhc0NoYW5nZWQ6IG5vdEVxdWFsCn07CmNvbnN0IFNUQVRFX0hBU19VUERBVEVEID0gMTsKY29uc3QgU1RBVEVfVVBEQVRFX1JFUVVFU1RFRCA9IDEgPDwgMjsKY29uc3QgU1RBVEVfSVNfUkVGTEVDVElOR19UT19BVFRSSUJVVEUgPSAxIDw8IDM7CmNvbnN0IFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFkgPSAxIDw8IDQ7CmNvbnN0IGZpbmFsaXplZCA9ICJmaW5hbGl6ZWQiOwpjbGFzcyBVcGRhdGluZ0VsZW1lbnQgZXh0ZW5kcyBIVE1MRWxlbWVudCB7CiAgICBjb25zdHJ1Y3RvcigpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7CiAgICB9CiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHsKICAgICAgICB0aGlzLmZpbmFsaXplKCk7CiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IFtdOwogICAgICAgIHRoaXMuX2NsYXNzUHJvcGVydGllcy5mb3JFYWNoKCh2LCBwKT0+ewogICAgICAgICAgICBjb25zdCBhdHRyID0gdGhpcy5fYXR0cmlidXRlTmFtZUZvclByb3BlcnR5KHAsIHYpOwogICAgICAgICAgICBpZiAoYXR0ciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9hdHRyaWJ1dGVUb1Byb3BlcnR5TWFwLnNldChhdHRyLCBwKTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaChhdHRyKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgfQogICAgc3RhdGljIF9lbnN1cmVDbGFzc1Byb3BlcnRpZXMoKSB7CiAgICAgICAgaWYgKCF0aGlzLmhhc093blByb3BlcnR5KEpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkoIl9jbGFzc1Byb3BlcnRpZXMiLCB0aGlzKSkpIHsKICAgICAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICBjb25zdCBzdXBlclByb3BlcnRpZXMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2NsYXNzUHJvcGVydGllczsKICAgICAgICAgICAgaWYgKHN1cGVyUHJvcGVydGllcyAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBzdXBlclByb3BlcnRpZXMuZm9yRWFjaCgodiwgayk9PnRoaXMuX2NsYXNzUHJvcGVydGllcy5zZXQoaywgdikKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgY3JlYXRlUHJvcGVydHkobmFtZSwgb3B0aW9ucyA9IGRlZmF1bHRQcm9wZXJ0eURlY2xhcmF0aW9uKSB7CiAgICAgICAgdGhpcy5fZW5zdXJlQ2xhc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLnNldChuYW1lLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy5ub0FjY2Vzc29yIHx8IHRoaXMucHJvdG90eXBlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3Qga2V5ID0gdHlwZW9mIG5hbWUgPT09ICJzeW1ib2wiID8gU3ltYm9sKCkgOiBgX18ke25hbWV9YDsKICAgICAgICBjb25zdCBkZXNjcmlwdG9yID0gdGhpcy5nZXRQcm9wZXJ0eURlc2NyaXB0b3IobmFtZSwga2V5LCBvcHRpb25zKTsKICAgICAgICBpZiAoZGVzY3JpcHRvciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnByb3RvdHlwZSwgbmFtZSwgZGVzY3JpcHRvcik7CiAgICAgICAgfQogICAgfQogICAgc3RhdGljIGdldFByb3BlcnR5RGVzY3JpcHRvcihuYW1lLCBrZXksIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXQgKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNba2V5XTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0ICh2YWx1ZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzW25hbWVdOwogICAgICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGVJbnRlcm5hbChuYW1lLCBvbGRWYWx1ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgICAgIH07CiAgICB9CiAgICBzdGF0aWMgZ2V0UHJvcGVydHlPcHRpb25zKG5hbWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2xhc3NQcm9wZXJ0aWVzICYmIHRoaXMuX2NsYXNzUHJvcGVydGllcy5nZXQobmFtZSkgfHwgZGVmYXVsdFByb3BlcnR5RGVjbGFyYXRpb247CiAgICB9CiAgICBzdGF0aWMgZmluYWxpemUoKSB7CiAgICAgICAgY29uc3Qgc3VwZXJDdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpOwogICAgICAgIGlmICghc3VwZXJDdG9yLmhhc093blByb3BlcnR5KGZpbmFsaXplZCkpIHsKICAgICAgICAgICAgc3VwZXJDdG9yLmZpbmFsaXplKCk7CiAgICAgICAgfQogICAgICAgIHRoaXNbZmluYWxpemVkXSA9IHRydWU7CiAgICAgICAgdGhpcy5fZW5zdXJlQ2xhc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgdGhpcy5fYXR0cmlidXRlVG9Qcm9wZXJ0eU1hcCA9IG5ldyBNYXAoKTsKICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShKU0NvbXBpbGVyX3JlbmFtZVByb3BlcnR5KCJwcm9wZXJ0aWVzIiwgdGhpcykpKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgICAgICAgICBjb25zdCBwcm9wS2V5cyA9IFsKICAgICAgICAgICAgICAgIC4uLk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHByb3BzKSwKICAgICAgICAgICAgICAgIC4uLnR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhwcm9wcykgOiBbXQogICAgICAgICAgICBdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgcHJvcEtleXMpewogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVQcm9wZXJ0eShwLCBwcm9wc1twXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgX2F0dHJpYnV0ZU5hbWVGb3JQcm9wZXJ0eShuYW1lLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgYXR0cmlidXRlID0gb3B0aW9ucy5hdHRyaWJ1dGU7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZSA9PT0gZmFsc2UgPyB2b2lkIDAgOiB0eXBlb2YgYXR0cmlidXRlID09PSAic3RyaW5nIiA/IGF0dHJpYnV0ZSA6IHR5cGVvZiBuYW1lID09PSAic3RyaW5nIiA/IG5hbWUudG9Mb3dlckNhc2UoKSA6IHZvaWQgMDsKICAgIH0KICAgIHN0YXRpYyBfdmFsdWVIYXNDaGFuZ2VkKHZhbHVlLCBvbGQsIGhhc0NoYW5nZWQgPSBub3RFcXVhbCkgewogICAgICAgIHJldHVybiBoYXNDaGFuZ2VkKHZhbHVlLCBvbGQpOwogICAgfQogICAgc3RhdGljIF9wcm9wZXJ0eVZhbHVlRnJvbUF0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGNvbnN0IHR5cGUyID0gb3B0aW9ucy50eXBlOwogICAgICAgIGNvbnN0IGNvbnZlcnRlciA9IG9wdGlvbnMuY29udmVydGVyIHx8IGRlZmF1bHRDb252ZXJ0ZXI7CiAgICAgICAgY29uc3QgZnJvbUF0dHJpYnV0ZSA9IHR5cGVvZiBjb252ZXJ0ZXIgPT09ICJmdW5jdGlvbiIgPyBjb252ZXJ0ZXIgOiBjb252ZXJ0ZXIuZnJvbUF0dHJpYnV0ZTsKICAgICAgICByZXR1cm4gZnJvbUF0dHJpYnV0ZSA/IGZyb21BdHRyaWJ1dGUodmFsdWUsIHR5cGUyKSA6IHZhbHVlOwogICAgfQogICAgc3RhdGljIF9wcm9wZXJ0eVZhbHVlVG9BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucy5yZWZsZWN0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB0eXBlMiA9IG9wdGlvbnMudHlwZTsKICAgICAgICBjb25zdCBjb252ZXJ0ZXIgPSBvcHRpb25zLmNvbnZlcnRlcjsKICAgICAgICBjb25zdCB0b0F0dHJpYnV0ZSA9IGNvbnZlcnRlciAmJiBjb252ZXJ0ZXIudG9BdHRyaWJ1dGUgfHwgZGVmYXVsdENvbnZlcnRlci50b0F0dHJpYnV0ZTsKICAgICAgICByZXR1cm4gdG9BdHRyaWJ1dGUodmFsdWUsIHR5cGUyKTsKICAgIH0KICAgIGluaXRpYWxpemUoKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSAwOwogICAgICAgIHRoaXMuX3VwZGF0ZVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzKT0+dGhpcy5fZW5hYmxlVXBkYXRpbmdSZXNvbHZlciA9IHJlcwogICAgICAgICk7CiAgICAgICAgdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5fc2F2ZUluc3RhbmNlUHJvcGVydGllcygpOwogICAgICAgIHRoaXMucmVxdWVzdFVwZGF0ZUludGVybmFsKCk7CiAgICB9CiAgICBfc2F2ZUluc3RhbmNlUHJvcGVydGllcygpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLl9jbGFzc1Byb3BlcnRpZXMuZm9yRWFjaCgoX3YsIHApPT57CiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KHApKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbcF07CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpc1twXTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzLnNldChwLCB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIF9hcHBseUluc3RhbmNlUHJvcGVydGllcygpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMuZm9yRWFjaCgodiwgcCk9PnRoaXNbcF0gPSB2CiAgICAgICAgKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMgPSB2b2lkIDA7CiAgICB9CiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHsKICAgICAgICB0aGlzLmVuYWJsZVVwZGF0aW5nKCk7CiAgICB9CiAgICBlbmFibGVVcGRhdGluZygpIHsKICAgICAgICBpZiAodGhpcy5fZW5hYmxlVXBkYXRpbmdSZXNvbHZlciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZVVwZGF0aW5nUmVzb2x2ZXIoKTsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlVXBkYXRpbmdSZXNvbHZlciA9IHZvaWQgMDsKICAgICAgICB9CiAgICB9CiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHsKICAgIH0KICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhuYW1lLCBvbGQsIHZhbHVlKSB7CiAgICAgICAgaWYgKG9sZCAhPT0gdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlVG9Qcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgX3Byb3BlcnR5VG9BdHRyaWJ1dGUobmFtZSwgdmFsdWUsIG9wdGlvbnMgPSBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbikgewogICAgICAgIGNvbnN0IGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yOwogICAgICAgIGNvbnN0IGF0dHIgPSBjdG9yLl9hdHRyaWJ1dGVOYW1lRm9yUHJvcGVydHkobmFtZSwgb3B0aW9ucyk7CiAgICAgICAgaWYgKGF0dHIgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBhdHRyVmFsdWUgPSBjdG9yLl9wcm9wZXJ0eVZhbHVlVG9BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoYXR0clZhbHVlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfSVNfUkVGTEVDVElOR19UT19BVFRSSUJVVEU7CiAgICAgICAgICAgIGlmIChhdHRyVmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoYXR0cik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShhdHRyLCBhdHRyVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgJiB+U1RBVEVfSVNfUkVGTEVDVElOR19UT19BVFRSSUJVVEU7CiAgICAgICAgfQogICAgfQogICAgX2F0dHJpYnV0ZVRvUHJvcGVydHkobmFtZSwgdmFsdWUpIHsKICAgICAgICBpZiAodGhpcy5fdXBkYXRlU3RhdGUgJiBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yOwogICAgICAgIGNvbnN0IHByb3BOYW1lID0gY3Rvci5fYXR0cmlidXRlVG9Qcm9wZXJ0eU1hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKHByb3BOYW1lICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgY29uc3Qgb3B0aW9uczMgPSBjdG9yLmdldFByb3BlcnR5T3B0aW9ucyhwcm9wTmFtZSk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX1BST1BFUlRZOwogICAgICAgICAgICB0aGlzW3Byb3BOYW1lXSA9IGN0b3IuX3Byb3BlcnR5VmFsdWVGcm9tQXR0cmlidXRlKHZhbHVlLCBvcHRpb25zMyk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgJiB+U1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWTsKICAgICAgICB9CiAgICB9CiAgICByZXF1ZXN0VXBkYXRlSW50ZXJuYWwobmFtZSwgb2xkVmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBsZXQgc2hvdWxkUmVxdWVzdFVwZGF0ZSA9IHRydWU7CiAgICAgICAgaWYgKG5hbWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgY3Rvci5nZXRQcm9wZXJ0eU9wdGlvbnMobmFtZSk7CiAgICAgICAgICAgIGlmIChjdG9yLl92YWx1ZUhhc0NoYW5nZWQodGhpc1tuYW1lXSwgb2xkVmFsdWUsIG9wdGlvbnMuaGFzQ2hhbmdlZCkpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMuc2V0KG5hbWUsIG9sZFZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnJlZmxlY3QgPT09IHRydWUgJiYgISh0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzLnNldChuYW1lLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3VsZFJlcXVlc3RVcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZSAmJiBzaG91bGRSZXF1ZXN0VXBkYXRlKSB7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVByb21pc2UgPSB0aGlzLl9lbnF1ZXVlVXBkYXRlKCk7CiAgICAgICAgfQogICAgfQogICAgcmVxdWVzdFVwZGF0ZShuYW1lLCBvbGRWYWx1ZSkgewogICAgICAgIHRoaXMucmVxdWVzdFVwZGF0ZUludGVybmFsKG5hbWUsIG9sZFZhbHVlKTsKICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVDb21wbGV0ZTsKICAgIH0KICAgIGFzeW5jIF9lbnF1ZXVlVXBkYXRlKCkgewogICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9VUERBVEVfUkVRVUVTVEVEOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZVByb21pc2U7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIH0KICAgICAgICBjb25zdCByZXN1bHQxID0gdGhpcy5wZXJmb3JtVXBkYXRlKCk7CiAgICAgICAgaWYgKHJlc3VsdDEgIT0gbnVsbCkgewogICAgICAgICAgICBhd2FpdCByZXN1bHQxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZTsKICAgIH0KICAgIGdldCBfaGFzUmVxdWVzdGVkVXBkYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX1VQREFURV9SRVFVRVNURUQ7CiAgICB9CiAgICBnZXQgaGFzVXBkYXRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlU3RhdGUgJiAxOwogICAgfQogICAgcGVyZm9ybVVwZGF0ZSgpIHsKICAgICAgICBpZiAoIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdGhpcy5fYXBwbHlJbnN0YW5jZVByb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgICAgbGV0IHNob3VsZFVwZGF0ZSA9IGZhbHNlOwogICAgICAgIGNvbnN0IGNoYW5nZWRQcm9wZXJ0aWVzID0gdGhpcy5fY2hhbmdlZFByb3BlcnRpZXM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gdGhpcy5zaG91bGRVcGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZShjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tYXJrVXBkYXRlZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBzaG91bGRVcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSkgewogICAgICAgICAgICBpZiAoISh0aGlzLl91cGRhdGVTdGF0ZSAmIDEpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfSEFTX1VQREFURUQ7CiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0VXBkYXRlZChjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy51cGRhdGVkKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICB9CiAgICB9CiAgICBfbWFya1VwZGF0ZWQoKSB7CiAgICAgICAgdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSAmIH5TVEFURV9VUERBVEVfUkVRVUVTVEVEOwogICAgfQogICAgZ2V0IHVwZGF0ZUNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRVcGRhdGVDb21wbGV0ZSgpOwogICAgfQogICAgX2dldFVwZGF0ZUNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldFVwZGF0ZUNvbXBsZXRlKCk7CiAgICB9CiAgICBnZXRVcGRhdGVDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlUHJvbWlzZTsKICAgIH0KICAgIHNob3VsZFVwZGF0ZShfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHVwZGF0ZShfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICBpZiAodGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMgIT09IHZvaWQgMCAmJiB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcy5zaXplID4gMCkgewogICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcy5mb3JFYWNoKCh2LCBrKT0+dGhpcy5fcHJvcGVydHlUb0F0dHJpYnV0ZShrLCB0aGlzW2tdLCB2KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyA9IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgIH0KICAgIHVwZGF0ZWQoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7CiAgICB9CiAgICBmaXJzdFVwZGF0ZWQoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7CiAgICB9Cn0KX2EgPSBmaW5hbGl6ZWQ7ClVwZGF0aW5nRWxlbWVudFtfYV0gPSB0cnVlOwpjb25zdCBsZWdhY3lDdXN0b21FbGVtZW50ID0gKHRhZ05hbWUsIGNsYXp6KT0+ewogICAgd2luZG93LmN1c3RvbUVsZW1lbnRzLmRlZmluZSh0YWdOYW1lLCBjbGF6eik7CiAgICByZXR1cm4gY2xheno7Cn07CmNvbnN0IHN0YW5kYXJkQ3VzdG9tRWxlbWVudCA9ICh0YWdOYW1lLCBkZXNjcmlwdG9yKT0+ewogICAgY29uc3QgeyBraW5kICwgZWxlbWVudHMgIH0gPSBkZXNjcmlwdG9yOwogICAgcmV0dXJuIHsKICAgICAgICBraW5kLAogICAgICAgIGVsZW1lbnRzLAogICAgICAgIGZpbmlzaGVyIChjbGF6eikgewogICAgICAgICAgICB3aW5kb3cuY3VzdG9tRWxlbWVudHMuZGVmaW5lKHRhZ05hbWUsIGNsYXp6KTsKICAgICAgICB9CiAgICB9Owp9Owpjb25zdCBzdGFuZGFyZFByb3BlcnR5ID0gKG9wdGlvbnMzLCBlbGVtZW50Nik9PnsKICAgIGlmIChlbGVtZW50Ni5raW5kID09PSAibWV0aG9kIiAmJiBlbGVtZW50Ni5kZXNjcmlwdG9yICYmICEoInZhbHVlIiBpbiBlbGVtZW50Ni5kZXNjcmlwdG9yKSkgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oewogICAgICAgIH0sIGVsZW1lbnQ2KSwgewogICAgICAgICAgICBmaW5pc2hlciAoY2xhenopIHsKICAgICAgICAgICAgICAgIGNsYXp6LmNyZWF0ZVByb3BlcnR5KGVsZW1lbnQ2LmtleSwgb3B0aW9uczMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGtpbmQ6ICJmaWVsZCIsCiAgICAgICAgICAgIGtleTogU3ltYm9sKCksCiAgICAgICAgICAgIHBsYWNlbWVudDogIm93biIsCiAgICAgICAgICAgIGRlc2NyaXB0b3I6IHsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5pdGlhbGl6ZXIgKCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50Ni5pbml0aWFsaXplciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgIHRoaXNbZWxlbWVudDYua2V5XSA9IGVsZW1lbnQ2LmluaXRpYWxpemVyLmNhbGwodGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpbmlzaGVyIChjbGF6eikgewogICAgICAgICAgICAgICAgY2xhenouY3JlYXRlUHJvcGVydHkoZWxlbWVudDYua2V5LCBvcHRpb25zMyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQp9Owpjb25zdCBsZWdhY3lQcm9wZXJ0eSA9IChvcHRpb25zMywgcHJvdG8sIG5hbWU0KT0+ewogICAgcHJvdG8uY29uc3RydWN0b3IuY3JlYXRlUHJvcGVydHkobmFtZTQsIG9wdGlvbnMzKTsKfTsKY29uc3QgbGVnYWN5UXVlcnkgPSAoZGVzY3JpcHRvciwgcHJvdG8sIG5hbWU0KT0+ewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvLCBuYW1lNCwgZGVzY3JpcHRvcik7Cn07CmNvbnN0IHN0YW5kYXJkRXZlbnRPcHRpb25zID0gKG9wdGlvbnMzLCBlbGVtZW50Nik9PnsKICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oewogICAgfSwgZWxlbWVudDYpLCB7CiAgICAgICAgZmluaXNoZXIgKGNsYXp6KSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY2xhenoucHJvdG90eXBlW2VsZW1lbnQ2LmtleV0sIG9wdGlvbnMzKTsKICAgICAgICB9CiAgICB9KTsKfTsKY29uc3QgbGVnYWN5RXZlbnRPcHRpb25zID0gKG9wdGlvbnMzLCBwcm90bywgbmFtZTQpPT57CiAgICBPYmplY3QuYXNzaWduKHByb3RvW25hbWU0XSwgb3B0aW9uczMpOwp9Owpjb25zdCBzdXBwb3J0c0Fkb3B0aW5nU3R5bGVTaGVldHMgPSB3aW5kb3cuU2hhZG93Um9vdCAmJiAod2luZG93LlNoYWR5Q1NTID09PSB2b2lkIDAgfHwgd2luZG93LlNoYWR5Q1NTLm5hdGl2ZVNoYWRvdykgJiYgImFkb3B0ZWRTdHlsZVNoZWV0cyIgaW4gRG9jdW1lbnQucHJvdG90eXBlICYmICJyZXBsYWNlIiBpbiBDU1NTdHlsZVNoZWV0LnByb3RvdHlwZTsKY29uc3QgY29uc3RydWN0aW9uVG9rZW4gPSBTeW1ib2woKTsKY2xhc3MgQ1NTUmVzdWx0IHsKICAgIGNvbnN0cnVjdG9yKGNzc1RleHQsIHNhZmVUb2tlbil7CiAgICAgICAgaWYgKHNhZmVUb2tlbiAhPT0gY29uc3RydWN0aW9uVG9rZW4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDU1NSZXN1bHQgaXMgbm90IGNvbnN0cnVjdGFibGUuIFVzZSBgdW5zYWZlQ1NTYCBvciBgY3NzYCBpbnN0ZWFkLiIpOwogICAgICAgIH0KICAgICAgICB0aGlzLmNzc1RleHQgPSBjc3NUZXh0OwogICAgfQogICAgZ2V0IHN0eWxlU2hlZXQoKSB7CiAgICAgICAgaWYgKHRoaXMuX3N0eWxlU2hlZXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICBpZiAoc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zdHlsZVNoZWV0ID0gbmV3IENTU1N0eWxlU2hlZXQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3N0eWxlU2hlZXQucmVwbGFjZVN5bmModGhpcy5jc3NUZXh0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3N0eWxlU2hlZXQgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9zdHlsZVNoZWV0OwogICAgfQogICAgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3NzVGV4dDsKICAgIH0KfQpjb25zdCB1bnNhZmVDU1MgPSAodmFsdWUpPT57CiAgICByZXR1cm4gbmV3IENTU1Jlc3VsdChTdHJpbmcodmFsdWUpLCBjb25zdHJ1Y3Rpb25Ub2tlbik7Cn07CmNvbnN0IHRleHRGcm9tQ1NTUmVzdWx0ID0gKHZhbHVlKT0+ewogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQ1NTUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIHZhbHVlLmNzc1RleHQ7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgVmFsdWUgcGFzc2VkIHRvICdjc3MnIGZ1bmN0aW9uIG11c3QgYmUgYSAnY3NzJyBmdW5jdGlvbiByZXN1bHQ6ICR7dmFsdWV9LiBVc2UgJ3Vuc2FmZUNTUycgdG8gcGFzcyBub24tbGl0ZXJhbCB2YWx1ZXMsIGJ1dAogICAgICAgICAgICB0YWtlIGNhcmUgdG8gZW5zdXJlIHBhZ2Ugc2VjdXJpdHkuYCk7CiAgICB9Cn07CmNvbnN0IGNzcyA9IChzdHJpbmdzNiwgLi4udmFsdWVzMSk9PnsKICAgIGNvbnN0IGNzc1RleHQxID0gdmFsdWVzMS5yZWR1Y2UoKGFjYywgdiwgaWR4KT0+YWNjICsgdGV4dEZyb21DU1NSZXN1bHQodikgKyBzdHJpbmdzNltpZHggKyAxXQogICAgLCBzdHJpbmdzNlswXSk7CiAgICByZXR1cm4gbmV3IENTU1Jlc3VsdChjc3NUZXh0MSwgY29uc3RydWN0aW9uVG9rZW4pOwp9Owood2luZG93WyJsaXRFbGVtZW50VmVyc2lvbnMiXSB8fCAod2luZG93WyJsaXRFbGVtZW50VmVyc2lvbnMiXSA9IFtdKSkucHVzaCgiMi41LjEiKTsKY29uc3QgcmVuZGVyTm90SW1wbGVtZW50ZWQgPSB7Cn07CmNsYXNzIExpdEVsZW1lbnQgZXh0ZW5kcyBVcGRhdGluZ0VsZW1lbnQgewogICAgc3RhdGljIGdldFN0eWxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHlsZXM7CiAgICB9CiAgICBzdGF0aWMgX2dldFVuaXF1ZVN0eWxlcygpIHsKICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShKU0NvbXBpbGVyX3JlbmFtZVByb3BlcnR5KCJfc3R5bGVzIiwgdGhpcykpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdXNlclN0eWxlcyA9IHRoaXMuZ2V0U3R5bGVzKCk7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlclN0eWxlcykpIHsKICAgICAgICAgICAgY29uc3QgYWRkU3R5bGVzID0gKHN0eWxlczIsIHNldDIpPT5zdHlsZXMyLnJlZHVjZVJpZ2h0KChzZXQzLCBzKT0+QXJyYXkuaXNBcnJheShzKSA/IGFkZFN0eWxlcyhzLCBzZXQzKSA6IChzZXQzLmFkZChzKSwgc2V0MykKICAgICAgICAgICAgICAgICwgc2V0MikKICAgICAgICAgICAgOwogICAgICAgICAgICBjb25zdCBzZXQgPSBhZGRTdHlsZXModXNlclN0eWxlcywgbmV3IFNldCgpKTsKICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0gW107CiAgICAgICAgICAgIHNldC5mb3JFYWNoKCh2KT0+c3R5bGVzLnVuc2hpZnQodikKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5fc3R5bGVzID0gc3R5bGVzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3N0eWxlcyA9IHVzZXJTdHlsZXMgPT09IHZvaWQgMCA/IFtdIDogWwogICAgICAgICAgICAgICAgdXNlclN0eWxlcwogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICB0aGlzLl9zdHlsZXMgPSB0aGlzLl9zdHlsZXMubWFwKChzKT0+ewogICAgICAgICAgICBpZiAocyBpbnN0YW5jZW9mIENTU1N0eWxlU2hlZXQgJiYgIXN1cHBvcnRzQWRvcHRpbmdTdHlsZVNoZWV0cykgewogICAgICAgICAgICAgICAgY29uc3QgY3NzVGV4dDEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChzLmNzc1J1bGVzKS5yZWR1Y2UoKGNzczIsIHJ1bGUpPT5jc3MyICsgcnVsZS5jc3NUZXh0CiAgICAgICAgICAgICAgICAsICIiKTsKICAgICAgICAgICAgICAgIHJldHVybiB1bnNhZmVDU1MoY3NzVGV4dDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0pOwogICAgfQogICAgaW5pdGlhbGl6ZSgpIHsKICAgICAgICBzdXBlci5pbml0aWFsaXplKCk7CiAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5fZ2V0VW5pcXVlU3R5bGVzKCk7CiAgICAgICAgdGhpcy5yZW5kZXJSb290ID0gdGhpcy5jcmVhdGVSZW5kZXJSb290KCk7CiAgICAgICAgaWYgKHdpbmRvdy5TaGFkb3dSb290ICYmIHRoaXMucmVuZGVyUm9vdCBpbnN0YW5jZW9mIHdpbmRvdy5TaGFkb3dSb290KSB7CiAgICAgICAgICAgIHRoaXMuYWRvcHRTdHlsZXMoKTsKICAgICAgICB9CiAgICB9CiAgICBjcmVhdGVSZW5kZXJSb290KCkgewogICAgICAgIHJldHVybiB0aGlzLmF0dGFjaFNoYWRvdyh0aGlzLmNvbnN0cnVjdG9yLnNoYWRvd1Jvb3RPcHRpb25zKTsKICAgIH0KICAgIGFkb3B0U3R5bGVzKCkgewogICAgICAgIGNvbnN0IHN0eWxlcyA9IHRoaXMuY29uc3RydWN0b3IuX3N0eWxlczsKICAgICAgICBpZiAoc3R5bGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh3aW5kb3cuU2hhZHlDU1MgIT09IHZvaWQgMCAmJiAhd2luZG93LlNoYWR5Q1NTLm5hdGl2ZVNoYWRvdykgewogICAgICAgICAgICB3aW5kb3cuU2hhZHlDU1MuU2NvcGluZ1NoaW0ucHJlcGFyZUFkb3B0ZWRDc3NUZXh0KHN0eWxlcy5tYXAoKHMpPT5zLmNzc1RleHQKICAgICAgICAgICAgKSwgdGhpcy5sb2NhbE5hbWUpOwogICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgIHRoaXMucmVuZGVyUm9vdC5hZG9wdGVkU3R5bGVTaGVldHMgPSBzdHlsZXMubWFwKChzKT0+cyBpbnN0YW5jZW9mIENTU1N0eWxlU2hlZXQgPyBzIDogcy5zdHlsZVNoZWV0CiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fbmVlZHNTaGltQWRvcHRlZFN0eWxlU2hlZXRzID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHsKICAgICAgICBzdXBlci5jb25uZWN0ZWRDYWxsYmFjaygpOwogICAgICAgIGlmICh0aGlzLmhhc1VwZGF0ZWQgJiYgd2luZG93LlNoYWR5Q1NTICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgd2luZG93LlNoYWR5Q1NTLnN0eWxlRWxlbWVudCh0aGlzKTsKICAgICAgICB9CiAgICB9CiAgICB1cGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICBjb25zdCB0ZW1wbGF0ZVJlc3VsdCA9IHRoaXMucmVuZGVyKCk7CiAgICAgICAgc3VwZXIudXBkYXRlKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICBpZiAodGVtcGxhdGVSZXN1bHQgIT09IHJlbmRlck5vdEltcGxlbWVudGVkKSB7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IucmVuZGVyKHRlbXBsYXRlUmVzdWx0LCB0aGlzLnJlbmRlclJvb3QsIHsKICAgICAgICAgICAgICAgIHNjb3BlTmFtZTogdGhpcy5sb2NhbE5hbWUsCiAgICAgICAgICAgICAgICBldmVudENvbnRleHQ6IHRoaXMKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMpIHsKICAgICAgICAgICAgdGhpcy5fbmVlZHNTaGltQWRvcHRlZFN0eWxlU2hlZXRzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IuX3N0eWxlcy5mb3JFYWNoKChzKT0+ewogICAgICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgICAgICAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBzLmNzc1RleHQ7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclJvb3QuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICByZW5kZXIoKSB7CiAgICAgICAgcmV0dXJuIHJlbmRlck5vdEltcGxlbWVudGVkOwogICAgfQp9CkxpdEVsZW1lbnRbImZpbmFsaXplZCJdID0gdHJ1ZTsKTGl0RWxlbWVudC5yZW5kZXIgPSByZW5kZXI7CkxpdEVsZW1lbnQuc2hhZG93Um9vdE9wdGlvbnMgPSB7CiAgICBtb2RlOiAib3BlbiIKfTsKYXN5bmMgZnVuY3Rpb24gbGlzdFNjcmlwdHMoYWNjb3VudElkLCBhcGlUb2tlbikgewogICAgY29uc3QgdXJsID0gYCR7Y29tcHV0ZUFjY291bnRCYXNlVXJsKGFjY291bnRJZCl9L3dvcmtlcnMvc2NyaXB0c2A7CiAgICByZXR1cm4gKGF3YWl0IGV4ZWN1dGUoJ2xpc3RTY3JpcHRzJywgJ0dFVCcsIHVybCwgYXBpVG9rZW4pKS5yZXN1bHQ7Cn0KYXN5bmMgZnVuY3Rpb24gbGlzdFRhaWxzKGFjY291bnRJZCwgc2NyaXB0TmFtZSwgYXBpVG9rZW4pIHsKICAgIGNvbnN0IHVybCA9IGAke2NvbXB1dGVBY2NvdW50QmFzZVVybChhY2NvdW50SWQpfS93b3JrZXJzL3NjcmlwdHMvJHtzY3JpcHROYW1lfS90YWlsc2A7CiAgICByZXR1cm4gKGF3YWl0IGV4ZWN1dGUoJ2xpc3RUYWlscycsICdHRVQnLCB1cmwsIGFwaVRva2VuKSkucmVzdWx0Owp9CmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhaWwoYWNjb3VudElkLCBzY3JpcHROYW1lLCBhcGlUb2tlbikgewogICAgY29uc3QgdXJsID0gYCR7Y29tcHV0ZUFjY291bnRCYXNlVXJsKGFjY291bnRJZCl9L3dvcmtlcnMvc2NyaXB0cy8ke3NjcmlwdE5hbWV9L3RhaWxzYDsKICAgIHJldHVybiAoYXdhaXQgZXhlY3V0ZSgnY3JlYXRlVGFpbCcsICdQT1NUJywgdXJsLCBhcGlUb2tlbikpLnJlc3VsdDsKfQpjbGFzcyBDbG91ZGZsYXJlQXBpMSB7CiAgICBzdGF0aWMgREVCVUcgPSBmYWxzZTsKICAgIHN0YXRpYyBVUkxfVFJBTlNGT1JNRVIgPSAodik9PnYKICAgIDsKfQpjb25zdCBBUFBMSUNBVElPTl9KU09OID0gJ2FwcGxpY2F0aW9uL2pzb24nOwpjb25zdCBBUFBMSUNBVElPTl9KU09OX1VURjggPSAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCc7CmNvbnN0IEFQUExJQ0FUSU9OX09DVEVUX1NUUkVBTSA9ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwpmdW5jdGlvbiBjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKSB7CiAgICByZXR1cm4gQ2xvdWRmbGFyZUFwaTEuVVJMX1RSQU5TRk9STUVSKGBodHRwczovL2FwaS5jbG91ZGZsYXJlLmNvbS9jbGllbnQvdjQvYWNjb3VudHMvJHthY2NvdW50SWR9YCk7Cn0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZShvcCwgbWV0aG9kLCB1cmwsIGFwaVRva2VuLCBib2R5LCByZXNwb25zZVR5cGUgPSAnanNvbicpIHsKICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycyh7CiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YXBpVG9rZW59YAogICAgfSk7CiAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaGVhZGVycy5zZXQoJ0NvbnRlbnQtVHlwZScsIEFQUExJQ0FUSU9OX0pTT05fVVRGOCk7CiAgICAgICAgaWYgKENsb3VkZmxhcmVBcGkxLkRFQlVHKSBjb25zb2xlLmxvZyhib2R5KTsKICAgIH0KICAgIGNvbnN0IGZldGNoUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2QsCiAgICAgICAgaGVhZGVycywKICAgICAgICBib2R5CiAgICB9KTsKICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gZmV0Y2hSZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgfHwgJyc7CiAgICBpZiAoKHJlc3BvbnNlVHlwZSA9PT0gJ2J5dGVzJyB8fCByZXNwb25zZVR5cGUgPT09ICdieXRlcz8nKSAmJiBjb250ZW50VHlwZSA9PT0gQVBQTElDQVRJT05fT0NURVRfU1RSRUFNKSB7CiAgICAgICAgY29uc3QgYnVmZmVyID0gYXdhaXQgZmV0Y2hSZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShidWZmZXIpOwogICAgfQogICAgaWYgKCFbCiAgICAgICAgQVBQTElDQVRJT05fSlNPTl9VVEY4LAogICAgICAgIEFQUExJQ0FUSU9OX0pTT04KICAgIF0uaW5jbHVkZXMoY29udGVudFR5cGUpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGNvbnRlbnQtdHlwZTogJHtjb250ZW50VHlwZX0sICBmZXRjaFJlc3BvbnNlPSR7ZmV0Y2hSZXNwb25zZX0sIGJvZHk9JHthd2FpdCBmZXRjaFJlc3BvbnNlLnRleHQoKX1gKTsKICAgIH0KICAgIGNvbnN0IGFwaVJlc3BvbnNlID0gYXdhaXQgZmV0Y2hSZXNwb25zZS5qc29uKCk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaTEuREVCVUcpIGNvbnNvbGUubG9nKGFwaVJlc3BvbnNlKTsKICAgIGlmICghYXBpUmVzcG9uc2Uuc3VjY2VzcykgewogICAgICAgIGlmIChmZXRjaFJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0ICYmIHJlc3BvbnNlVHlwZSA9PT0gJ2J5dGVzPycpIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgdGhyb3cgbmV3IENsb3VkZmxhcmVBcGlFcnJvcjIoYCR7b3B9IGZhaWxlZDogc3RhdHVzPSR7ZmV0Y2hSZXNwb25zZS5zdGF0dXN9LCBlcnJvcnM9JHthcGlSZXNwb25zZS5lcnJvcnMubWFwKCh2KT0+YCR7di5jb2RlfSAke3YubWVzc2FnZX1gCiAgICAgICAgKS5qb2luKCcsICcpfWAsIGZldGNoUmVzcG9uc2Uuc3RhdHVzLCBhcGlSZXNwb25zZS5lcnJvcnMpOwogICAgfQogICAgcmV0dXJuIGFwaVJlc3BvbnNlOwp9CmNsYXNzIENsb3VkZmxhcmVBcGlFcnJvcjIgZXh0ZW5kcyBFcnJvciB7CiAgICBzdGF0dXM7CiAgICBlcnJvcnM7CiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlMSwgc3RhdHVzMiwgZXJyb3JzMil7CiAgICAgICAgc3VwZXIobWVzc2FnZTEpOwogICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzMjsKICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczI7CiAgICB9Cn0KZnVuY3Rpb24gc2V0U3VidHJhY3QobGhzLCByaHMpIHsKICAgIGNvbnN0IHJ0ID0gbmV3IFNldChsaHMpOwogICAgZm9yIChjb25zdCBpdGVtIG9mIHJocyl7CiAgICAgICAgcnQuZGVsZXRlKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJ0Owp9CmZ1bmN0aW9uIHNldFVuaW9uKGxocywgcmhzKSB7CiAgICBjb25zdCBydCA9IG5ldyBTZXQobGhzKTsKICAgIGZvciAoY29uc3QgaXRlbSBvZiByaHMpewogICAgICAgIHJ0LmFkZChpdGVtKTsKICAgIH0KICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBzZXRJbnRlcnNlY3QobGhzLCByaHMpIHsKICAgIGNvbnN0IHJ0ID0gbmV3IFNldCgpOwogICAgZm9yIChjb25zdCBpdGVtIG9mIGxocyl7CiAgICAgICAgaWYgKHJocy5oYXMoaXRlbSkpIHJ0LmFkZChpdGVtKTsKICAgIH0KICAgIGZvciAoY29uc3QgaXRlbTEgb2YgcmhzKXsKICAgICAgICBpZiAobGhzLmhhcyhpdGVtMSkpIHJ0LmFkZChpdGVtMSk7CiAgICB9CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gc2V0RXF1YWwobGhzLCByaHMpIHsKICAgIHJldHVybiBsaHMuc2l6ZSA9PT0gcmhzLnNpemUgJiYgWwogICAgICAgIC4uLmxocwogICAgXS5ldmVyeSgodik9PnJocy5oYXModikKICAgICk7Cn0KZnVuY3Rpb24gcGFyc2VIZWFkZXJGaWx0ZXIoaGVhZGVyKSB7CiAgICBjb25zdCBpMSA9IGhlYWRlci5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaTEgPCAwKSByZXR1cm4gewogICAgICAgIGtleTogaGVhZGVyCiAgICB9OwogICAgY29uc3Qga2V5ID0gaGVhZGVyLnN1YnN0cmluZygwLCBpMSkudHJpbSgpOwogICAgY29uc3QgcXVlcnkgPSBoZWFkZXIuc3Vic3RyaW5nKGkxICsgMSkudHJpbSgpOwogICAgcmV0dXJuIHsKICAgICAgICBrZXksCiAgICAgICAgcXVlcnkKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMgPSBuZXcgU2V0KFsKICAgICdvdXRjb21lJywKICAgICdzY3JpcHROYW1lJywKICAgICdleGNlcHRpb25zJywKICAgICdsb2dzJywKICAgICdldmVudFRpbWVzdGFtcCcsCiAgICAnZXZlbnQnCl0pOwpjb25zdCBLTk9XTl9PVVRDT01FUyA9IG5ldyBTZXQoWwogICAgJ29rJywKICAgICdleGNlcHRpb24nLAogICAgJ2V4Y2VlZGVkQ3B1JywKICAgICdjYW5jZWxlZCcsCiAgICAndW5rbm93bicKXSk7CmZ1bmN0aW9uIHBhcnNlVGFpbE1lc3NhZ2Uob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGFpbE1lc3NhZ2U6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IG91dGNvbWUgLCBzY3JpcHROYW1lICwgZXZlbnRUaW1lc3RhbXAgIH0gPSBvYmpBc0FueTsKICAgIGlmICghS05PV05fT1VUQ09NRVMuaGFzKG91dGNvbWUpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBvdXRjb21lOiBleHBlY3RlZCBvbmUgb2YgWyR7WwogICAgICAgIC4uLktOT1dOX09VVENPTUVTCiAgICBdLmpvaW4oJywgJyl9XSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvdXRjb21lKX1gKTsKICAgIGlmIChzY3JpcHROYW1lICE9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBzY3JpcHROYW1lOiBleHBlY3RlZCBudWxsLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHNjcmlwdE5hbWUpfWApOwogICAgY29uc3QgbG9ncyA9IHBhcnNlTG9ncyhvYmpBc0FueS5sb2dzKTsKICAgIGNvbnN0IGV4Y2VwdGlvbnMgPSBwYXJzZUV4Y2VwdGlvbnMob2JqQXNBbnkuZXhjZXB0aW9ucyk7CiAgICBpZiAoISh0eXBlb2YgZXZlbnRUaW1lc3RhbXAgPT09ICdudW1iZXInICYmIGV2ZW50VGltZXN0YW1wID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIGV2ZW50VGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkoZXZlbnRUaW1lc3RhbXApfWApOwogICAgY29uc3QgZXZlbnQgPSBvYmpBc0FueS5ldmVudCAmJiBvYmpBc0FueS5ldmVudC5yZXF1ZXN0ID8gcGFyc2VUYWlsTWVzc2FnZVJlcXVlc3RFdmVudChvYmpBc0FueS5ldmVudCkgOiBwYXJzZVRhaWxNZXNzYWdlQ3JvbkV2ZW50KG9iakFzQW55LmV2ZW50KTsKICAgIHJldHVybiB7CiAgICAgICAgb3V0Y29tZSwKICAgICAgICBzY3JpcHROYW1lLAogICAgICAgIGV4Y2VwdGlvbnMsCiAgICAgICAgbG9ncywKICAgICAgICBldmVudFRpbWVzdGFtcCwKICAgICAgICBldmVudAogICAgfTsKfQpmdW5jdGlvbiBwYXJzZUxvZ3Mob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbG9nczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlTG9nKTsKfQpmdW5jdGlvbiBwYXJzZUV4Y2VwdGlvbnMob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgZXhjZXB0aW9uczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlRXhjZXB0aW9uKTsKfQpmdW5jdGlvbiBpc0xvZ01lc3NhZ2VQYXJ0KHZhbHVlKSB7CiAgICBjb25zdCB0ID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuIHQgPT09ICdzdHJpbmcnIHx8IHQgPT09ICdudW1iZXInIHx8IHQgPT09ICdib29sZWFuJyB8fCB0ID09PSAndW5kZWZpbmVkJyB8fCB0ID09PSAnb2JqZWN0JzsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMgPSBuZXcgU2V0KFsKICAgICdtZXNzYWdlJywKICAgICdsZXZlbCcsCiAgICAndGltZXN0YW1wJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUxvZyhvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUxvZzogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCBtZXNzYWdlMiA9IHBhcnNlTG9nTWVzc2FnZVBhcnRBcnJheShvYmpBc0FueS5tZXNzYWdlLCAnbWVzc2FnZScpOwogICAgY29uc3QgeyBsZXZlbCAsIHRpbWVzdGFtcCAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIGxldmVsID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIGxldmVsOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobGV2ZWwpfWApOwogICAgaWYgKCEodHlwZW9mIHRpbWVzdGFtcCA9PT0gJ251bWJlcicgJiYgdGltZXN0YW1wID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIHRpbWVzdGFtcDogZXhwZWN0ZWQgcG9zaXRpdmUgbnVtYmVyLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHRpbWVzdGFtcCl9YCk7CiAgICByZXR1cm4gewogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UyLAogICAgICAgIGxldmVsLAogICAgICAgIHRpbWVzdGFtcAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVhDRVBUSU9OX0tFWVMgPSBuZXcgU2V0KFsKICAgICduYW1lJywKICAgICdtZXNzYWdlJywKICAgICd0aW1lc3RhbXAnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXhjZXB0aW9uKG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlRXhjZXB0aW9uOiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FWENFUFRJT05fS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IHsgbmFtZTogbmFtZTQgLCBtZXNzYWdlOiBtZXNzYWdlMiAsIHRpbWVzdGFtcCAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIG5hbWU0ID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIG5hbWU6IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJHtKU09OLnN0cmluZ2lmeShuYW1lNCl9YCk7CiAgICBpZiAoISh0eXBlb2YgbWVzc2FnZTIgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbWVzc2FnZTogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG1lc3NhZ2UyKX1gKTsKICAgIGlmICghKHR5cGVvZiB0aW1lc3RhbXAgPT09ICdudW1iZXInICYmIHRpbWVzdGFtcCA+IDApKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0aW1lc3RhbXA6IGV4cGVjdGVkIHBvc2l0aXZlIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeSh0aW1lc3RhbXApfWApOwogICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBuYW1lNCwKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlMiwKICAgICAgICB0aW1lc3RhbXAKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0NST05fRVZFTlRfS0VZUyA9IG5ldyBTZXQoWwogICAgJ2Nyb24nLAogICAgJ3NjaGVkdWxlZFRpbWUnCl0pOwpmdW5jdGlvbiBpc1RhaWxNZXNzYWdlQ3JvbkV2ZW50KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IGtleXMgPSBuZXcgU2V0KE9iamVjdC5rZXlzKG9iaikpOwogICAgcmV0dXJuIHNldEVxdWFsKGtleXMsIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9DUk9OX0VWRU5UX0tFWVMpOwp9CmZ1bmN0aW9uIHBhcnNlVGFpbE1lc3NhZ2VDcm9uRXZlbnQob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGFpbE1lc3NhZ2VDcm9uRXZlbnQ6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0NST05fRVZFTlRfS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IHsgY3JvbiAsIHNjaGVkdWxlZFRpbWUgIH0gPSBvYmpBc0FueTsKICAgIGlmICghKHR5cGVvZiBjcm9uID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIGNyb246IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJHtKU09OLnN0cmluZ2lmeShjcm9uKX1gKTsKICAgIGlmICghKHR5cGVvZiBzY2hlZHVsZWRUaW1lID09PSAnbnVtYmVyJyAmJiBzY2hlZHVsZWRUaW1lID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIHNjaGVkdWxlZFRpbWU6IGV4cGVjdGVkIHBvc2l0aXZlIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShzY2hlZHVsZWRUaW1lKX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgY3JvbiwKICAgICAgICBzY2hlZHVsZWRUaW1lCiAgICB9Owp9CmNvbnN0IFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMgPSBuZXcgU2V0KFsKICAgICdyZXF1ZXN0JwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZVJlcXVlc3RFdmVudChvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZVJlcXVlc3RFdmVudDogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfUkVRVUVTVF9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgcmVxdWVzdCA9IHBhcnNlVGFpbE1lc3NhZ2VFdmVudFJlcXVlc3Qob2JqQXNBbnkucmVxdWVzdCk7CiAgICByZXR1cm4gewogICAgICAgIHJlcXVlc3QKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyA9IG5ldyBTZXQoWwogICAgJ3VybCcsCiAgICAnbWV0aG9kJywKICAgICdoZWFkZXJzJwpdKTsKY29uc3QgT1BUSU9OQUxfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyA9IG5ldyBTZXQoWwogICAgJ2NmJwpdKTsKY29uc3QgQUxMX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMgPSBzZXRVbmlvbihSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTLCBPUFRJT05BTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUV2ZW50UmVxdWVzdChvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUV2ZW50UmVxdWVzdDogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTLCBBTExfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyk7CiAgICBjb25zdCBvYmpBc0FueSA9IG9iajsKICAgIGNvbnN0IHsgdXJsICwgbWV0aG9kICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIHVybDogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHVybCl9YCk7CiAgICBpZiAoISh0eXBlb2YgbWV0aG9kID09PSAnc3RyaW5nJykpIHRocm93IG5ldyBFcnJvcihgQmFkIG1ldGhvZDogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG1ldGhvZCl9YCk7CiAgICBjb25zdCBoZWFkZXJzID0gcGFyc2VTdHJpbmdSZWNvcmQob2JqQXNBbnkuaGVhZGVycywgJ2hlYWRlcnMnKTsKICAgIGNvbnN0IGNmID0gb2JqQXNBbnkuY2YgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHBhcnNlSW5jb21pbmdSZXF1ZXN0Q2ZQcm9wZXJ0aWVzKG9iakFzQW55LmNmKTsKICAgIHJldHVybiB7CiAgICAgICAgdXJsLAogICAgICAgIG1ldGhvZCwKICAgICAgICBoZWFkZXJzLAogICAgICAgIGNmCiAgICB9Owp9CmZ1bmN0aW9uIGNoZWNrS2V5cyhvYmosIHJlcXVpcmVkS2V5cywgYWxsS2V5cykgewogICAgY29uc3Qga2V5cyA9IG5ldyBTZXQoT2JqZWN0LmtleXMob2JqKSk7CiAgICBjb25zdCBtaXNzaW5nS2V5cyA9IHNldFN1YnRyYWN0KHJlcXVpcmVkS2V5cywga2V5cyk7CiAgICBpZiAobWlzc2luZ0tleXMuc2l6ZSA+IDApIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBrZXlzOiAke1sKICAgICAgICAuLi5taXNzaW5nS2V5cwogICAgXS5qb2luKCcsICcpfWApOwogICAgY29uc3QgZXh0cmFLZXlzID0gc2V0U3VidHJhY3Qoa2V5cywgYWxsS2V5cyB8fCByZXF1aXJlZEtleXMpOwogICAgaWYgKGV4dHJhS2V5cy5zaXplID4gMCkgdGhyb3cgbmV3IEVycm9yKGBFeHRyYSBrZXlzOiAke1sKICAgICAgICAuLi5leHRyYUtleXMKICAgIF0uam9pbignLCAnKX1gKTsKfQpmdW5jdGlvbiBwYXJzZVN0cmluZ1JlY29yZChvYmosIG5hbWU0KSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lNH06IEV4cGVjdGVkIHN0cmluZyByZWNvcmQsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGZvciAoY29uc3QgW18sIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYmopKXsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lNH06IEV4cGVjdGVkIHN0cmluZyByZWNvcmQsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIH0KICAgIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gcGFyc2VMb2dNZXNzYWdlUGFydEFycmF5KG9iaiwgbmFtZTQpIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCAhQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCAke25hbWU0fTogRXhwZWN0ZWQgbG9nIG1lc3NhZ2UgcGFydCBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgZm9yIChjb25zdCB2YWx1ZSBvZiBvYmopewogICAgICAgIGlmICghaXNMb2dNZXNzYWdlUGFydCh2YWx1ZSkpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZTR9OiBFeHBlY3RlZCBsb2cgbWVzc2FnZSBwYXJ0IGFycmF5LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICB9CiAgICByZXR1cm4gb2JqOwp9CmZ1bmN0aW9uIHBhcnNlSW5jb21pbmdSZXF1ZXN0Q2ZQcm9wZXJ0aWVzKG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIGNmOiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gZHVtcE1lc3NhZ2VQcmV0dHkobWVzc2FnZTIsIGxvZ2dlciwgYWRkaXRpb25hbExvZ3MgPSBbXSkgewogICAgY29uc3QgdGltZSA9IGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUobWVzc2FnZTIuZXZlbnRUaW1lc3RhbXApKTsKICAgIGNvbnN0IG91dGNvbWUgPSBQUkVUVFlfT1VUQ09NRVMuZ2V0KG1lc3NhZ2UyLm91dGNvbWUpIHx8IG1lc3NhZ2UyLm91dGNvbWU7CiAgICBjb25zdCBvdXRjb21lQ29sb3IgPSBtZXNzYWdlMi5vdXRjb21lID09PSAnb2snID8gJ2dyZWVuJyA6ICdyZWQnOwogICAgY29uc3QgeyBwcm9wcyAsIHJlbWFpbmluZ0xvZ3MgIH0gPSBwYXJzZUxvZ1Byb3BzKG1lc3NhZ2UyLmxvZ3MpOwogICAgaWYgKGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQobWVzc2FnZTIuZXZlbnQpKSB7CiAgICAgICAgY29uc3QgY29sbyA9IHByb3BzLmNvbG8gfHwgJz8/Pyc7CiAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyR7Y29sb30lY10gWyVjJHtvdXRjb21lfSVjXSAlYyR7bWVzc2FnZTIuZXZlbnQuY3Jvbn1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IG1ldGhvZCAsIHVybCAsIGNmICB9ID0gbWVzc2FnZTIuZXZlbnQucmVxdWVzdDsKICAgICAgICBjb25zdCBjb2xvID0gY2Y/LmNvbG8gfHwgcHJvcHMuY29sbyB8fCAnPz8/JzsKICAgICAgICBpZiAoY2YgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBkdXJhYmxlT2JqZWN0SW5mbyA9IGNvbXB1dGVEdXJhYmxlT2JqZWN0SW5mbyhwcm9wcyk7CiAgICAgICAgICAgIGxvZ2dlcihgWyVjJHt0aW1lfSVjXSBbJWMke2NvbG99JWNdIFslYyR7b3V0Y29tZX0lY10gWyVjJHtkdXJhYmxlT2JqZWN0SW5mb30lY10gJHttZXRob2R9ICVjJHt1cmx9YCwgJ2NvbG9yOiBncmF5JywgJycsICdjb2xvcjogZ3JheScsICcnLCBgY29sb3I6ICR7b3V0Y29tZUNvbG9yfWAsICcnLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiByZWQ7IGZvbnQtc3R5bGU6IGJvbGQ7Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyR7Y29sb30lY10gWyVjJHtvdXRjb21lfSVjXSAke21ldGhvZH0gJWMke3VybH1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgeyBkYXRhICB9IG9mIGFkZGl0aW9uYWxMb2dzKXsKICAgICAgICBsb2dnZXIoLi4uZGF0YSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHsgbGV2ZWwgLCBtZXNzYWdlOiBsb2dNZXNzYWdlICB9IG9mIHJlbWFpbmluZ0xvZ3MpewogICAgICAgIGNvbnN0IGxldmVsQ29sb3IgPSBMT0dfTEVWRUxfQ09MT1JTLmdldChsZXZlbCkgfHwgJ2dyYXknOwogICAgICAgIGNvbnN0IGxvZ01lc3NhZ2VzID0gbG9nTWVzc2FnZS5tYXAoZm9ybWF0TG9nTWVzc2FnZVBhcnQpLmpvaW4oJywgJyk7CiAgICAgICAgbG9nZ2VyKGAgJWN8JWMgWyVjJHtsZXZlbH0lY10gJHtsb2dNZXNzYWdlc31gLCAnY29sb3I6IGdyYXknLCAnJywgYGNvbG9yOiAke2xldmVsQ29sb3J9YCwgJycpOwogICAgfQogICAgZm9yIChjb25zdCB7IG5hbWU6IG5hbWU0ICwgbWVzc2FnZTogZXhjZXB0aW9uTWVzc2FnZSAgfSBvZiBtZXNzYWdlMi5leGNlcHRpb25zKXsKICAgICAgICBsb2dnZXIoYCAlY3wlYyBbJWMke25hbWU0fSVjXSAlYyR7ZXhjZXB0aW9uTWVzc2FnZX1gLCAnY29sb3I6IGdyYXknLCAnJywgYGNvbG9yOiByZWQ7IGZvbnQtc3R5bGU6IGJvbGRgLCAnJywgJ2NvbG9yOiByZWQnKTsKICAgIH0KfQpmdW5jdGlvbiBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKGRhdGUpIHsKICAgIHJldHVybiBbCiAgICAgICAgZGF0ZS5nZXRGdWxsWWVhcigpLAogICAgICAgICctJywKICAgICAgICBwYWQyKGRhdGUuZ2V0TW9udGgoKSArIDEpLAogICAgICAgICctJywKICAgICAgICBwYWQyKGRhdGUuZ2V0RGF0ZSgpKSwKICAgICAgICAnICcsCiAgICAgICAgcGFkMihkYXRlLmdldEhvdXJzKCkpLAogICAgICAgICc6JywKICAgICAgICBwYWQyKGRhdGUuZ2V0TWludXRlcygpKSwKICAgICAgICAnOicsCiAgICAgICAgcGFkMihkYXRlLmdldFNlY29uZHMoKSkKICAgIF0uam9pbignJyk7Cn0KZnVuY3Rpb24gY29tcHV0ZUR1cmFibGVPYmplY3RJbmZvKHByb3BzKSB7CiAgICBjb25zdCBkdXJhYmxlT2JqZWN0Q2xhc3MgPSAodHlwZW9mIHByb3BzLmR1cmFibGVPYmplY3RDbGFzcyA9PT0gJ3N0cmluZycgPyBwcm9wcy5kdXJhYmxlT2JqZWN0Q2xhc3MgOiAnJykudHJpbSgpOwogICAgY29uc3QgZHVyYWJsZU9iamVjdElkID0gKHR5cGVvZiBwcm9wcy5kdXJhYmxlT2JqZWN0SWQgPT09ICdzdHJpbmcnID8gcHJvcHMuZHVyYWJsZU9iamVjdElkIDogJycpLnRyaW0oKTsKICAgIGNvbnN0IGR1cmFibGVPYmplY3ROYW1lID0gKHR5cGVvZiBwcm9wcy5kdXJhYmxlT2JqZWN0TmFtZSA9PT0gJ3N0cmluZycgPyBwcm9wcy5kdXJhYmxlT2JqZWN0TmFtZSA6ICcnKS50cmltKCk7CiAgICBjb25zdCBydCA9IFtdOwogICAgaWYgKGR1cmFibGVPYmplY3RDbGFzcy5sZW5ndGggPiAwKSBydC5wdXNoKGR1cmFibGVPYmplY3RDbGFzcyk7CiAgICBpZiAoZHVyYWJsZU9iamVjdE5hbWUubGVuZ3RoID4gMCkgcnQucHVzaChkdXJhYmxlT2JqZWN0TmFtZSk7CiAgICBpZiAoZHVyYWJsZU9iamVjdElkLmxlbmd0aCA+IDApIHJ0LnB1c2goY29tcHV0ZVNob3J0RHVyYWJsZU9iamVjdElkKGR1cmFibGVPYmplY3RJZCkpOwogICAgcmV0dXJuIHJ0Lmxlbmd0aCA+IDAgPyBydC5qb2luKCcgJykgOiAnRE8nOwp9CmZ1bmN0aW9uIGNvbXB1dGVTaG9ydER1cmFibGVPYmplY3RJZChpZCkgewogICAgcmV0dXJuIC9eWzAtOWEtZkEtRl17NSx9JC8udGVzdChpZCkgPyBgJHtpZC5zdWJzdHJpbmcoMCwgNCl94oCmYCA6IGlkOwp9CmZ1bmN0aW9uIHBhcnNlTG9nUHJvcHMobG9ncykgewogICAgY29uc3QgcmVtYWluaW5nTG9ncyA9IFtdOwogICAgY29uc3QgcHJvcHMgPSB7CiAgICB9OwogICAgZm9yIChjb25zdCBsb2cgb2YgbG9ncyl7CiAgICAgICAgaWYgKGxvZy5tZXNzYWdlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgbXNnID0gbG9nLm1lc3NhZ2VbMF07CiAgICAgICAgICAgIGlmICh0eXBlb2YgbXNnID09PSAnc3RyaW5nJyAmJiBtc2cuc3RhcnRzV2l0aCgnbG9ncHJvcHM6JykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYWlsZXIgPSBtc2cuc3Vic3RyaW5nKG1zZy5pbmRleE9mKCc6JykgKyAxKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYWlsZXJQcm9wcyA9IHRyeVBhcnNlUHJvcHNGcm9tSnNvbih0cmFpbGVyKTsKICAgICAgICAgICAgICAgIGFwcGVuZFByb3BzKHRyYWlsZXJQcm9wcywgcHJvcHMpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGxvZy5tZXNzYWdlLnNsaWNlKDEpKXsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0UHJvcHMgPSB0cnlQYXJzZVByb3BzRnJvbVBhcnQocGFydCk7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kUHJvcHMocGFydFByb3BzLCBwcm9wcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZW1haW5pbmdMb2dzLnB1c2gobG9nKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgcHJvcHMsCiAgICAgICAgcmVtYWluaW5nTG9ncwogICAgfTsKfQpmdW5jdGlvbiBhcHBlbmRQcm9wcyhzcmMsIGRzdCkgewogICAgaWYgKHNyYykgewogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHNyYykpewogICAgICAgICAgICBkc3Rba2V5XSA9IHZhbHVlOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiB0cnlQYXJzZVByb3BzRnJvbUpzb24odmFsdWUpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvcHMgPSBKU09OLnBhcnNlKHZhbHVlLnRyaW0oKSk7CiAgICAgICAgaWYgKHR5cGVvZiBwcm9wcyA9PT0gJ29iamVjdCcgJiYgcHJvcHMgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkocHJvcHMpKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9wczsKICAgICAgICB9CiAgICB9IGNhdGNoICB7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwp9CmZ1bmN0aW9uIHRyeVBhcnNlUHJvcHNGcm9tUGFydChwYXJ0KSB7CiAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2YgcGFydCA9PT0gJ29iamVjdCcgJiYgcGFydCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwYXJ0KSkgewogICAgICAgICAgICByZXR1cm4gcGFydDsKICAgICAgICB9CiAgICB9IGNhdGNoICB7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwp9CmZ1bmN0aW9uIGZvcm1hdExvZ01lc3NhZ2VQYXJ0KHBhcnQpIHsKICAgIGlmICh0eXBlb2YgcGFydCA9PT0gJ29iamVjdCcpIHJldHVybiBKU09OLnN0cmluZ2lmeShwYXJ0KTsKICAgIHJldHVybiBgJHtwYXJ0fWA7Cn0KZnVuY3Rpb24gcGFkMihudW0pIHsKICAgIHJldHVybiBudW0udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwp9CmNvbnN0IFBSRVRUWV9PVVRDT01FUyA9IG5ldyBNYXAoWwogICAgWwogICAgICAgICdvaycsCiAgICAgICAgJ09rJwogICAgXSwKICAgIFsKICAgICAgICAnZXhjZXB0aW9uJywKICAgICAgICAnRXJyb3InCiAgICBdLAogICAgWwogICAgICAgICdleGNlZWRlZENwdScsCiAgICAgICAgJ0V4Y2VlZGVkIExpbWl0JwogICAgXSwKICAgIFsKICAgICAgICAnY2FuY2VsZWQnLAogICAgICAgICdDYW5jZWxlZCcKICAgIF0sCiAgICBbCiAgICAgICAgJ3Vua25vd24nLAogICAgICAgICdVbmtub3duJwogICAgXSwgCl0pOwpjb25zdCBMT0dfTEVWRUxfQ09MT1JTID0gbmV3IE1hcChbCiAgICBbCiAgICAgICAgJ3RyYWNlJywKICAgICAgICAnZ3JheScKICAgIF0sCiAgICBbCiAgICAgICAgJ2RlYnVnJywKICAgICAgICAncHVycGxlJwogICAgXSwKICAgIFsKICAgICAgICAnbG9nJywKICAgICAgICAnZ3JheScKICAgIF0sCiAgICBbCiAgICAgICAgJ2luZm8nLAogICAgICAgICdncmF5JwogICAgXSwKICAgIFsKICAgICAgICAnd2FybicsCiAgICAgICAgJ3JlZCcKICAgIF0sCiAgICBbCiAgICAgICAgJ2Vycm9yJywKICAgICAgICAncmVkJwogICAgXSwgCl0pOwpjbGFzcyBUYWlsQ29ubmVjdGlvbiB7CiAgICBzdGF0aWMgVkVSQk9TRSA9IGZhbHNlOwogICAgd3M7CiAgICBjYWxsYmFja3M7CiAgICBvcHRpb25zOwogICAgaGVhcnRiZWF0SWQ7CiAgICBjb25zdHJ1Y3Rvcih3ZWJTb2NrZXRVcmwsIGNhbGxiYWNrczEsIG9wdHMyKXsKICAgICAgICB0aGlzLndzID0gbmV3IFdlYlNvY2tldCh3ZWJTb2NrZXRVcmwsICd0cmFjZS12MScpOwogICAgICAgIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzMTsKICAgICAgICBjb25zdCB7IHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM6IHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMxICB9ID0gb3B0czI7CiAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICB0aGlzLnNlbmRPcHRpb25zSWZPcGVuKCk7CiAgICAgICAgICAgIGlmIChjYWxsYmFja3MxLm9uT3BlbikgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzMS5vbk9wZW4odGhpcywgdGltZVN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kczEgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoVGFpbENvbm5lY3Rpb24uVkVSQk9TRSkgY29uc29sZS5sb2coZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhuZXcgRGF0ZSgpKSwgYHNlbmRpbmcgd3MgcGluZyB7fSBldmVyeSAke3dlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMxfWApOwogICAgICAgICAgICAgICAgdGhpcy5oZWFydGJlYXRJZCA9IHNldEludGVydmFsKCgpPT57CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMud3MucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRhaWxDb25uZWN0aW9uLlZFUkJPU0UpIGNvbnNvbGUubG9nKGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUoKSksIGBzZW5kaW5nIHdzIHBpbmcge31gKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53cy5zZW5kKCd7fScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMxICogMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IGNvZGUgLCByZWFzb24gLCB3YXNDbGVhbiAsIHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICBpZiAoVGFpbENvbm5lY3Rpb24uVkVSQk9TRSkgY29uc29sZS5sb2coZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhuZXcgRGF0ZSgpKSwgJ1RhaWxDb25uZWN0aW9uOiB3cyBjbG9zZScsIHsKICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICByZWFzb24sCiAgICAgICAgICAgICAgICB3YXNDbGVhbiwKICAgICAgICAgICAgICAgIHRpbWVTdGFtcAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmhlYXJ0YmVhdElkKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrczEub25DbG9zZSkgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzMS5vbkNsb3NlKHRoaXMsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICBjb25zdCBlcnJvckluZm8gPSBjb21wdXRlRXJyb3JJbmZvKGV2ZW50KTsKICAgICAgICAgICAgaWYgKFRhaWxDb25uZWN0aW9uLlZFUkJPU0UpIGNvbnNvbGUubG9nKGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUoKSksICdUYWlsQ29ubmVjdGlvbjogd3MgZXJyb3InLCBlcnJvckluZm8pOwogICAgICAgICAgICBpZiAoY2FsbGJhY2tzMS5vbkVycm9yKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3MxLm9uRXJyb3IodGhpcywgdGltZVN0YW1wLCBlcnJvckluZm8pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgYXN5bmMgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICBpZiAoZXZlbnQuZGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBldmVudC5kYXRhLnRleHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UodGV4dCk7CiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZTI7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UyID0gcGFyc2VUYWlsTWVzc2FnZShvYmopOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczEub25VbnBhcnNlZE1lc3NhZ2UodGhpcywgdGltZVN0YW1wLCBvYmosIGUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhbGxiYWNrczEub25UYWlsTWVzc2FnZSh0aGlzLCB0aW1lU3RhbXAsIG1lc3NhZ2UyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrczEub25VbnBhcnNlZE1lc3NhZ2UodGhpcywgdGltZVN0YW1wLCBldmVudC5kYXRhLCBuZXcgRXJyb3IoYEV4cGVjdGVkIGV2ZW50LmRhdGEgdG8gYmUgQmxvYmApKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICB0aGlzLnNlbmRPcHRpb25zSWZPcGVuKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9zZShjb2RlLCByZWFzb24pIHsKICAgICAgICB0aGlzLndzLmNsb3NlKGNvZGUsIHJlYXNvbik7CiAgICB9CiAgICBzZW5kT3B0aW9uc0lmT3BlbigpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMud3MucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHsKICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhgc2VuZE9wdGlvbnNJZk9wZW46IHNlbmRpbmcgJHtwYXlsb2FkfWApOwogICAgICAgICAgICB0aGlzLndzLnNlbmQocGF5bG9hZCk7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGNvbXB1dGVFcnJvckluZm8oZXZlbnQpIHsKICAgIGlmIChldmVudC50eXBlID09PSAnZXJyb3InKSB7CiAgICAgICAgY29uc3QgeyBtZXNzYWdlOiBtZXNzYWdlMiAsIGZpbGVuYW1lICwgbGluZW5vICwgY29sbm8gLCBlcnJvciAgfSA9IGV2ZW50OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UyLAogICAgICAgICAgICBmaWxlbmFtZSwKICAgICAgICAgICAgbGluZW5vLAogICAgICAgICAgICBjb2xubywKICAgICAgICAgICAgZXJyb3IKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBnZW5lcmF0ZVV1aWQoKSB7CiAgICBjb25zdCBjcnlwdG9Bc0FueSA9IGNyeXB0bzsKICAgIGlmICh0eXBlb2YgY3J5cHRvQXNBbnkucmFuZG9tVVVJRCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBjcnlwdG9Bc0FueS5yYW5kb21VVUlEKCk7CiAgICB9CiAgICBjb25zdCBybmRzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxNikpOwogICAgcm5kc1s2XSA9IHJuZHNbNl0gJiAxNSB8IDY0OwogICAgcm5kc1s4XSA9IHJuZHNbOF0gJiA2MyB8IDEyODsKICAgIHJldHVybiBieXRlc1RvVXVpZChybmRzKTsKfQpmdW5jdGlvbiBieXRlc1RvVXVpZChieXRlcykgewogICAgY29uc3QgYml0cyA9IFsKICAgICAgICAuLi5ieXRlcwogICAgXS5tYXAoKGJpdCk9PnsKICAgICAgICBjb25zdCBzID0gYml0LnRvU3RyaW5nKDE2KTsKICAgICAgICByZXR1cm4gYml0IDwgMTYgPyAiMCIgKyBzIDogczsKICAgIH0pOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5iaXRzLnNsaWNlKDAsIDQpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDQsIDYpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDYsIDgpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDgsIDEwKSwKICAgICAgICAiLSIsCiAgICAgICAgLi4uYml0cy5zbGljZSgxMCwgMTYpLCAKICAgIF0uam9pbigiIik7Cn0KY2xhc3MgTWF0ZXJpYWwgewogICAgc3RhdGljIGhpZ2hFbXBoYXNpc1RleHRDb2xvciA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuODcpJzsKICAgIHN0YXRpYyBtZWRpdW1FbXBoYXNpc1RleHRDb2xvciA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNjApJzsKfQpjb25zdCBNQVRFUklBTF9DU1MgPSBjc3NgCgo6cm9vdCB7CiAgLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3I6IHJnYigzMC43NSwgMzAuNzUsIDMwLjc1KTsKICAtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcjogcmdiKDQwLjk1LCA0MC45NSwgNDAuOTUpOwogIC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuODcpOwogIC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC42MCk7CiAgLS1kaXNhYmxlZC10ZXh0LWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMzgpOwogIC0tYnV0dG9uLWJvcmRlci1yYWRpdXM6IDAuMjVyZW07CiAgLS1wcmltYXJ5LWNvbG9yOiAjYmI4NmZjOwogIC0tYmFja2dyb3VuZC1jb2xvcjogIzEyMTIxMjsKICAtLXNhbnMtc2VyaWYtZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgYXZlbmlyIG5leHQsIGF2ZW5pciwgaGVsdmV0aWNhIG5ldWUsIGhlbHZldGljYSwgVWJ1bnR1LCByb2JvdG8sIG5vdG8sIHNlZ29lIHVpLCBhcmlhbCwgc2Fucy1zZXJpZjsKICAtLW1vbm9zcGFjZS1mb250LWZhbWlseTogTWVubG8sIENvbnNvbGFzLCB1aS1tb25vc3BhY2UsIG1vbm9zcGFjZTsKfQoKLyoqIHRleHQgc2l6ZSBjbGFzc2VzICovCgouaDYgewogICAgZm9udC1zaXplOiAxLjI1cmVtOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDA3NTByZW07CiAgICBmb250LXdlaWdodDogYm9sZGVyOwp9CgouYm9keTIsIGZpZWxkc2V0IGxhYmVsLCBmaWVsZHNldCBvdXRwdXQsIGZpZWxkc2V0IGRldGFpbHMgewogICAgZm9udC1zaXplOiAwLjg3NXJlbTsKICAgIGxldHRlci1zcGFjaW5nOiAwLjAxNzg2cmVtOwogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICAgIGxpbmUtaGVpZ2h0OiAxLjI1cmVtOwp9CgouYnV0dG9uLCBidXR0b24sIC5hY3Rpb24taWNvbiB7CiAgICBmb250LXNpemU6IDAuODc1cmVtOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAwLjA4OTI5cmVtOwogICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsKfQoKLm92ZXJsaW5lIHsKICAgIGZvbnQtc2l6ZTogMC42MjVyZW07CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMTUwMDByZW07CiAgICBmb250LXdlaWdodDogbm9ybWFsOwp9CgouY2FwdGlvbiB7CiAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICBsZXR0ZXItc3BhY2luZzogMC4wMzMzM3JlbTsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7Cn0KCi8qIGxpZ2h0IHRleHQgb24gZGFyayBiYWNrZ3JvdW5kIGNvbG9ycyAqLwoKLmhpZ2gtZW1waGFzaXMtdGV4dCB7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKLm1lZGl1bS1lbXBoYXNpcy10ZXh0LCBmaWVsZHNldCBsYWJlbCB7CiAgICBjb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgouZGlzYWJsZWQtZW1waGFzaXMtdGV4dCB7CiAgICBjb2xvcjogdmFyKC0tZGlzYWJsZWQtdGV4dC1jb2xvcik7Cn0KCi8qKiBlbGV2YXRpb24gYmFja2dyb3VuZHMgKi8KCi5zdXJmYWNlLTAxIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcik7Cn0KCi5zdXJmYWNlLTA0IHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcik7Cn0KCi8qKiBhY3Rpb24taWNvbiAqLwoKLmFjdGlvbi1pY29uIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBtaW4taGVpZ2h0OiAycmVtOwogICAgbWluLXdpZHRoOiAycmVtOwogICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYnV0dG9uLWJvcmRlci1yYWRpdXMpOwogICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBvcGFjaXR5OiAwLjY5OyAgLyoqIG1lZGl1bS1lbXBoYXNpcyAvIGhpZ2gtZW1waGFzaXMgKi8KICAgIHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwp9CgpAbWVkaWEgKGhvdmVyOiBob3ZlcikgewogICAgLmFjdGlvbi1pY29uOmhvdmVyIHsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTA0LWJhY2tncm91bmQtY29sb3IpOwogICAgICAgIG9wYWNpdHk6IDE7CiAgICB9Cn0KCi8qKiBidXR0b24gKi8KCmJ1dHRvbiB7CiAgICBib3JkZXI6IG5vbmU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIHBhZGRpbmc6IDAuNXJlbSAxcmVtOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICBtaW4td2lkdGg6IDhyZW07CiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1idXR0b24tYm9yZGVyLXJhZGl1cyk7Cn0KCmJ1dHRvbi5zZWxlY3RlZCB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTA0LWJhY2tncm91bmQtY29sb3IpOwogICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCkBtZWRpYSAoaG92ZXIpIHsKICAgIGJ1dHRvbjpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIH0KfQoKYnV0dG9uOmRpc2FibGVkIHsKICAgIGNvbG9yOiB2YXIoLS1kaXNhYmxlZC10ZXh0LWNvbG9yKTsKfQoKQG1lZGlhIChob3ZlcikgewogICAgYnV0dG9uOmRpc2FibGVkOmhvdmVyIHsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwogICAgICAgIGN1cnNvcjogZGVmYXVsdDsKICAgIH0KfQoKLyoqIGFuY2hvcnMgKi8KCmEgewogICAgY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOwogICAgdGV4dC11bmRlcmxpbmUtb2Zmc2V0OiAwLjJyZW07CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCkBtZWRpYSAoaG92ZXI6IGhvdmVyKSB7CiAgICBhOmhvdmVyIHsKICAgICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsKICAgIH0KfQoKLyoqIGZvcm1zICovCgpmaWVsZHNldCB7CiAgICBib3JkZXI6IHNvbGlkIDFweCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNjApOwogICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYnV0dG9uLWJvcmRlci1yYWRpdXMpOwogICAgZGlzcGxheTogZ3JpZDsKICAgIGdyaWQtcm93LWdhcDogMXJlbTsKICAgIGdyaWQtY29sdW1uLWdhcDogMXJlbTsKICAgIHBhZGRpbmc6IDFyZW07Cn0KCmxhYmVsIHsKICAgIGdyaWQtY29sdW1uOiAxOwogICAgcGFkZGluZzogMC41cmVtIDA7Cn0KCi5mb3JtLWxocyB7CiAgICBncmlkLWNvbHVtbjogMTsKfQoKaW5wdXQsIC5mb3JtLXJocyB7CiAgICBncmlkLWNvbHVtbjogMjsKICAgIG1pbi13aWR0aDogMDsKfQoKLmZvcm0tcm93IHsKICAgIGdyaWQtY29sdW1uOiAxIC8gc3BhbiAyOwp9CgpmaWVsZHNldCBpbnB1dFt0eXBlPXRleHRdIHsKICAgIHBhZGRpbmc6IDAuNXJlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGJvcmRlcjogc29saWQgMXB4IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKfQoKZmllbGRzZXQgb3V0cHV0IHsKICAgIHBhZGRpbmc6IDAuNXJlbSAwOwogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKZmllbGRzZXQgZGV0YWlscyB7CiAgICBjb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgpgOwpjb25zdCBIRUFERVJfSFRNTCA9IGh0bWxgCjxoZWFkZXIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCI+CiAgICA8ZGl2IGlkPSJoZWFkZXItY29udGVudCI+CiAgICAgICAgRGVub2ZsYXJlIFRhaWwKICAgICAgICA8c3BhbiBpZD0iaGVhZGVyLXZlcnNpb24iIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9zcGFuPgogICAgICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9za3ltZXRob2QvZGVub2ZsYXJlIiB0YXJnZXQ9Il9ibGFuayIgaWQ9ImdpdGh1Yi1sb2dvLWFuY2hvciI+PGltZyBpZD0iZ2l0aHViLWxvZ28iPjwvYT4KICAgIDwvZGl2Pgo8L2hlYWRlcj4KYDsKY29uc3QgSEVBREVSX0NTUyA9IGNzc2AKaGVhZGVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxcmVtIDA7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKI2hlYWRlci1jb250ZW50IHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogYmFzZWxpbmU7CiAgICBwYWRkaW5nLXJpZ2h0OiAyLjJyZW07Cn0KCiNoZWFkZXItdmVyc2lvbiB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNnaXRodWItbG9nby1hbmNob3IgewogICAgbGluZS1oZWlnaHQ6IDA7CiAgICBvcGFjaXR5OiAwLjU7Cn0KCkBtZWRpYSAoaG92ZXI6IGhvdmVyKSB7CiAgICAjZ2l0aHViLWxvZ28tYW5jaG9yOmhvdmVyIHsKICAgICAgICBvcGFjaXR5OiAwLjc1OwogICAgfQp9CgojZ2l0aHViLWxvZ28gewogICAgd2lkdGg6IDFyZW07CiAgICBtYXJnaW4tYm90dG9tOiAtMC4xcmVtOwp9CgpgOwpmdW5jdGlvbiBpbml0SGVhZGVyKGRvY3VtZW50LCB2bSwgZGF0YSkgewogICAgY29uc3QgaGVhZGVyQ29udGVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhZGVyLWNvbnRlbnQnKTsKICAgIGlmICgoZGF0YS5mbGFncyB8fCAnJykuaW5jbHVkZXMoJ2RlbW8tdG9nZ2xlJykpIHsKICAgICAgICBoZWFkZXJDb250ZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIChlKT0+ewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZtLnRvZ2dsZURlbW9Nb2RlKCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBoZWFkZXJWZXJzaW9uU3BhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItdmVyc2lvbicpOwogICAgY29uc3QgeyB2ZXJzaW9uICB9ID0gZGF0YTsKICAgIGhlYWRlclZlcnNpb25TcGFuLnRleHRDb250ZW50ID0gdmVyc2lvbiA/IGB2JHt2ZXJzaW9ufWAgOiAnJzsKICAgIGNvbnN0IGdpdGh1YkxvZ29JbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2l0aHViLWxvZ28nKTsKICAgIGdpdGh1YkxvZ29JbWcuc3JjID0gY29tcHV0ZUdpdGh1YkxvZ29EYXRhVXJsKCk7CiAgICByZXR1cm4gKCk9PnsKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUdpdGh1YkxvZ29EYXRhVXJsKCkgewogICAgY29uc3Qgc3ZnMSA9IEdJVEhVQl9MT0dPLnJlcGxhY2UoJ2ZpbGw6d2hpdGU7JywgYGZpbGw6JHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9O2ApOwogICAgcmV0dXJuICdkYXRhOmltYWdlL3N2Zyt4bWw7dXRmOCwnICsgc3ZnMTsKfQpjb25zdCBHSVRIVUJfTE9HTyA9IGA8c3ZnIHdpZHRoPSJhdXRvIiBoZWlnaHQ9ImF1dG8iIHZpZXdCb3g9IjAgMCAxMzYgMTMzIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MjsiPgo8ZyB0cmFuc2Zvcm09Im1hdHJpeCg0LjE2NjY3LDAsMCw0LjE2NjY3LC01NjgsLTEzODEuMDYpIj4KICAgIDxwYXRoIGQ9Ik0xNTIuNjA4LDMzMS40NTVDMTQzLjYxNCwzMzEuNDU1IDEzNi4zMiwzMzguNzQ4IDEzNi4zMiwzNDcuNzQ1QzEzNi4zMiwzNTQuOTQyIDE0MC45ODcsMzYxLjA0NyAxNDcuNDYsMzYzLjIwMUMxNDguMjc1LDM2My4zNTEgMTQ4LjU3MiwzNjIuODQ4IDE0OC41NzIsMzYyLjQxNkMxNDguNTcyLDM2Mi4wMjkgMTQ4LjU1OCwzNjEuMDA1IDE0OC41NSwzNTkuNjQ2QzE0NC4wMTksMzYwLjYzIDE0My4wNjMsMzU3LjQ2MiAxNDMuMDYzLDM1Ny40NjJDMTQyLjMyMiwzNTUuNTggMTQxLjI1NCwzNTUuMDc5IDE0MS4yNTQsMzU1LjA3OUMxMzkuNzc1LDM1NC4wNjkgMTQxLjM2NiwzNTQuMDg5IDE0MS4zNjYsMzU0LjA4OUMxNDMuMDAxLDM1NC4yMDQgMTQzLjg2MSwzNTUuNzY4IDE0My44NjEsMzU1Ljc2OEMxNDUuMzE0LDM1OC4yNTcgMTQ3LjY3NCwzNTcuNTM4IDE0OC42MDIsMzU3LjEyMUMxNDguNzUsMzU2LjA2OSAxNDkuMTcxLDM1NS4zNTEgMTQ5LjYzNiwzNTQuOTQ0QzE0Ni4wMTksMzU0LjUzMyAxNDIuMjE2LDM1My4xMzUgMTQyLjIxNiwzNDYuODkzQzE0Mi4yMTYsMzQ1LjExNSAxNDIuODUxLDM0My42NiAxNDMuODkzLDM0Mi41MjJDMTQzLjcyNSwzNDIuMTEgMTQzLjE2NiwzNDAuNDUzIDE0NC4wNTMsMzM4LjIxMUMxNDQuMDUzLDMzOC4yMTEgMTQ1LjQyLDMzNy43NzMgMTQ4LjUzMiwzMzkuODgxQzE0OS44MzEsMzM5LjUxOSAxNTEuMjI1LDMzOS4zMzkgMTUyLjYxLDMzOS4zMzJDMTUzLjk5NCwzMzkuMzM5IDE1NS4zODcsMzM5LjUxOSAxNTYuNjg4LDMzOS44ODFDMTU5Ljc5OCwzMzcuNzczIDE2MS4xNjMsMzM4LjIxMSAxNjEuMTYzLDMzOC4yMTFDMTYyLjA1MiwzNDAuNDUzIDE2MS40OTMsMzQyLjExIDE2MS4zMjYsMzQyLjUyMkMxNjIuMzcsMzQzLjY2IDE2MywzNDUuMTE1IDE2MywzNDYuODkzQzE2MywzNTMuMTUxIDE1OS4xOTEsMzU0LjUyOCAxNTUuNTYzLDM1NC45MzFDMTU2LjE0NywzNTUuNDM0IDE1Ni42NjgsMzU2LjQyOCAxNTYuNjY4LDM1Ny45NDdDMTU2LjY2OCwzNjAuMTI1IDE1Ni42NDgsMzYxLjg4MiAxNTYuNjQ4LDM2Mi40MTZDMTU2LjY0OCwzNjIuODUyIDE1Ni45NDIsMzYzLjM1OSAxNTcuNzY4LDM2My4yQzE2NC4yMzYsMzYxLjA0MSAxNjguODk5LDM1NC45NCAxNjguODk5LDM0Ny43NDVDMTY4Ljg5OSwzMzguNzQ4IDE2MS42MDUsMzMxLjQ1NSAxNTIuNjA4LDMzMS40NTVaIiBzdHlsZT0iZmlsbDp3aGl0ZTsiLz4KPC9nPgo8L3N2Zz5gOwpmdW5jdGlvbiBhY3Rpb25JY29uKGljb24sIG9wdHMxID0gewp9KSB7CiAgICBjb25zdCB7IHRleHQgLCBvbmNsaWNrICB9ID0gb3B0czE7CiAgICByZXR1cm4gaHRtbGA8ZGl2IGNsYXNzPSJhY3Rpb24taWNvbiIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIG9uY2xpY2sgJiYgb25jbGljaygpOwogICAgfX0+JHtpY29ufSR7dGV4dCB8fCAnJ308L2Rpdj5gOwp9CmNvbnN0IENMRUFSX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik01IDEzaDE0di0ySDV2MnptLTIgNGgxNHYtMkgzdjJ6TTcgN3YyaDE0VjdIN3oiLz48L3N2Zz5gOwpjb25zdCBFRElUX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xNC4wNiA5LjAybC45Mi45Mkw1LjkyIDE5SDV2LS45Mmw5LjA2LTkuMDZNMTcuNjYgM2MtLjI1IDAtLjUxLjEtLjcuMjlsLTEuODMgMS44MyAzLjc1IDMuNzUgMS44My0xLjgzYy4zOS0uMzkuMzktMS4wMiAwLTEuNDFsLTIuMzQtMi4zNGMtLjItLjItLjQ1LS4yOS0uNzEtLjI5em0tMy42IDMuMTlMMyAxNy4yNVYyMWgzLjc1TDE3LjgxIDkuOTRsLTMuNzUtMy43NXoiLz48L3N2Zz5gOwpjb25zdCBBRERfSUNPTiA9IHN2Z2A8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjQiIGZpbGw9IiR7TWF0ZXJpYWwuaGlnaEVtcGhhc2lzVGV4dENvbG9yfSI+PjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xOSAxM2gtNnY2aC0ydi02SDV2LTJoNlY1aDJ2Nmg2djJ6Ii8+PC9zdmc+YDsKY29uc3QgQ0hFQ0tfQk9YX1VOQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgNXYxNEg1VjVoMTRtMC0ySDVjLTEuMSAwLTIgLjktMiAydjE0YzAgMS4xLjkgMiAyIDJoMTRjMS4xIDAgMi0uOSAyLTJWNWMwLTEuMS0uOS0yLTItMnoiLz48L3N2Zz5gOwpjb25zdCBDSEVDS19CT1hfQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bTAgMTZINVY1aDE0djE0ek0xNy45OSA5bC0xLjQxLTEuNDItNi41OSA2LjU5LTIuNTgtMi41Ny0xLjQyIDEuNDEgNCAzLjk5eiIvPjwvc3ZnPmA7CmNvbnN0IFNJREVCQVJfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9InNpZGViYXIiPgogICAgJHtIRUFERVJfSFRNTH0KICAgIDxhIGlkPSJzaWRlYmFyLWFib3V0IiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiIGhyZWY9IiMiPkFib3V0PC9hPgogICAgPGRpdiBpZD0icHJvZmlsZXMiPjwvZGl2PgogICAgPGRpdiBpZD0ic2NyaXB0cyI+PC9kaXY+CjwvZGl2PgpgOwpjb25zdCBTSURFQkFSX0NTUyA9IGNzc2AKCiNzaWRlYmFyIHsKICAgIG1hcmdpbi1sZWZ0OiAxcmVtOwogICAgaGVpZ2h0OiAxMDB2aDsKICAgIG1pbi13aWR0aDogMTVyZW07Cn0KCiNzaWRlYmFyLWFib3V0IHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgbWFyZ2luLWJvdHRvbTogMXJlbTsKfQoKI3NpZGViYXIgLmJ1dHRvbi1ncmlkIHsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAycmVtOwogICAgZ3JpZC1nYXA6IDFweDsKICAgIG1hcmdpbi1sZWZ0OiAxcHg7CiAgICBtYXJnaW4tdG9wOiAxcmVtOwp9Cgojc2lkZWJhciAuYnV0dG9uLWdyaWQtbmV3IHsKICAgIGdyaWQtY29sdW1uOiAxOwogICAgbWluLXdpZHRoOiA4cmVtOwp9Cgojc2lkZWJhciBidXR0b24gewogICAgZ3JpZC1jb2x1bW46IDE7Cn0KCiNzaWRlYmFyIC5idXR0b24tZ3JpZCAuaGludCB7CiAgICBncmlkLWNvbHVtbjogMTsgCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNzY3JpcHRzLXNjcm9sbGVyIHsKICAgIGhlaWdodDogY2FsYygxMDB2aCAtIDE4cmVtKTsKfQoKYDsKZnVuY3Rpb24gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtLCBkYXRhKSB7CiAgICBjb25zdCB1cGRhdGVIZWFkZXIgPSBpbml0SGVhZGVyKGRvY3VtZW50LCB2bSwgZGF0YSk7CiAgICBjb25zdCBhYm91dEFuY2hvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyLWFib3V0Jyk7CiAgICBjb25zdCBwcm9maWxlc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlcycpOwogICAgY29uc3Qgc2NyaXB0c0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JpcHRzJyk7CiAgICBhYm91dEFuY2hvci5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLnNob3dBYm91dCgpOwogICAgfTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIHVwZGF0ZUhlYWRlcigpOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKFBST0ZJTEVTX0hUTUwodm0pLCBwcm9maWxlc0Rpdik7CiAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoU0NSSVBUU19IVE1MKHZtKSwgc2NyaXB0c0Rpdik7CiAgICB9Owp9CmNvbnN0IFBST0ZJTEVTX0hUTUwgPSAodm0pPT5odG1sYAogICAgPGRpdiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPlByb2ZpbGVzPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJidXR0b24tZ3JpZCI+CiAgICAgICAgJHt2bS5wcm9maWxlcy5tYXAoKHByb2ZpbGUpPT5odG1sYDxidXR0b24gCiAgICAgICAgICAgIGNsYXNzPSIke3Byb2ZpbGUuaWQgPT09IHZtLnNlbGVjdGVkUHJvZmlsZUlkID8gJ3NlbGVjdGVkJyA6ICcnfSIgCiAgICAgICAgICAgIEBjbGljaz0keygpPT57CiAgICAgICAgICAgIHZtLnNlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZS5pZDsKICAgICAgICB9fQogICAgICAgICAgICA/ZGlzYWJsZWQ9IiR7dm0ucHJvZmlsZUZvcm0uc2hvd2luZ30iPiR7cHJvZmlsZS50ZXh0fTwvYnV0dG9uPgogICAgICAgICR7cHJvZmlsZS5pZCA9PT0gdm0uc2VsZWN0ZWRQcm9maWxlSWQgPyBodG1sYCR7YWN0aW9uSWNvbihFRElUX0lDT04sIHsKICAgICAgICAgICAgb25jbGljazogKCk9PnZtLmVkaXRQcm9maWxlKHByb2ZpbGUuaWQpCiAgICAgICAgfSl9YCA6ICcnfWAKICAgICl9CiAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQtbmV3Ij4ke2FjdGlvbkljb24oQUREX0lDT04sIHsKICAgICAgICB0ZXh0OiAnTmV3JywKICAgICAgICBvbmNsaWNrOiAoKT0+dm0ubmV3UHJvZmlsZSgpCiAgICB9KX08L2Rpdj4KICAgIDwvZGl2PgpgCjsKY29uc3QgU0NSSVBUU19IVE1MID0gKHZtKT0+aHRtbGAKICAgIDxkaXYgY2xhc3M9Im92ZXJsaW5lIG1lZGl1bS1lbXBoYXNpcy10ZXh0Ij5TY3JpcHRzPC9kaXY+CiAgICA8ZGl2IGlkPSJzY3JpcHRzLXNjcm9sbGVyIiBjbGFzcz0iaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCI+CiAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQiPgogICAgICAgICAgICAke3ZtLnNjcmlwdHMubWFwKChzY3JpcHQpPT5odG1sYDxidXR0b24KICAgICAgICAgICAgICAgICAgICBjbGFzcz0iJHt2bS5zZWxlY3RlZFNjcmlwdElkcy5oYXMoc2NyaXB0LmlkKSA/ICdzZWxlY3RlZCcgOiAnJ30iIAogICAgICAgICAgICAgICAgICAgIEBjbGljaz0keyhlKT0+aGFuZGxlU2NyaXB0Q2xpY2soZSwgc2NyaXB0LmlkLCB2bSkKICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgID9kaXNhYmxlZD0iJHt2bS5wcm9maWxlRm9ybS5zaG93aW5nfSI+JHtzY3JpcHQudGV4dH08L2J1dHRvbj4KICAgICAgICAgICAgYAogICAgKX0KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcHRpb24gbWVkaXVtLWVtcGhhc2lzLXRleHQgaGludCI+JHtjb21wdXRlTXVsdGlzZWxlY3RLZXlDaGFyKCl9LWNsaWNrIHRvIG11bHRpc2VsZWN0PC9kaXY+CiAgICA8L2Rpdj4KYAo7CmZ1bmN0aW9uIGNvbXB1dGVNdWx0aXNlbGVjdEtleUNoYXIoKSB7CiAgICByZXR1cm4gaXNNYWNpbnRvc2goKSA/ICfijJgnIDogJ2N0cmwnOwp9CmZ1bmN0aW9uIGlzTWFjaW50b3NoKCkgewogICAgcmV0dXJuIG5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKCdNYWMnKSA+IC0xOwp9CmZ1bmN0aW9uIGhhbmRsZVNjcmlwdENsaWNrKGUsIHNjcmlwdElkLCB2bSkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgbmV3U2NyaXB0SWRzID0gbmV3IFNldChbCiAgICAgICAgc2NyaXB0SWQKICAgIF0pOwogICAgY29uc3QgbXVsdGkgPSBpc01hY2ludG9zaCgpID8gZS5tZXRhS2V5IDogZS5jdHJsS2V5OwogICAgdm0uc2VsZWN0ZWRTY3JpcHRJZHMgPSBtdWx0aSA/IHZtLnNlbGVjdGVkU2NyaXB0SWRzLmhhcyhzY3JpcHRJZCkgPyBzZXRTdWJ0cmFjdCh2bS5zZWxlY3RlZFNjcmlwdElkcywgbmV3U2NyaXB0SWRzKSA6IHNldFVuaW9uKHZtLnNlbGVjdGVkU2NyaXB0SWRzLCBuZXdTY3JpcHRJZHMpIDogbmV3U2NyaXB0SWRzOwp9CmNsYXNzIEFwcENvbnN0YW50cyB7CiAgICBzdGF0aWMgV0VCU09DS0VUX1BJTkdfSU5URVJWQUxfU0VDT05EUyA9IDEwOwogICAgc3RhdGljIElOQUNUSVZFX1RBSUxfU0VDT05EUyA9IDU7Cn0KY2xhc3MgVGFpbENvbnRyb2xsZXIgewogICAgY2FsbGJhY2tzOwogICAgcmVjb3JkcyA9IG5ldyBNYXAoKTsKICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM7CiAgICBpbmFjdGl2ZVRhaWxTZWNvbmRzOwogICAgdGFpbE9wdGlvbnMgPSB7CiAgICAgICAgZmlsdGVyczogW10KICAgIH07CiAgICBvbmxpbmU7CiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja3MyLCBvcHRzMSl7CiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3MyOwogICAgICAgIHRoaXMud2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA9IG9wdHMxLndlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM7CiAgICAgICAgdGhpcy5pbmFjdGl2ZVRhaWxTZWNvbmRzID0gb3B0czEuaW5hY3RpdmVUYWlsU2Vjb25kczsKICAgICAgICBjb25zdCBuYXZpZ2F0b3JBc0FueSA9IHdpbmRvdy5uYXZpZ2F0b3I7CiAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3JBc0FueS5vbkxpbmUgPT09ICdib29sZWFuJykgewogICAgICAgICAgICB0aGlzLnNldE9ubGluZShuYXZpZ2F0b3JBc0FueS5vbkxpbmUpOwogICAgICAgIH0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKCk9PnRoaXMuc2V0T25saW5lKHRydWUpCiAgICAgICAgKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsICgpPT50aGlzLnNldE9ubGluZShmYWxzZSkKICAgICAgICApOwogICAgfQogICAgc2V0VGFpbE9wdGlvbnModGFpbE9wdGlvbnMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgVGFpbENvbnRyb2xsZXIuc2V0VGFpbE9wdGlvbnMgJHtKU09OLnN0cmluZ2lmeSh0YWlsT3B0aW9ucyl9YCk7CiAgICAgICAgdGhpcy50YWlsT3B0aW9ucyA9IHRhaWxPcHRpb25zOwogICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHRoaXMucmVjb3Jkcy52YWx1ZXMoKSl7CiAgICAgICAgICAgIGlmIChyZWNvcmQuY29ubmVjdGlvbikgewogICAgICAgICAgICAgICAgcmVjb3JkLmNvbm5lY3Rpb24uc2V0T3B0aW9ucyh0YWlsT3B0aW9ucyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhc3luYyBzZXRUYWlscyhhY2NvdW50SWQsIGFwaVRva2VuLCBzY3JpcHRJZHMpIHsKICAgICAgICBjb25zdCBzdG9wS2V5cyA9IHNldFN1YnRyYWN0KHRoaXMuY29tcHV0ZVN0YXJ0aW5nT3JTdGFydGVkVGFpbEtleXMoKSwgbmV3IFNldChbCiAgICAgICAgICAgIC4uLnNjcmlwdElkcwogICAgICAgIF0ubWFwKCh2KT0+cGFja1RhaWxLZXkoYWNjb3VudElkLCB2KQogICAgICAgICkpKTsKICAgICAgICBmb3IgKGNvbnN0IHN0b3BLZXkgb2Ygc3RvcEtleXMpewogICAgICAgICAgICBjb25zdCByZWNvcmQgPSB0aGlzLnJlY29yZHMuZ2V0KHN0b3BLZXkpOwogICAgICAgICAgICByZWNvcmQuc3RhdGUgPSAnaW5hY3RpdmUnOwogICAgICAgICAgICByZWNvcmQuc3RvcFJlcXVlc3RlZFRpbWUgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnaW5hY3RpdmUnICYmIHJlY29yZC5zdG9wUmVxdWVzdGVkVGltZSAmJiBEYXRlLm5vdygpIC0gcmVjb3JkLnN0b3BSZXF1ZXN0ZWRUaW1lID49IHRoaXMuaW5hY3RpdmVUYWlsU2Vjb25kcykgewogICAgICAgICAgICAgICAgICAgIHJlY29yZC5zdGF0ZSA9ICdzdG9wcGluZyc7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFN0b3BwaW5nICR7cmVjb3JkLnNjcmlwdElkfSwgaW5hY3RpdmUgZm9yICR7RGF0ZS5ub3coKSAtIHJlY29yZC5zdG9wUmVxdWVzdGVkVGltZX1tc2ApOwogICAgICAgICAgICAgICAgICAgIHJlY29yZC5jb25uZWN0aW9uPy5jbG9zZSgxMDAwLCAnbm8gbG9uZ2VyIGludGVyZXN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29yZHMuZGVsZXRlKHJlY29yZC50YWlsS2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5pbmFjdGl2ZVRhaWxTZWNvbmRzICogMTAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdG9wS2V5cy5zaXplID4gMCkgewogICAgICAgICAgICB0aGlzLmRpc3BhdGNoVGFpbHNDaGFuZ2VkKCk7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3Qgc2NyaXB0SWQgb2Ygc2NyaXB0SWRzKXsKICAgICAgICAgICAgY29uc3QgdGFpbEtleSA9IHBhY2tUYWlsS2V5KGFjY291bnRJZCwgc2NyaXB0SWQpOwogICAgICAgICAgICBjb25zdCBleGlzdGluZ1JlY29yZCA9IHRoaXMucmVjb3Jkcy5nZXQodGFpbEtleSk7CiAgICAgICAgICAgIGlmIChleGlzdGluZ1JlY29yZCkgewogICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nUmVjb3JkLnN0YXRlID09PSAnaW5hY3RpdmUnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJldml2aW5nIGluYWN0aXZlICR7c2NyaXB0SWR9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBleGlzdGluZ1JlY29yZC5zdGF0ZSA9ICdzdGFydGVkJzsKICAgICAgICAgICAgICAgIGV4aXN0aW5nUmVjb3JkLnN0b3BSZXF1ZXN0ZWRUaW1lID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gewogICAgICAgICAgICAgICAgICAgIHN0YXRlOiAnc3RhcnRpbmcnLAogICAgICAgICAgICAgICAgICAgIHRhaWxLZXksCiAgICAgICAgICAgICAgICAgICAgYXBpVG9rZW4sCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkLAogICAgICAgICAgICAgICAgICAgIHNjcmlwdElkLAogICAgICAgICAgICAgICAgICAgIHJldHJ5Q291bnRBZnRlckNsb3NlOiAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5yZWNvcmRzLnNldCh0YWlsS2V5LCByZWNvcmQpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCk7CiAgICAgICAgICAgICAgICByZWNvcmQuc3RhdGUgPSAnc3RhcnRlZCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5kaXNwYXRjaFRhaWxzQ2hhbmdlZCgpOwogICAgICAgIH0KICAgIH0KICAgIGRpc3BhdGNoVGFpbHNDaGFuZ2VkKCkgewogICAgICAgIGNvbnN0IHRhaWxLZXlzID0gbmV3IFNldChbCiAgICAgICAgICAgIC4uLnRoaXMucmVjb3Jkcy52YWx1ZXMoKQogICAgICAgIF0uZmlsdGVyKCh2KT0+di5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnCiAgICAgICAgKS5tYXAoKHYpPT52LnRhaWxLZXkKICAgICAgICApKTsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxzQ2hhbmdlZCh0YWlsS2V5cyk7CiAgICB9CiAgICBjb21wdXRlU3RhcnRpbmdPclN0YXJ0ZWRUYWlsS2V5cygpIHsKICAgICAgICByZXR1cm4gbmV3IFNldChbCiAgICAgICAgICAgIC4uLnRoaXMucmVjb3Jkcy52YWx1ZXMoKQogICAgICAgIF0uZmlsdGVyKCh2KT0+di5zdGF0ZSA9PT0gJ3N0YXJ0aW5nJyB8fCB2LnN0YXRlID09PSAnc3RhcnRlZCcKICAgICAgICApLm1hcCgodik9PnYudGFpbEtleQogICAgICAgICkpOwogICAgfQogICAgc2V0T25saW5lKG9ubGluZSkgewogICAgICAgIGlmIChvbmxpbmUgPT09IHRoaXMub25saW5lKSByZXR1cm47CiAgICAgICAgY29uc3Qgb2xkT25saW5lID0gdGhpcy5vbmxpbmU7CiAgICAgICAgdGhpcy5vbmxpbmUgPSBvbmxpbmU7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXR3b3JrU3RhdHVzQ2hhbmdlZChvbmxpbmUpOwogICAgICAgIGlmICh0eXBlb2Ygb2xkT25saW5lID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgaWYgKG9ubGluZSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCByZWNvcmQgb2YgdGhpcy5yZWNvcmRzLnZhbHVlcygpKXsKICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnc3RhcnRlZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBzY3JpcHRJZCAgfSA9IHJlY29yZDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCkuY2F0Y2goKGUpPT50aGlzLmNhbGxiYWNrcy5vblRhaWxGYWlsZWRUb1N0YXJ0KGFjY291bnRJZCwgc2NyaXB0SWQsICdyZXN0YXJ0LWFmdGVyLWNvbWluZy1vbmxpbmUnLCBlKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHRoaXMucmVjb3Jkcy52YWx1ZXMoKSl7CiAgICAgICAgICAgICAgICAgICAgcmVjb3JkLmNvbm5lY3Rpb24/LmNsb3NlKDEwMDAsICdvZmZsaW5lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhc3luYyBzdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCkgewogICAgICAgIGNvbnN0IGFsbG93ZWRUb1N0YXJ0ID0gcmVjb3JkLnN0YXRlID09PSAnc3RhcnRpbmcnIHx8IHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnOwogICAgICAgIGlmICghYWxsb3dlZFRvU3RhcnQpIHJldHVybjsKICAgICAgICBjb25zdCB7IGFjY291bnRJZCAsIHNjcmlwdElkICB9ID0gdW5wYWNrVGFpbEtleShyZWNvcmQudGFpbEtleSk7CiAgICAgICAgY29uc3QgeyBhcGlUb2tlbiAgfSA9IHJlY29yZDsKICAgICAgICBpZiAoIXJlY29yZC50YWlsIHx8IERhdGUubm93KCkgPiBuZXcgRGF0ZShyZWNvcmQudGFpbC5leHBpcmVzX2F0KS5nZXRUaW1lKCkgLSAxMDAwICogNjAgKiA1KSB7CiAgICAgICAgICAgIGNvbnN0IHRhaWxDcmVhdGluZ1RpbWUgPSBEYXRlLm5vdygpOwogICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDcmVhdGluZyhhY2NvdW50SWQsIHNjcmlwdElkKTsKICAgICAgICAgICAgY29uc3QgdGFpbCA9IGF3YWl0IGNyZWF0ZVRhaWwoYWNjb3VudElkLCBzY3JpcHRJZCwgYXBpVG9rZW4pOwogICAgICAgICAgICByZWNvcmQudGFpbCA9IHRhaWw7CiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENyZWF0ZWQoYWNjb3VudElkLCBzY3JpcHRJZCwgRGF0ZS5ub3coKSAtIHRhaWxDcmVhdGluZ1RpbWUsIHRhaWwpOwogICAgICAgIH0KICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnaW5hY3RpdmUnKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBjYWxsYmFja3M6IGNhbGxiYWNrczMgLCB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzOiB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzMiAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgZGlzID0gdGhpczsKICAgICAgICBjb25zdCBvcGVuaW5nVGltZSA9IERhdGUubm93KCk7CiAgICAgICAgY29uc3QgdGFpbENvbm5lY3Rpb25DYWxsYmFja3MgPSB7CiAgICAgICAgICAgIG9uT3BlbiAoX2NuLCB0aW1lU3RhbXApIHsKICAgICAgICAgICAgICAgIHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSA9IDA7CiAgICAgICAgICAgICAgICBjYWxsYmFja3MzLm9uVGFpbENvbm5lY3Rpb25PcGVuKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgRGF0ZS5ub3coKSAtIG9wZW5pbmdUaW1lKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25DbG9zZSAoX2NuLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrczMub25UYWlsQ29ubmVjdGlvbkNsb3NlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbik7CiAgICAgICAgICAgICAgICByZWNvcmQuY2xvc2VUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuc3RhdGUgPT09ICdzdGFydGVkJyAmJiBkaXMub25saW5lICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSsrOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlbGF5U2Vjb25kcyA9IE1hdGgubWluKHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSAqIDUsIDYwKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgV2lsbCBhdHRlbXB0IHRvIHJlc3RhcnQgJHtzY3JpcHRJZH0gaW4gJHtkZWxheVNlY29uZHN9IHNlY29uZHNgKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnc3RhcnRlZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRpcy5zdGFydFRhaWxDb25uZWN0aW9uKHJlY29yZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBkZWxheVNlY29uZHMgKiAxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25FcnJvciAoX2NuLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzMy5vblRhaWxDb25uZWN0aW9uRXJyb3IoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBlcnJvckluZm8pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxNZXNzYWdlIChfY24sIHRpbWVTdGFtcCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSAhPT0gJ3N0YXJ0ZWQnKSByZXR1cm47CiAgICAgICAgICAgICAgICBjYWxsYmFja3MzLm9uVGFpbENvbm5lY3Rpb25NZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgbWVzc2FnZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVW5wYXJzZWRNZXNzYWdlIChfY24sIHRpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVW5wYXJzZWRNZXNzYWdlJywgdGltZVN0YW1wLCBtZXNzYWdlLCBwYXJzZUVycm9yKTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrczMub25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZWNvcmQuY29ubmVjdGlvbiA9IG5ldyBUYWlsQ29ubmVjdGlvbihyZWNvcmQudGFpbC51cmwsIHRhaWxDb25uZWN0aW9uQ2FsbGJhY2tzLCB7CiAgICAgICAgICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM6IHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHMyCiAgICAgICAgfSkuc2V0T3B0aW9ucyh0aGlzLnRhaWxPcHRpb25zKTsKICAgIH0KfQpmdW5jdGlvbiB1bnBhY2tUYWlsS2V5KHRhaWxLZXkpIHsKICAgIGNvbnN0IG0gPSAvXihbXlxzLV0rKS0oW15cc10rKSQvLmV4ZWModGFpbEtleSk7CiAgICBpZiAoIW0pIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxLZXk6ICR7dGFpbEtleX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgYWNjb3VudElkOiBtWzFdLAogICAgICAgIHNjcmlwdElkOiBtWzJdCiAgICB9Owp9CmZ1bmN0aW9uIHBhY2tUYWlsS2V5KGFjY291bnRJZCwgc2NyaXB0SWQpIHsKICAgIHJldHVybiBgJHthY2NvdW50SWR9LSR7c2NyaXB0SWR9YDsKfQpjbGFzcyBTd2l0Y2hhYmxlVGFpbENvbnRyb2xsZXJDYWxsYmFja3MgewogICAgY2FsbGJhY2tzOwogICAgZW5hYmxlZEZuOwogICAgY29uc3RydWN0b3IoY2FsbGJhY2tzMywgZW5hYmxlZEZuKXsKICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrczM7CiAgICAgICAgdGhpcy5lbmFibGVkRm4gPSBlbmFibGVkRm47CiAgICB9CiAgICBvblRhaWxDcmVhdGluZyhhY2NvdW50SWQsIHNjcmlwdElkKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ3JlYXRpbmcoYWNjb3VudElkLCBzY3JpcHRJZCk7CiAgICB9CiAgICBvblRhaWxDcmVhdGVkKGFjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDcmVhdGVkKGFjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpOwogICAgfQogICAgb25UYWlsQ29ubmVjdGlvbk9wZW4oYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCB0b29rTWlsbGlzKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk9wZW4oYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCB0b29rTWlsbGlzKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25DbG9zZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uQ2xvc2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25FcnJvcihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25FcnJvcihhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbyk7CiAgICB9CiAgICBvblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UpOwogICAgfQogICAgb25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uVW5wYXJzZWRNZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcik7CiAgICB9CiAgICBvblRhaWxzQ2hhbmdlZCh0YWlscykgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbHNDaGFuZ2VkKHRhaWxzKTsKICAgIH0KICAgIG9uTmV0d29ya1N0YXR1c0NoYW5nZWQob25saW5lKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXR3b3JrU3RhdHVzQ2hhbmdlZChvbmxpbmUpOwogICAgfQogICAgb25UYWlsRmFpbGVkVG9TdGFydChhY2NvdW50SWQsIHNjcmlwdElkLCB0cmlnZ2VyLCBlcnJvcikgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbEZhaWxlZFRvU3RhcnQoYWNjb3VudElkLCBzY3JpcHRJZCwgdHJpZ2dlciwgZXJyb3IpOwogICAgfQp9CmNsYXNzIERlbW9Nb2RlIHsKICAgIHN0YXRpYyBwcm9maWxlcyA9IFsKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAncHJvZmlsZTEnLAogICAgICAgICAgICB0ZXh0OiAnY29ycC1wcm9maWxlJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3Byb2ZpbGUyJywKICAgICAgICAgICAgdGV4dDogJ3BlcnMtcHJvZmlsZScKICAgICAgICB9LCAKICAgIF07CiAgICBzdGF0aWMgc2VsZWN0ZWRQcm9maWxlSWQgPSAncHJvZmlsZTEnOwogICAgc3RhdGljIHNldFNlbGVjdGVkUHJvZmlsZUlkKF92YWx1ZSkgewogICAgfQogICAgc3RhdGljIHNjcmlwdHMgPSBbCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDEnLAogICAgICAgICAgICB0ZXh0OiAnd29ya2VyMS1kZXYnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0MicsCiAgICAgICAgICAgIHRleHQ6ICd3b3JrZXIxLXByb2QnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0MycsCiAgICAgICAgICAgIHRleHQ6ICd3b3JrZXIyLWRldicKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQ0JywKICAgICAgICAgICAgdGV4dDogJ3dvcmtlcjItYmV0YScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQ1JywKICAgICAgICAgICAgdGV4dDogJ3dvcmtlcjItcHJvZCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQ2JywKICAgICAgICAgICAgdGV4dDogJ2R1cmFibGUtb2JqZWN0LWRlbW8nCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0NycsCiAgICAgICAgICAgIHRleHQ6ICdzZWNyZXQtYXBwJwogICAgICAgIH0sIAogICAgXTsKICAgIHN0YXRpYyBzZWxlY3RlZFNjcmlwdElkcyA9IG5ldyBTZXQoWwogICAgICAgICdzY3JpcHQ3JywKICAgICAgICAnc2NyaXB0NCcKICAgIF0pOwogICAgc3RhdGljIHNldFNlbGVjdGVkU2NyaXB0SWRzKF9zY3JpcHRJZHMpIHsKICAgIH0KICAgIHN0YXRpYyB0YWlscyA9IG5ldyBTZXQoKTsKICAgIHN0YXRpYyBsb2dGYWtlT3V0cHV0KGNhbGxiYWNrcykgewogICAgICAgIGNvbnN0IGFjY291bnRJZCA9ICcxNWE3ZmEzYTM3MjU0ZmU0YTdjYWRkMWJiMjc2Mjg3OSc7CiAgICAgICAgY29uc3Qgc2NyaXB0SWQgPSAnc2VjcmV0LWFwcCc7CiAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENyZWF0aW5nKGFjY291bnRJZCwgc2NyaXB0SWQpOwogICAgICAgIGNvbnN0IHRhaWwgPSB7CiAgICAgICAgICAgIGlkOiAnZGIxOWViOGJlOWY0NDQzYWFiOTFhOTA0MmMwZDM1MTcnLAogICAgICAgICAgICB1cmw6ICd3c3M6Ly90YWlsLmRldmVsb3BlcnMud29ya2Vycy5kZXYvZGIxOWViOGJlOWY0NDQzYWFiOTFhOTA0MmMwZDM1MTcnLAogICAgICAgICAgICAnZXhwaXJlc19hdCc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgIH07CiAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENyZWF0ZWQoYWNjb3VudElkLCBzY3JpcHRJZCwgMTU1LCB0YWlsKTsKICAgICAgICBjYWxsYmFja3Mub25UYWlsc0NoYW5nZWQobmV3IFNldChbCiAgICAgICAgICAgIHBhY2tUYWlsS2V5KGFjY291bnRJZCwgc2NyaXB0SWQpCiAgICAgICAgXSkpOwogICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uT3BlbihhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCA0Mik7CiAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgMjsgaTErKyl7CiAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCBjb21wdXRlRmFrZVJlcXVlc3QoKSk7CiAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCBjb21wdXRlRmFrZURvUmVxdWVzdCgpKTsKICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25NZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCksIGNvbXB1dGVGYWtlUmVxdWVzdFdpdGhMb2dzKCkpOwogICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgRGF0ZS5ub3coKSwgY29tcHV0ZUZha2VSZXF1ZXN0RXhjZWVkaW5nVGltZUxpbWl0KCkpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBVU0VSX0FHRU5UID0gJ01vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwLjE1OyBydjo5MS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzkxLjAnOwpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3QoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL2VuZHBvaW50JywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ2NmLWNvbm5lY3RpbmctaXAnOiAnMjAzLjAuMTEzLjEyJywKICAgICAgICAgICAgICAgICAgICAndXNlci1hZ2VudCc6IFVTRVJfQUdFTlQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZjogewogICAgICAgICAgICAgICAgICAgIGNvbG86ICdERlcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFtdLAogICAgICAgIGV4Y2VwdGlvbnM6IFtdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdvaycKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gY29tcHV0ZUZha2VEb1JlcXVlc3QoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2Zha2UtaG9zdC9wdXQnLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nczogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2xvZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ2xvZ3Byb3BzOicsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvOiAnRVdSJywKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYWJsZU9iamVjdENsYXNzOiAnTG9nZ2VyRE8nLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhYmxlT2JqZWN0SWQ6ICc1MzhmYzdjZTU1YjE0ZTUzYjZiODU1MmJlZmViOWFmNCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmFibGVPYmplY3ROYW1lOiAnbG9nMScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sIAogICAgICAgIF0sCiAgICAgICAgZXhjZXB0aW9uczogW10sCiAgICAgICAgZXZlbnRUaW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgb3V0Y29tZTogJ29rJwogICAgfTsKICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3RXaXRoTG9ncygpIHsKICAgIGNvbnN0IHJ0ID0gewogICAgICAgIGV2ZW50OiB7CiAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vbXktd29ya2VyLnN1YmRvbWFpbi53b3JrZXJzLmRldi90ZXN0P2xvZz10cnVlJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ2NmLWNvbm5lY3RpbmctaXAnOiAnMjAzLjAuMTEzLjEyJywKICAgICAgICAgICAgICAgICAgICAndXNlci1hZ2VudCc6IFVTRVJfQUdFTlQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZjogewogICAgICAgICAgICAgICAgICAgIGNvbG86ICdERlcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdsb2cnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgbWVzc2FnZTogWwogICAgICAgICAgICAgICAgICAgICdMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzY2luZyBlbGl0JwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2Vycm9yJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdpbmZvJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sIAogICAgICAgIF0sCiAgICAgICAgZXhjZXB0aW9uczogW10sCiAgICAgICAgZXZlbnRUaW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgb3V0Y29tZTogJ29rJwogICAgfTsKICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3RFeGNlZWRpbmdUaW1lTGltaXQoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL215LXdvcmtlci5zdWJkb21haW4ud29ya2Vycy5kZXYvY29tcHV0ZS1kaWdpdHMtb2YtcGknLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnY2YtY29ubmVjdGluZy1pcCc6ICcyMDMuMC4xMTMuMTInLAogICAgICAgICAgICAgICAgICAgICd1c2VyLWFnZW50JzogVVNFUl9BR0VOVAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNmOiB7CiAgICAgICAgICAgICAgICAgICAgY29sbzogJ0RGVycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbG9nczogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXZlbDogJ2xvZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ2J1cm5pbmcgY3B1JwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV4Y2VwdGlvbnM6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ0Vycm9yJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdXb3JrZXIgZXhjZWVkZWQgQ1BVIHRpbWUgbGltaXQuJwogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdleGNlZWRlZENwdScKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KY2xhc3MgUXBzQ29udHJvbGxlciB7CiAgICBzb3J0ZWRFdmVudFRpbWVzID0gW107CiAgICBjYWxsYmFja3M7CiAgICBuOwogICAgX3FwcyA9IDA7CiAgICBnZXQgcXBzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9xcHM7CiAgICB9CiAgICBjb25zdHJ1Y3RvcihuMiwgY2FsbGJhY2tzNCl7CiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M0OwogICAgICAgIHRoaXMubiA9IG4yOwogICAgfQogICAgYWRkRXZlbnQoZXZlbnRUaW1lKSB7CiAgICAgICAgY29uc3QgcXBzID0gY29tcHV0ZVFwcyh0aGlzLm4sIHRoaXMuc29ydGVkRXZlbnRUaW1lcywgZXZlbnRUaW1lKTsKICAgICAgICBpZiAocXBzID09PSB0aGlzLl9xcHMpIHJldHVybjsKICAgICAgICB0aGlzLl9xcHMgPSBxcHM7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25RcHNDaGFuZ2VkKHFwcyk7CiAgICB9Cn0KZnVuY3Rpb24gY29tcHV0ZVFwcyhuMywgc29ydGVkRXZlbnRUaW1lcywgZXZlbnRUaW1lKSB7CiAgICBhZGQoZXZlbnRUaW1lLCBzb3J0ZWRFdmVudFRpbWVzKTsKICAgIHdoaWxlKHNvcnRlZEV2ZW50VGltZXMubGVuZ3RoID4gbjMpewogICAgICAgIHNvcnRlZEV2ZW50VGltZXMuc2hpZnQoKTsKICAgIH0KICAgIGNvbnN0IG51bSA9IHNvcnRlZEV2ZW50VGltZXMubGVuZ3RoOwogICAgaWYgKG51bSA8IDIpIHJldHVybiAwOwogICAgY29uc3QgdGltZURpZmZTZWNvbmRzID0gKHNvcnRlZEV2ZW50VGltZXNbc29ydGVkRXZlbnRUaW1lcy5sZW5ndGggLSAxXSAtIHNvcnRlZEV2ZW50VGltZXNbMF0pIC8gMTAwMDsKICAgIHJldHVybiAobnVtIC0gMSkgLyB0aW1lRGlmZlNlY29uZHM7Cn0KZnVuY3Rpb24gYWRkKGVsLCBhcnIpIHsKICAgIGFyci5zcGxpY2UoZmluZExvYyhlbCwgYXJyKSArIDEsIDAsIGVsKTsKICAgIHJldHVybiBhcnI7Cn0KZnVuY3Rpb24gZmluZExvYyhlbCwgYXJyLCBzdCwgZW4pIHsKICAgIHN0ID0gc3QgfHwgMDsKICAgIGVuID0gZW4gfHwgYXJyLmxlbmd0aDsKICAgIGZvcihsZXQgaTEgPSAwOyBpMSA8IGFyci5sZW5ndGg7IGkxKyspewogICAgICAgIGlmIChhcnJbaTFdID4gZWwpIHsKICAgICAgICAgICAgcmV0dXJuIGkxIC0gMTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZW47Cn0KY2xhc3MgV2VidGFpbEFwcFZNIHsKICAgIF9wcm9maWxlcyA9IFtdOwogICAgZ2V0IHByb2ZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlbW9Nb2RlID8gRGVtb01vZGUucHJvZmlsZXMgOiB0aGlzLl9wcm9maWxlczsKICAgIH0KICAgIGdldCByZWFsUHJvZmlsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2ZpbGVzOwogICAgfQogICAgX3NlbGVjdGVkUHJvZmlsZUlkOwogICAgZ2V0IHNlbGVjdGVkUHJvZmlsZUlkKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlbW9Nb2RlID8gRGVtb01vZGUuc2VsZWN0ZWRQcm9maWxlSWQgOiB0aGlzLl9zZWxlY3RlZFByb2ZpbGVJZDsKICAgIH0KICAgIHNldCBzZWxlY3RlZFByb2ZpbGVJZCh2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSB7CiAgICAgICAgICAgIERlbW9Nb2RlLnNldFNlbGVjdGVkUHJvZmlsZUlkKHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQgPT09IHZhbHVlKSByZXR1cm47CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQgPSB2YWx1ZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZFByb2ZpbGVJZCA9IHZhbHVlOwogICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICB0aGlzLmZpbmRTY3JpcHRzKCk7CiAgICB9CiAgICBfc2NyaXB0cyA9IFtdOwogICAgZ2V0IHNjcmlwdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVtb01vZGUgPyBEZW1vTW9kZS5zY3JpcHRzIDogdGhpcy5fc2NyaXB0czsKICAgIH0KICAgIF9zZWxlY3RlZFNjcmlwdElkcyA9IG5ldyBTZXQoKTsKICAgIGdldCBzZWxlY3RlZFNjcmlwdElkcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZW1vTW9kZSA/IERlbW9Nb2RlLnNlbGVjdGVkU2NyaXB0SWRzIDogdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHM7CiAgICB9CiAgICBzZXQgc2VsZWN0ZWRTY3JpcHRJZHMoc2NyaXB0SWRzKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHsKICAgICAgICAgICAgRGVtb01vZGUuc2V0U2VsZWN0ZWRTY3JpcHRJZHMoc2NyaXB0SWRzKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc2V0RXF1YWwodGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHMsIHNjcmlwdElkcykpIHJldHVybjsKICAgICAgICB0aGlzLl9zZWxlY3RlZFNjcmlwdElkcyA9IG5ldyBTZXQoc2NyaXB0SWRzKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgJiYgdGhpcy5zdGF0ZS5wcm9maWxlc1t0aGlzLnNlbGVjdGVkUHJvZmlsZUlkXTsKICAgICAgICBpZiAocHJvZmlsZSkgewogICAgICAgICAgICBwcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzID0gWwogICAgICAgICAgICAgICAgLi4uc2NyaXB0SWRzCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRUYWlscygpOwogICAgfQogICAgcHJvZmlsZUZvcm0gPSBuZXcgUHJvZmlsZUZvcm1WTSgpOwogICAgZmlsdGVyRm9ybSA9IG5ldyBGaWx0ZXJGb3JtVk0oKTsKICAgIGZpbHRlciA9IHsKICAgIH07CiAgICBleHRyYUZpZWxkcyA9IFtdOwogICAgX3RhaWxzID0gbmV3IFNldCgpOwogICAgZ2V0IHRhaWxzKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlbW9Nb2RlID8gRGVtb01vZGUudGFpbHMgOiB0aGlzLl90YWlsczsKICAgIH0KICAgIHNldCB0YWlscyh0YWlscykgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSBEZW1vTW9kZS50YWlscyA9IHRhaWxzOwogICAgICAgIHRoaXMuX3RhaWxzID0gdGFpbHM7CiAgICB9CiAgICB3ZWxjb21lU2hvd2luZyA9IGZhbHNlOwogICAgYWJvdXRTaG93aW5nID0gZmFsc2U7CiAgICBzdGF0ZSA9IGxvYWRTdGF0ZSgpOwogICAgdGFpbENvbnRyb2xsZXI7CiAgICB0YWlsQ29udHJvbGxlckNhbGxiYWNrczsKICAgIHFwc0NvbnRyb2xsZXI7CiAgICBkZW1vTW9kZSA9IGZhbHNlOwogICAgb25DaGFuZ2UgPSAoKT0+ewogICAgfTsKICAgIGxvZ2dlciA9ICgpPT57CiAgICB9OwogICAgb25SZXNldE91dHB1dCA9ICgpPT57CiAgICB9OwogICAgb25RcHNDaGFuZ2UgPSAoKT0+ewogICAgfTsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgY29uc3QgZGlzID0gdGhpczsKICAgICAgICB0aGlzLnFwc0NvbnRyb2xsZXIgPSBuZXcgUXBzQ29udHJvbGxlcigyMCwgewogICAgICAgICAgICBvblFwc0NoYW5nZWQgKHFwcykgewogICAgICAgICAgICAgICAgaWYgKGRpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgZGlzLm9uUXBzQ2hhbmdlKHFwcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjb25zdCBsb2dUYWlsc0NoYW5nZSA9IChhY3Rpb24sIHRhaWxLZXlzKT0+ewogICAgICAgICAgICBpZiAodGFpbEtleXMuc2l6ZSA+IDApIHRoaXMubG9nV2l0aFByZWZpeChgJHthY3Rpb259ICR7WwogICAgICAgICAgICAgICAgLi4udGFpbEtleXMKICAgICAgICAgICAgXS5tYXAoKHYpPT51bnBhY2tUYWlsS2V5KHYpLnNjcmlwdElkCiAgICAgICAgICAgICkuc29ydCgpLmpvaW4oJywgJyl9YCk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBsb2dXaXRoUHJlZml4ID0gdGhpcy5sb2dXaXRoUHJlZml4LmJpbmQodGhpcyk7CiAgICAgICAgY29uc3QgdmVyYm9zZVdpdGhQcmVmaXggPSB0aGlzLnZlcmJvc2VXaXRoUHJlZml4LmJpbmQodGhpcyk7CiAgICAgICAgY29uc3QgY2FsbGJhY2tzNSA9IHsKICAgICAgICAgICAgb25UYWlsQ3JlYXRpbmcgKF9hY2NvdW50SWQsIHNjcmlwdElkKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgQ3JlYXRpbmcgdGFpbCBmb3IgJHtzY3JpcHRJZH0uLi5gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ3JlYXRlZCAoX2FjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpIHsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBDcmVhdGVkIHRhaWwgZm9yICR7c2NyaXB0SWR9IGluICR7dG9va01pbGxpc31tcywgJHtKU09OLnN0cmluZ2lmeSh0YWlsKX1gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbk9wZW4gKF9hY2NvdW50SWQsIHNjcmlwdElkLCBfdGltZVN0YW1wLCB0b29rTWlsbGlzKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgT3BlbmVkIHRhaWwgZm9yICR7c2NyaXB0SWR9IGluICR7dG9va01pbGxpc31tc2ApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uQ2xvc2UgKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVGFpbENvbm5lY3Rpb25DbG9zZScsIHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQsCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQsCiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgICAgcmVhc29uLAogICAgICAgICAgICAgICAgICAgIHdhc0NsZWFuCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBDbG9zZWQgdGFpbCBmb3IgJHtzY3JpcHRJZH0sICR7SlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgICAgcmVhc29uLAogICAgICAgICAgICAgICAgICAgIHdhc0NsZWFuCiAgICAgICAgICAgICAgICB9KX1gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbkVycm9yIChhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVGFpbENvbm5lY3Rpb25FcnJvcicsIHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQsCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQsCiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgIGVycm9ySW5mbwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsb2dXaXRoUHJlZml4KGBFcnJvciBpbiB0YWlsIGZvciAke3NjcmlwdElkfWAsIHsKICAgICAgICAgICAgICAgICAgICBlcnJvckluZm8KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uTWVzc2FnZSAoX2FjY291bnRJZCwgX3NjcmlwdElkLCBfdGltZVN0YW1wLCBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBpZiAoY29tcHV0ZU1lc3NhZ2VQYXNzZXNGaWx0ZXIobWVzc2FnZSwgZGlzLmZpbHRlcikpIHsKICAgICAgICAgICAgICAgICAgICBkdW1wTWVzc2FnZVByZXR0eShtZXNzYWdlLCBkaXMubG9nZ2VyLCBkaXMuY29tcHV0ZUFkZGl0aW9uYWxMb2dzKG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGRpcy5xcHNDb250cm9sbGVyLmFkZEV2ZW50KG1lc3NhZ2UuZXZlbnRUaW1lc3RhbXApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uVW5wYXJzZWRNZXNzYWdlIChfYWNjb3VudElkLCBzY3JpcHRJZCwgX3RpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7CiAgICAgICAgICAgICAgICBsb2dXaXRoUHJlZml4KGBVbnBhcnNlZCBtZXNzYWdlIGluIHRhaWwgZm9yICR7c2NyaXB0SWR9YCwgcGFyc2VFcnJvci5zdGFjayB8fCBwYXJzZUVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxzQ2hhbmdlZCAodGFpbHMpIHsKICAgICAgICAgICAgICAgIGlmIChzZXRFcXVhbChkaXMudGFpbHMsIHRhaWxzKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlZCA9IHNldFN1YnRyYWN0KGRpcy50YWlscywgdGFpbHMpOwogICAgICAgICAgICAgICAgbG9nVGFpbHNDaGFuZ2UoJ1VudGFpbGluZycsIHJlbW92ZWQpOwogICAgICAgICAgICAgICAgY29uc3QgYWRkZWQgPSBzZXRTdWJ0cmFjdCh0YWlscywgZGlzLnRhaWxzKTsKICAgICAgICAgICAgICAgIGxvZ1RhaWxzQ2hhbmdlKCdUYWlsaW5nJywgYWRkZWQpOwogICAgICAgICAgICAgICAgZGlzLnRhaWxzID0gdGFpbHM7CiAgICAgICAgICAgICAgICBkaXMub25DaGFuZ2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25OZXR3b3JrU3RhdHVzQ2hhbmdlZCAob25saW5lKSB7CiAgICAgICAgICAgICAgICBpZiAob25saW5lKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeCgnJWNPTkxJTkUlYycsICdjb2xvcjogZ3JlZW4nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeCgnJWNPRkZMSU5FJWMnLCAnY29sb3I6IHJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxGYWlsZWRUb1N0YXJ0IChfYWNjb3VudElkLCBzY3JpcHRJZCwgdHJpZ2dlciwgZXJyb3IpIHsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBUYWlsIGZvciAke3NjcmlwdElkfSBmYWlsZWQgdG8gc3RhcnQgKCR7dHJpZ2dlcn0pOiAke2Vycm9yLm5hbWV9ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3Qgd2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kczIgPSBBcHBDb25zdGFudHMuV0VCU09DS0VUX1BJTkdfSU5URVJWQUxfU0VDT05EUzsKICAgICAgICBjb25zdCBpbmFjdGl2ZVRhaWxTZWNvbmRzID0gQXBwQ29uc3RhbnRzLklOQUNUSVZFX1RBSUxfU0VDT05EUzsKICAgICAgICB0aGlzLnRhaWxDb250cm9sbGVyID0gbmV3IFRhaWxDb250cm9sbGVyKG5ldyBTd2l0Y2hhYmxlVGFpbENvbnRyb2xsZXJDYWxsYmFja3MoY2FsbGJhY2tzNSwgKCk9PiF0aGlzLmRlbW9Nb2RlCiAgICAgICAgKSwgewogICAgICAgICAgICB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzOiB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzMiwKICAgICAgICAgICAgaW5hY3RpdmVUYWlsU2Vjb25kcwogICAgICAgIH0pOwogICAgICAgIHRoaXMudGFpbENvbnRyb2xsZXJDYWxsYmFja3MgPSBjYWxsYmFja3M1OwogICAgICAgIHRoaXMuZXh0cmFGaWVsZHMgPSBbCiAgICAgICAgICAgIC4uLnRoaXMuc3RhdGUuZXh0cmFGaWVsZHMgfHwgW10KICAgICAgICBdOwogICAgICAgIHRoaXMuZmlsdGVyID0gdGhpcy5zdGF0ZS5maWx0ZXIgfHwgewogICAgICAgIH07CiAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgIHNhdmU6IGZhbHNlCiAgICAgICAgfSk7CiAgICB9CiAgICBzdGFydCgpIHsKICAgICAgICB0aGlzLnJlbG9hZFByb2ZpbGVzKCk7CiAgICAgICAgdGhpcy5yZWNvbXB1dGVXZWxjb21lU2hvd2luZygpOwogICAgICAgIHRoaXMucGVyZm9ybUluaXRpYWxTZWxlY3Rpb24oKTsKICAgIH0KICAgIG5ld1Byb2ZpbGUoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHsKICAgICAgICAgICAgaWYgKHRoaXMud2VsY29tZVNob3dpbmcpIHsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnByb2ZpbGVJZCA9IGdlbmVyYXRlVXVpZCgpOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS50aXRsZSA9ICdOZXcgUHJvZmlsZSc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5uYW1lID0gdGhpcy5fcHJvZmlsZXMubGVuZ3RoID09PSAwID8gJ2RlZmF1bHQnIDogYHByb2ZpbGUke3RoaXMuX3Byb2ZpbGVzLmxlbmd0aCArIDF9YDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSAnJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9ICcnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdFByb2ZpbGUocHJvZmlsZUlkKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdOwogICAgICAgIGlmICghcHJvZmlsZSkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlICR7cHJvZmlsZUlkfSBub3QgZm91bmRgKTsKICAgICAgICB0aGlzLl9zZWxlY3RlZFByb2ZpbGVJZCA9IHByb2ZpbGVJZDsKICAgICAgICBjb25zdCB7IG5hbWU6IG5hbWU0ICwgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ucHJvZmlsZUlkID0gcHJvZmlsZUlkOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS50aXRsZSA9ICdFZGl0IFByb2ZpbGUnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ubmFtZSA9IG5hbWU0OwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYWNjb3VudElkID0gYWNjb3VudElkOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSBhcGlUb2tlbjsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJyc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5jb21wdXRlU2F2ZUVuYWJsZWQoKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBkZWxldGVQcm9maWxlKHByb2ZpbGVJZCkgewogICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGUgcHJvZmlsZScsIHByb2ZpbGVJZCk7CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBpZiAoIXByb2ZpbGUpIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSAke3Byb2ZpbGVJZH0gbm90IGZvdW5kYCk7CiAgICAgICAgZGVsZXRlIHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5yZWxvYWRQcm9maWxlcygpOwogICAgICAgIHRoaXMucmVjb21wdXRlV2VsY29tZVNob3dpbmcoKTsKICAgICAgICB0aGlzLnBlcmZvcm1Jbml0aWFsU2VsZWN0aW9uKCk7CiAgICB9CiAgICBjYW5jZWxQcm9maWxlKCkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVOYW1lKG5hbWUpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2V0UHJvZmlsZUFjY291bnRJZChhY2NvdW50SWQpIHsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFjY291bnRJZCA9IGFjY291bnRJZDsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldFByb2ZpbGVBcGlUb2tlbihhcGlUb2tlbikgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYXBpVG9rZW4gPSBhcGlUb2tlbjsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNhdmVQcm9maWxlKCkgewogICAgICAgIGNvbnN0IHsgcHJvZmlsZUZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHsgcHJvZmlsZUlkICB9ID0gcHJvZmlsZUZvcm07CiAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHsKICAgICAgICAgICAgbmFtZTogcHJvZmlsZUZvcm0ubmFtZS50cmltKCksCiAgICAgICAgICAgIGFjY291bnRJZDogcHJvZmlsZUZvcm0uYWNjb3VudElkLnRyaW0oKSwKICAgICAgICAgICAgYXBpVG9rZW46IHByb2ZpbGVGb3JtLmFwaVRva2VuLnRyaW0oKQogICAgICAgIH07CiAgICAgICAgdGhpcy50cnlTYXZlUHJvZmlsZShwcm9maWxlSWQsIG5ld1Byb2ZpbGUpOwogICAgfQogICAgZWRpdEV2ZW50RmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnRXZlbnQgdHlwZTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnYWxsJywKICAgICAgICAgICAgICAgIHRleHQ6ICdBbGwnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnY3JvbicsCiAgICAgICAgICAgICAgICB0ZXh0OiAnQ1JPTiB0cmlnZ2VyJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZDogJ2h0dHAnLAogICAgICAgICAgICAgICAgdGV4dDogJ0hUVFAgcmVxdWVzdCcKICAgICAgICAgICAgfSwgCiAgICAgICAgXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmlsdGVyLmV2ZW50MSA9PT0gJ2h0dHAnID8gJ2h0dHAnIDogZmlsdGVyLmV2ZW50MSA9PT0gJ2Nyb24nID8gJ2Nyb24nIDogJ2FsbCc7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdDaG9vc2Ugd2hpY2ggdHlwZXMgb2YgZXZlbnRzIHRvIHNob3cnOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGlmIChmaWx0ZXIuZXZlbnQxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLmV2ZW50MSA9IGZpbHRlckZvcm0uZmllbGRWYWx1ZTsKICAgICAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgICAgICBzYXZlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZENob2ljZVRleHQgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzLmZpbmQoKHYpPT52LmlkID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUKICAgICAgICAgICAgKS50ZXh0OwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYEV2ZW50IHR5cGUgZmlsdGVyIGNoYW5nZWQgdG86ICR7c2VsZWN0ZWRDaG9pY2VUZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdFN0YXR1c0ZpbHRlcigpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyICwgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ1N0YXR1czonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnYWxsJywKICAgICAgICAgICAgICAgIHRleHQ6ICdBbGwnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICB0ZXh0OiAnU3VjY2VzcycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdlcnJvcicsCiAgICAgICAgICAgICAgICB0ZXh0OiAnRXJyb3InCiAgICAgICAgICAgIH0sIAogICAgICAgIF07CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGZpbHRlci5zdGF0dXMxID09PSAnc3VjY2VzcycgPyAnc3VjY2VzcycgOiBmaWx0ZXIuc3RhdHVzMSA9PT0gJ2Vycm9yJyA/ICdlcnJvcicgOiAnYWxsJzsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gJ1Nob3cgZXZlbnRzIHRoaXMgdGhpcyBzdGF0dXMnOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGlmIChmaWx0ZXIuc3RhdHVzMSA9PT0gZmlsdGVyRm9ybS5maWVsZFZhbHVlKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5zdGF0dXMxID0gZmlsdGVyRm9ybS5maWVsZFZhbHVlOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkQ2hvaWNlVGV4dCA9IGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMuZmluZCgodik9PnYuaWQgPT09IGZpbHRlckZvcm0uZmllbGRWYWx1ZQogICAgICAgICAgICApLnRleHQ7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgU3RhdHVzIGZpbHRlciBjaGFuZ2VkIHRvOiAke3NlbGVjdGVkQ2hvaWNlVGV4dH1gKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGVkaXRJcEFkZHJlc3NGaWx0ZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IGlzVmFsaWRJcEFkZHJlc3MgPSAoaXBBZGRyZXNzKT0+ewogICAgICAgICAgICByZXR1cm4gL14oc2VsZnxbXGRcLjphLWZdezMsfSkkLy50ZXN0KGlwQWRkcmVzcyk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjaGVja1ZhbGlkSXBBZGRyZXNzID0gKGlwQWRkcmVzcyk9PnsKICAgICAgICAgICAgaWYgKCFpc1ZhbGlkSXBBZGRyZXNzKGlwQWRkcmVzcykpIHRocm93IG5ldyBFcnJvcihgQmFkIGlwIGFkZHJlc3M6ICR7aXBBZGRyZXNzfWApOwogICAgICAgICAgICByZXR1cm4gaXBBZGRyZXNzOwogICAgICAgIH07CiAgICAgICAgY29uc3QgcGFyc2VGaWx0ZXJJcEFkZHJlc3Nlc0Zyb21GaWVsZFZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgeyBmaWVsZFZhbHVlICB9ID0gZmlsdGVyRm9ybTsKICAgICAgICAgICAgY29uc3QgdiA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2ID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3Qodi5zcGxpdCgnLCcpLm1hcCgodjEpPT52MS50cmltKCkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICApLmZpbHRlcigodjEpPT52MSAhPT0gJycKICAgICAgICAgICAgKS5tYXAoY2hlY2tWYWxpZElwQWRkcmVzcykpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgY29tcHV0ZUZpZWxkVmFsdWVGcm9tRmlsdGVySXBBZGRyZXNzZXMgPSAoKT0+ewogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QoZmlsdGVyLmlwQWRkcmVzczEgfHwgW10pLmpvaW4oJywgJyk7CiAgICAgICAgfTsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnSVAgYWRkcmVzcyhzKTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gY29tcHV0ZUZpZWxkVmFsdWVGcm9tRmlsdGVySXBBZGRyZXNzZXMoKTsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gYCdzZWxmJyB0byBmaWx0ZXIgeW91ciBvd24gYWRkcmVzcywgY29tbWEtc2VwYXJhdGVkIGlmIG11bHRpcGxlLCBlLmcuIHNlbGYsIDEuMS4xLjFgOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGFyc2VGaWx0ZXJJcEFkZHJlc3Nlc0Zyb21GaWVsZFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzZXRFcXVhbChuZXcgU2V0KGZpbHRlci5pcEFkZHJlc3MxIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZSkpKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5pcEFkZHJlc3MxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlLmxlbmd0aCA9PT0gMCA/ICdhbnkgSVAgYWRkcmVzcycgOiBuZXdWYWx1ZS5qb2luKCcsICcpOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYElQIGFkZHJlc3MgZmlsdGVyIGNoYW5nZWQgdG86ICR7dGV4dH1gKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGVkaXRNZXRob2RGaWx0ZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHBhcnNlRmlsdGVyTWV0aG9kc0Zyb21GaWVsZFZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgeyBmaWVsZFZhbHVlICB9ID0gZmlsdGVyRm9ybTsKICAgICAgICAgICAgY29uc3QgdiA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2ID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3Qodi5zcGxpdCgnLCcpLm1hcCgodjEpPT52MS50cmltKCkudG9VcHBlckNhc2UoKQogICAgICAgICAgICApLmZpbHRlcigodjEpPT52MSAhPT0gJycKICAgICAgICAgICAgKSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJNZXRob2RzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5tZXRob2QxIHx8IFtdKS5tYXAoKHYpPT52LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0hUVFAgTWV0aG9kKHMpOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJNZXRob2RzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdjb21tYS1zZXBhcmF0ZWQgaWYgbXVsdGlwbGUsIGUuZy4gR0VULCBQT1NUJzsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmlsdGVyTWV0aG9kc0Zyb21GaWVsZFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzZXRFcXVhbChuZXcgU2V0KGZpbHRlci5tZXRob2QxIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZSkpKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5tZXRob2QxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlLmxlbmd0aCA9PT0gMCA/ICdhbnkgbWV0aG9kJyA6IG5ld1ZhbHVlLmpvaW4oJywgJyk7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgTWV0aG9kIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2FtcGxpbmdSYXRlRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgcGFyc2VTYW1wbGVSYXRlRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2ID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYgPT09ICcnKSByZXR1cm4gMTsKICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2KTsKICAgICAgICAgICAgaWYgKCFpc1ZhbGlkU2FtcGxpbmdSYXRlKG51bSkpIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCByYXRlOiAke3Z9YCk7CiAgICAgICAgICAgIHJldHVybiBudW07CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGZpbHRlckZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkTmFtZSA9ICdTYW1wbGluZyByYXRlOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSAodHlwZW9mIGZpbHRlci5zYW1wbGluZ1JhdGUxID09PSAnbnVtYmVyJyAmJiBpc1ZhbGlkU2FtcGxpbmdSYXRlKGZpbHRlci5zYW1wbGluZ1JhdGUxKSA/IGZpbHRlci5zYW1wbGluZ1JhdGUxIDogMSkudG9GaXhlZCgyKTsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gJ0NhbiByYW5nZSBmcm9tIDAgKDAlKSB0byAxICgxMDAlKSc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZVNhbXBsZVJhdGVGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoZmlsdGVyLnNhbXBsaW5nUmF0ZTEgPT09IG5ld1ZhbHVlKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5zYW1wbGluZ1JhdGUxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlID09PSAxID8gJ25vIHNhbXBsaW5nJyA6IGAke25ld1ZhbHVlfSAoJHsobmV3VmFsdWUgKiAxMDApLnRvRml4ZWQoMil9JSlgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNhbXBsZSByYXRlIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2VhcmNoRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnU2VhcmNoIHRleHQ6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGZpbHRlci5zZWFyY2gxIHx8ICcnOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnRmlsdGVyIGJ5IGEgdGV4dCBtYXRjaCBpbiBjb25zb2xlLmxvZyBtZXNzYWdlcyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5zZWFyY2gxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLnNlYXJjaDEgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IChmaWx0ZXIuc2VhcmNoMSB8fCAnJykubGVuZ3RoID09PSAwID8gJ25vIHNlYXJjaCBmaWx0ZXInIDogYCcke2ZpbHRlci5zZWFyY2gxfSdgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNlYXJjaCBmaWx0ZXIgY2hhbmdlZCB0bzogJHt0ZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdEhlYWRlckZpbHRlcigpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyICwgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgcGFyc2VGaWx0ZXJIZWFkZXJzRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2ID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYgPT09ICcnKSByZXR1cm4gW107CiAgICAgICAgICAgIHJldHVybiBkaXN0aW5jdCh2LnNwbGl0KCcsJykubWFwKCh2MSk9PnYxLnRyaW0oKQogICAgICAgICAgICApLmZpbHRlcigodjEpPT52MSAhPT0gJycKICAgICAgICAgICAgKSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJIZWFkZXJzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5oZWFkZXIxIHx8IFtdKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0hlYWRlcihzKTonOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gY29tcHV0ZUZpZWxkVmFsdWVGcm9tRmlsdGVySGVhZGVycygpOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSBgJ2tleScsIG9yICdrZXk6cXVlcnknLCBjb21tYS1zZXBhcmF0ZWQgaWYgbXVsdGlwbGVgOwogICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGFyc2VGaWx0ZXJIZWFkZXJzRnJvbUZpZWxkVmFsdWUoKTsKICAgICAgICAgICAgaWYgKHNldEVxdWFsKG5ldyBTZXQoZmlsdGVyLmhlYWRlcjEgfHwgW10pLCBuZXcgU2V0KG5ld1ZhbHVlKSkpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLmhlYWRlcjEgPSBuZXdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgICAgICBzYXZlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gbmV3VmFsdWUubGVuZ3RoID09PSAwID8gJ25vIGhlYWRlciBmaWx0ZXInIDogbmV3VmFsdWUuam9pbignLCAnKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBIZWFkZXIgZmlsdGVyIGNoYW5nZWQgdG86ICR7dGV4dH1gKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGhhc0FueUZpbHRlcnMoKSB7CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHsgZXZlbnQxICB9ID0gZmlsdGVyOwogICAgICAgIHJldHVybiBjb21wdXRlVGFpbE9wdGlvbnNGb3JGaWx0ZXIoZmlsdGVyKS5maWx0ZXJzLmxlbmd0aCA+IDAgfHwgdHlwZW9mIGV2ZW50MSA9PT0gJ3N0cmluZycgJiYgZXZlbnQxICE9PSAnJyAmJiBldmVudDEgIT09ICdhbGwnOwogICAgfQogICAgcmVzZXRGaWx0ZXJzKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5maWx0ZXIgPSB7CiAgICAgICAgfTsKICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgRmlsdGVycyByZXNldGApOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGNhbmNlbEZpbHRlcigpIHsKICAgICAgICBjb25zb2xlLmxvZygnY2FuY2VsRmlsdGVyJyk7CiAgICAgICAgdGhpcy5maWx0ZXJGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBzYXZlRmlsdGVyKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdzYXZlRmlsdGVyJyk7CiAgICAgICAgY29uc3QgeyBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICBmaWx0ZXJGb3JtLm91dHB1dE1lc3NhZ2UgPSAnQ2hlY2tpbmcgZmlsdGVyLi4uJzsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlKCk7CiAgICAgICAgICAgIGZpbHRlckZvcm0ub3V0cHV0TWVzc2FnZSA9IGBgOwogICAgICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGZpbHRlckZvcm0ub3V0cHV0TWVzc2FnZSA9IGBFcnJvcjogJHtlLm1lc3NhZ2V9YDsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICBzZWxlY3RGaWx0ZXJDaG9pY2UoaWQpIHsKICAgICAgICBpZiAodGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPT09IGlkKSByZXR1cm47CiAgICAgICAgdGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBpZDsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2VsZWN0aW9uRmllbGRzKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnQWRkaXRpb25hbCBmaWVsZHM6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IEVYVFJBX0ZJRUxEU19PUFRJT05TOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9ICh0aGlzLmV4dHJhRmllbGRzIHx8IFtdKS5qb2luKCcsJyk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdTZWxlY3QgYWRkaXRpb25hbCBmaWVsZHMgdG8gc2hvdyBpbiB0aGUgb3V0cHV0JzsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZXMgPSBkaXN0aW5jdCgoZmlsdGVyRm9ybS5maWVsZFZhbHVlIHx8ICcnKS5zcGxpdCgnLCcpLm1hcCgodik9PnYudHJpbSgpCiAgICAgICAgICAgICkuZmlsdGVyKCh2KT0+diAhPT0gJycKICAgICAgICAgICAgKSk7CiAgICAgICAgICAgIGlmIChzZXRFcXVhbChuZXcgU2V0KHRoaXMuZXh0cmFGaWVsZHMgfHwgW10pLCBuZXcgU2V0KG5ld1ZhbHVlcykpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuZXh0cmFGaWVsZHMgPSBuZXdWYWx1ZXM7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgZXh0cmFGaWVsZHNUZXh0ID0gdGhpcy5jb21wdXRlU2VsZWN0aW9uRmllbGRzVGV4dCgpOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYE91dHB1dCBmaWVsZHMgY2hhbmdlZCB0bzogJHtleHRyYUZpZWxkc1RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBjb21wdXRlU2VsZWN0aW9uRmllbGRzVGV4dCgpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAnc3RhbmRhcmQgZmllbGRzJywKICAgICAgICAgICAgLi4udGhpcy5leHRyYUZpZWxkcy5tYXAoKGlkKT0+RVhUUkFfRklFTERTX09QVElPTlMuZmluZCgodik9PnYuaWQgPT09IGlkCiAgICAgICAgICAgICAgICApPy50ZXh0IHx8IGlkCiAgICAgICAgICAgICkKICAgICAgICBdLmpvaW4oJywgJyk7CiAgICB9CiAgICB0b2dnbGVGaWx0ZXJPcHRpb24oaWQpIHsKICAgICAgICBjb25zdCBleHRyYUZpZWxkcyA9IGRpc3RpbmN0KCh0aGlzLmZpbHRlckZvcm0uZmllbGRWYWx1ZSB8fCAnJykuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKQogICAgICAgICkuZmlsdGVyKCh2KT0+diAhPT0gJycKICAgICAgICApKTsKICAgICAgICBjb25zdCBpMSA9IGV4dHJhRmllbGRzLmluZGV4T2YoaWQpOwogICAgICAgIGlmIChpMSA+PSAwKSB7CiAgICAgICAgICAgIGV4dHJhRmllbGRzLnNwbGljZShpMSwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXh0cmFGaWVsZHMucHVzaChpZCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSBleHRyYUZpZWxkcy5qb2luKCcsJyk7CiAgICAgICAgaWYgKHRoaXMuZmlsdGVyRm9ybS5maWVsZFZhbHVlID09PSBmaWVsZFZhbHVlKSByZXR1cm47CiAgICAgICAgdGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBmaWVsZFZhbHVlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHRvZ2dsZURlbW9Nb2RlKCkgewogICAgICAgIHRoaXMuc2V0RGVtb01vZGUoIXRoaXMuZGVtb01vZGUpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHJlc2V0T3V0cHV0KCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5vblJlc2V0T3V0cHV0KCk7CiAgICB9CiAgICBzaG93QWJvdXQoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICB0aGlzLmFib3V0U2hvd2luZyA9IHRydWU7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgY2xvc2VBYm91dCgpIHsKICAgICAgICB0aGlzLmFib3V0U2hvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldERlbW9Nb2RlKGRlbW9Nb2RlKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUgPT09IGRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5kZW1vTW9kZSA9IGRlbW9Nb2RlOwogICAgICAgIGlmIChkZW1vTW9kZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnRW5hYmxlIGRlbW8gbW9kZScpOwogICAgICAgICAgICB0aGlzLm9uUXBzQ2hhbmdlKDEyLjM0KTsKICAgICAgICAgICAgdGhpcy5vblJlc2V0T3V0cHV0KCk7CiAgICAgICAgICAgIERlbW9Nb2RlLmxvZ0Zha2VPdXRwdXQodGhpcy50YWlsQ29udHJvbGxlckNhbGxiYWNrcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0Rpc2FibGUgZGVtbyBtb2RlJyk7CiAgICAgICAgICAgIHRoaXMub25RcHNDaGFuZ2UodGhpcy5xcHNDb250cm9sbGVyLnFwcyk7CiAgICAgICAgICAgIHRoaXMub25SZXNldE91dHB1dCgpOwogICAgICAgIH0KICAgIH0KICAgIGFwcGx5RmlsdGVyKG9wdHMpIHsKICAgICAgICBjb25zdCB7IHNhdmUgIH0gPSBvcHRzOwogICAgICAgIHRoaXMuc3RhdGUuZmlsdGVyID0gdGhpcy5maWx0ZXI7CiAgICAgICAgdGhpcy5zdGF0ZS5leHRyYUZpZWxkcyA9IHRoaXMuZXh0cmFGaWVsZHM7CiAgICAgICAgaWYgKHNhdmUpIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICBjb25zdCB0YWlsT3B0aW9ucyA9IGNvbXB1dGVUYWlsT3B0aW9uc0ZvckZpbHRlcih0aGlzLmZpbHRlcik7CiAgICAgICAgdGhpcy50YWlsQ29udHJvbGxlci5zZXRUYWlsT3B0aW9ucyh0YWlsT3B0aW9ucyk7CiAgICB9CiAgICBsb2dXaXRoUHJlZml4KC4uLmRhdGEpIHsKICAgICAgICBjb25zdCB0aW1lID0gZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhuZXcgRGF0ZSgpKTsKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwICYmIHR5cGVvZiBkYXRhWzBdID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBkYXRhID0gWwogICAgICAgICAgICAgICAgYFslYyR7dGltZX0lY10gJHtkYXRhWzBdfWAsCiAgICAgICAgICAgICAgICAnY29sb3I6IGdyYXknLAogICAgICAgICAgICAgICAgJycsCiAgICAgICAgICAgICAgICAuLi5kYXRhLnNsaWNlKDEpCiAgICAgICAgICAgIF07CiAgICAgICAgfQogICAgICAgIHRoaXMubG9nZ2VyKC4uLmRhdGEpOwogICAgfQogICAgdmVyYm9zZVdpdGhQcmVmaXgobWVzc2FnZSkgewogICAgICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpOwogICAgICAgIHRoaXMubG9nZ2VyKGBbJWMke3RpbWV9JWNdICVjJHttZXNzYWdlfSVjYCwgJ2NvbG9yOiBncmF5JywgJycsICdjb2xvcjogZ3JheScpOwogICAgfQogICAgcGVyZm9ybUluaXRpYWxTZWxlY3Rpb24oKSB7CiAgICAgICAgY29uc3QgaW5pdGlhbGx5U2VsZWN0ZWRQcm9maWxlSWQgPSBjb21wdXRlSW5pdGlhbGx5U2VsZWN0ZWRQcm9maWxlSWQodGhpcy5zdGF0ZSwgdGhpcy5fcHJvZmlsZXMpOwogICAgICAgIGlmIChpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgSW5pdGlhbGx5IHNlbGVjdGluZyBwcm9maWxlOiAke3RoaXMuc3RhdGUucHJvZmlsZXNbaW5pdGlhbGx5U2VsZWN0ZWRQcm9maWxlSWRdLm5hbWV9YCk7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgPSBpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgdHJ5U2F2ZVByb2ZpbGUocHJvZmlsZUlkLCBwcm9maWxlKSB7CiAgICAgICAgY29uc3QgeyBwcm9maWxlRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgcHJvZmlsZUZvcm0uZW5hYmxlZCA9IGZhbHNlOwogICAgICAgIHByb2ZpbGVGb3JtLnByb2dyZXNzVmlzaWJsZSA9IHRydWU7CiAgICAgICAgcHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9ICdDaGVja2luZyBwcm9maWxlLi4uJzsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgY2FuTGlzdFRhaWxzID0gYXdhaXQgY29tcHV0ZUNhbkxpc3RUYWlscyhwcm9maWxlLmFjY291bnRJZCwgcHJvZmlsZS5hcGlUb2tlbik7CiAgICAgICAgICAgIGlmIChjYW5MaXN0VGFpbHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXSA9IHByb2ZpbGU7CiAgICAgICAgICAgICAgICBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLnJlbG9hZFByb2ZpbGVzKCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlY29tcHV0ZVdlbGNvbWVTaG93aW5nKCk7CiAgICAgICAgICAgICAgICBwcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZUlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZSA9IGBUaGVzZSBjcmVkZW50aWFscyBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHRhaWxgOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gYEVycm9yOiAke2UubWVzc2FnZX1gOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgcHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHByb2ZpbGVGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfQogICAgfQogICAgcmVsb2FkUHJvZmlsZXMoKSB7CiAgICAgICAgY29uc3QgeyBzdGF0ZSAgfSA9IHRoaXM7CiAgICAgICAgdGhpcy5fcHJvZmlsZXMuc3BsaWNlKDApOwogICAgICAgIGZvciAoY29uc3QgW3Byb2ZpbGVJZCwgcHJvZmlsZV0gb2YgT2JqZWN0LmVudHJpZXMoc3RhdGUucHJvZmlsZXMpKXsKICAgICAgICAgICAgY29uc3QgbmFtZTQgPSBwcm9maWxlLm5hbWUgfHwgJyh1bm5hbWVkKSc7CiAgICAgICAgICAgIHRoaXMuX3Byb2ZpbGVzLnB1c2goewogICAgICAgICAgICAgICAgaWQ6IHByb2ZpbGVJZCwKICAgICAgICAgICAgICAgIHRleHQ6IG5hbWU0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGZpbmRTY3JpcHRzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgICAgIGlmIChwcm9maWxlID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICAgICAgICAgIHRoaXMudmVyYm9zZVdpdGhQcmVmaXgoYEZpbmRpbmcgc2NyaXB0cyBmb3IgJHtwcm9maWxlLm5hbWUudG9VcHBlckNhc2UoKX0uLi5gKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjb25zdCBzY3JpcHRzID0gYXdhaXQgbGlzdFNjcmlwdHMoYWNjb3VudElkLCBhcGlUb2tlbik7CiAgICAgICAgICAgIGlmICghdGhpcy5kZW1vTW9kZSkgdGhpcy52ZXJib3NlV2l0aFByZWZpeChgRm91bmQgJHtzY3JpcHRzLmxlbmd0aH0gc2NyaXB0cyBpbiAke0RhdGUubm93KCkgLSBzdGFydH1tc2ApOwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNwbGljZSgwKTsKICAgICAgICAgICAgZm9yIChjb25zdCBzY3JpcHQgb2Ygc2NyaXB0cyl7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBzY3JpcHQuaWQsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogc2NyaXB0LmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNvcnQoKGxocywgcmhzKT0+bGhzLnRleHQubG9jYWxlQ29tcGFyZShyaHMudGV4dCkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRTY3JpcHRJZHMgPSB0aGlzLmNvbXB1dGVTZWxlY3RlZFNjcmlwdElkc0FmdGVyRmluZFNjcmlwdHMoKTsKICAgICAgICAgICAgaWYgKHNlbGVjdGVkU2NyaXB0SWRzLnNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2NyaXB0SWRzID0gc2VsZWN0ZWRTY3JpcHRJZHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLmRlbW9Nb2RlKSB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuZGVtb01vZGUpIHRoaXMubG9nZ2VyKGBFcnJvciBpbiBmaW5kU2NyaXB0czogJHtlLnN0YWNrfWApOwogICAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVTZWxlY3RlZFNjcmlwdElkc0FmdGVyRmluZFNjcmlwdHMoKSB7CiAgICAgICAgaWYgKHRoaXMuX3NjcmlwdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsbHkgc2VsZWN0aW5nIG5vIHNjcmlwdHMsIG5vIHNjcmlwdHMgdG8gc2VsZWN0Jyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgU2V0KCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkICYmIHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgJiYgdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdGhpcy5zdGF0ZS5zZWxlY3RlZFByb2ZpbGVJZCkgewogICAgICAgICAgICBjb25zdCBpbml0aWFsUHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgICAgIGlmIChpbml0aWFsUHJvZmlsZSAmJiBpbml0aWFsUHJvZmlsZS5zZWxlY3RlZFNjcmlwdElkcyAmJiBpbml0aWFsUHJvZmlsZS5zZWxlY3RlZFNjcmlwdElkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2NyaXB0SWRzID0gbmV3IFNldCh0aGlzLl9zY3JpcHRzLm1hcCgodik9PnYuaWQKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IHNldEludGVyc2VjdChjdXJyZW50U2NyaXB0SWRzLCBuZXcgU2V0KGluaXRpYWxQcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzKSk7CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlcy5zaXplID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbml0aWFsbHkgc2VsZWN0aW5nIHNjcmlwdCR7Y2FuZGlkYXRlcy5zaXplID09PSAxID8gJycgOiAncyd9ICR7WwogICAgICAgICAgICAgICAgICAgICAgICAuLi5jYW5kaWRhdGVzCiAgICAgICAgICAgICAgICAgICAgXS5zb3J0KCkuam9pbignLCAnKX06IHJlbWVtYmVyZWQgZnJvbSBsYXN0IHRpbWVgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBmaXJzdFNjcmlwdElkID0gdGhpcy5fc2NyaXB0c1swXS5pZDsKICAgICAgICBjb25zb2xlLmxvZyhgSW5pdGlhbGx5IHNlbGVjdGluZyBzY3JpcHQgJHtmaXJzdFNjcmlwdElkfTogZmlyc3Qgb25lIGluIHRoZSBsaXN0YCk7CiAgICAgICAgcmV0dXJuIG5ldyBTZXQoWwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzWzBdLmlkCiAgICAgICAgXSk7CiAgICB9CiAgICBhc3luYyBzZXRUYWlscygpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgaWYgKHByb2ZpbGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMudGFpbENvbnRyb2xsZXIuc2V0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbiwgdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHMpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5sb2dnZXIoJ0Vycm9yIGluIHNldFRhaWxzJywgZS5zdGFjayB8fCBlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVBZGRpdGlvbmFsTG9ncyhtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgcnQgPSBbXTsKICAgICAgICBjb25zdCBpbmNsdWRlSXBBZGRyZXNzID0gdGhpcy5leHRyYUZpZWxkcy5pbmNsdWRlcygnaXAtYWRkcmVzcycpOwogICAgICAgIGNvbnN0IGluY2x1ZGVVc2VyQWdlbnQgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCd1c2VyLWFnZW50Jyk7CiAgICAgICAgY29uc3QgaW5jbHVkZVJlZmVyZXIgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCdyZWZlcmVyJyk7CiAgICAgICAgaWYgKGluY2x1ZGVJcEFkZHJlc3MgfHwgaW5jbHVkZVVzZXJBZ2VudCB8fCBpbmNsdWRlUmVmZXJlcikgewogICAgICAgICAgICBpZiAoIWlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQobWVzc2FnZS5ldmVudCkpIHsKICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlSXBBZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXBBZGRyZXNzID0gbWVzc2FnZS5ldmVudC5yZXF1ZXN0LmhlYWRlcnNbJ2NmLWNvbm5lY3RpbmctaXAnXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlwQWRkcmVzcykgcnQucHVzaChjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQoJ0lQIGFkZHJlc3MnLCBpcEFkZHJlc3MpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlVXNlckFnZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlckFnZW50ID0gbWVzc2FnZS5ldmVudC5yZXF1ZXN0LmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJBZ2VudCkgcnQucHVzaChjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQoJ1VzZXIgYWdlbnQnLCB1c2VyQWdlbnQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlUmVmZXJlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZmVyZXIgPSBtZXNzYWdlLmV2ZW50LnJlcXVlc3QuaGVhZGVyc1sncmVmZXJlciddIHx8IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmZXJlcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWZlcmVyVXJsID0gdHJ5UGFyc2VVcmwocmVmZXJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmZXJlclVybCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0VXJsID0gdHJ5UGFyc2VVcmwobWVzc2FnZS5ldmVudC5yZXF1ZXN0LnVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdFVybCAmJiByZXF1ZXN0VXJsLm9yaWdpbiA9PT0gcmVmZXJlclVybC5vcmlnaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nKSBydC5wdXNoKGNvbXB1dGVBZGRpdGlvbmFsTG9nRm9yRXh0cmFGaWVsZCgnUmVmZXJlcicsIHJlZmVyZXIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQogICAgcmVjb21wdXRlV2VsY29tZVNob3dpbmcoKSB7CiAgICAgICAgY29uc3Qgc2hvdWxkU2hvdyA9IHRoaXMucHJvZmlsZXMubGVuZ3RoID09PSAwOwogICAgICAgIGlmIChzaG91bGRTaG93ID09PSB0aGlzLndlbGNvbWVTaG93aW5nKSByZXR1cm47CiAgICAgICAgdGhpcy5zZXREZW1vTW9kZShzaG91bGRTaG93KTsKICAgICAgICB0aGlzLndlbGNvbWVTaG93aW5nID0gc2hvdWxkU2hvdzsKICAgIH0KfQpmdW5jdGlvbiBjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQobmFtZTQsIHZhbHVlKSB7CiAgICByZXR1cm4gewogICAgICAgIGRhdGE6IFsKICAgICAgICAgICAgYCAlY3wlYyBbJWMke25hbWU0fSVjXSAke3ZhbHVlfWAsCiAgICAgICAgICAgICdjb2xvcjpncmF5JywKICAgICAgICAgICAgJycsCiAgICAgICAgICAgICdjb2xvcjpncmF5JwogICAgICAgIF0KICAgIH07Cn0KY2xhc3MgUHJvZmlsZUZvcm1WTSB7CiAgICBzaG93aW5nID0gZmFsc2U7CiAgICBlbmFibGVkID0gZmFsc2U7CiAgICBuYW1lID0gJyc7CiAgICBhY2NvdW50SWQgPSAnJzsKICAgIGFwaVRva2VuID0gJyc7CiAgICBkZWxldGVWaXNpYmxlID0gZmFsc2U7CiAgICBzYXZlRW5hYmxlZCA9IGZhbHNlOwogICAgcHJvZmlsZUlkID0gJyc7CiAgICB0aXRsZSA9ICcnOwogICAgcHJvZ3Jlc3NWaXNpYmxlID0gZmFsc2U7CiAgICBvdXRwdXRNZXNzYWdlID0gJyc7CiAgICBjb21wdXRlU2F2ZUVuYWJsZWQoKSB7CiAgICAgICAgdGhpcy5zYXZlRW5hYmxlZCA9IHRoaXMubmFtZS50cmltKCkubGVuZ3RoID4gMCAmJiB0aGlzLmFwaVRva2VuLnRyaW0oKS5sZW5ndGggPiAwICYmIHRoaXMuYWNjb3VudElkLnRyaW0oKS5sZW5ndGggPiAwOwogICAgfQp9CmNsYXNzIEZpbHRlckZvcm1WTSB7CiAgICBzaG93aW5nID0gZmFsc2U7CiAgICBlbmFibGVkID0gZmFsc2U7CiAgICBmaWVsZE5hbWUgPSAnJzsKICAgIGZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICBmaWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgZmllbGRWYWx1ZTsKICAgIGhlbHBUZXh0ID0gJyc7CiAgICBvdXRwdXRNZXNzYWdlID0gJyc7CiAgICBhcHBseVZhbHVlID0gKCk9PnsKICAgIH07Cn0KY29uc3QgRVhUUkFfRklFTERTX09QVElPTlMgPSBbCiAgICB7CiAgICAgICAgaWQ6ICdpcC1hZGRyZXNzJywKICAgICAgICB0ZXh0OiAnSVAgYWRkcmVzcycKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICd1c2VyLWFnZW50JywKICAgICAgICB0ZXh0OiAnVXNlciBhZ2VudCcKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICdyZWZlcmVyJywKICAgICAgICB0ZXh0OiAnUmVmZXJlcicKICAgIH0sIApdOwpjb25zdCBTVEFURV9LRVkgPSAnc3RhdGUxJzsKZnVuY3Rpb24gbG9hZFN0YXRlKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBqc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RBVEVfS0VZKSB8fCB1bmRlZmluZWQ7CiAgICAgICAgaWYgKGpzb24pIHsKICAgICAgICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShqc29uKTsKICAgICAgICAgICAgY29uc3QgcnQgPSBwYXJzZVN0YXRlKG9iaik7CiAgICAgICAgICAgIHJldHVybiBydDsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdsb2FkU3RhdGU6IEVycm9yIGxvYWRpbmcgc3RhdGUnLCBlKTsKICAgIH0KICAgIGNvbnNvbGUubG9nKCdsb2FkU3RhdGU6IHJldHVybmluZyBuZXcgc3RhdGUnKTsKICAgIHJldHVybiB7CiAgICAgICAgcHJvZmlsZXM6IHsKICAgICAgICB9CiAgICB9Owp9CmZ1bmN0aW9uIHBhcnNlU3RhdGUocGFyc2VkKSB7CiAgICBpZiAodHlwZW9mIHBhcnNlZCAhPT0gJ29iamVjdCcpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgb2JqZWN0YCk7CiAgICBjb25zdCB7IHByb2ZpbGVzICB9ID0gcGFyc2VkOwogICAgaWYgKHR5cGVvZiBwcm9maWxlcyAhPT0gJ29iamVjdCcpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgcHJvZmlsZXMgb2JqZWN0YCk7CiAgICBmb3IgKGNvbnN0IFtwcm9maWxlSWQsIHByb2ZpbGVTdGF0ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvZmlsZXMpKXsKICAgICAgICBpZiAodHlwZW9mIHByb2ZpbGVJZCAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignUHJvZmlsZSBpZCBtdXN0IGJlIHN0cmluZycpOwogICAgICAgIHBhcnNlUHJvZmlsZVN0YXRlKHByb2ZpbGVTdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcGFyc2VkOwp9CmZ1bmN0aW9uIHBhcnNlUHJvZmlsZVN0YXRlKHBhcnNlZCkgewogICAgaWYgKHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnIHx8IHBhcnNlZCA9PT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKCdQcm9maWxlIHN0YXRlIG11c3QgYmUgb2JqZWN0Jyk7CiAgICBjb25zdCB7IG5hbWU6IG5hbWU0ICwgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwYXJzZWQ7CiAgICBpZiAodHlwZW9mIG5hbWU0ICE9PSAnc3RyaW5nJyB8fCBuYW1lNC50cmltKCkubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgc3RhdGUgbmFtZSBtdXN0IGV4aXN0YCk7CiAgICBpZiAodHlwZW9mIGFjY291bnRJZCAhPT0gJ3N0cmluZycgfHwgYWNjb3VudElkLnRyaW0oKS5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSBzdGF0ZSBhY2NvdW50SWQgbXVzdCBleGlzdGApOwogICAgaWYgKHR5cGVvZiBhcGlUb2tlbiAhPT0gJ3N0cmluZycgfHwgYXBpVG9rZW4udHJpbSgpLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlIHN0YXRlIGFwaVRva2VuIG11c3QgZXhpc3RgKTsKICAgIHJldHVybiBwYXJzZWQ7Cn0KZnVuY3Rpb24gc2F2ZVN0YXRlKHN0YXRlKSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVEFURV9LRVksIEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7Cn0KYXN5bmMgZnVuY3Rpb24gY29tcHV0ZUNhbkxpc3RUYWlscyhhY2NvdW50SWQsIGFwaVRva2VuKSB7CiAgICB0cnkgewogICAgICAgIGF3YWl0IGxpc3RUYWlscyhhY2NvdW50SWQsICcnLCBhcGlUb2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBDbG91ZGZsYXJlQXBpRXJyb3IyICYmIGUuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmZ1bmN0aW9uIGlzVmFsaWRTYW1wbGluZ1JhdGUoc2FtcGxpbmdSYXRlKSB7CiAgICByZXR1cm4gIWlzTmFOKHNhbXBsaW5nUmF0ZSkgJiYgc2FtcGxpbmdSYXRlID49IDAgJiYgc2FtcGxpbmdSYXRlIDw9IDE7Cn0KZnVuY3Rpb24gY29tcHV0ZUluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkKHN0YXRlLCBwcm9maWxlcykgewogICAgaWYgKHN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkICYmIHN0YXRlLnByb2ZpbGVzW3N0YXRlLnNlbGVjdGVkUHJvZmlsZUlkXSkgcmV0dXJuIHN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkOwogICAgaWYgKHByb2ZpbGVzLmxlbmd0aCA+IDApIHJldHVybiBwcm9maWxlc1swXS5pZDsKICAgIHJldHVybiB1bmRlZmluZWQ7Cn0KZnVuY3Rpb24gY29tcHV0ZVRhaWxPcHRpb25zRm9yRmlsdGVyKGZpbHRlcikgewogICAgY29uc3QgZmlsdGVycyA9IFtdOwogICAgaWYgKGZpbHRlci5zdGF0dXMxID09PSAnZXJyb3InKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgb3V0Y29tZTogWwogICAgICAgICAgICAgICAgJ2V4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAnZXhjZWVkZWRDcHUnLAogICAgICAgICAgICAgICAgJ2NhbmNlbGVkJywKICAgICAgICAgICAgICAgICd1bmtub3duJwogICAgICAgICAgICBdCiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGZpbHRlci5zdGF0dXMxID09PSAnc3VjY2VzcycpIHsKICAgICAgICBmaWx0ZXJzLnB1c2goewogICAgICAgICAgICBvdXRjb21lOiBbCiAgICAgICAgICAgICAgICAnb2snCiAgICAgICAgICAgIF0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIuc2FtcGxpbmdSYXRlMSAhPT0gdW5kZWZpbmVkICYmIGlzVmFsaWRTYW1wbGluZ1JhdGUoZmlsdGVyLnNhbXBsaW5nUmF0ZTEpICYmIGZpbHRlci5zYW1wbGluZ1JhdGUxIDwgMSkgewogICAgICAgIGZpbHRlcnMucHVzaCh7CiAgICAgICAgICAgIHNhbXBsaW5nX3JhdGU6IGZpbHRlci5zYW1wbGluZ1JhdGUxCiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZmlsdGVyLnNlYXJjaDEgIT09IHVuZGVmaW5lZCAmJiBmaWx0ZXIuc2VhcmNoMS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgcXVlcnk6IGZpbHRlci5zZWFyY2gxCiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZmlsdGVyLm1ldGhvZDEgJiYgZmlsdGVyLm1ldGhvZDEubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlcnMucHVzaCh7CiAgICAgICAgICAgIG1ldGhvZDogZmlsdGVyLm1ldGhvZDEKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIuaXBBZGRyZXNzMSAmJiBmaWx0ZXIuaXBBZGRyZXNzMS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgY2xpZW50X2lwOiBmaWx0ZXIuaXBBZGRyZXNzMQogICAgICAgIH0pOwogICAgfQogICAgaWYgKGZpbHRlci5oZWFkZXIxICYmIGZpbHRlci5oZWFkZXIxLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKGNvbnN0IGhlYWRlciBvZiBmaWx0ZXIuaGVhZGVyMSl7CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChwYXJzZUhlYWRlckZpbHRlcihoZWFkZXIpKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGZpbHRlcnMKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZU1lc3NhZ2VQYXNzZXNGaWx0ZXIobWVzc2FnZTMsIGZpbHRlcikgewogICAgaWYgKGZpbHRlci5ldmVudDEgPT09ICdjcm9uJyB8fCBmaWx0ZXIuZXZlbnQxID09PSAnaHR0cCcpIHsKICAgICAgICBjb25zdCBpc0Nyb24gPSBpc1RhaWxNZXNzYWdlQ3JvbkV2ZW50KG1lc3NhZ2UzKTsKICAgICAgICByZXR1cm4gaXNDcm9uICYmIGZpbHRlci5ldmVudDEgPT09ICdjcm9uJyB8fCAhaXNDcm9uICYmIGZpbHRlci5ldmVudDEgPT09ICdodHRwJzsKICAgIH0KICAgIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGRpc3RpbmN0KHZhbHVlczEpIHsKICAgIGNvbnN0IHJ0ID0gW107CiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlczEpewogICAgICAgIGlmICghcnQuaW5jbHVkZXModmFsdWUpKSB7CiAgICAgICAgICAgIHJ0LnB1c2godmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiB0cnlQYXJzZVVybCh1cmwpIHsKICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkwodXJsKTsKICAgIH0gY2F0Y2ggIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQp9CmNvbnN0IEZJTFRFUl9FRElUT1JfSFRNTCA9IGh0bWxgCjxmb3JtIGlkPSJmaWx0ZXItZm9ybSIgYXV0b2NvbXBsZXRlPSJvZmYiPgo8ZmllbGRzZXQgaWQ9ImZpbHRlci1maWVsZHNldCI+CiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0tdGl0bGUiIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQgZm9ybS1yb3ciPkVkaXQgZmlsdGVyPC9kaXY+CgogIDxsYWJlbCBpZD0iZmlsdGVyLWZpZWxkLWxhYmVsIj5GaWx0ZXIgZmllbGQ6PC9sYWJlbD4KICA8aW5wdXQgaWQ9ImZpbHRlci1maWVsZC10ZXh0IiB0eXBlPSJ0ZXh0Ij4KICA8ZGl2IGlkPSJmaWx0ZXItZmllbGQtY2hvaWNlIj48L2Rpdj4KICA8ZGl2IGlkPSJmaWx0ZXItZmllbGQtb3B0aW9ucyI+PC9kaXY+CgogIDxkaXYgaWQ9ImZpbHRlci1mb3JtLWhlbHAiIGNsYXNzPSJib2R5MiBtZWRpdW0tZW1waGFzaXMtdGV4dCI+CiAgPC9kaXY+ICAKCiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0tb3V0cHV0LXJvdyIgY2xhc3M9ImZvcm0tcm93Ij4KICAgIDxvdXRwdXQgaWQ9ImZpbHRlci1mb3JtLW91dHB1dCI+PC9vdXRwdXQ+CiAgPC9kaXY+CgogIDxkaXYgaWQ9ImZpbHRlci1mb3JtLWJ1dHRvbnMiIGNsYXNzPSJmb3JtLXJocyI+CiAgICA8YnV0dG9uIGlkPSJmaWx0ZXItYXBwbHkiIHR5cGU9InN1Ym1pdCI+QXBwbHk8L2J1dHRvbj48IS0tIGZpcnN0IHNvIGl0IGlzIGRlZmF1bHQgYnV0dG9uIG9uIHJldHVybiAtLT4KICAgIDxidXR0b24gaWQ9ImZpbHRlci1jYW5jZWwiPkNhbmNlbDwvYnV0dG9uPgogIDwvZGl2Pgo8L2ZpZWxkc2V0Pgo8L2Zvcm0+CmA7CmNvbnN0IEZJTFRFUl9FRElUT1JfQ1NTID0gY3NzYAoKICAgICNmaWx0ZXItZm9ybS1idXR0b25zIHsKICAgICAgICBqdXN0aWZ5LXNlbGY6IGVuZDsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3ctcmV2ZXJzZTsKICAgICAgICBnYXA6IDFyZW07CiAgICB9CgogICAgI2ZpbHRlci1maWVsZC1jaG9pY2UgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZ2FwOiAxcHg7CiAgICB9CgogICAgI2ZpbHRlci1maWVsZC1vcHRpb25zIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgICBnYXA6IDFweDsKICAgIH0KCiAgICAjZmlsdGVyLWZpZWxkLW9wdGlvbnMgYnV0dG9uIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiAwLjVyZW07CiAgICB9CgogICAgI2ZpbHRlci1mb3JtLWhlbHAgewogICAgICAgIGdyaWQtY29sdW1uOiAyOwogICAgfQoKICAgICNmaWx0ZXItZm9ybS1vdXRwdXQtcm93IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiAxcmVtOwogICAgICAgIG1pbi1oZWlnaHQ6IDIuNXJlbTsKICAgIH0KCiAgICAjZmlsdGVyLWZvcm0tb3V0cHV0LXJvdyBvdXRwdXQgewogICAgICAgIGZsZXgtZ3JvdzogMTsKICAgIH0KCmA7CmZ1bmN0aW9uIGluaXRGaWx0ZXJFZGl0b3IoZG9jdW1lbnQsIHZtKSB7CiAgICBjb25zdCBmaWx0ZXJGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1mb3JtJyk7CiAgICBjb25zdCBmaWx0ZXJGaWVsZHNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZmllbGRzZXQnKTsKICAgIGNvbnN0IGZpbHRlckZpZWxkTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkLWxhYmVsJyk7CiAgICBjb25zdCBmaWx0ZXJGaWVsZFRleHRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZmllbGQtdGV4dCcpOwogICAgY29uc3QgZmlsdGVyRmllbGRDaG9pY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkLWNob2ljZScpOwogICAgY29uc3QgZmlsdGVyRmllbGRPcHRpb25zRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1maWVsZC1vcHRpb25zJyk7CiAgICBjb25zdCBmaWx0ZXJDYW5jZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWNhbmNlbCcpOwogICAgY29uc3QgZmlsdGVyQXBwbHlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWFwcGx5Jyk7CiAgICBjb25zdCBmaWx0ZXJGb3JtT3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1mb3JtLW91dHB1dCcpOwogICAgY29uc3QgZmlsdGVyRm9ybUhlbHBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZvcm0taGVscCcpOwogICAgZmlsdGVyQ2FuY2VsQnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0uY2FuY2VsRmlsdGVyKCk7CiAgICB9OwogICAgZmlsdGVyQXBwbHlCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBjb25zdCB0eXBlMiA9IGNvbXB1dGVUeXBlKHZtKTsKICAgICAgICBpZiAodHlwZTIgPT09ICd0ZXh0JykgewogICAgICAgICAgICB2bS5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBmaWx0ZXJGaWVsZFRleHRJbnB1dC52YWx1ZTsKICAgICAgICB9CiAgICAgICAgdm0uc2F2ZUZpbHRlcigpOwogICAgfTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIGNvbnN0IHdhc0hpZGRlbiA9IGZpbHRlckZvcm0uc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnOwogICAgICAgIGZpbHRlckZvcm0uc3R5bGUuZGlzcGxheSA9IHZtLmZpbHRlckZvcm0uc2hvd2luZyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgZmlsdGVyRmllbGRzZXQuZGlzYWJsZWQgPSAhdm0uZmlsdGVyRm9ybS5lbmFibGVkOwogICAgICAgIGNvbnN0IHR5cGUyID0gY29tcHV0ZVR5cGUodm0pOwogICAgICAgIGZpbHRlckZpZWxkTGFiZWwudGV4dENvbnRlbnQgPSB2bS5maWx0ZXJGb3JtLmZpZWxkTmFtZTsKICAgICAgICBmaWx0ZXJGaWVsZExhYmVsLmh0bWxGb3IgPSB0eXBlMiA9PSAnY2hvaWNlJyA/IGZpbHRlckZpZWxkQ2hvaWNlRGl2LmlkIDogdHlwZTIgPT0gJ29wdGlvbnMnID8gZmlsdGVyRmllbGRPcHRpb25zRGl2LmlkIDogZmlsdGVyRmllbGRUZXh0SW5wdXQuaWQ7CiAgICAgICAgZmlsdGVyRmllbGRUZXh0SW5wdXQuc3R5bGUuZGlzcGxheSA9IHR5cGUyID09ICd0ZXh0JyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgZmlsdGVyRmllbGRDaG9pY2VEaXYuc3R5bGUuZGlzcGxheSA9IHR5cGUyID09ICdjaG9pY2UnID8gJ2ZsZXgnIDogJ25vbmUnOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKENIT0lDRVNfSFRNTCh2bSksIGZpbHRlckZpZWxkQ2hvaWNlRGl2KTsKICAgICAgICBmaWx0ZXJGaWVsZE9wdGlvbnNEaXYuc3R5bGUuZGlzcGxheSA9IHR5cGUyID09ICdvcHRpb25zJyA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihPUFRJT05TX0hUTUwodm0pLCBmaWx0ZXJGaWVsZE9wdGlvbnNEaXYpOwogICAgICAgIGZpbHRlckZvcm1IZWxwRGl2LnRleHRDb250ZW50ID0gdm0uZmlsdGVyRm9ybS5oZWxwVGV4dDsKICAgICAgICBmaWx0ZXJGb3JtT3V0cHV0LnRleHRDb250ZW50ID0gdm0uZmlsdGVyRm9ybS5vdXRwdXRNZXNzYWdlOwogICAgICAgIGlmICh3YXNIaWRkZW4gJiYgdm0uZmlsdGVyRm9ybS5zaG93aW5nKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmaWx0ZXIgZm9ybSBvcGVuJyk7CiAgICAgICAgICAgIGlmICh0eXBlMiA9PT0gJ3RleHQnICYmIHZtLmZpbHRlckZvcm0uZmllbGRWYWx1ZSkgZmlsdGVyRmllbGRUZXh0SW5wdXQudmFsdWUgPSB2bS5maWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkVGV4dElucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZFRleHRJbnB1dC5zZWxlY3QoKTsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgfQogICAgfTsKfQpmdW5jdGlvbiBjb21wdXRlVHlwZSh2bSkgewogICAgcmV0dXJuIHZtLmZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMubGVuZ3RoID4gMCA/ICdjaG9pY2UnIDogdm0uZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucy5sZW5ndGggPyAnb3B0aW9ucycgOiAndGV4dCc7Cn0KY29uc3QgQ0hPSUNFU19IVE1MID0gKHZtKT0+ewogICAgcmV0dXJuIHZtLmZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMubWFwKChjaG9pY2UpPT5odG1sYDxidXR0b24gY2xhc3M9IiR7Y2hvaWNlLmlkID09PSB2bS5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgPyAnc2VsZWN0ZWQnIDogJyd9IiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2bS5zZWxlY3RGaWx0ZXJDaG9pY2UoY2hvaWNlLmlkKTsKICAgICAgICB9fSA/ZGlzYWJsZWQ9IiR7IXZtLmZpbHRlckZvcm0uc2hvd2luZ30iPiR7Y2hvaWNlLnRleHR9PC9idXR0b24+YAogICAgKTsKfTsKY29uc3QgT1BUSU9OU19IVE1MID0gKHZtKT0+ewogICAgcmV0dXJuIHZtLmZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMubWFwKChvcHRpb24pPT57CiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBmaWVsZFZhbHVlU2V0KHZtKS5oYXMob3B0aW9uLmlkKTsKICAgICAgICByZXR1cm4gaHRtbGA8YnV0dG9uIGNsYXNzPSIke3NlbGVjdGVkID8gJ3NlbGVjdGVkJyA6ICcnfSIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdm0udG9nZ2xlRmlsdGVyT3B0aW9uKG9wdGlvbi5pZCk7CiAgICAgICAgfX0gP2Rpc2FibGVkPSIkeyF2bS5maWx0ZXJGb3JtLnNob3dpbmd9Ij4ke3NlbGVjdGVkID8gQ0hFQ0tfQk9YX0NIRUNLRURfSUNPTiA6IENIRUNLX0JPWF9VTkNIRUNLRURfSUNPTn0gJHtvcHRpb24udGV4dH08L2J1dHRvbj5gOwogICAgfSk7Cn07CmZ1bmN0aW9uIGZpZWxkVmFsdWVTZXQodm0pIHsKICAgIHJldHVybiBuZXcgU2V0KCh2bS5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgfHwgJycpLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkKICAgICkuZmlsdGVyKCh2KT0+di5sZW5ndGggPiAwCiAgICApKTsKfQpjb25zdCBQUk9GSUxFX0VESVRPUl9IVE1MID0gaHRtbGAKPGZvcm0gaWQ9InByb2ZpbGUtZm9ybSIgYXV0b2NvbXBsZXRlPSJvZmYiPgo8ZmllbGRzZXQgaWQ9InByb2ZpbGUtZmllbGRzZXQiPgogIDxkaXYgaWQ9InByb2ZpbGUtZm9ybS10aXRsZSIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCBmb3JtLXJvdyI+UHJvZmlsZTwvZGl2PgoKICA8bGFiZWwgZm9yPSJwcm9maWxlLW5hbWUiPlByb2ZpbGUgbmFtZTo8L2xhYmVsPgogIDxpbnB1dCBpZD0icHJvZmlsZS1uYW1lIiB0eXBlPSJ0ZXh0Ij4KCiAgPGxhYmVsIGZvcj0iYWNjb3VudC1pZCI+Q2xvdWRmbGFyZSBBY2NvdW50IElEOjwvbGFiZWw+CiAgPGlucHV0IGlkPSJwcm9maWxlLWFjY291bnQtaWQiIHR5cGU9InRleHQiPgoKICA8bGFiZWwgZm9yPSJhcGktdG9rZW4iPkNsb3VkZmxhcmUgQVBJIFRva2VuOjwvbGFiZWw+CiAgPGlucHV0IGlkPSJwcm9maWxlLWFwaS10b2tlbiIgdHlwZT0idGV4dCI+CgogIDxkZXRhaWxzIGlkPSJwcm9maWxlLWZvcm0taGVscC1yb3ciIGNsYXNzPSJmb3JtLXJvdyI+CiAgICA8c3VtbWFyeT5Vc2UgYSA8YSBocmVmPSJodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QcmluY2lwbGVfb2ZfbGVhc3RfcHJpdmlsZWdlIiB0YXJnZXQ9Il9ibGFuayI+bGVhc3QgcHJpdmlsZWdlPC9hPiB0b2tlbiB3aXRoIHBlcm1pc3Npb246IDxjb2RlPkFjY291bnQgJmd0OyBXb3JrZXJzIFRhaWwgJmd0OyBSZWFkPC9jb2RlPjwvc3VtbWFyeT4KICAgIDxvbD4KICAgICAgICA8bGk+U2VsZWN0IDxzcGFuIGNsYXNzPSJjZi1idXR0b24iPkNyZWF0ZSBUb2tlbjwvc3Bhbj4gb24geW91ciBDbG91ZGZsYXJlIDxhIGhyZWY9Imh0dHBzOi8vZGFzaC5jbG91ZGZsYXJlLmNvbS9wcm9maWxlL2FwaS10b2tlbnMiIHRhcmdldD0iX2JsYW5rIj5BUEkgVG9rZW5zPC9hPiBwYWdlLjwvbGk+CiAgICAgICAgPGxpPlNjcm9sbCBkb3duIHRvIDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5DcmVhdGUgQ3VzdG9tIFRva2VuPC9zcGFuPiwgdGhlbiA8c3BhbiBjbGFzcz0iY2YtYnV0dG9uIj5HZXQgc3RhcnRlZDwvc3Bhbj48L2xpPgogICAgICAgIDxsaT5VbmRlciA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+UGVybWlzc2lvbnM8L3NwYW4+LCBncmFudCB5b3VyIHRva2VuIDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5BY2NvdW50PC9zcGFuPiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+V29ya2VycyBUYWlsPC9zcGFuPiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+UmVhZDwvc3Bhbj48L2xpPgogICAgPC9vbD4KICA8L2RldGFpbHM+ICAKCiAgPGRpdiBpZD0icHJvZmlsZS1mb3JtLW91dHB1dC1yb3ciIGNsYXNzPSJmb3JtLXJvdyI+CiAgICA8b3V0cHV0IGlkPSJwcm9maWxlLWZvcm0tb3V0cHV0Ij48L291dHB1dD4KICAgIDxwcm9ncmVzcyBpZD0icHJvZmlsZS1mb3JtLXByb2dyZXNzIiBjbGFzcz0icHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciI+PC9wcm9ncmVzcz4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iZm9ybS1saHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1kZWxldGUiPkRlbGV0ZTwvYnV0dG9uPgogIDwvZGl2PgogIDxkaXYgaWQ9InByb2ZpbGUtZm9ybS1idXR0b25zIiBjbGFzcz0iZm9ybS1yaHMiPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1jYW5jZWwiPkNhbmNlbDwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0icHJvZmlsZS1zYXZlIj5TYXZlPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgUFJPRklMRV9FRElUT1JfQ1NTID0gY3NzYAoKICAgICNwcm9maWxlLWZvcm0tYnV0dG9ucyB7CiAgICAgICAganVzdGlmeS1zZWxmOiBlbmQ7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBnYXA6IDFyZW07CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1oZWxwLXJvdyB7CiAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgc3VtbWFyeSB7CiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1oZWxwLXJvdyBvbCB7CiAgICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgbGkgewogICAgICAgIHBhZGRpbmc6IDAuNXJlbSAwOwogICAgfQoKICAgIC5jZi1idXR0b24gewogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibHVlOwogICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICBwYWRkaW5nOiAwLjI1cmVtIDAuNXJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOwogICAgfQoKICAgIC5jZi1zZWN0aW9uIHsKICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgICAgICAgY29sb3I6IGJsYWNrOwogICAgICAgIHBhZGRpbmc6IDAuMjVyZW0gMC41cmVtOwogICAgICAgIG91dGxpbmU6IHNvbGlkIDFweCBncmF5OwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tb3V0cHV0LXJvdyB7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIGdhcDogMXJlbTsKICAgICAgICBtaW4taGVpZ2h0OiAyLjVyZW07CiAgICB9CgogICAgI3Byb2ZpbGUtZm9ybS1vdXRwdXQtcm93IG91dHB1dCB7CiAgICAgICAgZmxleC1ncm93OiAxOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tcHJvZ3Jlc3MgewogICAgICAgIGZvbnQtc2l6ZTogMC41cmVtOyAvKiBkZWZhdWx0IDNlbSA9PiAxLjVyZW0gKi8KICAgIH0KCmA7CmZ1bmN0aW9uIGluaXRQcm9maWxlRWRpdG9yKGRvY3VtZW50LCB2bSkgewogICAgY29uc3QgcHJvZmlsZUZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtJyk7CiAgICBjb25zdCBwcm9maWxlRm9ybVRpdGxlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS10aXRsZScpOwogICAgY29uc3QgcHJvZmlsZUZpZWxkc2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZmllbGRzZXQnKTsKICAgIGNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1uYW1lJyk7CiAgICBjb25zdCBwcm9maWxlQWNjb3VudElkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1hY2NvdW50LWlkJyk7CiAgICBjb25zdCBwcm9maWxlQXBpVG9rZW5JbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWFwaS10b2tlbicpOwogICAgY29uc3QgcHJvZmlsZURlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWRlbGV0ZScpOwogICAgY29uc3QgcHJvZmlsZUNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWNhbmNlbCcpOwogICAgY29uc3QgcHJvZmlsZVNhdmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1zYXZlJyk7CiAgICBjb25zdCBwcm9maWxlRm9ybVByb2dyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS1wcm9ncmVzcycpOwogICAgY29uc3QgcHJvZmlsZUZvcm1PdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtLW91dHB1dCcpOwogICAgY29uc3QgcHJvZmlsZUZvcm1IZWxwRGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0taGVscC1yb3cnKTsKICAgIHByb2ZpbGVDYW5jZWxCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bS5jYW5jZWxQcm9maWxlKCk7CiAgICB9OwogICAgcHJvZmlsZU5hbWVJbnB1dC5vbmlucHV0ID0gKCk9PnsKICAgICAgICB2bS5zZXRQcm9maWxlTmFtZShwcm9maWxlTmFtZUlucHV0LnZhbHVlKTsKICAgIH07CiAgICBwcm9maWxlQWNjb3VudElkSW5wdXQub25pbnB1dCA9ICgpPT57CiAgICAgICAgdm0uc2V0UHJvZmlsZUFjY291bnRJZChwcm9maWxlQWNjb3VudElkSW5wdXQudmFsdWUpOwogICAgfTsKICAgIHByb2ZpbGVBcGlUb2tlbklucHV0Lm9uaW5wdXQgPSAoKT0+ewogICAgICAgIHZtLnNldFByb2ZpbGVBcGlUb2tlbihwcm9maWxlQXBpVG9rZW5JbnB1dC52YWx1ZSk7CiAgICB9OwogICAgcHJvZmlsZVNhdmVCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bS5zYXZlUHJvZmlsZSgpOwogICAgfTsKICAgIHByb2ZpbGVEZWxldGVCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bS5kZWxldGVQcm9maWxlKHZtLnByb2ZpbGVGb3JtLnByb2ZpbGVJZCk7CiAgICB9OwogICAgcmV0dXJuICgpPT57CiAgICAgICAgY29uc3Qgd2FzSGlkZGVuID0gcHJvZmlsZUZvcm0uc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnOwogICAgICAgIHByb2ZpbGVGb3JtLnN0eWxlLmRpc3BsYXkgPSB2bS5wcm9maWxlRm9ybS5zaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBwcm9maWxlRmllbGRzZXQuZGlzYWJsZWQgPSAhdm0ucHJvZmlsZUZvcm0uZW5hYmxlZDsKICAgICAgICBwcm9maWxlRm9ybVRpdGxlRGl2LnRleHRDb250ZW50ID0gdm0ucHJvZmlsZUZvcm0udGl0bGU7CiAgICAgICAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHZtLnByb2ZpbGVGb3JtLm5hbWU7CiAgICAgICAgcHJvZmlsZUFjY291bnRJZElucHV0LnZhbHVlID0gdm0ucHJvZmlsZUZvcm0uYWNjb3VudElkOwogICAgICAgIHByb2ZpbGVBcGlUb2tlbklucHV0LnZhbHVlID0gdm0ucHJvZmlsZUZvcm0uYXBpVG9rZW47CiAgICAgICAgcHJvZmlsZURlbGV0ZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gdm0ucHJvZmlsZUZvcm0uZGVsZXRlVmlzaWJsZSA/ICdpbmxpbmUtYmxvY2snIDogJ25vbmUnOwogICAgICAgIHByb2ZpbGVTYXZlQnV0dG9uLmRpc2FibGVkID0gIXZtLnByb2ZpbGVGb3JtLnNhdmVFbmFibGVkOwogICAgICAgIHByb2ZpbGVGb3JtUHJvZ3Jlc3Muc3R5bGUuZGlzcGxheSA9IHZtLnByb2ZpbGVGb3JtLnByb2dyZXNzVmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgcHJvZmlsZUZvcm1PdXRwdXQudGV4dENvbnRlbnQgPSB2bS5wcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlOwogICAgICAgIGlmICh3YXNIaWRkZW4gJiYgdm0ucHJvZmlsZUZvcm0uc2hvd2luZykgewogICAgICAgICAgICBjb25zdCBpbml0aWFsRGV0YWlsc09wZW4gPSB2bS5yZWFsUHJvZmlsZXMubGVuZ3RoID09PSAwOwogICAgICAgICAgICBwcm9maWxlRm9ybUhlbHBEZXRhaWxzLm9wZW4gPSBpbml0aWFsRGV0YWlsc09wZW47CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgIHByb2ZpbGVOYW1lSW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVOYW1lSW5wdXQuc2VsZWN0KCk7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgIH0KICAgIH07Cn0KY29uc3QgV0VMQ09NRV9QQU5FTF9IVE1MID0gaHRtbGAKPGZvcm0gaWQ9IndlbGNvbWUtcGFuZWwiIGF1dG9jb21wbGV0ZT0ib2ZmIj4KPGZpZWxkc2V0IGlkPSJ3ZWxjb21lLXBhbmVsLWZpZWxkc2V0Ij4KICA8ZGl2IGlkPSJ3ZWxjb21lLXBhbmVsLWZvcm0tdGl0bGUiIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQgZm9ybS1yb3ciPnRpdGxlPC9kaXY+CgogIDxkaXYgY2xhc3M9ImZvcm0tcm93IGJvZHkyIG1lZGl1bS1lbXBoYXNpcy10ZXh0Ij4KICAgIFdlbGNvbWUgdG8gPHNwYW4gY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+V2VidGFpbCBmb3IgQ2xvdWRmbGFyZSBXb3JrZXJzPC9zcGFuPiEKICAgIDxwPlZpZXcgbGl2ZSByZXF1ZXN0cyBhbmQgbG9ncyBmcm9tIDxhIGhyZWY9Imh0dHBzOi8vd29ya2Vycy5jbG91ZGZsYXJlLmNvbS8iIHRhcmdldD0iX2JsYW5rIj5DbG91ZGZsYXJlIFdvcmtlcnM8L2E+IGZyb20gdGhlIGNvbWZvcnQgb2YgeW91ciBicm93c2VyLiAKICAgIEEgZmV3IGVuaGFuY2VtZW50cyBvdmVyIHdoYXQncyBwcm92aWRlZCA8YSBocmVmPSJodHRwczovL2Jsb2cuY2xvdWRmbGFyZS5jb20vaW50cm9kdWNpbmctd29ya2Vycy1kYXNoYm9hcmQtbG9ncy8iIHRhcmdldD0iX2JsYW5rIj5ieSBkZWZhdWx0PC9hPiBpbiB0aGUgQ2xvdWRmbGFyZSBkYXNoYm9hcmQ6PC9wPgogICAgPHVsPgogICAgICAgIDxsaT5UYWlsIG11bHRpcGxlIHdvcmtlcnMgYXQgdGhlIHNhbWUgdGltZTwvbGk+CiAgICAgICAgPGxpPkFkdmFuY2VkIGZpbHRlcmluZyBhbmQgbXVsdGktY29sb3Igb3V0cHV0IHNpbWlsYXIgdG8gPGEgaHJlZj0iaHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3dvcmtlcnMvY2xpLXdyYW5nbGVyL2NvbW1hbmRzI3RhaWwiIHRhcmdldD0iX2JsYW5rIj53cmFuZ2xlciB0YWlsPC9hPjwvbGk+CiAgICAgICAgPGxpPkR1cmFibGUgb2JqZWN0IGNsYXNzL25hbWUvaWQgYW5kIGNvbG8gaW5mb3JtYXRpb24gY2FuIGJlIHN1cmZhY2VkIHdpdGggPGEgaHJlZj0iVE9ETyBXRUJUQUlMIERPQ1MgTElOSyNsb2dwcm9wcyIgdGFyZ2V0PSJfYmxhbmsiPmxvZ3Byb3BzPC9hPjwvbGk+CiAgICAgICAgPGxpPk11bHRpcGxlIHByb2ZpbGVzLCBzd2l0Y2ggZWFzaWx5IGJldHdlZW4gbXVsdGlwbGUgYWNjb3VudHM8L2xpPgogICAgICAgIDxsaT5ObyBuZWVkIHRvIGxvZyBpbiB3aXRoIHlvdXIgZnVsbCBDbG91ZGZsYXJlIGNyZWRlbnRpYWxzLiAgUHJvZmlsZXMgYXJlIHN0b3JlZCBsb2NhbGx5IGluIHRoZSBicm93c2VyLCBhbmQgY2FuIGJlIHBlcm1pc3Npb25lZCBvbmx5IGZvciB0YWlsaW5nIHdvcmtlcnM8L2xpPgogICAgICAgIDxsaT5JbXBsZW1lbnRlZCBhcyA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2t5bWV0aG9kL2Rlbm9mbGFyZS90cmVlL21hc3Rlci9leGFtcGxlcy93ZWJ0YWlsLXdvcmtlciIgdGFyZ2V0PSJfYmxhbmsiPmFuIG9wZW4tc291cmNlIENsb3VkZmxhcmUgV29ya2VyPC9hPiwgCiAgICAgICAgICAgPGEgaHJlZj0iVE9ETyBXRUJUQUlMIERPQ1MgTElOSyNkZXBsb3ktaXQtdG8teW91ci1vd24tYWNjb3VudCIgdGFyZ2V0PSJfYmxhbmsiPmRlcGxveSBpdCB0byB5b3VyIG93biBhY2NvdW50PC9hPiwgCiAgICAgICAgICAgIG9yIDxhIGhyZWY9IlRPRE8gV0VCVEFJTCBET0NTIExJTksjaG9zdC1pdC1sb2NhbGx5IiB0YXJnZXQ9Il9ibGFuayI+aG9zdCBpdCBsb2NhbGx5PC9hPiB3aXRoIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9za3ltZXRob2QvZGVub2ZsYXJlIiB0YXJnZXQ9Il9ibGFuayI+PGNvZGU+ZGVub2ZsYXJlPC9jb2RlPjwvYT48L2xpPgogICAgPC91bD4KICAgIDxwIGlkPSJ3ZWxjb21lLXBhbmVsLXRyYWlsZXIiPkNyZWF0ZSBhIG5ldyBwcm9maWxlIHRvIGdldCBzdGFydGVkITwvcD4KICAgIDxwIGlkPSJhYm91dC1wYW5lbC10cmFpbGVyIj5MZWFybiBtb3JlIGF0IHRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2t5bWV0aG9kL2Rlbm9mbGFyZSIgdGFyZ2V0PSJfYmxhbmsiPkRlbm9mbGFyZSBHaXRIdWIgcmVwbzwvYT4hPC9wPgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJmb3JtLXJocyI+CiAgICA8YnV0dG9uIGlkPSJ3ZWxjb21lLXBhbmVsLW5ldy1wcm9maWxlIiB0eXBlPSJzdWJtaXQiPk5ldyBwcm9maWxlPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJ3ZWxjb21lLXBhbmVsLWNsb3NlIiB0eXBlPSJzdWJtaXQiPkNsb3NlPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgV0VMQ09NRV9QQU5FTF9DU1MgPSBjc3NgCgogICAgI3dlbGNvbWUtcGFuZWwtZm9ybS10aXRsZSB7CiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICB9CgpgOwpmdW5jdGlvbiBpbml0V2VsY29tZVBhbmVsKGRvY3VtZW50LCB2bSkgewogICAgY29uc3Qgd2VsY29tZVBhbmVsRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLXBhbmVsJyk7CiAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1wYW5lbC1mb3JtLXRpdGxlJyk7CiAgICBjb25zdCB3ZWxjb21lVHJhaWxlckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1wYW5lbC10cmFpbGVyJyk7CiAgICBjb25zdCBhYm91dFRyYWlsZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fib3V0LXBhbmVsLXRyYWlsZXInKTsKICAgIGNvbnN0IG5ld1Byb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1wYW5lbC1uZXctcHJvZmlsZScpOwogICAgY29uc3QgY2xvc2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1wYW5lbC1jbG9zZScpOwogICAgbmV3UHJvZmlsZUJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLm5ld1Byb2ZpbGUoKTsKICAgIH07CiAgICBjbG9zZUJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLmNsb3NlQWJvdXQoKTsKICAgIH07CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBjb25zdCB3YXNIaWRkZW4gPSB3ZWxjb21lUGFuZWxFbGVtZW50LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJzsKICAgICAgICBjb25zdCBzaG93ID0gdm0ud2VsY29tZVNob3dpbmcgJiYgIXZtLnByb2ZpbGVGb3JtLnNob3dpbmcgfHwgdm0uYWJvdXRTaG93aW5nOwogICAgICAgIHdlbGNvbWVQYW5lbEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHNob3cgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGNvbnN0IHdlbGNvbWUgPSB2bS53ZWxjb21lU2hvd2luZzsKICAgICAgICB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSB3ZWxjb21lID8gJ0hlbGxvIPCfkYsnIDogJ0Fib3V0JzsKICAgICAgICB3ZWxjb21lVHJhaWxlckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHdlbGNvbWUgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGFib3V0VHJhaWxlckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHdlbGNvbWUgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIG5ld1Byb2ZpbGVCdXR0b24uc3R5bGUuZGlzcGxheSA9IHdlbGNvbWUgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGNsb3NlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB3ZWxjb21lID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICBpZiAod2FzSGlkZGVuICYmIHNob3cpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYCR7d2VsY29tZSA/ICd3ZWxjb21lJyA6ICdhYm91dCd9IHBhbmVsIG9wZW5gKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgKHdlbGNvbWUgPyBuZXdQcm9maWxlQnV0dG9uIDogY2xvc2VCdXR0b24pLmZvY3VzKCk7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgIH0KICAgIH07Cn0KY29uc3QgTU9EQUxfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9Im1vZGFsIiBjbGFzcz0ibW9kYWwgaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCI+CiAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KICAgICR7V0VMQ09NRV9QQU5FTF9IVE1MfQogICAgJHtQUk9GSUxFX0VESVRPUl9IVE1MfQogICAgJHtGSUxURVJfRURJVE9SX0hUTUx9CiAgICA8L2Rpdj4KPC9kaXY+CmA7CmNvbnN0IE1PREFMX0NTUyA9IGNzc2AKLm1vZGFsIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB6LWluZGV4OiAxOwogICAgbGVmdDogMDsKICAgIHRvcDogMDsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjQpOwp9CgoubW9kYWwtY29udGVudCB7CiAgICBtYXJnaW46IDEwJSBhdXRvOwogICAgd2lkdGg6IDgwJTsKICAgIG1heC13aWR0aDogNDByZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKfQoKQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjAwcHgpIHsKICAgIC5tb2RhbC1jb250ZW50IHsKICAgICAgICBtYXJnaW46IDEwJSAwOwogICAgICAgIHdpZHRoOiAxMDAlOwogICAgfQp9CgpgOwpmdW5jdGlvbiBpbml0TW9kYWwoZG9jdW1lbnQsIHZtKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbCcpOwogICAgY29uc3QgdXBkYXRlUHJvZmlsZUVkaXRvciA9IGluaXRQcm9maWxlRWRpdG9yKGRvY3VtZW50LCB2bSk7CiAgICBjb25zdCB1cGRhdGVGaWx0ZXJFZGl0b3IgPSBpbml0RmlsdGVyRWRpdG9yKGRvY3VtZW50LCB2bSk7CiAgICBjb25zdCB1cGRhdGVXZWxjb21lUGFuZWwgPSBpbml0V2VsY29tZVBhbmVsKGRvY3VtZW50LCB2bSk7CiAgICBjb25zdCBjbG9zZU1vZGFsID0gKCk9PnsKICAgICAgICBpZiAoIXZtLnByb2ZpbGVGb3JtLnNob3dpbmcgJiYgIXZtLmZpbHRlckZvcm0uc2hvd2luZyAmJiAhdm0ud2VsY29tZVNob3dpbmcgJiYgIXZtLmFib3V0U2hvd2luZykgcmV0dXJuOwogICAgICAgIGlmICh2bS5wcm9maWxlRm9ybS5wcm9ncmVzc1Zpc2libGUpIHJldHVybjsKICAgICAgICB2bS5wcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdm0uZmlsdGVyRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdm0uYWJvdXRTaG93aW5nID0gZmFsc2U7CiAgICAgICAgdm0ub25DaGFuZ2UoKTsKICAgIH07CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpPT57CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PSBtb2RhbCkgewogICAgICAgICAgICBjbG9zZU1vZGFsKCk7CiAgICAgICAgfQogICAgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2ZW50KT0+ewogICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50OwogICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7CiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIHVwZGF0ZVByb2ZpbGVFZGl0b3IoKTsKICAgICAgICB1cGRhdGVGaWx0ZXJFZGl0b3IoKTsKICAgICAgICB1cGRhdGVXZWxjb21lUGFuZWwoKTsKICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gdm0ucHJvZmlsZUZvcm0uc2hvd2luZyB8fCB2bS5maWx0ZXJGb3JtLnNob3dpbmcgfHwgdm0ud2VsY29tZVNob3dpbmcgfHwgdm0uYWJvdXRTaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgIH07Cn0KY29uc3QgQ0lSQ1VMQVJfUFJPR1JFU1NfQ1NTID0gY3NzYAoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciB7CiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJvcmRlcjogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHBhZGRpbmc6IDAuMjVlbTsKICAgIHdpZHRoOiAzZW07CiAgICBoZWlnaHQ6IDNlbTsKICAgIGNvbG9yOiB2YXIoLS1wdXJlLW1hdGVyaWFsLXByaW1hcnktcmdiLCByZ2IoMzMsIDE1MCwgMjQzKSk7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZvbnQtc2l6ZTogMTZweDsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOjotd2Via2l0LXByb2dyZXNzLWJhciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoKLyogSW5kZXRlcm1pbmF0ZSAqLwoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlIHsKICAgIC13ZWJraXQtbWFzay1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKSwgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB0cmFuc3BhcmVudCA1MCUsIGJsYWNrIDUwJSk7CiAgICBtYXNrLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodHJhbnNwYXJlbnQgNTAlLCBibGFjayA1MCUpLCBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsIHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKTsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciA2cyBpbmZpbml0ZSBjdWJpYy1iZXppZXIoMC4zLCAwLjYsIDEsIDEpOwp9Cgo6LW1zLWxhbmcoeCksIC5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGUgewogICAgYW5pbWF0aW9uOiBub25lOwp9CgoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlOjpiZWZvcmUsCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGU6Oi13ZWJraXQtcHJvZ3Jlc3MtdmFsdWUgewogICAgY29udGVudDogIiI7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBtYXJnaW4tYm90dG9tOiAwLjI1ZW07CiAgICBib3JkZXI6IHNvbGlkIDAuMjVlbSB0cmFuc3BhcmVudDsKICAgIGJvcmRlci10b3AtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhci1wc2V1ZG8gMC43NXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6LW1vei1wcm9ncmVzcy1iYXIgewogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJvcmRlcjogc29saWQgMC4yNWVtIHRyYW5zcGFyZW50OwogICAgYm9yZGVyLXRvcC1jb2xvcjogY3VycmVudENvbG9yOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhci1wc2V1ZG8gMC43NXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6LW1zLWZpbGwgewogICAgYW5pbWF0aW9uLW5hbWU6IC1tcy1yaW5nOwp9CgpAa2V5ZnJhbWVzIHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXIgewogICAgMCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOwogICAgfQogICAgMTIuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDE4MGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgMjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSg2MzBkZWcpOwogICAgfQogICAgMzcuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDgxMGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgNTAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxMjYwZGVnKTsKICAgIH0KICAgIDYyLjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxNDQwZGVnKTsKICAgICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7CiAgICB9CiAgICA3NSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDE4OTBkZWcpOwogICAgfQogICAgODcuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDIwNzBkZWcpOwogICAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjsKICAgIH0KICAgIDEwMCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDI1MjBkZWcpOwogICAgfQp9CgpAa2V5ZnJhbWVzIHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXItcHNldWRvIHsKICAgIDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgtMzBkZWcpOwogICAgfQogICAgMjkuNCUgewogICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIH0KICAgIDI5LjQxJSB7CiAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIH0KICAgIDY0LjclIHsKICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIH0KICAgIDY0LjcxJSB7CiAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogY3VycmVudENvbG9yOwogICAgfQogICAgMTAwJSB7CiAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMjI1ZGVnKTsKICAgIH0KfQpgOwpjb25zdCBDT05TT0xFX0hUTUwgPSBodG1sYAo8ZGl2IGlkPSJjb25zb2xlIj4KICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyIj4KICAgICAgICA8ZGl2IGlkPSJjb25zb2xlLWhlYWRlci1maWx0ZXJzIiBjbGFzcz0iYm9keTIiPjwvZGl2PgogICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLXN0YXR1cyI+CiAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLXRhaWxzIiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJjb25zb2xlLWhlYWRlci1xcHMiIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLWNsZWFyIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGNvZGUgaWQ9ImNvbnNvbGUtbGFzdC1saW5lIiBjbGFzcz0ibGluZSI+c3BhY2VyPC9jb2RlPgo8L2Rpdj4KYDsKY29uc3QgQ09OU09MRV9DU1MgPSBjc3NgCgojY29uc29sZSB7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGhlaWdodDogMTAwdmg7CiAgICB3aWR0aDogMTAwJTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwogICAgb3ZlcmZsb3cteTogc2Nyb2xsOwogICAgb3ZlcmZsb3cteDogaGlkZGVuOwogICAgZmxleC1ncm93OiAxOwp9CgojY29uc29sZTo6LXdlYmtpdC1zY3JvbGxiYXIgewogICAgd2lkdGg6IDFyZW07CiAgICBoZWlnaHQ6IDNyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKfQoKI2NvbnNvbGU6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKI2NvbnNvbGUtaGVhZGVyIHsKICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICB0b3A6IDA7CiAgICBoZWlnaHQ6IDMuNzVyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxLjI1cmVtIDFyZW0gMXJlbSAwOwp9CgojY29uc29sZS1oZWFkZXItZmlsdGVycyB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBjb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgZm9udC1mYW1pbHk6IHZhcigtLXNhbnMtc2VyaWYtZm9udC1mYW1pbHkpOwoKICAgIGRpc3BsYXk6IC13ZWJraXQtYm94OwogICAgLXdlYmtpdC1saW5lLWNsYW1wOiAzOwogICAgLXdlYmtpdC1ib3gtb3JpZW50OiB2ZXJ0aWNhbDsgIAogICAgb3ZlcmZsb3c6IGhpZGRlbjsKfQoKI2NvbnNvbGUtaGVhZGVyLXN0YXR1cyB7CiAgICBoZWlnaHQ6IDFyZW07CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIG1pbi13aWR0aDogNnJlbTsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgcGFkZGluZy10b3A6IDAuMjVyZW07CiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKI2NvbnNvbGUtaGVhZGVyLXRhaWxzIHsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7Cn0KCiNjb25zb2xlLWhlYWRlci1jbGVhciB7CiAgICBtYXJnaW4tcmlnaHQ6IC0wLjVyZW07CiAgICBtYXJnaW4tbGVmdDogMXJlbTsKICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoKI2NvbnNvbGUtaGVhZGVyLWNsZWFyIC5hY3Rpb24taWNvbiB7CiAgICBwYWRkaW5nLXJpZ2h0OiAwLjVyZW07CiAgICBwYWRkaW5nLWxlZnQ6IDAuNXJlbTsKfQoKI2NvbnNvbGUgLmxpbmUgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBmb250LXNpemU6IDAuNzVyZW07IC8qIDEycHggKi8KICAgIGxpbmUtaGVpZ2h0OiAxLjFyZW07CiAgICBmb250LWZhbWlseTogdmFyKC0tbW9ub3NwYWNlLWZvbnQtZmFtaWx5KTsKICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKfQoKI2NvbnNvbGUtbGFzdC1saW5lIHsKICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoKYDsKZnVuY3Rpb24gaW5pdENvbnNvbGUoZG9jdW1lbnQsIHZtKSB7CiAgICBjb25zdCBjb25zb2xlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUnKTsKICAgIGNvbnN0IGNvbnNvbGVIZWFkZXJGaWx0ZXJzRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtaGVhZGVyLWZpbHRlcnMnKTsKICAgIGNvbnN0IGNvbnNvbGVIZWFkZXJUYWlsc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZS1oZWFkZXItdGFpbHMnKTsKICAgIGNvbnN0IGNvbnNvbGVIZWFkZXJRcHNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtaGVhZGVyLXFwcycpOwogICAgY29uc3QgY29uc29sZUhlYWRlckNsZWFyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlLWhlYWRlci1jbGVhcicpOwogICAgY29uc3QgY29uc29sZUxhc3RMaW5lRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlLWxhc3QtbGluZScpOwogICAgbGV0IHNob3dpbmdDbGVhckJ1dHRvbiA9IGZhbHNlOwogICAgdm0ubG9nZ2VyID0gKC4uLmRhdGEpPT57CiAgICAgICAgY29uc3QgbGluZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjb2RlJyk7CiAgICAgICAgbGluZUVsZW1lbnQuY2xhc3NOYW1lID0gJ2xpbmUnOwogICAgICAgIGxldCBwb3MgPSAwOwogICAgICAgIHdoaWxlKHBvcyA8IGRhdGEubGVuZ3RoKXsKICAgICAgICAgICAgaWYgKHBvcyA+IDApIHsKICAgICAgICAgICAgICAgIGxpbmVFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcsICcpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBtc2cgPSBkYXRhW3Bvc107CiAgICAgICAgICAgIGlmICh0eXBlb2YgbXNnID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgY29uc3QgdG9rZW5zID0gbXNnLnNwbGl0KCclYycpOwogICAgICAgICAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgdG9rZW5zLmxlbmd0aDsgaTErKyl7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaTEgPiAwICYmIGkxIDwgdG9rZW5zLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSBkYXRhW3BvcyArIGkxXTsKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgc3R5bGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZW5kZXJUZXh0SW50b1NwYW4odG9rZW5zW2kxXSwgc3Bhbik7CiAgICAgICAgICAgICAgICAgICAgbGluZUVsZW1lbnQuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3MgKz0gMSArIHRva2Vucy5sZW5ndGggLSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGluZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoSlNPTi5zdHJpbmdpZnkobXNnKSkpOwogICAgICAgICAgICAgICAgcG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc29sZURpdi5pbnNlcnRCZWZvcmUobGluZUVsZW1lbnQsIGNvbnNvbGVMYXN0TGluZUVsZW1lbnQpOwogICAgICAgIGNvbnN0IHsgc2Nyb2xsSGVpZ2h0ICwgc2Nyb2xsVG9wICwgY2xpZW50SGVpZ2h0ICB9ID0gY29uc29sZURpdjsKICAgICAgICBjb25zdCBkaWZmID0gc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wOwogICAgICAgIGNvbnN0IGF1dG9zY3JvbGwgPSBkaWZmIC0gMTYgKiA0IDw9IGNsaWVudEhlaWdodDsKICAgICAgICBpZiAoYXV0b3Njcm9sbCkgewogICAgICAgICAgICBjb25zb2xlTGFzdExpbmVFbGVtZW50LnNjcm9sbEludG9WaWV3KGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaG93aW5nQ2xlYXJCdXR0b24pIHsKICAgICAgICAgICAgY29uc29sZUhlYWRlckNsZWFyRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgICAgICBzaG93aW5nQ2xlYXJCdXR0b24gPSB0cnVlOwogICAgICAgIH0KICAgIH07CiAgICB2bS5vblJlc2V0T3V0cHV0ID0gKCk9PnsKICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnNvbGVEaXYucXVlcnlTZWxlY3RvckFsbCgnLmxpbmUnKTsKICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKT0+ewogICAgICAgICAgICBpZiAobGluZS5pZCAhPT0gJ2NvbnNvbGUtbGFzdC1saW5lJykgY29uc29sZURpdi5yZW1vdmVDaGlsZChsaW5lKTsKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlSGVhZGVyQ2xlYXJFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgICBzaG93aW5nQ2xlYXJCdXR0b24gPSBmYWxzZTsKICAgIH07CiAgICBjb25zb2xlSGVhZGVyUXBzRWxlbWVudC50ZXh0Q29udGVudCA9IGNvbXB1dGVRcHNUZXh0KDApOwogICAgdm0ub25RcHNDaGFuZ2UgPSAocXBzKT0+ewogICAgICAgIGNvbnNvbGVIZWFkZXJRcHNFbGVtZW50LnRleHRDb250ZW50ID0gY29tcHV0ZVFwc1RleHQocXBzKTsKICAgIH07CiAgICBMaXRFbGVtZW50LnJlbmRlcihhY3Rpb25JY29uKENMRUFSX0lDT04sIHsKICAgICAgICB0ZXh0OiAnQ2xlYXInLAogICAgICAgIG9uY2xpY2s6ICgpPT52bS5yZXNldE91dHB1dCgpCiAgICB9KSwgY29uc29sZUhlYWRlckNsZWFyRWxlbWVudCk7CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBjb25zb2xlSGVhZGVyRmlsdGVyc0Rpdi5zdHlsZS52aXNpYmlsaXR5ID0gdm0ucHJvZmlsZXMubGVuZ3RoID4gMCA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nOwogICAgICAgIGNvbnNvbGVIZWFkZXJUYWlsc0VsZW1lbnQudGV4dENvbnRlbnQgPSBjb21wdXRlVGFpbHNUZXh0KHZtLnRhaWxzLnNpemUpOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKEZJTFRFUlNfSFRNTCh2bSksIGNvbnNvbGVIZWFkZXJGaWx0ZXJzRGl2KTsKICAgIH07Cn0KY29uc3QgRklMVEVSU19IVE1MID0gKHZtKT0+ewogICAgcmV0dXJuIGh0bWxgU2hvd2luZyA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0uZWRpdFNlbGVjdGlvbkZpZWxkcygpOwogICAgfX0+JHt2bS5jb21wdXRlU2VsZWN0aW9uRmllbGRzVGV4dCgpfTwvYT4KICAgICBmb3IgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLmVkaXRFdmVudEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlRXZlbnRGaWx0ZXJUZXh0KHZtLmZpbHRlcil9PC9hPgogICAgIHdpdGggPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLmVkaXRTdGF0dXNGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZVN0YXR1c0ZpbHRlclRleHQodm0uZmlsdGVyKX08L2E+LAogICAgIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bS5lZGl0SXBBZGRyZXNzRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVJcEFkZHJlc3NGaWx0ZXJUZXh0KHZtLmZpbHRlcil9PC9hPiwKICAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0uZWRpdE1ldGhvZEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlTWV0aG9kRmlsdGVyVGV4dCh2bS5maWx0ZXIpfTwvYT4sCiAgICAgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtLmVkaXRTYW1wbGluZ1JhdGVGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZVNhbXBsaW5nUmF0ZUZpbHRlclRleHQodm0uZmlsdGVyKX08L2E+LCAKICAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0uZWRpdFNlYXJjaEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlU2VhcmNoRmlsdGVyVGV4dCh2bS5maWx0ZXIpfTwvYT4sIAogICAgIGFuZCA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0uZWRpdEhlYWRlckZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlSGVhZGVyRmlsdGVyVGV4dCh2bS5maWx0ZXIpfTwvYT4uCiAgICAgJHt2bS5oYXNBbnlGaWx0ZXJzKCkgPyBodG1sYCg8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0ucmVzZXRGaWx0ZXJzKCk7CiAgICB9fT5yZXNldDwvYT4pYCA6ICcnfWA7Cn07CmZ1bmN0aW9uIGNvbXB1dGVFdmVudEZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCB7IGV2ZW50MSAgfSA9IGZpbHRlcjsKICAgIHJldHVybiBldmVudDEgPT09ICdjcm9uJyA/ICdDUk9OIHRyaWdnZXIgZXZlbnRzJyA6IGV2ZW50MSA9PT0gJ2h0dHAnID8gJ0hUVFAgcmVxdWVzdCBldmVudHMnIDogJ2FsbCBldmVudHMnOwp9CmZ1bmN0aW9uIGNvbXB1dGVTdGF0dXNGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgeyBzdGF0dXMxOiBzdGF0dXMxMSAgfSA9IGZpbHRlcjsKICAgIHJldHVybiBzdGF0dXMxMSA9PT0gJ2Vycm9yJyA/ICdlcnJvciBzdGF0dXMnIDogc3RhdHVzMTEgPT09ICdzdWNjZXNzJyA/ICdzdWNjZXNzIHN0YXR1cycgOiAnYW55IHN0YXR1cyc7Cn0KZnVuY3Rpb24gY29tcHV0ZUlwQWRkcmVzc0ZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCBpcEFkZHJlc3MxID0gZmlsdGVyLmlwQWRkcmVzczEgfHwgW107CiAgICByZXR1cm4gaXBBZGRyZXNzMS5sZW5ndGggPT09IDAgPyAnYW55IElQIGFkZHJlc3MnIDogaXBBZGRyZXNzMS5sZW5ndGggPT09IDEgPyBgSVAgYWRkcmVzcyBvZiAke2lwQWRkcmVzczFbMF19YCA6IGBJUCBhZGRyZXNzIGluIFske2lwQWRkcmVzczEuam9pbignLCAnKX1dYDsKfQpmdW5jdGlvbiBjb21wdXRlTWV0aG9kRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IG1ldGhvZDEgPSBmaWx0ZXIubWV0aG9kMSB8fCBbXTsKICAgIHJldHVybiBtZXRob2QxLmxlbmd0aCA9PT0gMCA/ICdhbnkgbWV0aG9kJyA6IG1ldGhvZDEubGVuZ3RoID09PSAxID8gYG1ldGhvZCBvZiAke21ldGhvZDFbMF19YCA6IGBtZXRob2QgaW4gWyR7bWV0aG9kMS5qb2luKCcsICcpfV1gOwp9CmZ1bmN0aW9uIGNvbXB1dGVTYW1wbGluZ1JhdGVGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3Qgc2FtcGxpbmdSYXRlMSA9IHR5cGVvZiBmaWx0ZXIuc2FtcGxpbmdSYXRlMSA9PT0gJ251bWJlcicgPyBmaWx0ZXIuc2FtcGxpbmdSYXRlMSA6IDE7CiAgICByZXR1cm4gc2FtcGxpbmdSYXRlMSA+PSAxID8gJ25vIHNhbXBsaW5nJyA6IGAkeyhNYXRoLm1heCgwLCBzYW1wbGluZ1JhdGUxKSAqIDEwMCkudG9GaXhlZCgyKX0lIHNhbXBsaW5nIHJhdGVgOwp9CmZ1bmN0aW9uIGNvbXB1dGVTZWFyY2hGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgeyBzZWFyY2gxICB9ID0gZmlsdGVyOwogICAgcmV0dXJuIHR5cGVvZiBzZWFyY2gxID09PSAnc3RyaW5nJyAmJiBzZWFyY2gxLmxlbmd0aCA+IDAgPyBgY29uc29sZSBsb2dzIGNvbnRhaW5pbmcgIiR7c2VhcmNoMX0iYCA6ICdubyBzZWFyY2ggZmlsdGVyJzsKfQpmdW5jdGlvbiBjb21wdXRlSGVhZGVyRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IGhlYWRlcjEgPSBmaWx0ZXIuaGVhZGVyMSB8fCBbXTsKICAgIHJldHVybiBoZWFkZXIxLmxlbmd0aCA9PT0gMCA/ICdubyBoZWFkZXIgZmlsdGVyJyA6IGhlYWRlcjEubGVuZ3RoID09PSAxID8gYGhlYWRlciBmaWx0ZXIgb2YgJHtoZWFkZXIxWzBdfWAgOiBgaGVhZGVyIGZpbHRlcnMgb2YgWyR7aGVhZGVyMS5qb2luKCcsICcpfV1gOwp9CmZ1bmN0aW9uIGNvbXB1dGVUYWlsc1RleHQodGFpbENvdW50KSB7CiAgICByZXR1cm4gdGFpbENvdW50ID09PSAwID8gJ25vIHRhaWxzJyA6IHRhaWxDb3VudCA9PT0gMSA/ICcxIHRhaWwnIDogYCR7dGFpbENvdW50fSB0YWlsc2A7Cn0KZnVuY3Rpb24gY29tcHV0ZVFwc1RleHQocXBzKSB7CiAgICByZXR1cm4gYCR7cXBzLnRvRml4ZWQoMil9IHFwc2A7Cn0KZnVuY3Rpb24gcmVuZGVyVGV4dEludG9TcGFuKHRleHQsIHNwYW4pIHsKICAgIGNvbnN0IHBhdHRlcm4gPSAvKGh0dHBzOlwvXC9bXlxzKV0rfFxkezEsM31cLlxkezEsM31cLlxkezEsM31cLlxkezEsM318W1xkMC1mXSsoOltcZDAtZl17MCw0fSl7Niw3fSkvZzsKICAgIGxldCBtOwogICAgbGV0IGkxID0gMDsKICAgIHdoaWxlKG51bGwgIT09IChtID0gcGF0dGVybi5leGVjKHRleHQpKSl7CiAgICAgICAgaWYgKG0uaW5kZXggPiBpMSkgewogICAgICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc3Vic3RyaW5nKGkxLCBtLmluZGV4KSkpOwogICAgICAgIH0KICAgICAgICBjb25zdCB1cmxPcklwID0gbVswXTsKICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGEuaHJlZiA9IHVybE9ySXAuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSA/IHVybE9ySXAgOiBgaHR0cHM6Ly9pcGluZm8uaW8vJHt1cmxPcklwfWA7CiAgICAgICAgYS50YXJnZXQgPSAnX2JsYW5rJzsKICAgICAgICBhLnJlbCA9ICdub3JlZmVycmVyIG5vb3BlbmVyIG5vZm9sbG93JzsKICAgICAgICBhLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHVybE9ySXApKTsKICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGEpOwogICAgICAgIGkxID0gbS5pbmRleCArIHVybE9ySXAubGVuZ3RoOwogICAgfQogICAgaWYgKGkxIDwgdGV4dC5sZW5ndGgpIHsKICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQuc3Vic3RyaW5nKGkxKSkpOwogICAgfQp9CmNvbnN0IGFwcE1vZHVsZVNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAtbW9kdWxlLXNjcmlwdCcpOwpmdW5jdGlvbiBzZXRBcHBTdGF0ZShhcHBTdGF0ZSkgewogICAgYXBwTW9kdWxlU2NyaXB0LmRhdGFzZXQuc3RhdGUgPSBhcHBTdGF0ZTsKfQpzZXRBcHBTdGF0ZSgnc3RhcnRpbmcnKTsKY29uc3QgYXBwQ3NzID0gY3NzYAoKbWFpbiB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZ2FwOiAwLjVyZW07Cn0KCjpyb290IHsKICAgIC0tcHVyZS1tYXRlcmlhbC1wcmltYXJ5LXJnYjogcmdiKDE4NywgMTM0LCAyNTIpOwp9CgouaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCB7CiAgICBzY3JvbGxiYXItd2lkdGg6IG5vbmU7IC1tcy1vdmVyZmxvdy1zdHlsZTogbm9uZTsKICAgIG92ZXJmbG93LXk6IHNjcm9sbDsKfQoKLmhpZGRlbi12ZXJ0aWNhbC1zY3JvbGw6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIGZvciBDaHJvbWUsIFNhZmFyaSwgYW5kIE9wZXJhICovCn0KCmA7CmNvbnN0IGFwcEh0bWwgPSBodG1sYAo8bWFpbj4KJHtTSURFQkFSX0hUTUx9CiR7Q09OU09MRV9IVE1MfQoke01PREFMX0hUTUx9CjwvbWFpbj5gOwpmdW5jdGlvbiBhcHBlbmRTdHlsZXNoZWV0cyhjc3NUZXh0cykgewogICAgY29uc3Qgc3R5bGVTaGVldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICBzdHlsZVNoZWV0LnR5cGUgPSAndGV4dC9jc3MnOwogICAgc3R5bGVTaGVldC50ZXh0Q29udGVudCA9IGNzc1RleHRzLmpvaW4oJ1xuXG4nKTsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVTaGVldCk7Cn0KYXBwZW5kU3R5bGVzaGVldHMoWwogICAgTUFURVJJQUxfQ1NTLmNzc1RleHQsCiAgICBhcHBDc3MuY3NzVGV4dCwKICAgIEhFQURFUl9DU1MuY3NzVGV4dCwKICAgIFNJREVCQVJfQ1NTLmNzc1RleHQsCiAgICBDT05TT0xFX0NTUy5jc3NUZXh0LAogICAgTU9EQUxfQ1NTLmNzc1RleHQsCiAgICBXRUxDT01FX1BBTkVMX0NTUy5jc3NUZXh0LAogICAgUFJPRklMRV9FRElUT1JfQ1NTLmNzc1RleHQsCiAgICBGSUxURVJfRURJVE9SX0NTUy5jc3NUZXh0LAogICAgQ0lSQ1VMQVJfUFJPR1JFU1NfQ1NTLmNzc1RleHQsIApdKTsKTGl0RWxlbWVudC5yZW5kZXIoYXBwSHRtbCwgZG9jdW1lbnQuYm9keSk7CmZ1bmN0aW9uIHBhcnNlU3RhdGljRGF0YSgpIHsKICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0aWMtZGF0YS1zY3JpcHQnKTsKICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHNjcmlwdC50ZXh0KTsKICAgIGNvbnN0IHZlcnNpb24gPSB0eXBlb2YgZGF0YS52ZXJzaW9uID09PSAnc3RyaW5nJyA/IGRhdGEudmVyc2lvbiA6IHVuZGVmaW5lZDsKICAgIGNvbnN0IGZsYWdzID0gdHlwZW9mIGRhdGEuZmxhZ3MgPT09ICdzdHJpbmcnID8gZGF0YS5mbGFncyA6IHVuZGVmaW5lZDsKICAgIHJldHVybiB7CiAgICAgICAgdmVyc2lvbiwKICAgICAgICBmbGFncwogICAgfTsKfQpjb25zdCBkYXRhID0gcGFyc2VTdGF0aWNEYXRhKCk7CmNvbnN0IHZtID0gbmV3IFdlYnRhaWxBcHBWTSgpOwpjb25zdCB1cGRhdGVTaWRlYmFyID0gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtLCBkYXRhKTsKY29uc3QgdXBkYXRlQ29uc29sZSA9IGluaXRDb25zb2xlKGRvY3VtZW50LCB2bSk7CmNvbnN0IHVwZGF0ZU1vZGFsID0gaW5pdE1vZGFsKGRvY3VtZW50LCB2bSk7CnZtLm9uQ2hhbmdlID0gKCk9PnsKICAgIHVwZGF0ZVNpZGViYXIoKTsKICAgIHVwZGF0ZUNvbnNvbGUoKTsKICAgIHVwZGF0ZU1vZGFsKCk7Cn07CkNsb3VkZmxhcmVBcGkuVVJMX1RSQU5TRk9STUVSID0gKHYpPT5gL2ZldGNoLyR7di5zdWJzdHJpbmcoJ2h0dHBzOi8vJy5sZW5ndGgpfWAKOwp2bS5zdGFydCgpOwpzZXRBcHBTdGF0ZSgnc3RhcnRlZCcpOwo=';