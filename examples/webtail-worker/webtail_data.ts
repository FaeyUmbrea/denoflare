

export const WEBTAIL_APP_HASH = 'bef79b404279a35f1d3f84217309ae474108b577';
export const WEBTAIL_APP_B64 = 'Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5Cgpjb25zdCBkaXJlY3RpdmVzID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgaXNEaXJlY3RpdmUgPSAobyk9PnsKICAgIHJldHVybiB0eXBlb2YgbyA9PT0gImZ1bmN0aW9uIiAmJiBkaXJlY3RpdmVzLmhhcyhvKTsKfTsKY29uc3QgaXNDRVBvbHlmaWxsID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgd2luZG93LmN1c3RvbUVsZW1lbnRzICE9IG51bGwgJiYgd2luZG93LmN1c3RvbUVsZW1lbnRzLnBvbHlmaWxsV3JhcEZsdXNoQ2FsbGJhY2sgIT09IHZvaWQgMDsKY29uc3QgcmVwYXJlbnROb2RlcyA9IChjb250YWluZXIsIHN0YXJ0LCBlbmQgPSBudWxsLCBiZWZvcmUgPSBudWxsKT0+ewogICAgd2hpbGUoc3RhcnQgIT09IGVuZCl7CiAgICAgICAgY29uc3QgbiA9IHN0YXJ0Lm5leHRTaWJsaW5nOwogICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoc3RhcnQsIGJlZm9yZSk7CiAgICAgICAgc3RhcnQgPSBuOwogICAgfQp9Owpjb25zdCByZW1vdmVOb2RlcyA9IChjb250YWluZXIsIHN0YXJ0LCBlbmQgPSBudWxsKT0+ewogICAgd2hpbGUoc3RhcnQgIT09IGVuZCl7CiAgICAgICAgY29uc3QgbiA9IHN0YXJ0Lm5leHRTaWJsaW5nOwogICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChzdGFydCk7CiAgICAgICAgc3RhcnQgPSBuOwogICAgfQp9Owpjb25zdCBub0NoYW5nZSA9IHt9Owpjb25zdCBub3RoaW5nID0ge307CmNvbnN0IG1hcmtlciA9IGB7e2xpdC0ke1N0cmluZyhNYXRoLnJhbmRvbSgpKS5zbGljZSgyKX19fWA7CmNvbnN0IG5vZGVNYXJrZXIgPSBgPCEtLSR7bWFya2VyfS0tPmA7CmNvbnN0IG1hcmtlclJlZ2V4ID0gbmV3IFJlZ0V4cChgJHttYXJrZXJ9fCR7bm9kZU1hcmtlcn1gKTsKY29uc3QgYm91bmRBdHRyaWJ1dGVTdWZmaXggPSAiJGxpdCQiOwpjbGFzcyBUZW1wbGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihyZXN1bHQsIGVsZW1lbnQpewogICAgICAgIHRoaXMucGFydHMgPSBbXTsKICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIGNvbnN0IG5vZGVzVG9SZW1vdmUgPSBbXTsKICAgICAgICBjb25zdCBzdGFjayA9IFtdOwogICAgICAgIGNvbnN0IHdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIoZWxlbWVudC5jb250ZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgbGFzdFBhcnRJbmRleCA9IDA7CiAgICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgICAgbGV0IHBhcnRJbmRleCA9IDA7CiAgICAgICAgY29uc3QgeyBzdHJpbmdzICwgdmFsdWVzOiB7IGxlbmd0aCAgfSAgfSA9IHJlc3VsdDsKICAgICAgICB3aGlsZShwYXJ0SW5kZXggPCBsZW5ndGgpewogICAgICAgICAgICBjb25zdCBub2RlID0gd2Fsa2VyLm5leHROb2RlKCk7CiAgICAgICAgICAgIGlmIChub2RlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB3YWxrZXIuY3VycmVudE5vZGUgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgbGVuZ3RoOiBsZW5ndGgyICB9ID0gYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW5ndGgyOyBpKyspewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kc1dpdGgoYXR0cmlidXRlc1tpXS5uYW1lLCBib3VuZEF0dHJpYnV0ZVN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoY291bnQtLSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdGb3JQYXJ0ID0gc3RyaW5nc1twYXJ0SW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbGFzdEF0dHJpYnV0ZU5hbWVSZWdleC5leGVjKHN0cmluZ0ZvclBhcnQpWzJdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVMb29rdXBOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpICsgYm91bmRBdHRyaWJ1dGVTdWZmaXg7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZVZhbHVlID0gbm9kZS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTG9va3VwTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZUxvb2t1cE5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0aWNzID0gYXR0cmlidXRlVmFsdWUuc3BsaXQobWFya2VyUmVnZXgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImF0dHJpYnV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdzOiBzdGF0aWNzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXggKz0gc3RhdGljcy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChub2RlLnRhZ05hbWUgPT09ICJURU1QTEFURSIpIHsKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKG5vZGUpOwogICAgICAgICAgICAgICAgICAgIHdhbGtlci5jdXJyZW50Tm9kZSA9IG5vZGUuY29udGVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhMSA9IG5vZGUuZGF0YTsKICAgICAgICAgICAgICAgIGlmIChkYXRhMS5pbmRleE9mKG1hcmtlcikgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdzMiA9IGRhdGExLnNwbGl0KG1hcmtlclJlZ2V4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0SW5kZXggPSBzdHJpbmdzMi5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsYXN0SW5kZXg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnNlcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzID0gc3RyaW5nczJbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzID09PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ID0gY3JlYXRlTWFya2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXguZXhlYyhzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCAhPT0gbnVsbCAmJiBlbmRzV2l0aChtYXRjaFsyXSwgYm91bmRBdHRyaWJ1dGVTdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHMuc2xpY2UoMCwgbWF0Y2guaW5kZXgpICsgbWF0Y2hbMV0gKyBtYXRjaFsyXS5zbGljZSgwLCAtYm91bmRBdHRyaWJ1dGVTdWZmaXgubGVuZ3RoKSArIG1hdGNoWzNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShpbnNlcnQsIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6ICsraW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmdzMltsYXN0SW5kZXhdID09PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGNyZWF0ZU1hcmtlcigpLCBub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNUb1JlbW92ZS5wdXNoKG5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YSA9IHN0cmluZ3MyW2xhc3RJbmRleF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCArPSBsYXN0SW5kZXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PT0gOCkgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YSA9PT0gbWFya2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnByZXZpb3VzU2libGluZyA9PT0gbnVsbCB8fCBpbmRleCA9PT0gbGFzdFBhcnRJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGNyZWF0ZU1hcmtlcigpLCBub2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGFzdFBhcnRJbmRleCA9IGluZGV4OwogICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5uZXh0U2libGluZyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmRhdGEgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmVtb3ZlLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LS07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKChpID0gbm9kZS5kYXRhLmluZGV4T2YobWFya2VyLCBpICsgMSkpICE9PSAtMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAibm9kZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogLTEKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IG4gb2Ygbm9kZXNUb1JlbW92ZSl7CiAgICAgICAgICAgIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgZW5kc1dpdGggPSAoc3RyLCBzdWZmaXgpPT57CiAgICBjb25zdCBpbmRleCA9IHN0ci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoOwogICAgcmV0dXJuIGluZGV4ID49IDAgJiYgc3RyLnNsaWNlKGluZGV4KSA9PT0gc3VmZml4Owp9Owpjb25zdCBpc1RlbXBsYXRlUGFydEFjdGl2ZSA9IChwYXJ0KT0+cGFydC5pbmRleCAhPT0gLTEKOwpjb25zdCBjcmVhdGVNYXJrZXIgPSAoKT0+ZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgiIikKOwpjb25zdCBsYXN0QXR0cmlidXRlTmFtZVJlZ2V4ID0gLyhbIFx4MDlceDBhXHgwY1x4MGRdKShbXlwwLVx4MUZceDdGLVx4OUYgIic+PS9dKykoWyBceDA5XHgwYVx4MGNceDBkXSo9WyBceDA5XHgwYVx4MGNceDBkXSooPzpbXiBceDA5XHgwYVx4MGNceDBkIidgPD49XSp8IlteIl0qfCdbXiddKikpJC87CmNsYXNzIFRlbXBsYXRlSW5zdGFuY2UgewogICAgY29uc3RydWN0b3IodGVtcGxhdGUsIHByb2Nlc3Nvciwgb3B0aW9ucyl7CiAgICAgICAgdGhpcy5fX3BhcnRzID0gW107CiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlOwogICAgICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yOwogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICB9CiAgICB1cGRhdGUodmFsdWVzKSB7CiAgICAgICAgbGV0IGkgPSAwOwogICAgICAgIGZvciAoY29uc3QgcGFydCBvZiB0aGlzLl9fcGFydHMpewogICAgICAgICAgICBpZiAocGFydCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBwYXJ0LnNldFZhbHVlKHZhbHVlc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IHBhcnQxIG9mIHRoaXMuX19wYXJ0cyl7CiAgICAgICAgICAgIGlmIChwYXJ0MSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBwYXJ0MS5jb21taXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9jbG9uZSgpIHsKICAgICAgICBjb25zdCBmcmFnbWVudCA9IGlzQ0VQb2x5ZmlsbCA/IHRoaXMudGVtcGxhdGUuZWxlbWVudC5jb250ZW50LmNsb25lTm9kZSh0cnVlKSA6IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZS5lbGVtZW50LmNvbnRlbnQsIHRydWUpOwogICAgICAgIGNvbnN0IHN0YWNrID0gW107CiAgICAgICAgY29uc3QgcGFydHMyID0gdGhpcy50ZW1wbGF0ZS5wYXJ0czsKICAgICAgICBjb25zdCB3YWxrZXIgPSBkb2N1bWVudC5jcmVhdGVUcmVlV2Fsa2VyKGZyYWdtZW50LCAxMzMsIG51bGwsIGZhbHNlKTsKICAgICAgICBsZXQgcGFydEluZGV4ID0gMDsKICAgICAgICBsZXQgbm9kZUluZGV4ID0gMDsKICAgICAgICBsZXQgcGFydDsKICAgICAgICBsZXQgbm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpOwogICAgICAgIHdoaWxlKHBhcnRJbmRleCA8IHBhcnRzMi5sZW5ndGgpewogICAgICAgICAgICBwYXJ0ID0gcGFydHMyW3BhcnRJbmRleF07CiAgICAgICAgICAgIGlmICghaXNUZW1wbGF0ZVBhcnRBY3RpdmUocGFydCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19wYXJ0cy5wdXNoKHZvaWQgMCk7CiAgICAgICAgICAgICAgICBwYXJ0SW5kZXgrKzsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlKG5vZGVJbmRleCA8IHBhcnQuaW5kZXgpewogICAgICAgICAgICAgICAgbm9kZUluZGV4Kys7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gIlRFTVBMQVRFIikgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gbm9kZS5jb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChub2RlID0gd2Fsa2VyLm5leHROb2RlKCkpID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUgPT09ICJub2RlIikgewogICAgICAgICAgICAgICAgY29uc3QgcGFydDIgPSB0aGlzLnByb2Nlc3Nvci5oYW5kbGVUZXh0RXhwcmVzc2lvbih0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICAgICAgcGFydDIuaW5zZXJ0QWZ0ZXJOb2RlKG5vZGUucHJldmlvdXNTaWJsaW5nKTsKICAgICAgICAgICAgICAgIHRoaXMuX19wYXJ0cy5wdXNoKHBhcnQyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX19wYXJ0cy5wdXNoKC4uLnRoaXMucHJvY2Vzc29yLmhhbmRsZUF0dHJpYnV0ZUV4cHJlc3Npb25zKG5vZGUsIHBhcnQubmFtZSwgcGFydC5zdHJpbmdzLCB0aGlzLm9wdGlvbnMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXJ0SW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ0VQb2x5ZmlsbCkgewogICAgICAgICAgICBkb2N1bWVudC5hZG9wdE5vZGUoZnJhZ21lbnQpOwogICAgICAgICAgICBjdXN0b21FbGVtZW50cy51cGdyYWRlKGZyYWdtZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyYWdtZW50OwogICAgfQp9CmNvbnN0IHBvbGljeSA9IHdpbmRvdy50cnVzdGVkVHlwZXMgJiYgdHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSgibGl0LWh0bWwiLCB7CiAgICBjcmVhdGVIVE1MOiAocyk9PnMKfSk7CmNvbnN0IGNvbW1lbnRNYXJrZXIgPSBgICR7bWFya2VyfSBgOwpjbGFzcyBUZW1wbGF0ZVJlc3VsdCB7CiAgICBjb25zdHJ1Y3RvcihzdHJpbmdzLCB2YWx1ZXMsIHR5cGUsIHByb2Nlc3Nvcil7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlczsKICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yOwogICAgfQogICAgZ2V0SFRNTCgpIHsKICAgICAgICBjb25zdCBsID0gdGhpcy5zdHJpbmdzLmxlbmd0aCAtIDE7CiAgICAgICAgbGV0IGh0bWwyID0gIiI7CiAgICAgICAgbGV0IGlzQ29tbWVudEJpbmRpbmcgPSBmYWxzZTsKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbDsgaSsrKXsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuc3RyaW5nc1tpXTsKICAgICAgICAgICAgY29uc3QgY29tbWVudE9wZW4gPSBzLmxhc3RJbmRleE9mKCI8IS0tIik7CiAgICAgICAgICAgIGlzQ29tbWVudEJpbmRpbmcgPSAoY29tbWVudE9wZW4gPiAtMSB8fCBpc0NvbW1lbnRCaW5kaW5nKSAmJiBzLmluZGV4T2YoIi0tPiIsIGNvbW1lbnRPcGVuICsgMSkgPT09IC0xOwogICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVNYXRjaCA9IGxhc3RBdHRyaWJ1dGVOYW1lUmVnZXguZXhlYyhzKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU1hdGNoID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBodG1sMiArPSBzICsgKGlzQ29tbWVudEJpbmRpbmcgPyBjb21tZW50TWFya2VyIDogbm9kZU1hcmtlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBodG1sMiArPSBzLnN1YnN0cigwLCBhdHRyaWJ1dGVNYXRjaC5pbmRleCkgKyBhdHRyaWJ1dGVNYXRjaFsxXSArIGF0dHJpYnV0ZU1hdGNoWzJdICsgYm91bmRBdHRyaWJ1dGVTdWZmaXggKyBhdHRyaWJ1dGVNYXRjaFszXSArIG1hcmtlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBodG1sMiArPSB0aGlzLnN0cmluZ3NbbF07CiAgICAgICAgcmV0dXJuIGh0bWwyOwogICAgfQogICAgZ2V0VGVtcGxhdGVFbGVtZW50KCkgewogICAgICAgIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmdldEhUTUwoKTsKICAgICAgICBpZiAocG9saWN5ICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdmFsdWUgPSBwb2xpY3kuY3JlYXRlSFRNTCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHRlbXBsYXRlLmlubmVySFRNTCA9IHZhbHVlOwogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgIH0KfQpjbGFzcyBTVkdUZW1wbGF0ZVJlc3VsdCBleHRlbmRzIFRlbXBsYXRlUmVzdWx0IHsKICAgIGdldEhUTUwoKSB7CiAgICAgICAgcmV0dXJuIGA8c3ZnPiR7c3VwZXIuZ2V0SFRNTCgpfTwvc3ZnPmA7CiAgICB9CiAgICBnZXRUZW1wbGF0ZUVsZW1lbnQoKSB7CiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBzdXBlci5nZXRUZW1wbGF0ZUVsZW1lbnQoKTsKICAgICAgICBjb25zdCBjb250ZW50ID0gdGVtcGxhdGUuY29udGVudDsKICAgICAgICBjb25zdCBzdmdFbGVtZW50ID0gY29udGVudC5maXJzdENoaWxkOwogICAgICAgIGNvbnRlbnQucmVtb3ZlQ2hpbGQoc3ZnRWxlbWVudCk7CiAgICAgICAgcmVwYXJlbnROb2Rlcyhjb250ZW50LCBzdmdFbGVtZW50LmZpcnN0Q2hpbGQpOwogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgIH0KfQpjb25zdCBpc1ByaW1pdGl2ZSA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCAhKHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iKTsKfTsKY29uc3QgaXNJdGVyYWJsZSA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSB8fCAhISh2YWx1ZSAmJiB2YWx1ZVtTeW1ib2wuaXRlcmF0b3JdKTsKfTsKY2xhc3MgQXR0cmlidXRlQ29tbWl0dGVyIHsKICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIG5hbWUsIHN0cmluZ3MpewogICAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzOwogICAgICAgIHRoaXMucGFydHMgPSBbXTsKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc3RyaW5ncy5sZW5ndGggLSAxOyBpKyspewogICAgICAgICAgICB0aGlzLnBhcnRzW2ldID0gdGhpcy5fY3JlYXRlUGFydCgpOwogICAgICAgIH0KICAgIH0KICAgIF9jcmVhdGVQYXJ0KCkgewogICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlUGFydCh0aGlzKTsKICAgIH0KICAgIF9nZXRWYWx1ZSgpIHsKICAgICAgICBjb25zdCBzdHJpbmdzID0gdGhpcy5zdHJpbmdzOwogICAgICAgIGNvbnN0IGwgPSBzdHJpbmdzLmxlbmd0aCAtIDE7CiAgICAgICAgY29uc3QgcGFydHMyID0gdGhpcy5wYXJ0czsKICAgICAgICBpZiAobCA9PT0gMSAmJiBzdHJpbmdzWzBdID09PSAiIiAmJiBzdHJpbmdzWzFdID09PSAiIikgewogICAgICAgICAgICBjb25zdCB2ID0gcGFydHMyWzBdLnZhbHVlOwogICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJzeW1ib2wiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gInN0cmluZyIgfHwgIWlzSXRlcmFibGUodikpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxldCB0ZXh0ID0gIiI7CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGw7IGkrKyl7CiAgICAgICAgICAgIHRleHQgKz0gc3RyaW5nc1tpXTsKICAgICAgICAgICAgY29uc3QgcGFydCA9IHBhcnRzMltpXTsKICAgICAgICAgICAgaWYgKHBhcnQgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgY29uc3QgdiA9IHBhcnQudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoaXNQcmltaXRpdmUodikgfHwgIWlzSXRlcmFibGUodikpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IHR5cGVvZiB2ID09PSAic3RyaW5nIiA/IHYgOiBTdHJpbmcodik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiB2KXsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSB0eXBlb2YgdCA9PT0gInN0cmluZyIgPyB0IDogU3RyaW5nKHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZXh0ICs9IHN0cmluZ3NbbF07CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKHRoaXMubmFtZSwgdGhpcy5fZ2V0VmFsdWUoKSk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIEF0dHJpYnV0ZVBhcnQgewogICAgY29uc3RydWN0b3IoY29tbWl0dGVyKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuY29tbWl0dGVyID0gY29tbWl0dGVyOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgIT09IG5vQ2hhbmdlICYmICghaXNQcmltaXRpdmUodmFsdWUpIHx8IHZhbHVlICE9PSB0aGlzLnZhbHVlKSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIGlmICghaXNEaXJlY3RpdmUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbW1pdHRlci5kaXJ0eSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy52YWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy52YWx1ZTsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmNvbW1pdHRlci5jb21taXQoKTsKICAgIH0KfQpjbGFzcyBOb2RlUGFydCB7CiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIH0KICAgIGFwcGVuZEludG8oY29udGFpbmVyKSB7CiAgICAgICAgdGhpcy5zdGFydE5vZGUgPSBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlTWFya2VyKCkpOwogICAgICAgIHRoaXMuZW5kTm9kZSA9IGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVNYXJrZXIoKSk7CiAgICB9CiAgICBpbnNlcnRBZnRlck5vZGUocmVmKSB7CiAgICAgICAgdGhpcy5zdGFydE5vZGUgPSByZWY7CiAgICAgICAgdGhpcy5lbmROb2RlID0gcmVmLm5leHRTaWJsaW5nOwogICAgfQogICAgYXBwZW5kSW50b1BhcnQocGFydCkgewogICAgICAgIHBhcnQuX19pbnNlcnQodGhpcy5zdGFydE5vZGUgPSBjcmVhdGVNYXJrZXIoKSk7CiAgICAgICAgcGFydC5fX2luc2VydCh0aGlzLmVuZE5vZGUgPSBjcmVhdGVNYXJrZXIoKSk7CiAgICB9CiAgICBpbnNlcnRBZnRlclBhcnQocmVmKSB7CiAgICAgICAgcmVmLl9faW5zZXJ0KHRoaXMuc3RhcnROb2RlID0gY3JlYXRlTWFya2VyKCkpOwogICAgICAgIHRoaXMuZW5kTm9kZSA9IHJlZi5lbmROb2RlOwogICAgICAgIHJlZi5lbmROb2RlID0gdGhpcy5zdGFydE5vZGU7CiAgICB9CiAgICBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIGNvbW1pdCgpIHsKICAgICAgICBpZiAodGhpcy5zdGFydE5vZGUucGFyZW50Tm9kZSA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHdoaWxlKGlzRGlyZWN0aXZlKHRoaXMuX19wZW5kaW5nVmFsdWUpKXsKICAgICAgICAgICAgY29uc3QgZGlyZWN0aXZlMiA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgICAgICAgICAgZGlyZWN0aXZlMih0aGlzKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9fcGVuZGluZ1ZhbHVlOwogICAgICAgIGlmICh2YWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoaXNQcmltaXRpdmUodmFsdWUpKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy52YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5fX2NvbW1pdFRleHQodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFRlbXBsYXRlUmVzdWx0KSB7CiAgICAgICAgICAgIHRoaXMuX19jb21taXRUZW1wbGF0ZVJlc3VsdCh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5vZGUpIHsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdE5vZGUodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoaXNJdGVyYWJsZSh2YWx1ZSkpIHsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdEl0ZXJhYmxlKHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBub3RoaW5nKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBub3RoaW5nOwogICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdFRleHQodmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIF9faW5zZXJ0KG5vZGUpIHsKICAgICAgICB0aGlzLmVuZE5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgdGhpcy5lbmROb2RlKTsKICAgIH0KICAgIF9fY29tbWl0Tm9kZSh2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLnZhbHVlID09PSB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB0aGlzLl9faW5zZXJ0KHZhbHVlKTsKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBfX2NvbW1pdFRleHQodmFsdWUpIHsKICAgICAgICBjb25zdCBub2RlID0gdGhpcy5zdGFydE5vZGUubmV4dFNpYmxpbmc7CiAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZTsKICAgICAgICBjb25zdCB2YWx1ZUFzU3RyaW5nID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlIDogU3RyaW5nKHZhbHVlKTsKICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5lbmROb2RlLnByZXZpb3VzU2libGluZyAmJiBub2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICAgIG5vZGUuZGF0YSA9IHZhbHVlQXNTdHJpbmc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fX2NvbW1pdE5vZGUoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWVBc1N0cmluZykpOwogICAgICAgIH0KICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBfX2NvbW1pdFRlbXBsYXRlUmVzdWx0KHZhbHVlKSB7CiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGVGYWN0b3J5KHZhbHVlKTsKICAgICAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIFRlbXBsYXRlSW5zdGFuY2UgJiYgdGhpcy52YWx1ZS50ZW1wbGF0ZSA9PT0gdGVtcGxhdGUpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZS51cGRhdGUodmFsdWUudmFsdWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBUZW1wbGF0ZUluc3RhbmNlKHRlbXBsYXRlLCB2YWx1ZS5wcm9jZXNzb3IsIHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50ID0gaW5zdGFuY2UuX2Nsb25lKCk7CiAgICAgICAgICAgIGluc3RhbmNlLnVwZGF0ZSh2YWx1ZS52YWx1ZXMpOwogICAgICAgICAgICB0aGlzLl9fY29tbWl0Tm9kZShmcmFnbWVudCk7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBpbnN0YW5jZTsKICAgICAgICB9CiAgICB9CiAgICBfX2NvbW1pdEl0ZXJhYmxlKHZhbHVlKSB7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBbXTsKICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBjb25zdCBpdGVtUGFydHMgPSB0aGlzLnZhbHVlOwogICAgICAgIGxldCBwYXJ0SW5kZXggPSAwOwogICAgICAgIGxldCBpdGVtUGFydDsKICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdmFsdWUpewogICAgICAgICAgICBpdGVtUGFydCA9IGl0ZW1QYXJ0c1twYXJ0SW5kZXhdOwogICAgICAgICAgICBpZiAoaXRlbVBhcnQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgaXRlbVBhcnQgPSBuZXcgTm9kZVBhcnQodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIGl0ZW1QYXJ0cy5wdXNoKGl0ZW1QYXJ0KTsKICAgICAgICAgICAgICAgIGlmIChwYXJ0SW5kZXggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpdGVtUGFydC5hcHBlbmRJbnRvUGFydCh0aGlzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbVBhcnQuaW5zZXJ0QWZ0ZXJQYXJ0KGl0ZW1QYXJ0c1twYXJ0SW5kZXggLSAxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXRlbVBhcnQuc2V0VmFsdWUoaXRlbSk7CiAgICAgICAgICAgIGl0ZW1QYXJ0LmNvbW1pdCgpOwogICAgICAgICAgICBwYXJ0SW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcnRJbmRleCA8IGl0ZW1QYXJ0cy5sZW5ndGgpIHsKICAgICAgICAgICAgaXRlbVBhcnRzLmxlbmd0aCA9IHBhcnRJbmRleDsKICAgICAgICAgICAgdGhpcy5jbGVhcihpdGVtUGFydCAmJiBpdGVtUGFydC5lbmROb2RlKTsKICAgICAgICB9CiAgICB9CiAgICBjbGVhcihzdGFydE5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSkgewogICAgICAgIHJlbW92ZU5vZGVzKHRoaXMuc3RhcnROb2RlLnBhcmVudE5vZGUsIHN0YXJ0Tm9kZS5uZXh0U2libGluZywgdGhpcy5lbmROb2RlKTsKICAgIH0KfQpjbGFzcyBCb29sZWFuQXR0cmlidXRlUGFydCB7CiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKXsKICAgICAgICB0aGlzLnZhbHVlID0gdm9pZCAwOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgaWYgKHN0cmluZ3MubGVuZ3RoICE9PSAyIHx8IHN0cmluZ3NbMF0gIT09ICIiIHx8IHN0cmluZ3NbMV0gIT09ICIiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQm9vbGVhbiBhdHRyaWJ1dGVzIGNhbiBvbmx5IGNvbnRhaW4gYSBzaW5nbGUgZXhwcmVzc2lvbiIpOwogICAgICAgIH0KICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgIH0KICAgIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZhbHVlOwogICAgfQogICAgY29tbWl0KCkgewogICAgICAgIHdoaWxlKGlzRGlyZWN0aXZlKHRoaXMuX19wZW5kaW5nVmFsdWUpKXsKICAgICAgICAgICAgY29uc3QgZGlyZWN0aXZlMiA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgICAgICAgICAgZGlyZWN0aXZlMih0aGlzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX19wZW5kaW5nVmFsdWUgPT09IG5vQ2hhbmdlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWUgPSAhIXRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgaWYgKHRoaXMudmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSh0aGlzLm5hbWUsICIiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUodGhpcy5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgIH0KfQpjbGFzcyBQcm9wZXJ0eUNvbW1pdHRlciBleHRlbmRzIEF0dHJpYnV0ZUNvbW1pdHRlciB7CiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKXsKICAgICAgICBzdXBlcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKTsKICAgICAgICB0aGlzLnNpbmdsZSA9IHN0cmluZ3MubGVuZ3RoID09PSAyICYmIHN0cmluZ3NbMF0gPT09ICIiICYmIHN0cmluZ3NbMV0gPT09ICIiOwogICAgfQogICAgX2NyZWF0ZVBhcnQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9wZXJ0eVBhcnQodGhpcyk7CiAgICB9CiAgICBfZ2V0VmFsdWUoKSB7CiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnRzWzBdLnZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwZXIuX2dldFZhbHVlKCk7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmVsZW1lbnRbdGhpcy5uYW1lXSA9IHRoaXMuX2dldFZhbHVlKCk7CiAgICAgICAgfQogICAgfQp9CmNsYXNzIFByb3BlcnR5UGFydCBleHRlbmRzIEF0dHJpYnV0ZVBhcnQgewp9CmxldCBldmVudE9wdGlvbnNTdXBwb3J0ZWQgPSBmYWxzZTsKKCgpPT57CiAgICB0cnkgewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7CiAgICAgICAgICAgIGdldCBjYXB0dXJlICgpIHsKICAgICAgICAgICAgICAgIGV2ZW50T3B0aW9uc1N1cHBvcnRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0ZXN0Iiwgb3B0aW9ucywgb3B0aW9ucyk7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInRlc3QiLCBvcHRpb25zLCBvcHRpb25zKTsKICAgIH0gY2F0Y2ggKF9lKSB7fQp9KSgpOwpjbGFzcyBFdmVudFBhcnQgewogICAgY29uc3RydWN0b3IoZWxlbWVudCwgZXZlbnROYW1lLCBldmVudENvbnRleHQpewogICAgICAgIHRoaXMudmFsdWUgPSB2b2lkIDA7CiAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IHZvaWQgMDsKICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lOwogICAgICAgIHRoaXMuZXZlbnRDb250ZXh0ID0gZXZlbnRDb250ZXh0OwogICAgICAgIHRoaXMuX19ib3VuZEhhbmRsZUV2ZW50ID0gKGUpPT50aGlzLmhhbmRsZUV2ZW50KGUpCiAgICAgICAgOwogICAgfQogICAgc2V0VmFsdWUodmFsdWUpIHsKICAgICAgICB0aGlzLl9fcGVuZGluZ1ZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBjb21taXQoKSB7CiAgICAgICAgd2hpbGUoaXNEaXJlY3RpdmUodGhpcy5fX3BlbmRpbmdWYWx1ZSkpewogICAgICAgICAgICBjb25zdCBkaXJlY3RpdmUyID0gdGhpcy5fX3BlbmRpbmdWYWx1ZTsKICAgICAgICAgICAgdGhpcy5fX3BlbmRpbmdWYWx1ZSA9IG5vQ2hhbmdlOwogICAgICAgICAgICBkaXJlY3RpdmUyKHRoaXMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fX3BlbmRpbmdWYWx1ZSA9PT0gbm9DaGFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBuZXdMaXN0ZW5lciA9IHRoaXMuX19wZW5kaW5nVmFsdWU7CiAgICAgICAgY29uc3Qgb2xkTGlzdGVuZXIgPSB0aGlzLnZhbHVlOwogICAgICAgIGNvbnN0IHNob3VsZFJlbW92ZUxpc3RlbmVyID0gbmV3TGlzdGVuZXIgPT0gbnVsbCB8fCBvbGRMaXN0ZW5lciAhPSBudWxsICYmIChuZXdMaXN0ZW5lci5jYXB0dXJlICE9PSBvbGRMaXN0ZW5lci5jYXB0dXJlIHx8IG5ld0xpc3RlbmVyLm9uY2UgIT09IG9sZExpc3RlbmVyLm9uY2UgfHwgbmV3TGlzdGVuZXIucGFzc2l2ZSAhPT0gb2xkTGlzdGVuZXIucGFzc2l2ZSk7CiAgICAgICAgY29uc3Qgc2hvdWxkQWRkTGlzdGVuZXIgPSBuZXdMaXN0ZW5lciAhPSBudWxsICYmIChvbGRMaXN0ZW5lciA9PSBudWxsIHx8IHNob3VsZFJlbW92ZUxpc3RlbmVyKTsKICAgICAgICBpZiAoc2hvdWxkUmVtb3ZlTGlzdGVuZXIpIHsKICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIHRoaXMuX19ib3VuZEhhbmRsZUV2ZW50LCB0aGlzLl9fb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIGlmIChzaG91bGRBZGRMaXN0ZW5lcikgewogICAgICAgICAgICB0aGlzLl9fb3B0aW9ucyA9IGdldE9wdGlvbnMobmV3TGlzdGVuZXIpOwogICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgdGhpcy5fX2JvdW5kSGFuZGxlRXZlbnQsIHRoaXMuX19vcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52YWx1ZSA9IG5ld0xpc3RlbmVyOwogICAgICAgIHRoaXMuX19wZW5kaW5nVmFsdWUgPSBub0NoYW5nZTsKICAgIH0KICAgIGhhbmRsZUV2ZW50KGV2ZW50KSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhbHVlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUuY2FsbCh0aGlzLmV2ZW50Q29udGV4dCB8fCB0aGlzLmVsZW1lbnQsIGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnZhbHVlLmhhbmRsZUV2ZW50KGV2ZW50KTsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgZ2V0T3B0aW9ucyA9IChvKT0+byAmJiAoZXZlbnRPcHRpb25zU3VwcG9ydGVkID8gewogICAgICAgIGNhcHR1cmU6IG8uY2FwdHVyZSwKICAgICAgICBwYXNzaXZlOiBvLnBhc3NpdmUsCiAgICAgICAgb25jZTogby5vbmNlCiAgICB9IDogby5jYXB0dXJlKQo7CmNsYXNzIERlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvciB7CiAgICBoYW5kbGVBdHRyaWJ1dGVFeHByZXNzaW9ucyhlbGVtZW50LCBuYW1lLCBzdHJpbmdzLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZVswXTsKICAgICAgICBpZiAocHJlZml4ID09PSAiLiIpIHsKICAgICAgICAgICAgY29uc3QgY29tbWl0dGVyMiA9IG5ldyBQcm9wZXJ0eUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBzdHJpbmdzKTsKICAgICAgICAgICAgcmV0dXJuIGNvbW1pdHRlcjIucGFydHM7CiAgICAgICAgfQogICAgICAgIGlmIChwcmVmaXggPT09ICJAIikgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgbmV3IEV2ZW50UGFydChlbGVtZW50LCBuYW1lLnNsaWNlKDEpLCBvcHRpb25zLmV2ZW50Q29udGV4dCkKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgaWYgKHByZWZpeCA9PT0gIj8iKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBuZXcgQm9vbGVhbkF0dHJpYnV0ZVBhcnQoZWxlbWVudCwgbmFtZS5zbGljZSgxKSwgc3RyaW5ncykKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29tbWl0dGVyID0gbmV3IEF0dHJpYnV0ZUNvbW1pdHRlcihlbGVtZW50LCBuYW1lLCBzdHJpbmdzKTsKICAgICAgICByZXR1cm4gY29tbWl0dGVyLnBhcnRzOwogICAgfQogICAgaGFuZGxlVGV4dEV4cHJlc3Npb24ob3B0aW9ucykgewogICAgICAgIHJldHVybiBuZXcgTm9kZVBhcnQob3B0aW9ucyk7CiAgICB9Cn0KY29uc3QgZGVmYXVsdFRlbXBsYXRlUHJvY2Vzc29yID0gbmV3IERlZmF1bHRUZW1wbGF0ZVByb2Nlc3NvcigpOwpmdW5jdGlvbiB0ZW1wbGF0ZUZhY3RvcnkocmVzdWx0KSB7CiAgICBsZXQgdGVtcGxhdGVDYWNoZSA9IHRlbXBsYXRlQ2FjaGVzLmdldChyZXN1bHQudHlwZSk7CiAgICBpZiAodGVtcGxhdGVDYWNoZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGVtcGxhdGVDYWNoZSA9IHsKICAgICAgICAgICAgc3RyaW5nc0FycmF5OiBuZXcgV2Vha01hcCgpLAogICAgICAgICAgICBrZXlTdHJpbmc6IG5ldyBNYXAoKQogICAgICAgIH07CiAgICAgICAgdGVtcGxhdGVDYWNoZXMuc2V0KHJlc3VsdC50eXBlLCB0ZW1wbGF0ZUNhY2hlKTsKICAgIH0KICAgIGxldCB0ZW1wbGF0ZSA9IHRlbXBsYXRlQ2FjaGUuc3RyaW5nc0FycmF5LmdldChyZXN1bHQuc3RyaW5ncyk7CiAgICBpZiAodGVtcGxhdGUgIT09IHZvaWQgMCkgewogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHJlc3VsdC5zdHJpbmdzLmpvaW4obWFya2VyKTsKICAgIHRlbXBsYXRlID0gdGVtcGxhdGVDYWNoZS5rZXlTdHJpbmcuZ2V0KGtleSk7CiAgICBpZiAodGVtcGxhdGUgPT09IHZvaWQgMCkgewogICAgICAgIHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKHJlc3VsdCwgcmVzdWx0LmdldFRlbXBsYXRlRWxlbWVudCgpKTsKICAgICAgICB0ZW1wbGF0ZUNhY2hlLmtleVN0cmluZy5zZXQoa2V5LCB0ZW1wbGF0ZSk7CiAgICB9CiAgICB0ZW1wbGF0ZUNhY2hlLnN0cmluZ3NBcnJheS5zZXQocmVzdWx0LnN0cmluZ3MsIHRlbXBsYXRlKTsKICAgIHJldHVybiB0ZW1wbGF0ZTsKfQpjb25zdCB0ZW1wbGF0ZUNhY2hlcyA9IG5ldyBNYXAoKTsKY29uc3QgcGFydHMgPSBuZXcgV2Vha01hcCgpOwpjb25zdCByZW5kZXIgPSAocmVzdWx0LCBjb250YWluZXIsIG9wdGlvbnMpPT57CiAgICBsZXQgcGFydCA9IHBhcnRzLmdldChjb250YWluZXIpOwogICAgaWYgKHBhcnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbW92ZU5vZGVzKGNvbnRhaW5lciwgY29udGFpbmVyLmZpcnN0Q2hpbGQpOwogICAgICAgIHBhcnRzLnNldChjb250YWluZXIsIHBhcnQgPSBuZXcgTm9kZVBhcnQoT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICAgIHRlbXBsYXRlRmFjdG9yeQogICAgICAgIH0sIG9wdGlvbnMpKSk7CiAgICAgICAgcGFydC5hcHBlbmRJbnRvKGNvbnRhaW5lcik7CiAgICB9CiAgICBwYXJ0LnNldFZhbHVlKHJlc3VsdCk7CiAgICBwYXJ0LmNvbW1pdCgpOwp9OwppZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICh3aW5kb3dbImxpdEh0bWxWZXJzaW9ucyJdIHx8ICh3aW5kb3dbImxpdEh0bWxWZXJzaW9ucyJdID0gW10pKS5wdXNoKCIxLjQuMSIpOwp9CmNvbnN0IGh0bWwgPSAoc3RyaW5ncywgLi4udmFsdWVzKT0+bmV3IFRlbXBsYXRlUmVzdWx0KHN0cmluZ3MsIHZhbHVlcywgImh0bWwiLCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IpCjsKY29uc3Qgc3ZnID0gKHN0cmluZ3MsIC4uLnZhbHVlcyk9Pm5ldyBTVkdUZW1wbGF0ZVJlc3VsdChzdHJpbmdzLCB2YWx1ZXMsICJzdmciLCBkZWZhdWx0VGVtcGxhdGVQcm9jZXNzb3IpCjsKdmFyIF9hOwp3aW5kb3cuSlNDb21waWxlcl9yZW5hbWVQcm9wZXJ0eSA9IChwcm9wLCBfb2JqKT0+cHJvcAo7CmNvbnN0IGRlZmF1bHRDb252ZXJ0ZXIgPSB7CiAgICB0b0F0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/ICIiIDogbnVsbDsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZnJvbUF0dHJpYnV0ZSAodmFsdWUsIHR5cGUpIHsKICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgQm9vbGVhbjoKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbDsKICAgICAgICAgICAgY2FzZSBOdW1iZXI6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgPyBudWxsIDogTnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgY2FzZSBPYmplY3Q6CiAgICAgICAgICAgIGNhc2UgQXJyYXk6CiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KfTsKY29uc3Qgbm90RXF1YWwgPSAodmFsdWUsIG9sZCk9PnsKICAgIHJldHVybiBvbGQgIT09IHZhbHVlICYmIChvbGQgPT09IG9sZCB8fCB2YWx1ZSA9PT0gdmFsdWUpOwp9Owpjb25zdCBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbiA9IHsKICAgIGF0dHJpYnV0ZTogdHJ1ZSwKICAgIHR5cGU6IFN0cmluZywKICAgIGNvbnZlcnRlcjogZGVmYXVsdENvbnZlcnRlciwKICAgIHJlZmxlY3Q6IGZhbHNlLAogICAgaGFzQ2hhbmdlZDogbm90RXF1YWwKfTsKY29uc3QgU1RBVEVfSEFTX1VQREFURUQgPSAxOwpjb25zdCBTVEFURV9VUERBVEVfUkVRVUVTVEVEID0gMSA8PCAyOwpjb25zdCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURSA9IDEgPDwgMzsKY29uc3QgU1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWSA9IDEgPDwgNDsKY29uc3QgZmluYWxpemVkID0gImZpbmFsaXplZCI7CmNsYXNzIFVwZGF0aW5nRWxlbWVudCBleHRlbmRzIEhUTUxFbGVtZW50IHsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLmluaXRpYWxpemUoKTsKICAgIH0KICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gW107CiAgICAgICAgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLmZvckVhY2goKHYsIHApPT57CiAgICAgICAgICAgIGNvbnN0IGF0dHIgPSB0aGlzLl9hdHRyaWJ1dGVOYW1lRm9yUHJvcGVydHkocCwgdik7CiAgICAgICAgICAgIGlmIChhdHRyICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJpYnV0ZVRvUHJvcGVydHlNYXAuc2V0KGF0dHIsIHApOwogICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKGF0dHIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXM7CiAgICB9CiAgICBzdGF0aWMgX2Vuc3VyZUNsYXNzUHJvcGVydGllcygpIHsKICAgICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoSlNDb21waWxlcl9yZW5hbWVQcm9wZXJ0eSgiX2NsYXNzUHJvcGVydGllcyIsIHRoaXMpKSkgewogICAgICAgICAgICB0aGlzLl9jbGFzc1Byb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IHN1cGVyUHJvcGVydGllcyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fY2xhc3NQcm9wZXJ0aWVzOwogICAgICAgICAgICBpZiAoc3VwZXJQcm9wZXJ0aWVzICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHN1cGVyUHJvcGVydGllcy5mb3JFYWNoKCh2LCBrKT0+dGhpcy5fY2xhc3NQcm9wZXJ0aWVzLnNldChrLCB2KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBjcmVhdGVQcm9wZXJ0eShuYW1lLCBvcHRpb25zID0gZGVmYXVsdFByb3BlcnR5RGVjbGFyYXRpb24pIHsKICAgICAgICB0aGlzLl9lbnN1cmVDbGFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB0aGlzLl9jbGFzc1Byb3BlcnRpZXMuc2V0KG5hbWUsIG9wdGlvbnMpOwogICAgICAgIGlmIChvcHRpb25zLm5vQWNjZXNzb3IgfHwgdGhpcy5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBrZXkgPSB0eXBlb2YgbmFtZSA9PT0gInN5bWJvbCIgPyBTeW1ib2woKSA6IGBfXyR7bmFtZX1gOwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSB0aGlzLmdldFByb3BlcnR5RGVzY3JpcHRvcihuYW1lLCBrZXksIG9wdGlvbnMpOwogICAgICAgIGlmIChkZXNjcmlwdG9yICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucHJvdG90eXBlLCBuYW1lLCBkZXNjcmlwdG9yKTsKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgZ2V0UHJvcGVydHlEZXNjcmlwdG9yKG5hbWUsIGtleSwgb3B0aW9ucykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldCAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1trZXldOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFVwZGF0ZUludGVybmFsKG5hbWUsIG9sZFZhbHVlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICAgICAgfTsKICAgIH0KICAgIHN0YXRpYyBnZXRQcm9wZXJ0eU9wdGlvbnMobmFtZSkgewogICAgICAgIHJldHVybiB0aGlzLl9jbGFzc1Byb3BlcnRpZXMgJiYgdGhpcy5fY2xhc3NQcm9wZXJ0aWVzLmdldChuYW1lKSB8fCBkZWZhdWx0UHJvcGVydHlEZWNsYXJhdGlvbjsKICAgIH0KICAgIHN0YXRpYyBmaW5hbGl6ZSgpIHsKICAgICAgICBjb25zdCBzdXBlckN0b3IgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyk7CiAgICAgICAgaWYgKCFzdXBlckN0b3IuaGFzT3duUHJvcGVydHkoZmluYWxpemVkKSkgewogICAgICAgICAgICBzdXBlckN0b3IuZmluYWxpemUoKTsKICAgICAgICB9CiAgICAgICAgdGhpc1tmaW5hbGl6ZWRdID0gdHJ1ZTsKICAgICAgICB0aGlzLl9lbnN1cmVDbGFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB0aGlzLl9hdHRyaWJ1dGVUb1Byb3BlcnR5TWFwID0gbmV3IE1hcCgpOwogICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KEpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkoInByb3BlcnRpZXMiLCB0aGlzKSkpIHsKICAgICAgICAgICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BlcnRpZXM7CiAgICAgICAgICAgIGNvbnN0IHByb3BLZXlzID0gWwogICAgICAgICAgICAgICAgLi4uT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocHJvcHMpLAogICAgICAgICAgICAgICAgLi4udHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHByb3BzKSA6IFtdCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBwcm9wS2V5cyl7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVByb3BlcnR5KHAsIHByb3BzW3BdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfYXR0cmlidXRlTmFtZUZvclByb3BlcnR5KG5hbWUsIG9wdGlvbnMpIHsKICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBvcHRpb25zLmF0dHJpYnV0ZTsKICAgICAgICByZXR1cm4gYXR0cmlidXRlID09PSBmYWxzZSA/IHZvaWQgMCA6IHR5cGVvZiBhdHRyaWJ1dGUgPT09ICJzdHJpbmciID8gYXR0cmlidXRlIDogdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciID8gbmFtZS50b0xvd2VyQ2FzZSgpIDogdm9pZCAwOwogICAgfQogICAgc3RhdGljIF92YWx1ZUhhc0NoYW5nZWQodmFsdWUsIG9sZCwgaGFzQ2hhbmdlZCA9IG5vdEVxdWFsKSB7CiAgICAgICAgcmV0dXJuIGhhc0NoYW5nZWQodmFsdWUsIG9sZCk7CiAgICB9CiAgICBzdGF0aWMgX3Byb3BlcnR5VmFsdWVGcm9tQXR0cmlidXRlKHZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgICBjb25zdCBjb252ZXJ0ZXIgPSBvcHRpb25zLmNvbnZlcnRlciB8fCBkZWZhdWx0Q29udmVydGVyOwogICAgICAgIGNvbnN0IGZyb21BdHRyaWJ1dGUgPSB0eXBlb2YgY29udmVydGVyID09PSAiZnVuY3Rpb24iID8gY29udmVydGVyIDogY29udmVydGVyLmZyb21BdHRyaWJ1dGU7CiAgICAgICAgcmV0dXJuIGZyb21BdHRyaWJ1dGUgPyBmcm9tQXR0cmlidXRlKHZhbHVlLCB0eXBlKSA6IHZhbHVlOwogICAgfQogICAgc3RhdGljIF9wcm9wZXJ0eVZhbHVlVG9BdHRyaWJ1dGUodmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucy5yZWZsZWN0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB0eXBlID0gb3B0aW9ucy50eXBlOwogICAgICAgIGNvbnN0IGNvbnZlcnRlciA9IG9wdGlvbnMuY29udmVydGVyOwogICAgICAgIGNvbnN0IHRvQXR0cmlidXRlID0gY29udmVydGVyICYmIGNvbnZlcnRlci50b0F0dHJpYnV0ZSB8fCBkZWZhdWx0Q29udmVydGVyLnRvQXR0cmlidXRlOwogICAgICAgIHJldHVybiB0b0F0dHJpYnV0ZSh2YWx1ZSwgdHlwZSk7CiAgICB9CiAgICBpbml0aWFsaXplKCkgewogICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gMDsKICAgICAgICB0aGlzLl91cGRhdGVQcm9taXNlID0gbmV3IFByb21pc2UoKHJlcyk9PnRoaXMuX2VuYWJsZVVwZGF0aW5nUmVzb2x2ZXIgPSByZXMKICAgICAgICApOwogICAgICAgIHRoaXMuX2NoYW5nZWRQcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgICAgIHRoaXMuX3NhdmVJbnN0YW5jZVByb3BlcnRpZXMoKTsKICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGVJbnRlcm5hbCgpOwogICAgfQogICAgX3NhdmVJbnN0YW5jZVByb3BlcnRpZXMoKSB7CiAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5fY2xhc3NQcm9wZXJ0aWVzLmZvckVhY2goKF92LCBwKT0+ewogICAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShwKSkgewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW3BdOwogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXNbcF07CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlUHJvcGVydGllcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlUHJvcGVydGllcy5zZXQocCwgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBfYXBwbHlJbnN0YW5jZVByb3BlcnRpZXMoKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzLmZvckVhY2goKHYsIHApPT50aGlzW3BdID0gdgogICAgICAgICk7CiAgICAgICAgdGhpcy5faW5zdGFuY2VQcm9wZXJ0aWVzID0gdm9pZCAwOwogICAgfQogICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7CiAgICAgICAgdGhpcy5lbmFibGVVcGRhdGluZygpOwogICAgfQogICAgZW5hYmxlVXBkYXRpbmcoKSB7CiAgICAgICAgaWYgKHRoaXMuX2VuYWJsZVVwZGF0aW5nUmVzb2x2ZXIgIT09IHZvaWQgMCkgewogICAgICAgICAgICB0aGlzLl9lbmFibGVVcGRhdGluZ1Jlc29sdmVyKCk7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZVVwZGF0aW5nUmVzb2x2ZXIgPSB2b2lkIDA7CiAgICAgICAgfQogICAgfQogICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7fQogICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKG5hbWUsIG9sZCwgdmFsdWUpIHsKICAgICAgICBpZiAob2xkICE9PSB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLl9hdHRyaWJ1dGVUb1Byb3BlcnR5KG5hbWUsIHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBfcHJvcGVydHlUb0F0dHJpYnV0ZShuYW1lLCB2YWx1ZSwgb3B0aW9ucyA9IGRlZmF1bHRQcm9wZXJ0eURlY2xhcmF0aW9uKSB7CiAgICAgICAgY29uc3QgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgY29uc3QgYXR0ciA9IGN0b3IuX2F0dHJpYnV0ZU5hbWVGb3JQcm9wZXJ0eShuYW1lLCBvcHRpb25zKTsKICAgICAgICBpZiAoYXR0ciAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnN0IGF0dHJWYWx1ZSA9IGN0b3IuX3Byb3BlcnR5VmFsdWVUb0F0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChhdHRyVmFsdWUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURTsKICAgICAgICAgICAgaWYgKGF0dHJWYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShhdHRyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGF0dHIsIGF0dHJWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSAmIH5TVEFURV9JU19SRUZMRUNUSU5HX1RPX0FUVFJJQlVURTsKICAgICAgICB9CiAgICB9CiAgICBfYXR0cmlidXRlVG9Qcm9wZXJ0eShuYW1lLCB2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fQVRUUklCVVRFKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgY29uc3QgcHJvcE5hbWUgPSBjdG9yLl9hdHRyaWJ1dGVUb1Byb3BlcnR5TWFwLmdldChuYW1lKTsKICAgICAgICBpZiAocHJvcE5hbWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBvcHRpb25zID0gY3Rvci5nZXRQcm9wZXJ0eU9wdGlvbnMocHJvcE5hbWUpOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWTsKICAgICAgICAgICAgdGhpc1twcm9wTmFtZV0gPSBjdG9yLl9wcm9wZXJ0eVZhbHVlRnJvbUF0dHJpYnV0ZSh2YWx1ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgJiB+U1RBVEVfSVNfUkVGTEVDVElOR19UT19QUk9QRVJUWTsKICAgICAgICB9CiAgICB9CiAgICByZXF1ZXN0VXBkYXRlSW50ZXJuYWwobmFtZSwgb2xkVmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBsZXQgc2hvdWxkUmVxdWVzdFVwZGF0ZSA9IHRydWU7CiAgICAgICAgaWYgKG5hbWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgY3Rvci5nZXRQcm9wZXJ0eU9wdGlvbnMobmFtZSk7CiAgICAgICAgICAgIGlmIChjdG9yLl92YWx1ZUhhc0NoYW5nZWQodGhpc1tuYW1lXSwgb2xkVmFsdWUsIG9wdGlvbnMuaGFzQ2hhbmdlZCkpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMuc2V0KG5hbWUsIG9sZFZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnJlZmxlY3QgPT09IHRydWUgJiYgISh0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX0lTX1JFRkxFQ1RJTkdfVE9fUFJPUEVSVFkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmxlY3RpbmdQcm9wZXJ0aWVzLnNldChuYW1lLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3VsZFJlcXVlc3RVcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZSAmJiBzaG91bGRSZXF1ZXN0VXBkYXRlKSB7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVByb21pc2UgPSB0aGlzLl9lbnF1ZXVlVXBkYXRlKCk7CiAgICAgICAgfQogICAgfQogICAgcmVxdWVzdFVwZGF0ZShuYW1lLCBvbGRWYWx1ZSkgewogICAgICAgIHRoaXMucmVxdWVzdFVwZGF0ZUludGVybmFsKG5hbWUsIG9sZFZhbHVlKTsKICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVDb21wbGV0ZTsKICAgIH0KICAgIGFzeW5jIF9lbnF1ZXVlVXBkYXRlKCkgewogICAgICAgIHRoaXMuX3VwZGF0ZVN0YXRlID0gdGhpcy5fdXBkYXRlU3RhdGUgfCBTVEFURV9VUERBVEVfUkVRVUVTVEVEOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZVByb21pc2U7CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnBlcmZvcm1VcGRhdGUoKTsKICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHsKICAgICAgICAgICAgYXdhaXQgcmVzdWx0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZTsKICAgIH0KICAgIGdldCBfaGFzUmVxdWVzdGVkVXBkYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVTdGF0ZSAmIFNUQVRFX1VQREFURV9SRVFVRVNURUQ7CiAgICB9CiAgICBnZXQgaGFzVXBkYXRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlU3RhdGUgJiAxOwogICAgfQogICAgcGVyZm9ybVVwZGF0ZSgpIHsKICAgICAgICBpZiAoIXRoaXMuX2hhc1JlcXVlc3RlZFVwZGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZVByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdGhpcy5fYXBwbHlJbnN0YW5jZVByb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgICAgbGV0IHNob3VsZFVwZGF0ZSA9IGZhbHNlOwogICAgICAgIGNvbnN0IGNoYW5nZWRQcm9wZXJ0aWVzID0gdGhpcy5fY2hhbmdlZFByb3BlcnRpZXM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gdGhpcy5zaG91bGRVcGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpOwogICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZShjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tYXJrVXBkYXRlZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBzaG91bGRVcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSkgewogICAgICAgICAgICBpZiAoISh0aGlzLl91cGRhdGVTdGF0ZSAmIDEpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTdGF0ZSA9IHRoaXMuX3VwZGF0ZVN0YXRlIHwgU1RBVEVfSEFTX1VQREFURUQ7CiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0VXBkYXRlZChjaGFuZ2VkUHJvcGVydGllcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy51cGRhdGVkKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICB9CiAgICB9CiAgICBfbWFya1VwZGF0ZWQoKSB7CiAgICAgICAgdGhpcy5fY2hhbmdlZFByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5fdXBkYXRlU3RhdGUgPSB0aGlzLl91cGRhdGVTdGF0ZSAmIH5TVEFURV9VUERBVEVfUkVRVUVTVEVEOwogICAgfQogICAgZ2V0IHVwZGF0ZUNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRVcGRhdGVDb21wbGV0ZSgpOwogICAgfQogICAgX2dldFVwZGF0ZUNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldFVwZGF0ZUNvbXBsZXRlKCk7CiAgICB9CiAgICBnZXRVcGRhdGVDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlUHJvbWlzZTsKICAgIH0KICAgIHNob3VsZFVwZGF0ZShfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHVwZGF0ZShfY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICBpZiAodGhpcy5fcmVmbGVjdGluZ1Byb3BlcnRpZXMgIT09IHZvaWQgMCAmJiB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcy5zaXplID4gMCkgewogICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcy5mb3JFYWNoKCh2LCBrKT0+dGhpcy5fcHJvcGVydHlUb0F0dHJpYnV0ZShrLCB0aGlzW2tdLCB2KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLl9yZWZsZWN0aW5nUHJvcGVydGllcyA9IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbWFya1VwZGF0ZWQoKTsKICAgIH0KICAgIHVwZGF0ZWQoX2NoYW5nZWRQcm9wZXJ0aWVzKSB7fQogICAgZmlyc3RVcGRhdGVkKF9jaGFuZ2VkUHJvcGVydGllcykge30KfQpfYSA9IGZpbmFsaXplZDsKVXBkYXRpbmdFbGVtZW50W19hXSA9IHRydWU7CmNvbnN0IEVsZW1lbnRQcm90byA9IEVsZW1lbnQucHJvdG90eXBlOwpFbGVtZW50UHJvdG8ubXNNYXRjaGVzU2VsZWN0b3IgfHwgRWxlbWVudFByb3RvLndlYmtpdE1hdGNoZXNTZWxlY3RvcjsKY29uc3Qgc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzID0gd2luZG93LlNoYWRvd1Jvb3QgJiYgKHdpbmRvdy5TaGFkeUNTUyA9PT0gdm9pZCAwIHx8IHdpbmRvdy5TaGFkeUNTUy5uYXRpdmVTaGFkb3cpICYmICJhZG9wdGVkU3R5bGVTaGVldHMiIGluIERvY3VtZW50LnByb3RvdHlwZSAmJiAicmVwbGFjZSIgaW4gQ1NTU3R5bGVTaGVldC5wcm90b3R5cGU7CmNvbnN0IGNvbnN0cnVjdGlvblRva2VuID0gU3ltYm9sKCk7CmNsYXNzIENTU1Jlc3VsdCB7CiAgICBjb25zdHJ1Y3Rvcihjc3NUZXh0LCBzYWZlVG9rZW4pewogICAgICAgIGlmIChzYWZlVG9rZW4gIT09IGNvbnN0cnVjdGlvblRva2VuKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ1NTUmVzdWx0IGlzIG5vdCBjb25zdHJ1Y3RhYmxlLiBVc2UgYHVuc2FmZUNTU2Agb3IgYGNzc2AgaW5zdGVhZC4iKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jc3NUZXh0ID0gY3NzVGV4dDsKICAgIH0KICAgIGdldCBzdHlsZVNoZWV0KCkgewogICAgICAgIGlmICh0aGlzLl9zdHlsZVNoZWV0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgaWYgKHN1cHBvcnRzQWRvcHRpbmdTdHlsZVNoZWV0cykgewogICAgICAgICAgICAgICAgdGhpcy5fc3R5bGVTaGVldCA9IG5ldyBDU1NTdHlsZVNoZWV0KCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zdHlsZVNoZWV0LnJlcGxhY2VTeW5jKHRoaXMuY3NzVGV4dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zdHlsZVNoZWV0ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVTaGVldDsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLmNzc1RleHQ7CiAgICB9Cn0KY29uc3QgdW5zYWZlQ1NTID0gKHZhbHVlKT0+ewogICAgcmV0dXJuIG5ldyBDU1NSZXN1bHQoU3RyaW5nKHZhbHVlKSwgY29uc3RydWN0aW9uVG9rZW4pOwp9Owpjb25zdCB0ZXh0RnJvbUNTU1Jlc3VsdCA9ICh2YWx1ZSk9PnsKICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIENTU1Jlc3VsdCkgewogICAgICAgIHJldHVybiB2YWx1ZS5jc3NUZXh0OwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZhbHVlIHBhc3NlZCB0byAnY3NzJyBmdW5jdGlvbiBtdXN0IGJlIGEgJ2NzcycgZnVuY3Rpb24gcmVzdWx0OiAke3ZhbHVlfS4gVXNlICd1bnNhZmVDU1MnIHRvIHBhc3Mgbm9uLWxpdGVyYWwgdmFsdWVzLCBidXQKICAgICAgICAgICAgdGFrZSBjYXJlIHRvIGVuc3VyZSBwYWdlIHNlY3VyaXR5LmApOwogICAgfQp9Owpjb25zdCBjc3MgPSAoc3RyaW5ncywgLi4udmFsdWVzKT0+ewogICAgY29uc3QgY3NzVGV4dCA9IHZhbHVlcy5yZWR1Y2UoKGFjYywgdiwgaWR4KT0+YWNjICsgdGV4dEZyb21DU1NSZXN1bHQodikgKyBzdHJpbmdzW2lkeCArIDFdCiAgICAsIHN0cmluZ3NbMF0pOwogICAgcmV0dXJuIG5ldyBDU1NSZXN1bHQoY3NzVGV4dCwgY29uc3RydWN0aW9uVG9rZW4pOwp9Owood2luZG93WyJsaXRFbGVtZW50VmVyc2lvbnMiXSB8fCAod2luZG93WyJsaXRFbGVtZW50VmVyc2lvbnMiXSA9IFtdKSkucHVzaCgiMi41LjEiKTsKY29uc3QgcmVuZGVyTm90SW1wbGVtZW50ZWQgPSB7fTsKY2xhc3MgTGl0RWxlbWVudCBleHRlbmRzIFVwZGF0aW5nRWxlbWVudCB7CiAgICBzdGF0aWMgZ2V0U3R5bGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLnN0eWxlczsKICAgIH0KICAgIHN0YXRpYyBfZ2V0VW5pcXVlU3R5bGVzKCkgewogICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KEpTQ29tcGlsZXJfcmVuYW1lUHJvcGVydHkoIl9zdHlsZXMiLCB0aGlzKSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB1c2VyU3R5bGVzID0gdGhpcy5nZXRTdHlsZXMoKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VyU3R5bGVzKSkgewogICAgICAgICAgICBjb25zdCBhZGRTdHlsZXMgPSAoc3R5bGVzMiwgc2V0Mik9PnN0eWxlczIucmVkdWNlUmlnaHQoKHNldDMsIHMpPT5BcnJheS5pc0FycmF5KHMpID8gYWRkU3R5bGVzKHMsIHNldDMpIDogKHNldDMuYWRkKHMpLCBzZXQzKQogICAgICAgICAgICAgICAgLCBzZXQyKQogICAgICAgICAgICA7CiAgICAgICAgICAgIGNvbnN0IHNldCA9IGFkZFN0eWxlcyh1c2VyU3R5bGVzLCBuZXcgU2V0KCkpOwogICAgICAgICAgICBjb25zdCBzdHlsZXMgPSBbXTsKICAgICAgICAgICAgc2V0LmZvckVhY2goKHYpPT5zdHlsZXMudW5zaGlmdCh2KQogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLl9zdHlsZXMgPSBzdHlsZXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fc3R5bGVzID0gdXNlclN0eWxlcyA9PT0gdm9pZCAwID8gW10gOiBbCiAgICAgICAgICAgICAgICB1c2VyU3R5bGVzCiAgICAgICAgICAgIF07CiAgICAgICAgfQogICAgICAgIHRoaXMuX3N0eWxlcyA9IHRoaXMuX3N0eWxlcy5tYXAoKHMpPT57CiAgICAgICAgICAgIGlmIChzIGluc3RhbmNlb2YgQ1NTU3R5bGVTaGVldCAmJiAhc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjc3NUZXh0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwocy5jc3NSdWxlcykucmVkdWNlKChjc3MyLCBydWxlKT0+Y3NzMiArIHJ1bGUuY3NzVGV4dAogICAgICAgICAgICAgICAgLCAiIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5zYWZlQ1NTKGNzc1RleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0pOwogICAgfQogICAgaW5pdGlhbGl6ZSgpIHsKICAgICAgICBzdXBlci5pbml0aWFsaXplKCk7CiAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5fZ2V0VW5pcXVlU3R5bGVzKCk7CiAgICAgICAgdGhpcy5yZW5kZXJSb290ID0gdGhpcy5jcmVhdGVSZW5kZXJSb290KCk7CiAgICAgICAgaWYgKHdpbmRvdy5TaGFkb3dSb290ICYmIHRoaXMucmVuZGVyUm9vdCBpbnN0YW5jZW9mIHdpbmRvdy5TaGFkb3dSb290KSB7CiAgICAgICAgICAgIHRoaXMuYWRvcHRTdHlsZXMoKTsKICAgICAgICB9CiAgICB9CiAgICBjcmVhdGVSZW5kZXJSb290KCkgewogICAgICAgIHJldHVybiB0aGlzLmF0dGFjaFNoYWRvdyh0aGlzLmNvbnN0cnVjdG9yLnNoYWRvd1Jvb3RPcHRpb25zKTsKICAgIH0KICAgIGFkb3B0U3R5bGVzKCkgewogICAgICAgIGNvbnN0IHN0eWxlcyA9IHRoaXMuY29uc3RydWN0b3IuX3N0eWxlczsKICAgICAgICBpZiAoc3R5bGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh3aW5kb3cuU2hhZHlDU1MgIT09IHZvaWQgMCAmJiAhd2luZG93LlNoYWR5Q1NTLm5hdGl2ZVNoYWRvdykgewogICAgICAgICAgICB3aW5kb3cuU2hhZHlDU1MuU2NvcGluZ1NoaW0ucHJlcGFyZUFkb3B0ZWRDc3NUZXh0KHN0eWxlcy5tYXAoKHMpPT5zLmNzc1RleHQKICAgICAgICAgICAgKSwgdGhpcy5sb2NhbE5hbWUpOwogICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNBZG9wdGluZ1N0eWxlU2hlZXRzKSB7CiAgICAgICAgICAgIHRoaXMucmVuZGVyUm9vdC5hZG9wdGVkU3R5bGVTaGVldHMgPSBzdHlsZXMubWFwKChzKT0+cyBpbnN0YW5jZW9mIENTU1N0eWxlU2hlZXQgPyBzIDogcy5zdHlsZVNoZWV0CiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fbmVlZHNTaGltQWRvcHRlZFN0eWxlU2hlZXRzID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHsKICAgICAgICBzdXBlci5jb25uZWN0ZWRDYWxsYmFjaygpOwogICAgICAgIGlmICh0aGlzLmhhc1VwZGF0ZWQgJiYgd2luZG93LlNoYWR5Q1NTICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgd2luZG93LlNoYWR5Q1NTLnN0eWxlRWxlbWVudCh0aGlzKTsKICAgICAgICB9CiAgICB9CiAgICB1cGRhdGUoY2hhbmdlZFByb3BlcnRpZXMpIHsKICAgICAgICBjb25zdCB0ZW1wbGF0ZVJlc3VsdCA9IHRoaXMucmVuZGVyKCk7CiAgICAgICAgc3VwZXIudXBkYXRlKGNoYW5nZWRQcm9wZXJ0aWVzKTsKICAgICAgICBpZiAodGVtcGxhdGVSZXN1bHQgIT09IHJlbmRlck5vdEltcGxlbWVudGVkKSB7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IucmVuZGVyKHRlbXBsYXRlUmVzdWx0LCB0aGlzLnJlbmRlclJvb3QsIHsKICAgICAgICAgICAgICAgIHNjb3BlTmFtZTogdGhpcy5sb2NhbE5hbWUsCiAgICAgICAgICAgICAgICBldmVudENvbnRleHQ6IHRoaXMKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9uZWVkc1NoaW1BZG9wdGVkU3R5bGVTaGVldHMpIHsKICAgICAgICAgICAgdGhpcy5fbmVlZHNTaGltQWRvcHRlZFN0eWxlU2hlZXRzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IuX3N0eWxlcy5mb3JFYWNoKChzKT0+ewogICAgICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgICAgICAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBzLmNzc1RleHQ7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclJvb3QuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICByZW5kZXIoKSB7CiAgICAgICAgcmV0dXJuIHJlbmRlck5vdEltcGxlbWVudGVkOwogICAgfQp9CkxpdEVsZW1lbnRbImZpbmFsaXplZCJdID0gdHJ1ZTsKTGl0RWxlbWVudC5yZW5kZXIgPSByZW5kZXI7CkxpdEVsZW1lbnQuc2hhZG93Um9vdE9wdGlvbnMgPSB7CiAgICBtb2RlOiAib3BlbiIKfTsKYXN5bmMgZnVuY3Rpb24gbGlzdER1cmFibGVPYmplY3RzTmFtZXNwYWNlcyhhY2NvdW50SWQsIGFwaVRva2VuKSB7CiAgICBjb25zdCB1cmwgPSBgJHtjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKX0vd29ya2Vycy9kdXJhYmxlX29iamVjdHMvbmFtZXNwYWNlc2A7CiAgICByZXR1cm4gKGF3YWl0IGV4ZWN1dGUoJ2xpc3REdXJhYmxlT2JqZWN0c05hbWVzcGFjZXMnLCAnR0VUJywgdXJsLCBhcGlUb2tlbikpLnJlc3VsdDsKfQphc3luYyBmdW5jdGlvbiBsaXN0U2NyaXB0cyhhY2NvdW50SWQsIGFwaVRva2VuKSB7CiAgICBjb25zdCB1cmwgPSBgJHtjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKX0vd29ya2Vycy9zY3JpcHRzYDsKICAgIHJldHVybiAoYXdhaXQgZXhlY3V0ZSgnbGlzdFNjcmlwdHMnLCAnR0VUJywgdXJsLCBhcGlUb2tlbikpLnJlc3VsdDsKfQphc3luYyBmdW5jdGlvbiBsaXN0VGFpbHMoYWNjb3VudElkLCBzY3JpcHROYW1lLCBhcGlUb2tlbikgewogICAgY29uc3QgdXJsID0gYCR7Y29tcHV0ZUFjY291bnRCYXNlVXJsKGFjY291bnRJZCl9L3dvcmtlcnMvc2NyaXB0cy8ke3NjcmlwdE5hbWV9L3RhaWxzYDsKICAgIHJldHVybiAoYXdhaXQgZXhlY3V0ZSgnbGlzdFRhaWxzJywgJ0dFVCcsIHVybCwgYXBpVG9rZW4pKS5yZXN1bHQ7Cn0KYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGFpbChhY2NvdW50SWQsIHNjcmlwdE5hbWUsIGFwaVRva2VuKSB7CiAgICBjb25zdCB1cmwgPSBgJHtjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKX0vd29ya2Vycy9zY3JpcHRzLyR7c2NyaXB0TmFtZX0vdGFpbHNgOwogICAgcmV0dXJuIChhd2FpdCBleGVjdXRlKCdjcmVhdGVUYWlsJywgJ1BPU1QnLCB1cmwsIGFwaVRva2VuKSkucmVzdWx0Owp9CmNsYXNzIENsb3VkZmxhcmVBcGkgewogICAgc3RhdGljIERFQlVHID0gZmFsc2U7CiAgICBzdGF0aWMgVVJMX1RSQU5TRk9STUVSID0gKHYpPT52CiAgICA7Cn0KY29uc3QgQVBQTElDQVRJT05fSlNPTiA9ICdhcHBsaWNhdGlvbi9qc29uJzsKY29uc3QgQVBQTElDQVRJT05fSlNPTl9VVEY4ID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnOwpjb25zdCBBUFBMSUNBVElPTl9PQ1RFVF9TVFJFQU0gPSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJzsKY29uc3QgVEVYVF9QTEFJTl9VVEY4ID0gJ3RleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgnOwpmdW5jdGlvbiBjb21wdXRlQWNjb3VudEJhc2VVcmwoYWNjb3VudElkKSB7CiAgICByZXR1cm4gQ2xvdWRmbGFyZUFwaS5VUkxfVFJBTlNGT1JNRVIoYGh0dHBzOi8vYXBpLmNsb3VkZmxhcmUuY29tL2NsaWVudC92NC9hY2NvdW50cy8ke2FjY291bnRJZH1gKTsKfQpmdW5jdGlvbiBpc1N0cmluZ1JlY29yZChvYmopIHsKICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmogIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkob2JqKSAmJiBvYmouY29uc3RydWN0b3IgPT09IE9iamVjdDsKfQphc3luYyBmdW5jdGlvbiBleGVjdXRlKG9wLCBtZXRob2QsIHVybCwgYXBpVG9rZW4sIGJvZHksIHJlc3BvbnNlVHlwZSA9ICdqc29uJykgewogICAgaWYgKENsb3VkZmxhcmVBcGkuREVCVUcpIGNvbnNvbGUubG9nKGAke29wfTogJHttZXRob2R9ICR7dXJsfWApOwogICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHthcGlUb2tlbn1gCiAgICB9KTsKICAgIGxldCBib2R5T2JqOwogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykgewogICAgICAgIGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBURVhUX1BMQUlOX1VURjgpOwogICAgfSBlbHNlIGlmIChpc1N0cmluZ1JlY29yZChib2R5KSkgewogICAgICAgIGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBBUFBMSUNBVElPTl9KU09OX1VURjgpOwogICAgICAgIGJvZHlPYmogPSBib2R5OwogICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTsKICAgIH0KICAgIGlmIChDbG91ZGZsYXJlQXBpLkRFQlVHKSBjb25zb2xlLmxvZyhbCiAgICAgICAgLi4uaGVhZGVycwogICAgXS5tYXAoKHYpPT52LmpvaW4oJzogJykKICAgICkuam9pbignXG4nKSk7CiAgICBpZiAoQ2xvdWRmbGFyZUFwaS5ERUJVRyAmJiBib2R5T2JqKSBjb25zb2xlLmxvZyhib2R5T2JqKTsKICAgIGNvbnN0IGZldGNoUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2QsCiAgICAgICAgaGVhZGVycywKICAgICAgICBib2R5CiAgICB9KTsKICAgIGlmIChDbG91ZGZsYXJlQXBpLkRFQlVHKSBjb25zb2xlLmxvZyhgJHtmZXRjaFJlc3BvbnNlLnN0YXR1c30gJHtmZXRjaFJlc3BvbnNlLnVybH1gKTsKICAgIGlmIChDbG91ZGZsYXJlQXBpLkRFQlVHKSBjb25zb2xlLmxvZyhbCiAgICAgICAgLi4uZmV0Y2hSZXNwb25zZS5oZWFkZXJzCiAgICBdLm1hcCgodik9PnYuam9pbignOiAnKQogICAgKS5qb2luKCdcbicpKTsKICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gZmV0Y2hSZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgfHwgJyc7CiAgICBpZiAocmVzcG9uc2VUeXBlID09PSAnZW1wdHknICYmIGZldGNoUmVzcG9uc2Uuc3RhdHVzID49IDIwMCAmJiBmZXRjaFJlc3BvbnNlLnN0YXR1cyA8IDMwMCkgewogICAgICAgIGlmIChjb250ZW50VHlwZSAhPT0gJycpIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBjb250ZW50LXR5cGUgKGV4cGVjdGVkIG5vbmUpOiAke2NvbnRlbnRUeXBlfSwgZmV0Y2hSZXNwb25zZT0ke2ZldGNoUmVzcG9uc2V9LCBib2R5PSR7YXdhaXQgZmV0Y2hSZXNwb25zZS50ZXh0KCl9YCk7CiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGZldGNoUmVzcG9uc2UudGV4dCgpOwogICAgICAgIGlmICh0ZXh0ICE9PSAnJykgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGJvZHkgKGV4cGVjdGVkIG5vbmUpOiAke3RleHR9LCBmZXRjaFJlc3BvbnNlPSR7ZmV0Y2hSZXNwb25zZX0sIGJvZHk9JHt0ZXh0fWApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICgocmVzcG9uc2VUeXBlID09PSAnYnl0ZXMnIHx8IHJlc3BvbnNlVHlwZSA9PT0gJ2J5dGVzPycpICYmIGNvbnRlbnRUeXBlID09PSBBUFBMSUNBVElPTl9PQ1RFVF9TVFJFQU0pIHsKICAgICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBmZXRjaFJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICB9CiAgICBpZiAocmVzcG9uc2VUeXBlID09PSAndGV4dD8nICYmIGNvbnRlbnRUeXBlLnN0YXJ0c1dpdGgoJ3RleHQvJykpIHsKICAgICAgICByZXR1cm4gYXdhaXQgZmV0Y2hSZXNwb25zZS50ZXh0KCk7CiAgICB9CiAgICBpZiAoIVsKICAgICAgICBBUFBMSUNBVElPTl9KU09OX1VURjgsCiAgICAgICAgQVBQTElDQVRJT05fSlNPTgogICAgXS5pbmNsdWRlcyhjb250ZW50VHlwZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgY29udGVudC10eXBlOiAke2NvbnRlbnRUeXBlfSwgZmV0Y2hSZXNwb25zZT0ke2ZldGNoUmVzcG9uc2V9LCBib2R5PSR7YXdhaXQgZmV0Y2hSZXNwb25zZS50ZXh0KCl9YCk7CiAgICB9CiAgICBjb25zdCBhcGlSZXNwb25zZSA9IGF3YWl0IGZldGNoUmVzcG9uc2UuanNvbigpOwogICAgaWYgKENsb3VkZmxhcmVBcGkuREVCVUcpIGNvbnNvbGUubG9nKGFwaVJlc3BvbnNlKTsKICAgIGlmICghYXBpUmVzcG9uc2Uuc3VjY2VzcykgewogICAgICAgIGlmIChmZXRjaFJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0ICYmIFsKICAgICAgICAgICAgJ2J5dGVzPycsCiAgICAgICAgICAgICdqc29uPycKICAgICAgICBdLmluY2x1ZGVzKHJlc3BvbnNlVHlwZSkpIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgdGhyb3cgbmV3IENsb3VkZmxhcmVBcGlFcnJvcihgJHtvcH0gZmFpbGVkOiBzdGF0dXM9JHtmZXRjaFJlc3BvbnNlLnN0YXR1c30sIGVycm9ycz0ke2FwaVJlc3BvbnNlLmVycm9ycy5tYXAoKHYpPT5gJHt2LmNvZGV9ICR7di5tZXNzYWdlfWAKICAgICAgICApLmpvaW4oJywgJyl9YCwgZmV0Y2hSZXNwb25zZS5zdGF0dXMsIGFwaVJlc3BvbnNlLmVycm9ycyk7CiAgICB9CiAgICByZXR1cm4gYXBpUmVzcG9uc2U7Cn0KY2xhc3MgQ2xvdWRmbGFyZUFwaUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgc3RhdHVzOwogICAgZXJyb3JzOwogICAgY29uc3RydWN0b3IobWVzc2FnZSwgc3RhdHVzLCBlcnJvcnMpewogICAgICAgIHN1cGVyKG1lc3NhZ2UpOwogICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzOwogICAgfQp9CmZ1bmN0aW9uIHNldFN1YnRyYWN0KGxocywgcmhzKSB7CiAgICBjb25zdCBydCA9IG5ldyBTZXQobGhzKTsKICAgIGZvciAoY29uc3QgaXRlbSBvZiByaHMpewogICAgICAgIHJ0LmRlbGV0ZShpdGVtKTsKICAgIH0KICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiBzZXRVbmlvbihsaHMsIHJocykgewogICAgY29uc3QgcnQgPSBuZXcgU2V0KGxocyk7CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmhzKXsKICAgICAgICBydC5hZGQoaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gc2V0SW50ZXJzZWN0KGxocywgcmhzKSB7CiAgICBjb25zdCBydCA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgaXRlbSBvZiBsaHMpewogICAgICAgIGlmIChyaHMuaGFzKGl0ZW0pKSBydC5hZGQoaXRlbSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGl0ZW0xIG9mIHJocyl7CiAgICAgICAgaWYgKGxocy5oYXMoaXRlbTEpKSBydC5hZGQoaXRlbTEpOwogICAgfQogICAgcmV0dXJuIHJ0Owp9CmZ1bmN0aW9uIHNldEVxdWFsKGxocywgcmhzKSB7CiAgICByZXR1cm4gbGhzLnNpemUgPT09IHJocy5zaXplICYmIFsKICAgICAgICAuLi5saHMKICAgIF0uZXZlcnkoKHYpPT5yaHMuaGFzKHYpCiAgICApOwp9CmZ1bmN0aW9uIHBhcnNlSGVhZGVyRmlsdGVyKGhlYWRlcikgewogICAgY29uc3QgaSA9IGhlYWRlci5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaSA8IDApIHJldHVybiB7CiAgICAgICAga2V5OiBoZWFkZXIKICAgIH07CiAgICBjb25zdCBrZXkgPSBoZWFkZXIuc3Vic3RyaW5nKDAsIGkpLnRyaW0oKTsKICAgIGNvbnN0IHF1ZXJ5MSA9IGhlYWRlci5zdWJzdHJpbmcoaSArIDEpLnRyaW0oKTsKICAgIHJldHVybiB7CiAgICAgICAga2V5LAogICAgICAgIHF1ZXJ5OiBxdWVyeTEKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMgPSBuZXcgU2V0KFsKICAgICdvdXRjb21lJywKICAgICdzY3JpcHROYW1lJywKICAgICdleGNlcHRpb25zJywKICAgICdsb2dzJywKICAgICdldmVudFRpbWVzdGFtcCcsCiAgICAnZXZlbnQnCl0pOwpjb25zdCBLTk9XTl9PVVRDT01FUyA9IG5ldyBTZXQoWwogICAgJ29rJywKICAgICdleGNlcHRpb24nLAogICAgJ2V4Y2VlZGVkQ3B1JywKICAgICdjYW5jZWxlZCcsCiAgICAndW5rbm93bicKXSk7CmZ1bmN0aW9uIHBhcnNlVGFpbE1lc3NhZ2Uob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGFpbE1lc3NhZ2U6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IG91dGNvbWUgLCBzY3JpcHROYW1lICwgZXZlbnRUaW1lc3RhbXAgIH0gPSBvYmpBc0FueTsKICAgIGlmICghS05PV05fT1VUQ09NRVMuaGFzKG91dGNvbWUpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBvdXRjb21lOiBleHBlY3RlZCBvbmUgb2YgWyR7WwogICAgICAgIC4uLktOT1dOX09VVENPTUVTCiAgICBdLmpvaW4oJywgJyl9XSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvdXRjb21lKX1gKTsKICAgIGlmIChzY3JpcHROYW1lICE9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBzY3JpcHROYW1lOiBleHBlY3RlZCBudWxsLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHNjcmlwdE5hbWUpfWApOwogICAgY29uc3QgbG9ncyA9IHBhcnNlTG9ncyhvYmpBc0FueS5sb2dzKTsKICAgIGNvbnN0IGV4Y2VwdGlvbnMgPSBwYXJzZUV4Y2VwdGlvbnMob2JqQXNBbnkuZXhjZXB0aW9ucyk7CiAgICBpZiAoISh0eXBlb2YgZXZlbnRUaW1lc3RhbXAgPT09ICdudW1iZXInICYmIGV2ZW50VGltZXN0YW1wID4gMCkpIHRocm93IG5ldyBFcnJvcihgQmFkIGV2ZW50VGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkoZXZlbnRUaW1lc3RhbXApfWApOwogICAgY29uc3QgZXZlbnQgPSBvYmpBc0FueS5ldmVudCAmJiBvYmpBc0FueS5ldmVudC5yZXF1ZXN0ID8gcGFyc2VUYWlsTWVzc2FnZVJlcXVlc3RFdmVudChvYmpBc0FueS5ldmVudCkgOiBwYXJzZVRhaWxNZXNzYWdlQ3JvbkV2ZW50KG9iakFzQW55LmV2ZW50KTsKICAgIHJldHVybiB7CiAgICAgICAgb3V0Y29tZSwKICAgICAgICBzY3JpcHROYW1lLAogICAgICAgIGV4Y2VwdGlvbnMsCiAgICAgICAgbG9ncywKICAgICAgICBldmVudFRpbWVzdGFtcCwKICAgICAgICBldmVudAogICAgfTsKfQpmdW5jdGlvbiBwYXJzZUxvZ3Mob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbG9nczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlTG9nKTsKfQpmdW5jdGlvbiBwYXJzZUV4Y2VwdGlvbnMob2JqKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgZXhjZXB0aW9uczogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIHJldHVybiBbCiAgICAgICAgLi4ub2JqCiAgICBdLm1hcChwYXJzZVRhaWxNZXNzYWdlRXhjZXB0aW9uKTsKfQpmdW5jdGlvbiBpc0xvZ01lc3NhZ2VQYXJ0KHZhbHVlKSB7CiAgICBjb25zdCB0ID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuIHQgPT09ICdzdHJpbmcnIHx8IHQgPT09ICdudW1iZXInIHx8IHQgPT09ICdib29sZWFuJyB8fCB0ID09PSAndW5kZWZpbmVkJyB8fCB0ID09PSAnb2JqZWN0JzsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMgPSBuZXcgU2V0KFsKICAgICdtZXNzYWdlJywKICAgICdsZXZlbCcsCiAgICAndGltZXN0YW1wJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUxvZyhvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUxvZzogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfTE9HX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCBtZXNzYWdlID0gcGFyc2VMb2dNZXNzYWdlUGFydEFycmF5KG9iakFzQW55Lm1lc3NhZ2UsICdtZXNzYWdlJyk7CiAgICBjb25zdCB7IGxldmVsICwgdGltZXN0YW1wICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgbGV2ZWwgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbGV2ZWw6IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJHtKU09OLnN0cmluZ2lmeShsZXZlbCl9YCk7CiAgICBpZiAoISh0eXBlb2YgdGltZXN0YW1wID09PSAnbnVtYmVyJyAmJiB0aW1lc3RhbXAgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodGltZXN0YW1wKX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgbWVzc2FnZSwKICAgICAgICBsZXZlbCwKICAgICAgICB0aW1lc3RhbXAKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VYQ0VQVElPTl9LRVlTID0gbmV3IFNldChbCiAgICAnbmFtZScsCiAgICAnbWVzc2FnZScsCiAgICAndGltZXN0YW1wJwpdKTsKZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUV4Y2VwdGlvbihvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUV4Y2VwdGlvbjogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVhDRVBUSU9OX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IG5hbWUgLCBtZXNzYWdlICwgdGltZXN0YW1wICB9ID0gb2JqQXNBbnk7CiAgICBpZiAoISh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBuYW1lOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobmFtZSl9YCk7CiAgICBpZiAoISh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBtZXNzYWdlOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobWVzc2FnZSl9YCk7CiAgICBpZiAoISh0eXBlb2YgdGltZXN0YW1wID09PSAnbnVtYmVyJyAmJiB0aW1lc3RhbXAgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdGltZXN0YW1wOiBleHBlY3RlZCBwb3NpdGl2ZSBudW1iZXIsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodGltZXN0YW1wKX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgbmFtZSwKICAgICAgICBtZXNzYWdlLAogICAgICAgIHRpbWVzdGFtcAogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTID0gbmV3IFNldChbCiAgICAnY3JvbicsCiAgICAnc2NoZWR1bGVkVGltZScKXSk7CmZ1bmN0aW9uIGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIGZhbHNlOwogICAgY29uc3Qga2V5cyA9IG5ldyBTZXQoT2JqZWN0LmtleXMob2JqKSk7CiAgICByZXR1cm4gc2V0RXF1YWwoa2V5cywgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0NST05fRVZFTlRfS0VZUyk7Cn0KZnVuY3Rpb24gcGFyc2VUYWlsTWVzc2FnZUNyb25FdmVudChvYmopIHsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUNyb25FdmVudDogRXhwZWN0ZWQgb2JqZWN0LCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KG9iail9YCk7CiAgICBjaGVja0tleXMob2JqLCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfQ1JPTl9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyBjcm9uICwgc2NoZWR1bGVkVGltZSAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIGNyb24gPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY3JvbjogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KGNyb24pfWApOwogICAgaWYgKCEodHlwZW9mIHNjaGVkdWxlZFRpbWUgPT09ICdudW1iZXInICYmIHNjaGVkdWxlZFRpbWUgPiAwKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgc2NoZWR1bGVkVGltZTogZXhwZWN0ZWQgcG9zaXRpdmUgbnVtYmVyLCBmb3VuZCAke0pTT04uc3RyaW5naWZ5KHNjaGVkdWxlZFRpbWUpfWApOwogICAgcmV0dXJuIHsKICAgICAgICBjcm9uLAogICAgICAgIHNjaGVkdWxlZFRpbWUKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX1JFUVVFU1RfRVZFTlRfS0VZUyA9IG5ldyBTZXQoWwogICAgJ3JlcXVlc3QnCl0pOwpjb25zdCBPUFRJT05BTF9UQUlMX01FU1NBR0VfUkVRVUVTVF9FVkVOVF9LRVlTID0gbmV3IFNldChbCiAgICAncmVzcG9uc2UnCl0pOwpjb25zdCBBTExfVEFJTF9NRVNTQUdFX1JFUVVFU1RfRVZFTlRfS0VZUyA9IHNldFVuaW9uKFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMsIE9QVElPTkFMX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMpOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlUmVxdWVzdEV2ZW50OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9SRVFVRVNUX0VWRU5UX0tFWVMsIEFMTF9UQUlMX01FU1NBR0VfUkVRVUVTVF9FVkVOVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgcmVxdWVzdCA9IHBhcnNlVGFpbE1lc3NhZ2VFdmVudFJlcXVlc3Qob2JqQXNBbnkucmVxdWVzdCk7CiAgICBjb25zdCByZXNwb25zZSA9IHBhcnNlVGFpbE1lc3NhZ2VFdmVudFJlc3BvbnNlKG9iakFzQW55LnJlc3BvbnNlKTsKICAgIHJldHVybiB7CiAgICAgICAgcmVxdWVzdCwKICAgICAgICByZXNwb25zZQogICAgfTsKfQpjb25zdCBSRVFVSVJFRF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAndXJsJywKICAgICdtZXRob2QnLAogICAgJ2hlYWRlcnMnCl0pOwpjb25zdCBPUFRJT05BTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTID0gbmV3IFNldChbCiAgICAnY2YnCl0pOwpjb25zdCBBTExfVEFJTF9NRVNTQUdFX0VWRU5UX1JFUVVFU1RfS0VZUyA9IHNldFVuaW9uKFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIE9QVElPTkFMX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMpOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0KG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxNZXNzYWdlRXZlbnRSZXF1ZXN0OiBFeHBlY3RlZCBvYmplY3QsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGNoZWNrS2V5cyhvYmosIFJFUVVJUkVEX1RBSUxfTUVTU0FHRV9FVkVOVF9SRVFVRVNUX0tFWVMsIEFMTF9UQUlMX01FU1NBR0VfRVZFTlRfUkVRVUVTVF9LRVlTKTsKICAgIGNvbnN0IG9iakFzQW55ID0gb2JqOwogICAgY29uc3QgeyB1cmwgLCBtZXRob2QgIH0gPSBvYmpBc0FueTsKICAgIGlmICghKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgdXJsOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkodXJsKX1gKTsKICAgIGlmICghKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgbWV0aG9kOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkobWV0aG9kKX1gKTsKICAgIGNvbnN0IGhlYWRlcnMgPSBwYXJzZVN0cmluZ1JlY29yZChvYmpBc0FueS5oZWFkZXJzLCAnaGVhZGVycycpOwogICAgY29uc3QgY2YgPSBvYmpBc0FueS5jZiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqQXNBbnkuY2YpOwogICAgcmV0dXJuIHsKICAgICAgICB1cmwsCiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgY2YKICAgIH07Cn0KY29uc3QgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VWRU5UX1JFU1BPTlNFX0tFWVMgPSBuZXcgU2V0KFsKICAgICdzdGF0dXMnCl0pOwpmdW5jdGlvbiBwYXJzZVRhaWxNZXNzYWdlRXZlbnRSZXNwb25zZShvYmopIHsKICAgIGlmIChvYmogPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwgfHwgQXJyYXkuaXNBcnJheShvYmopKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCB0YWlsTWVzc2FnZUV2ZW50UmVzcG9uc2U6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgY2hlY2tLZXlzKG9iaiwgUkVRVUlSRURfVEFJTF9NRVNTQUdFX0VWRU5UX1JFU1BPTlNFX0tFWVMpOwogICAgY29uc3Qgb2JqQXNBbnkgPSBvYmo7CiAgICBjb25zdCB7IHN0YXR1cyAgfSA9IG9iakFzQW55OwogICAgaWYgKCEodHlwZW9mIHN0YXR1cyA9PT0gJ251bWJlcicpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBzdGF0dXM6IGV4cGVjdGVkIG51bWJlciwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShzdGF0dXMpfWApOwogICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXMKICAgIH07Cn0KZnVuY3Rpb24gY2hlY2tLZXlzKG9iaiwgcmVxdWlyZWRLZXlzLCBhbGxLZXlzKSB7CiAgICBjb25zdCBrZXlzID0gbmV3IFNldChPYmplY3Qua2V5cyhvYmopKTsKICAgIGNvbnN0IG1pc3NpbmdLZXlzID0gc2V0U3VidHJhY3QocmVxdWlyZWRLZXlzLCBrZXlzKTsKICAgIGlmIChtaXNzaW5nS2V5cy5zaXplID4gMCkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGtleXM6ICR7WwogICAgICAgIC4uLm1pc3NpbmdLZXlzCiAgICBdLmpvaW4oJywgJyl9YCk7CiAgICBjb25zdCBleHRyYUtleXMgPSBzZXRTdWJ0cmFjdChrZXlzLCBhbGxLZXlzIHx8IHJlcXVpcmVkS2V5cyk7CiAgICBpZiAoZXh0cmFLZXlzLnNpemUgPiAwKSB0aHJvdyBuZXcgRXJyb3IoYEV4dHJhIGtleXM6ICR7WwogICAgICAgIC4uLmV4dHJhS2V5cwogICAgXS5qb2luKCcsICcpfWApOwp9CmZ1bmN0aW9uIHBhcnNlU3RyaW5nUmVjb3JkKG9iaiwgbmFtZSkgewogICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG9iaikpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIHN0cmluZyByZWNvcmQsIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIGZvciAoY29uc3QgW18sIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYmopKXsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lfTogRXhwZWN0ZWQgc3RyaW5nIHJlY29yZCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgfQogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBwYXJzZUxvZ01lc3NhZ2VQYXJ0QXJyYXkob2JqLCBuYW1lKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgIUFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgJHtuYW1lfTogRXhwZWN0ZWQgbG9nIG1lc3NhZ2UgcGFydCBhcnJheSwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgZm9yIChjb25zdCB2YWx1ZSBvZiBvYmopewogICAgICAgIGlmICghaXNMb2dNZXNzYWdlUGFydCh2YWx1ZSkpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IEV4cGVjdGVkIGxvZyBtZXNzYWdlIHBhcnQgYXJyYXksIGZvdW5kICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTsKICAgIH0KICAgIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gcGFyc2VJbmNvbWluZ1JlcXVlc3RDZlByb3BlcnRpZXMob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkob2JqKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgY2Y6IEV4cGVjdGVkIG9iamVjdCwgZm91bmQgJHtKU09OLnN0cmluZ2lmeShvYmopfWApOwogICAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBkdW1wTWVzc2FnZVByZXR0eShtZXNzYWdlLCBsb2dnZXIsIGFkZGl0aW9uYWxMb2dzID0gW10pIHsKICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKG1lc3NhZ2UuZXZlbnRUaW1lc3RhbXApKTsKICAgIGNvbnN0IG91dGNvbWUgPSBQUkVUVFlfT1VUQ09NRVMuZ2V0KG1lc3NhZ2Uub3V0Y29tZSkgfHwgbWVzc2FnZS5vdXRjb21lOwogICAgY29uc3Qgb3V0Y29tZUNvbG9yID0gbWVzc2FnZS5vdXRjb21lID09PSAnb2snID8gJ2dyZWVuJyA6ICdyZWQnOwogICAgY29uc3QgeyBwcm9wcyAsIHJlbWFpbmluZ0xvZ3MgIH0gPSBwYXJzZUxvZ1Byb3BzKG1lc3NhZ2UubG9ncyk7CiAgICBpZiAoaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlLmV2ZW50KSkgewogICAgICAgIGNvbnN0IGNvbG8gPSBwcm9wcy5jb2xvIHx8ICc/Pz8nOwogICAgICAgIGxvZ2dlcihgWyVjJHt0aW1lfSVjXSBbJWMke2NvbG99JWNdIFslYyR7b3V0Y29tZX0lY10gJWMke21lc3NhZ2UuZXZlbnQuY3Jvbn1gLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogJHtvdXRjb21lQ29sb3J9YCwgJycsICdjb2xvcjogcmVkOyBmb250LXN0eWxlOiBib2xkOycpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IG1ldGhvZCAsIHVybCAsIGNmICB9ID0gbWVzc2FnZS5ldmVudC5yZXF1ZXN0OwogICAgICAgIGNvbnN0IHVucmVkYWN0ZWRVcmwgPSB0eXBlb2YgcHJvcHMudXJsID09PSAnc3RyaW5nJyA/IHByb3BzLnVybCA6IHVybDsKICAgICAgICBjb25zdCBjb2xvID0gY2Y/LmNvbG8gfHwgcHJvcHMuY29sbyB8fCAnPz8/JzsKICAgICAgICBpZiAoY2YgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCB7IGR1cmFibGVPYmplY3RDbGFzcyAsIGR1cmFibGVPYmplY3ROYW1lICwgZHVyYWJsZU9iamVjdElkICB9ID0gY29tcHV0ZUR1cmFibGVPYmplY3RJbmZvKHByb3BzKTsKICAgICAgICAgICAgY29uc3QgZG9UZW1wbGF0ZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgZG9TdHlsZXMgPSBbXTsKICAgICAgICAgICAgaWYgKGR1cmFibGVPYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgZG9UZW1wbGF0ZXMucHVzaChgJWMke2R1cmFibGVPYmplY3RDbGFzc30lY2ApOwogICAgICAgICAgICAgICAgZG9TdHlsZXMucHVzaChgY29sb3I6IGdyYXk7IHgtZHVyYWJsZS1vYmplY3QtY2xhc3M6ICcke2R1cmFibGVPYmplY3RDbGFzc30nYCwgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkdXJhYmxlT2JqZWN0TmFtZSkgewogICAgICAgICAgICAgICAgZG9UZW1wbGF0ZXMucHVzaChgJWMke2R1cmFibGVPYmplY3ROYW1lfSVjYCk7CiAgICAgICAgICAgICAgICBkb1N0eWxlcy5wdXNoKGBjb2xvcjogZ3JheTsgeC1kdXJhYmxlLW9iamVjdC1uYW1lOiAnJHtkdXJhYmxlT2JqZWN0TmFtZX0nYCwgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkdXJhYmxlT2JqZWN0SWQpIHsKICAgICAgICAgICAgICAgIGRvVGVtcGxhdGVzLnB1c2goYCVjJHtjb21wdXRlU2hvcnREdXJhYmxlT2JqZWN0SWQoZHVyYWJsZU9iamVjdElkKX0lY2ApOwogICAgICAgICAgICAgICAgZG9TdHlsZXMucHVzaChgY29sb3I6IGdyYXk7IHgtZHVyYWJsZS1vYmplY3QtaWQ6ICcke2R1cmFibGVPYmplY3RJZH0nYCwgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkb1RlbXBsYXRlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGRvVGVtcGxhdGVzLnB1c2goYCVjRE8lY2ApOwogICAgICAgICAgICAgICAgZG9TdHlsZXMucHVzaCgnY29sb3I6IGdyYXknLCAnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyR7Y29sb30lY10gWyVjJHtvdXRjb21lfSVjXSBbJHtkb1RlbXBsYXRlcy5qb2luKCcgJyl9XSAke21ldGhvZH0gJWMke3VucmVkYWN0ZWRVcmx9YCwgJ2NvbG9yOiBncmF5JywgJycsICdjb2xvcjogZ3JheScsICcnLCBgY29sb3I6ICR7b3V0Y29tZUNvbG9yfWAsICcnLCAuLi5kb1N0eWxlcywgJ2NvbG9yOiByZWQ7IGZvbnQtc3R5bGU6IGJvbGQ7Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9nZ2VyKGBbJWMke3RpbWV9JWNdIFslYyR7Y29sb30lY10gWyVjJHtvdXRjb21lfSVjXSAke21ldGhvZH0gJWMke3VucmVkYWN0ZWRVcmx9YCwgJ2NvbG9yOiBncmF5JywgJycsICdjb2xvcjogZ3JheScsICcnLCBgY29sb3I6ICR7b3V0Y29tZUNvbG9yfWAsICcnLCAnY29sb3I6IHJlZDsgZm9udC1zdHlsZTogYm9sZDsnKTsKICAgICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHsgZGF0YTogZGF0YTIgIH0gb2YgYWRkaXRpb25hbExvZ3MpewogICAgICAgIGxvZ2dlciguLi5kYXRhMik7CiAgICB9CiAgICBmb3IgKGNvbnN0IHsgbGV2ZWwgLCBtZXNzYWdlOiBsb2dNZXNzYWdlICB9IG9mIHJlbWFpbmluZ0xvZ3MpewogICAgICAgIGNvbnN0IGxldmVsQ29sb3IgPSBMT0dfTEVWRUxfQ09MT1JTLmdldChsZXZlbCkgfHwgJ2dyYXknOwogICAgICAgIGNvbnN0IGxvZ01lc3NhZ2VzID0gbG9nTWVzc2FnZS5tYXAoZm9ybWF0TG9nTWVzc2FnZVBhcnQpLmpvaW4oJywgJyk7CiAgICAgICAgbG9nZ2VyKGAgJWN8JWMgWyVjJHtsZXZlbH0lY10gJHtsb2dNZXNzYWdlc31gLCAnY29sb3I6IGdyYXknLCAnJywgYGNvbG9yOiAke2xldmVsQ29sb3J9YCwgJycpOwogICAgfQogICAgZm9yIChjb25zdCB7IG5hbWUgLCBtZXNzYWdlOiBleGNlcHRpb25NZXNzYWdlICB9IG9mIG1lc3NhZ2UuZXhjZXB0aW9ucyl7CiAgICAgICAgbG9nZ2VyKGAgJWN8JWMgWyVjJHtuYW1lfSVjXSAlYyR7ZXhjZXB0aW9uTWVzc2FnZX1gLCAnY29sb3I6IGdyYXknLCAnJywgYGNvbG9yOiByZWQ7IGZvbnQtc3R5bGU6IGJvbGRgLCAnJywgJ2NvbG9yOiByZWQnKTsKICAgIH0KICAgIGlmICghaXNUYWlsTWVzc2FnZUNyb25FdmVudChtZXNzYWdlLmV2ZW50KSkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbWVzc2FnZS5ldmVudC5yZXNwb25zZTsKICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgbG9nZ2VyKGAgJWN8JWMgWyVjcmVzJWNdICVjJHtyZXNwb25zZS5zdGF0dXN9YCwgJ2NvbG9yOiBncmF5JywgJycsIGBjb2xvcjogZ3JheWAsICcnLCAnY29sb3I6IGdyYXknKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhkYXRlKSB7CiAgICByZXR1cm4gWwogICAgICAgIGRhdGUuZ2V0RnVsbFllYXIoKSwKICAgICAgICAnLScsCiAgICAgICAgcGFkMihkYXRlLmdldE1vbnRoKCkgKyAxKSwKICAgICAgICAnLScsCiAgICAgICAgcGFkMihkYXRlLmdldERhdGUoKSksCiAgICAgICAgJyAnLAogICAgICAgIHBhZDIoZGF0ZS5nZXRIb3VycygpKSwKICAgICAgICAnOicsCiAgICAgICAgcGFkMihkYXRlLmdldE1pbnV0ZXMoKSksCiAgICAgICAgJzonLAogICAgICAgIHBhZDIoZGF0ZS5nZXRTZWNvbmRzKCkpCiAgICBdLmpvaW4oJycpOwp9CmZ1bmN0aW9uIHBhcnNlTG9nUHJvcHMobG9ncykgewogICAgY29uc3QgcmVtYWluaW5nTG9ncyA9IFtdOwogICAgY29uc3QgcHJvcHMgPSB7fTsKICAgIGZvciAoY29uc3QgbG9nIG9mIGxvZ3MpewogICAgICAgIGlmIChsb2cubWVzc2FnZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGxvZy5tZXNzYWdlWzBdOwogICAgICAgICAgICBpZiAodHlwZW9mIG1zZyA9PT0gJ3N0cmluZycgJiYgbXNnLnN0YXJ0c1dpdGgoJ2xvZ3Byb3BzOicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFpbGVyID0gbXNnLnN1YnN0cmluZyhtc2cuaW5kZXhPZignOicpICsgMSk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFpbGVyUHJvcHMgPSB0cnlQYXJzZVByb3BzRnJvbUpzb24odHJhaWxlcik7CiAgICAgICAgICAgICAgICBhcHBlbmRQcm9wcyh0cmFpbGVyUHJvcHMsIHByb3BzKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBsb2cubWVzc2FnZS5zbGljZSgxKSl7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydFByb3BzID0gdHJ5UGFyc2VQcm9wc0Zyb21QYXJ0KHBhcnQpOwogICAgICAgICAgICAgICAgICAgIGFwcGVuZFByb3BzKHBhcnRQcm9wcywgcHJvcHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVtYWluaW5nTG9ncy5wdXNoKGxvZyk7CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHByb3BzLAogICAgICAgIHJlbWFpbmluZ0xvZ3MKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUR1cmFibGVPYmplY3RJbmZvKHByb3BzKSB7CiAgICBjb25zdCBkdXJhYmxlT2JqZWN0Q2xhc3MgPSB1bmRlZmluZWRJZkVtcHR5KCh0eXBlb2YgcHJvcHMuZHVyYWJsZU9iamVjdENsYXNzID09PSAnc3RyaW5nJyA/IHByb3BzLmR1cmFibGVPYmplY3RDbGFzcyA6ICcnKS50cmltKCkpOwogICAgY29uc3QgZHVyYWJsZU9iamVjdElkID0gdW5kZWZpbmVkSWZFbXB0eSgodHlwZW9mIHByb3BzLmR1cmFibGVPYmplY3RJZCA9PT0gJ3N0cmluZycgPyBwcm9wcy5kdXJhYmxlT2JqZWN0SWQgOiAnJykudHJpbSgpKTsKICAgIGNvbnN0IGR1cmFibGVPYmplY3ROYW1lID0gdW5kZWZpbmVkSWZFbXB0eSgodHlwZW9mIHByb3BzLmR1cmFibGVPYmplY3ROYW1lID09PSAnc3RyaW5nJyA/IHByb3BzLmR1cmFibGVPYmplY3ROYW1lIDogJycpLnRyaW0oKSk7CiAgICByZXR1cm4gewogICAgICAgIGR1cmFibGVPYmplY3RDbGFzcywKICAgICAgICBkdXJhYmxlT2JqZWN0SWQsCiAgICAgICAgZHVyYWJsZU9iamVjdE5hbWUKICAgIH07Cn0KZnVuY3Rpb24gdW5kZWZpbmVkSWZFbXB0eShzdHIpIHsKICAgIHJldHVybiBzdHIgPT09ICcnID8gdW5kZWZpbmVkIDogc3RyOwp9CmZ1bmN0aW9uIGNvbXB1dGVTaG9ydER1cmFibGVPYmplY3RJZChpZCkgewogICAgcmV0dXJuIC9eWzAtOWEtZkEtRl17NSx9JC8udGVzdChpZCkgPyBgJHtpZC5zdWJzdHJpbmcoMCwgNCl94oCmYCA6IGlkOwp9CmZ1bmN0aW9uIGFwcGVuZFByb3BzKHNyYywgZHN0KSB7CiAgICBpZiAoc3JjKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoc3JjKSl7CiAgICAgICAgICAgIGRzdFtrZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIHRyeVBhcnNlUHJvcHNGcm9tSnNvbih2YWx1ZSkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9wcyA9IEpTT04ucGFyc2UodmFsdWUudHJpbSgpKTsKICAgICAgICBpZiAodHlwZW9mIHByb3BzID09PSAnb2JqZWN0JyAmJiBwcm9wcyAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwcm9wcykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb3BzOwogICAgICAgIH0KICAgIH0gY2F0Y2ggIHt9CiAgICByZXR1cm4gdW5kZWZpbmVkOwp9CmZ1bmN0aW9uIHRyeVBhcnNlUHJvcHNGcm9tUGFydChwYXJ0KSB7CiAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2YgcGFydCA9PT0gJ29iamVjdCcgJiYgcGFydCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwYXJ0KSkgewogICAgICAgICAgICByZXR1cm4gcGFydDsKICAgICAgICB9CiAgICB9IGNhdGNoICB7fQogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBmb3JtYXRMb2dNZXNzYWdlUGFydChwYXJ0KSB7CiAgICBpZiAodHlwZW9mIHBhcnQgPT09ICdvYmplY3QnKSByZXR1cm4gSlNPTi5zdHJpbmdpZnkocGFydCk7CiAgICByZXR1cm4gYCR7cGFydH1gOwp9CmZ1bmN0aW9uIHBhZDIobnVtKSB7CiAgICByZXR1cm4gbnVtLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKfQpjb25zdCBQUkVUVFlfT1VUQ09NRVMgPSBuZXcgTWFwKFsKICAgIFsKICAgICAgICAnb2snLAogICAgICAgICdPaycKICAgIF0sCiAgICBbCiAgICAgICAgJ2V4Y2VwdGlvbicsCiAgICAgICAgJ0Vycm9yJwogICAgXSwKICAgIFsKICAgICAgICAnZXhjZWVkZWRDcHUnLAogICAgICAgICdFeGNlZWRlZCBMaW1pdCcKICAgIF0sCiAgICBbCiAgICAgICAgJ2NhbmNlbGVkJywKICAgICAgICAnQ2FuY2VsZWQnCiAgICBdLAogICAgWwogICAgICAgICd1bmtub3duJywKICAgICAgICAnVW5rbm93bicKICAgIF0sIApdKTsKY29uc3QgTE9HX0xFVkVMX0NPTE9SUyA9IG5ldyBNYXAoWwogICAgWwogICAgICAgICd0cmFjZScsCiAgICAgICAgJ2dyYXknCiAgICBdLAogICAgWwogICAgICAgICdkZWJ1ZycsCiAgICAgICAgJ3B1cnBsZScKICAgIF0sCiAgICBbCiAgICAgICAgJ2xvZycsCiAgICAgICAgJ2dyYXknCiAgICBdLAogICAgWwogICAgICAgICdpbmZvJywKICAgICAgICAnZ3JheScKICAgIF0sCiAgICBbCiAgICAgICAgJ3dhcm4nLAogICAgICAgICdyZWQnCiAgICBdLAogICAgWwogICAgICAgICdlcnJvcicsCiAgICAgICAgJ3JlZCcKICAgIF0sIApdKTsKY2xhc3MgVGFpbENvbm5lY3Rpb24gewogICAgc3RhdGljIFZFUkJPU0UgPSBmYWxzZTsKICAgIHdzOwogICAgY2FsbGJhY2tzOwogICAgb3B0aW9uczsKICAgIGhlYXJ0YmVhdElkOwogICAgY29uc3RydWN0b3Iod2ViU29ja2V0VXJsLCBjYWxsYmFja3MsIG9wdHMpewogICAgICAgIHRoaXMud3MgPSBuZXcgV2ViU29ja2V0KHdlYlNvY2tldFVybCwgJ3RyYWNlLXYxJyk7CiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7CiAgICAgICAgY29uc3QgeyB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzICB9ID0gb3B0czsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIHRoaXMuc2VuZE9wdGlvbnNJZk9wZW4oKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbk9wZW4pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vbk9wZW4odGhpcywgdGltZVN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCBgc2VuZGluZyB3cyBwaW5nIHt9IGV2ZXJ5ICR7d2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kc31gKTsKICAgICAgICAgICAgICAgIHRoaXMuaGVhcnRiZWF0SWQgPSBzZXRJbnRlcnZhbCgoKT0+ewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLndzLnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCBgc2VuZGluZyB3cyBwaW5nIHt9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud3Muc2VuZCgne30nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzICogMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKGV2ZW50KT0+ewogICAgICAgICAgICBjb25zdCB7IGNvZGUgLCByZWFzb24gLCB3YXNDbGVhbiAsIHRpbWVTdGFtcCAgfSA9IGV2ZW50OwogICAgICAgICAgICBpZiAoVGFpbENvbm5lY3Rpb24uVkVSQk9TRSkgY29uc29sZS5sb2coZm9ybWF0TG9jYWxZeXl5TW1EZEhoTW1TcyhuZXcgRGF0ZSgpKSwgJ1RhaWxDb25uZWN0aW9uOiB3cyBjbG9zZScsIHsKICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICByZWFzb24sCiAgICAgICAgICAgICAgICB3YXNDbGVhbiwKICAgICAgICAgICAgICAgIHRpbWVTdGFtcAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmhlYXJ0YmVhdElkKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbkNsb3NlKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25DbG9zZSh0aGlzLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIChldmVudCk9PnsKICAgICAgICAgICAgY29uc3QgeyB0aW1lU3RhbXAgIH0gPSBldmVudDsKICAgICAgICAgICAgY29uc3QgZXJyb3JJbmZvID0gY29tcHV0ZUVycm9ySW5mbyhldmVudCk7CiAgICAgICAgICAgIGlmIChUYWlsQ29ubmVjdGlvbi5WRVJCT1NFKSBjb25zb2xlLmxvZyhmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpLCAnVGFpbENvbm5lY3Rpb246IHdzIGVycm9yJywgZXJyb3JJbmZvKTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrcy5vbkVycm9yKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25FcnJvcih0aGlzLCB0aW1lU3RhbXAsIGVycm9ySW5mbyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBhc3luYyAoZXZlbnQpPT57CiAgICAgICAgICAgIGNvbnN0IHsgdGltZVN0YW1wICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIGlmIChldmVudC5kYXRhIGluc3RhbmNlb2YgQmxvYikgewogICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGV2ZW50LmRhdGEudGV4dCgpOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZSh0ZXh0KTsKICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcGFyc2VUYWlsTWVzc2FnZShvYmopOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblVucGFyc2VkTWVzc2FnZSh0aGlzLCB0aW1lU3RhbXAsIG9iaiwgZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbE1lc3NhZ2UodGhpcywgdGltZVN0YW1wLCBtZXNzYWdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblVucGFyc2VkTWVzc2FnZSh0aGlzLCB0aW1lU3RhbXAsIGV2ZW50LmRhdGEsIG5ldyBFcnJvcihgRXhwZWN0ZWQgZXZlbnQuZGF0YSB0byBiZSBCbG9iYCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMuc2VuZE9wdGlvbnNJZk9wZW4oKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb3NlKGNvZGUsIHJlYXNvbikgewogICAgICAgIHRoaXMud3MuY2xvc2UoY29kZSwgcmVhc29uKTsKICAgIH0KICAgIHNlbmRPcHRpb25zSWZPcGVuKCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy53cy5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikgewogICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgaWYgKFRhaWxDb25uZWN0aW9uLlZFUkJPU0UpIGNvbnNvbGUubG9nKGBzZW5kT3B0aW9uc0lmT3Blbjogc2VuZGluZyAke3BheWxvYWR9YCk7CiAgICAgICAgICAgIHRoaXMud3Muc2VuZChwYXlsb2FkKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gY29tcHV0ZUVycm9ySW5mbyhldmVudCkgewogICAgaWYgKGV2ZW50LnR5cGUgPT09ICdlcnJvcicpIHsKICAgICAgICBjb25zdCB7IG1lc3NhZ2UgLCBmaWxlbmFtZSAsIGxpbmVubyAsIGNvbG5vICwgZXJyb3IgIH0gPSBldmVudDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtZXNzYWdlLAogICAgICAgICAgICBmaWxlbmFtZSwKICAgICAgICAgICAgbGluZW5vLAogICAgICAgICAgICBjb2xubywKICAgICAgICAgICAgZXJyb3IKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBnZW5lcmF0ZVV1aWQoKSB7CiAgICBjb25zdCBjcnlwdG9Bc0FueSA9IGNyeXB0bzsKICAgIGlmICh0eXBlb2YgY3J5cHRvQXNBbnkucmFuZG9tVVVJRCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBjcnlwdG9Bc0FueS5yYW5kb21VVUlEKCk7CiAgICB9CiAgICBjb25zdCBybmRzID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxNikpOwogICAgcm5kc1s2XSA9IHJuZHNbNl0gJiAweDBmIHwgMHg0MDsKICAgIHJuZHNbOF0gPSBybmRzWzhdICYgMHgzZiB8IDB4ODA7CiAgICByZXR1cm4gYnl0ZXNUb1V1aWQocm5kcyk7Cn0KZnVuY3Rpb24gYnl0ZXNUb1V1aWQoYnl0ZXMpIHsKICAgIGNvbnN0IGJpdHMgPSBbCiAgICAgICAgLi4uYnl0ZXMKICAgIF0ubWFwKChiaXQpPT57CiAgICAgICAgY29uc3QgcyA9IGJpdC50b1N0cmluZygxNik7CiAgICAgICAgcmV0dXJuIGJpdCA8IDB4MTAgPyAiMCIgKyBzIDogczsKICAgIH0pOwogICAgcmV0dXJuIFsKICAgICAgICAuLi5iaXRzLnNsaWNlKDAsIDQpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDQsIDYpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDYsIDgpLAogICAgICAgICItIiwKICAgICAgICAuLi5iaXRzLnNsaWNlKDgsIDEwKSwKICAgICAgICAiLSIsCiAgICAgICAgLi4uYml0cy5zbGljZSgxMCwgMTYpLCAKICAgIF0uam9pbigiIik7Cn0KZnVuY3Rpb24gY2hlY2tFcXVhbChuYW1lLCB2YWx1ZSwgZXhwZWN0ZWQpIHsKICAgIGlmICh2YWx1ZSAhPT0gZXhwZWN0ZWQpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bmFtZX06IGV4cGVjdGVkICR7ZXhwZWN0ZWR9LCBmb3VuZCAke3ZhbHVlfWApOwp9CmZ1bmN0aW9uIGNoZWNrTWF0Y2hlcyhuYW1lLCB2YWx1ZSwgcGF0dGVybikgewogICAgaWYgKCFwYXR0ZXJuLnRlc3QodmFsdWUpKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCAke25hbWV9OiAke3ZhbHVlfWApOwogICAgcmV0dXJuIHZhbHVlOwp9CmNsYXNzIEdyYXBocWxRdWVyeSB7CiAgICBfcGFyZW50OwogICAgX25vZGVzOwogICAgX25vZGVPcmRlcjsKICAgIF9hcmdzOwogICAgX2FyZ09yZGVyOwogICAgY29uc3RydWN0b3IocGFyZW50LCBub2Rlcywgbm9kZU9yZGVyLCBhcmdzLCBhcmdPcmRlcil7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50OwogICAgICAgIHRoaXMuX25vZGVzID0gbm9kZXM7CiAgICAgICAgdGhpcy5fbm9kZU9yZGVyID0gbm9kZU9yZGVyOwogICAgICAgIHRoaXMuX2FyZ3MgPSBhcmdzOwogICAgICAgIHRoaXMuX2FyZ09yZGVyID0gYXJnT3JkZXI7CiAgICB9CiAgICBzdGF0aWMgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgR3JhcGhxbFF1ZXJ5KFtdLCBuZXcgTWFwKCksIFtdLCBuZXcgTWFwKCksIFtdKTsKICAgIH0KICAgIHNjYWxhcihuYW1lKSB7CiAgICAgICAgdGhpcy5hZGQobmFtZSwgTm9kZUtpbmQuU2NhbGFyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG9iamVjdChuYW1lKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYWRkKG5hbWUsIE5vZGVLaW5kLk9iamVjdCk7CiAgICAgICAgY29uc3QgcnQgPSBuZXcgR3JhcGhxbFF1ZXJ5KFsKICAgICAgICAgICAgdGhpcwogICAgICAgIF0sIG5ldyBNYXAoKSwgW10sIG5ldyBNYXAoKSwgW10pOwogICAgICAgIG5vZGUucXVlcnkucHVzaChydCk7CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQogICAgb2JqZWN0UXVlcnkobmFtZSwgcXVlcnkyKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYWRkKG5hbWUsIE5vZGVLaW5kLk9iamVjdCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5Mi5jb3B5V2l0aFBhcmVudCh0aGlzKTsKICAgICAgICBjb25zdCBydCA9IHE7CiAgICAgICAgbm9kZS5xdWVyeS5wdXNoKHJ0KTsKICAgICAgICByZXR1cm4gcnQ7CiAgICB9CiAgICBhcmdSYXcobmFtZSwgcmF3VmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGRBcmcobmFtZSwgcmF3VmFsdWUpOwogICAgfQogICAgYXJnQm9vbGVhbihuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCB2YWx1ZSA/ICd0cnVlJyA6ICdmYWxzZScpOwogICAgfQogICAgYXJnTG9uZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgJHt2YWx1ZX1gKTsKICAgIH0KICAgIGFyZ1N0cmluZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgIiR7dmFsdWUucmVwbGFjZUFsbCgnIicsICdcXCInKX0iYCk7CiAgICB9CiAgICBhcmdPYmplY3QobmFtZSwgZmllbGROYW1lLCBmaWVsZFZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQXJnKG5hbWUsIGB7JHtmaWVsZE5hbWV9OiIke2ZpZWxkVmFsdWUucmVwbGFjZUFsbCgnIicsICdcXCInKX0ifWApOwogICAgfQogICAgYXJnVmFyaWFibGUobmFtZSwgdmFyaWFibGVOYW1lKSB7CiAgICAgICAgY2hlY2tNYXRjaGVzKCd2YXJpYWJsZU5hbWUnLCB2YXJpYWJsZU5hbWUsIC9eW2Etel0rJC8pOwogICAgICAgIHJldHVybiB0aGlzLmFkZEFyZyhuYW1lLCBgJCR7dmFyaWFibGVOYW1lfWApOwogICAgfQogICAgZW5kKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQubGVuZ3RoID4gMCA/IHRoaXMuX3BhcmVudFswXSA6IHRoaXM7CiAgICB9CiAgICB0b3AoKSB7CiAgICAgICAgbGV0IHJ0ID0gdGhpczsKICAgICAgICB3aGlsZShydC5fcGFyZW50Lmxlbmd0aCA+IDApewogICAgICAgICAgICBydCA9IHJ0Ll9wYXJlbnRbMF07CiAgICAgICAgfQogICAgICAgIHJldHVybiBydDsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICAgIGNvbnN0IGxpbmVzID0gW107CiAgICAgICAgbGluZXMucHVzaCgneycpOwogICAgICAgIHRoaXMud3JpdGUobGluZXMsIDEpOwogICAgICAgIGxpbmVzLnB1c2goJ30nKTsKICAgICAgICByZXR1cm4gbGluZXMuam9pbignXG4nKTsKICAgIH0KICAgIGFkZEFyZyhuYW1lLCB2YWx1ZSkgewogICAgICAgIGlmICh0aGlzLl9hcmdzLmhhcyhuYW1lKSkgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGUgYXJnOiAke25hbWV9YCk7CiAgICAgICAgdGhpcy5fYXJnT3JkZXIucHVzaChuYW1lKTsKICAgICAgICB0aGlzLl9hcmdzLnNldChuYW1lLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB3cml0ZShsaW5lcywgbGV2ZWwpIHsKICAgICAgICBjb25zdCBpbmRlbnQgPSAnICAnLnJlcGVhdChsZXZlbCk7CiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5fbm9kZU9yZGVyKXsKICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNoZWNrR2V0KCdfbm9kZXMnLCB0aGlzLl9ub2Rlcywga2V5KTsKICAgICAgICAgICAgaWYgKG5vZGUua2luZCA9PT0gTm9kZUtpbmQuU2NhbGFyKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGAke2luZGVudH0ke2tleX1gKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmtpbmQgPT09IE5vZGVLaW5kLk9iamVjdCkgewogICAgICAgICAgICAgICAgY29uc3QgcSA9IG5vZGUucXVlcnlbMF07CiAgICAgICAgICAgICAgICBsZXQgbGluZSA9IGAke2luZGVudH0ke2tleX1gOwogICAgICAgICAgICAgICAgaWYgKHEuX2FyZ09yZGVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcoJzsKICAgICAgICAgICAgICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBhcmdOYW1lIG9mIHEuX2FyZ09yZGVyKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPiAwKSBsaW5lICs9ICcsICc7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gYCR7YXJnTmFtZX06ICR7Y2hlY2tHZXQoJ3EuX2FyZ3MnLCBxLl9hcmdzLCBhcmdOYW1lKX1gOwogICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gJyknOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGluZSArPSAnIHsnOwogICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lKTsKICAgICAgICAgICAgICAgIG5vZGUucXVlcnlbMF0ud3JpdGUobGluZXMsIGxldmVsICsgMSk7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGAke2luZGVudH19YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEltcGxlbWVudCBub2RlIGtpbmQgJHtub2RlLmtpbmR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBhZGQobmFtZSwga2luZCkgewogICAgICAgIGlmICh0aGlzLl9ub2Rlcy5oYXMobmFtZSkpIHRocm93IG5ldyBFcnJvcihgRHVwbGljYXRlIGZpZWxkOiAke25hbWV9YCk7CiAgICAgICAgY29uc3QgcnQgPSBuZXcgTm9kZTEoa2luZCk7CiAgICAgICAgdGhpcy5fbm9kZXMuc2V0KG5hbWUsIHJ0KTsKICAgICAgICB0aGlzLl9ub2RlT3JkZXIucHVzaChuYW1lKTsKICAgICAgICByZXR1cm4gcnQ7CiAgICB9CiAgICBjb3B5V2l0aFBhcmVudChwYXJlbnQpIHsKICAgICAgICBjb25zdCBub2RlcyA9IG5ldyBNYXAoKTsKICAgICAgICBjb25zdCBub2RlT3JkZXIgPSBbCiAgICAgICAgICAgIC4uLnRoaXMuX25vZGVPcmRlcgogICAgICAgIF07CiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBNYXAoKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9hcmdzLmVudHJpZXMoKSl7CiAgICAgICAgICAgIGFyZ3Muc2V0KGtleSwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmdPcmRlciA9IFsKICAgICAgICAgICAgLi4udGhpcy5fYXJnT3JkZXIKICAgICAgICBdOwogICAgICAgIGNvbnN0IHJ0ID0gbmV3IEdyYXBocWxRdWVyeShbCiAgICAgICAgICAgIHBhcmVudAogICAgICAgIF0sIG5vZGVzLCBub2RlT3JkZXIsIGFyZ3MsIGFyZ09yZGVyKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXkxLCBub2RlXSBvZiB0aGlzLl9ub2Rlcy5lbnRyaWVzKCkpewogICAgICAgICAgICBjb25zdCBuZXdOb2RlID0gbmV3IE5vZGUxKG5vZGUua2luZCk7CiAgICAgICAgICAgIGlmIChub2RlLnF1ZXJ5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1F1ZXJ5ID0gbm9kZS5xdWVyeVswXS5jb3B5V2l0aFBhcmVudChydCk7CiAgICAgICAgICAgICAgICBuZXdOb2RlLnF1ZXJ5LnB1c2gobmV3UXVlcnkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5vZGVzLnNldChrZXkxLCBuZXdOb2RlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQp9CmZ1bmN0aW9uIGNoZWNrR2V0KG1hcE5hbWUsIG1hcCwga2V5KSB7CiAgICBjb25zdCBydCA9IG1hcC5nZXQoa2V5KTsKICAgIGlmICghcnQpIHRocm93IG5ldyBFcnJvcihgQmFkICR7bWFwTmFtZX0ua2V5OiAke2tleX1gKTsKICAgIHJldHVybiBydDsKfQp2YXIgTm9kZUtpbmQ7CihmdW5jdGlvbihOb2RlS2luZDEpIHsKICAgIE5vZGVLaW5kMVtOb2RlS2luZDFbIlNjYWxhciJdID0gMV0gPSAiU2NhbGFyIjsKICAgIE5vZGVLaW5kMVtOb2RlS2luZDFbIk9iamVjdCJdID0gMl0gPSAiT2JqZWN0IjsKfSkoTm9kZUtpbmQgfHwgKE5vZGVLaW5kID0ge30pKTsKY2xhc3MgTm9kZTEgewogICAga2luZDsKICAgIHF1ZXJ5ID0gW107CiAgICBjb25zdHJ1Y3RvcihraW5kKXsKICAgICAgICB0aGlzLmtpbmQgPSBraW5kOwogICAgfQp9CmNsYXNzIENmR3FsQ2xpZW50IHsKICAgIHN0YXRpYyBERUJVRyA9IGZhbHNlOwogICAgc3RhdGljIFVSTF9UUkFOU0ZPUk1FUiA9ICh2KT0+dgogICAgOwogICAgcHJvZmlsZTsKICAgIGNvbnN0cnVjdG9yKHByb2ZpbGUpewogICAgICAgIHRoaXMucHJvZmlsZSA9IHByb2ZpbGU7CiAgICB9CiAgICBhc3luYyBnZXREdXJhYmxlT2JqZWN0UGVyaW9kaWNNZXRyaWNzQnlEYXRlKHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgICAgIHJldHVybiBhd2FpdCBfZ2V0RHVyYWJsZU9iamVjdFBlcmlvZGljTWV0cmljc0J5RGF0ZSh0aGlzLnByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSk7CiAgICB9CiAgICBhc3luYyBnZXREdXJhYmxlT2JqZWN0U3RvcmFnZUJ5RGF0ZShzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgICAgICByZXR1cm4gYXdhaXQgX2dldER1cmFibGVPYmplY3RTdG9yYWdlQnlEYXRlKHRoaXMucHJvZmlsZSwgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKTsKICAgIH0KICAgIGFzeW5jIGdldER1cmFibGVPYmplY3RJbnZvY2F0aW9uc0J5RGF0ZShzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgICAgICByZXR1cm4gYXdhaXQgX2dldER1cmFibGVPYmplY3RJbnZvY2F0aW9uc0J5RGF0ZSh0aGlzLnByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSk7CiAgICB9CiAgICBhc3luYyBnZXRSMlN0b3JhZ2VCeURhdGUoc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IF9nZXRSMlN0b3JhZ2VCeURhdGUodGhpcy5wcm9maWxlLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpOwogICAgfQogICAgYXN5bmMgZ2V0UjJPcGVyYXRpb25zQnlEYXRlKG9wZXJhdGlvbkNsYXNzLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgICAgICByZXR1cm4gYXdhaXQgX2dldFIyT3BlcmF0aW9uc0J5RGF0ZSh0aGlzLnByb2ZpbGUsIG9wZXJhdGlvbkNsYXNzLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpOwogICAgfQp9CmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5KHByb2ZpbGUsIHF1ZXJ5Rm4sIHZhcmlhYmxlcykgewogICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICBjb25zdCBxID0gR3JhcGhxbFF1ZXJ5LmNyZWF0ZSgpLnNjYWxhcignY29zdCcpLm9iamVjdCgndmlld2VyJykuc2NhbGFyKCdidWRnZXQnKS5vYmplY3QoJ2FjY291bnRzJykuYXJnT2JqZWN0KCdmaWx0ZXInLCAnYWNjb3VudFRhZycsIGFjY291bnRJZCkuc2NhbGFyKCdhY2NvdW50VGFnJyk7CiAgICBxdWVyeUZuKHEpOwogICAgY29uc3QgcXVlcnkxID0gcS50b3AoKS50b1N0cmluZygpOwogICAgaWYgKENmR3FsQ2xpZW50LkRFQlVHKSBjb25zb2xlLmxvZyhxdWVyeTEpOwogICAgY29uc3QgcmVxT2JqID0gewogICAgICAgIHF1ZXJ5OiBxdWVyeTEsCiAgICAgICAgdmFyaWFibGVzCiAgICB9OwogICAgY29uc3QgYm9keSA9IEpTT04uc3RyaW5naWZ5KHJlcU9iaik7CiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7CiAgICBjb25zdCB1cmwgPSBDZkdxbENsaWVudC5VUkxfVFJBTlNGT1JNRVIoJ2h0dHBzOi8vYXBpLmNsb3VkZmxhcmUuY29tL2NsaWVudC92NC9ncmFwaHFsJyk7CiAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsCiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2FwaVRva2VufWAKICAgICAgICB9LAogICAgICAgIGJvZHkKICAgIH0pOwogICAgY29uc3QgZmV0Y2hNaWxsaXMgPSBEYXRlLm5vdygpIC0gc3RhcnQ7CiAgICBpZiAoQ2ZHcWxDbGllbnQuREVCVUcpIGNvbnNvbGUubG9nKHJlcyk7CiAgICBpZiAocmVzLnN0YXR1cyAhPT0gMjAwKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCByZXMuc3RhdHVzOiAke3Jlcy5zdGF0dXN9LCBleHBlY3RlZCAyMDAsIHRleHQ9JHthd2FpdCByZXMudGV4dCgpfWApOwogICAgY29uc3QgY29udGVudFR5cGUgPSByZXMuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpOwogICAgaWYgKGNvbnRlbnRUeXBlICE9PSAnYXBwbGljYXRpb24vanNvbicpIHRocm93IG5ldyBFcnJvcihgQmFkIHJlcy5jb250ZW50VHlwZTogJHtjb250ZW50VHlwZX0sIGV4cGVjdGVkIGFwcGxpY2F0aW9uL2pzb24sIGZvdW5kICR7Y29udGVudFR5cGV9LCB0ZXh0PSR7YXdhaXQgcmVzLnRleHQoKX1gKTsKICAgIGNvbnN0IHJlc09iaiA9IGF3YWl0IHJlcy5qc29uKCk7CiAgICByZXNPYmouZmV0Y2hNaWxsaXMgPSBmZXRjaE1pbGxpczsKICAgIGlmIChDZkdxbENsaWVudC5ERUJVRykgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzT2JqLCB1bmRlZmluZWQsIDIpKTsKICAgIGlmIChpc0dxbEVycm9yUmVzcG9uc2UocmVzT2JqKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNPYmouZXJyb3JzLm1hcChjb21wdXRlR3FsRXJyb3JTdHJpbmcpLmpvaW4oJywgJykpOwogICAgfQogICAgcmV0dXJuIHJlc09iajsKfQpmdW5jdGlvbiBpc0dxbEVycm9yUmVzcG9uc2Uob2JqKSB7CiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgb2JqLmRhdGEgPT09IG51bGwgJiYgQXJyYXkuaXNBcnJheShvYmouZXJyb3JzKTsKfQpmdW5jdGlvbiBjb21wdXRlR3FsRXJyb3JTdHJpbmcoZXJyb3IpIHsKICAgIGNvbnN0IHBpZWNlcyA9IFsKICAgICAgICBlcnJvci5tZXNzYWdlCiAgICBdOwogICAgaWYgKGVycm9yLnBhdGgpIHBpZWNlcy5wdXNoKGAoJHtlcnJvci5wYXRoLmpvaW4oJy8nKX0pYCk7CiAgICBpZiAoZXJyb3IuZXh0ZW5zaW9ucy5jb2RlKSBwaWVjZXMucHVzaChgKGNvZGU9JHtlcnJvci5leHRlbnNpb25zLmNvZGV9KWApOwogICAgcmV0dXJuIHBpZWNlcy5qb2luKCcgJyk7Cn0KYXN5bmMgZnVuY3Rpb24gX2dldER1cmFibGVPYmplY3RQZXJpb2RpY01ldHJpY3NCeURhdGUocHJvZmlsZSwgc3RhcnREYXRlSW5jbHVzaXZlLCBlbmREYXRlSW5jbHVzaXZlKSB7CiAgICBjb25zdCByZXNPYmogPSBhd2FpdCBxdWVyeShwcm9maWxlLCAocSk9PnEub2JqZWN0KCdkdXJhYmxlT2JqZWN0c1BlcmlvZGljR3JvdXBzJykuYXJnTG9uZygnbGltaXQnLCAxMDAwMCkuYXJnUmF3KCdmaWx0ZXInLCBge2RhdGVfZ2VxOiAkc3RhcnQsIGRhdGVfbGVxOiAkZW5kfWApLmFyZ1Jhdygnb3JkZXJCeScsIGBbZGF0ZV9BU0NdYCkub2JqZWN0KCdkaW1lbnNpb25zJykuc2NhbGFyKCdkYXRlJykuc2NhbGFyKCduYW1lc3BhY2VJZCcpLmVuZCgpLm9iamVjdCgnbWF4Jykuc2NhbGFyKCdhY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucycpLmVuZCgpLm9iamVjdCgnc3VtJykuc2NhbGFyKCdhY3RpdmVUaW1lJykuc2NhbGFyKCdjcHVUaW1lJykuc2NhbGFyKCdleGNlZWRlZENwdUVycm9ycycpLnNjYWxhcignZXhjZWVkZWRNZW1vcnlFcnJvcnMnKS5zY2FsYXIoJ2ZhdGFsSW50ZXJuYWxFcnJvcnMnKS5zY2FsYXIoJ2luYm91bmRXZWJzb2NrZXRNc2dDb3VudCcpLnNjYWxhcignb3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCcpLnNjYWxhcignc3RvcmFnZURlbGV0ZXMnKS5zY2FsYXIoJ3N0b3JhZ2VSZWFkVW5pdHMnKS5zY2FsYXIoJ3N0b3JhZ2VXcml0ZVVuaXRzJykuc2NhbGFyKCdzdWJyZXF1ZXN0cycpCiAgICAsIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5kdXJhYmxlT2JqZWN0c1BlcmlvZGljR3JvdXBzKXsKICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGdyb3VwLmRpbWVuc2lvbnMuZGF0ZTsKICAgICAgICAgICAgY29uc3QgbmFtZXNwYWNlSWQgPSBncm91cC5kaW1lbnNpb25zLm5hbWVzcGFjZUlkOwogICAgICAgICAgICBjb25zdCBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucyA9IGdyb3VwLm1heC5hY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9uczsKICAgICAgICAgICAgY29uc3Qgc3VtQWN0aXZlVGltZSA9IGdyb3VwLnN1bS5hY3RpdmVUaW1lOwogICAgICAgICAgICBjb25zdCBzdW1DcHVUaW1lID0gZ3JvdXAuc3VtLmNwdVRpbWU7CiAgICAgICAgICAgIGNvbnN0IHN1bUV4Y2VlZGVkQ3B1RXJyb3JzID0gZ3JvdXAuc3VtLmV4Y2VlZGVkQ3B1RXJyb3JzOwogICAgICAgICAgICBjb25zdCBzdW1FeGNlZWRlZE1lbW9yeUVycm9ycyA9IGdyb3VwLnN1bS5leGNlZWRlZE1lbW9yeUVycm9yczsKICAgICAgICAgICAgY29uc3Qgc3VtRmF0YWxJbnRlcm5hbEVycm9ycyA9IGdyb3VwLnN1bS5mYXRhbEludGVybmFsRXJyb3JzOwogICAgICAgICAgICBjb25zdCBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQgPSBncm91cC5zdW0uaW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50OwogICAgICAgICAgICBjb25zdCBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50ID0gZ3JvdXAuc3VtLm91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQ7CiAgICAgICAgICAgIGNvbnN0IHN1bVN0b3JhZ2VEZWxldGVzID0gZ3JvdXAuc3VtLnN0b3JhZ2VEZWxldGVzOwogICAgICAgICAgICBjb25zdCBzdW1TdG9yYWdlUmVhZFVuaXRzID0gZ3JvdXAuc3VtLnN0b3JhZ2VSZWFkVW5pdHM7CiAgICAgICAgICAgIGNvbnN0IHN1bVN0b3JhZ2VXcml0ZVVuaXRzID0gZ3JvdXAuc3VtLnN0b3JhZ2VXcml0ZVVuaXRzOwogICAgICAgICAgICBjb25zdCBzdW1TdWJyZXF1ZXN0cyA9IGdyb3VwLnN1bS5zdWJyZXF1ZXN0czsKICAgICAgICAgICAgcm93cy5wdXNoKHsKICAgICAgICAgICAgICAgIGRhdGUsCiAgICAgICAgICAgICAgICBuYW1lc3BhY2VJZCwKICAgICAgICAgICAgICAgIG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zLAogICAgICAgICAgICAgICAgc3VtQWN0aXZlVGltZSwKICAgICAgICAgICAgICAgIHN1bUNwdVRpbWUsCiAgICAgICAgICAgICAgICBzdW1FeGNlZWRlZENwdUVycm9ycywKICAgICAgICAgICAgICAgIHN1bUV4Y2VlZGVkTWVtb3J5RXJyb3JzLAogICAgICAgICAgICAgICAgc3VtRmF0YWxJbnRlcm5hbEVycm9ycywKICAgICAgICAgICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgICAgIHN1bU91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQsCiAgICAgICAgICAgICAgICBzdW1TdG9yYWdlRGVsZXRlcywKICAgICAgICAgICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHMsCiAgICAgICAgICAgICAgICBzdW1TdG9yYWdlV3JpdGVVbml0cywKICAgICAgICAgICAgICAgIHN1bVN1YnJlcXVlc3RzCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgaW5mbzogewogICAgICAgICAgICBmZXRjaE1pbGxpcywKICAgICAgICAgICAgY29zdCwKICAgICAgICAgICAgYnVkZ2V0CiAgICAgICAgfSwKICAgICAgICByb3dzCiAgICB9Owp9CmFzeW5jIGZ1bmN0aW9uIF9nZXREdXJhYmxlT2JqZWN0U3RvcmFnZUJ5RGF0ZShwcm9maWxlLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgIGNvbnN0IHJlc09iaiA9IGF3YWl0IHF1ZXJ5KHByb2ZpbGUsIChxKT0+cS5vYmplY3QoJ2R1cmFibGVPYmplY3RzU3RvcmFnZUdyb3VwcycpLmFyZ0xvbmcoJ2xpbWl0JywgMTAwMDApLmFyZ1JhdygnZmlsdGVyJywgYHtkYXRlX2dlcTogJHN0YXJ0LCBkYXRlX2xlcTogJGVuZH1gKS5hcmdSYXcoJ29yZGVyQnknLCBgW2RhdGVfQVNDXWApLm9iamVjdCgnZGltZW5zaW9ucycpLnNjYWxhcignZGF0ZScpLmVuZCgpLm9iamVjdCgnbWF4Jykuc2NhbGFyKCdzdG9yZWRCeXRlcycpLmVuZCgpCiAgICAsIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5kdXJhYmxlT2JqZWN0c1N0b3JhZ2VHcm91cHMpewogICAgICAgICAgICBjb25zdCBkYXRlID0gZ3JvdXAuZGltZW5zaW9ucy5kYXRlOwogICAgICAgICAgICBjb25zdCBtYXhTdG9yZWRCeXRlcyA9IGdyb3VwLm1heC5zdG9yZWRCeXRlczsKICAgICAgICAgICAgcm93cy5wdXNoKHsKICAgICAgICAgICAgICAgIGRhdGUsCiAgICAgICAgICAgICAgICBtYXhTdG9yZWRCeXRlcwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGluZm86IHsKICAgICAgICAgICAgZmV0Y2hNaWxsaXMsCiAgICAgICAgICAgIGNvc3QsCiAgICAgICAgICAgIGJ1ZGdldAogICAgICAgIH0sCiAgICAgICAgcm93cwogICAgfTsKfQphc3luYyBmdW5jdGlvbiBfZ2V0RHVyYWJsZU9iamVjdEludm9jYXRpb25zQnlEYXRlKHByb2ZpbGUsIHN0YXJ0RGF0ZUluY2x1c2l2ZSwgZW5kRGF0ZUluY2x1c2l2ZSkgewogICAgY29uc3QgcmVzT2JqID0gYXdhaXQgcXVlcnkocHJvZmlsZSwgKHEpPT5xLm9iamVjdCgnZHVyYWJsZU9iamVjdHNJbnZvY2F0aW9uc0FkYXB0aXZlR3JvdXBzJykuYXJnTG9uZygnbGltaXQnLCAxMDAwMCkuYXJnUmF3KCdmaWx0ZXInLCBge2RhdGVfZ2VxOiAkc3RhcnQsIGRhdGVfbGVxOiAkZW5kfWApLmFyZ1Jhdygnb3JkZXJCeScsIGBbZGF0ZV9BU0NdYCkub2JqZWN0KCdkaW1lbnNpb25zJykuc2NhbGFyKCdkYXRlJykuc2NhbGFyKCduYW1lc3BhY2VJZCcpLmVuZCgpLm9iamVjdCgnYXZnJykuc2NhbGFyKCdzYW1wbGVJbnRlcnZhbCcpLmVuZCgpLm9iamVjdCgnc3VtJykuc2NhbGFyKCdyZXF1ZXN0cycpLmVuZCgpCiAgICAsIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5kdXJhYmxlT2JqZWN0c0ludm9jYXRpb25zQWRhcHRpdmVHcm91cHMpewogICAgICAgICAgICBjb25zdCBkYXRlID0gZ3JvdXAuZGltZW5zaW9ucy5kYXRlOwogICAgICAgICAgICBjb25zdCBuYW1lc3BhY2VJZCA9IGdyb3VwLmRpbWVuc2lvbnMubmFtZXNwYWNlSWQ7CiAgICAgICAgICAgIGNvbnN0IGF2Z1NhbXBsZUludGVydmFsID0gZ3JvdXAuYXZnLnNhbXBsZUludGVydmFsOwogICAgICAgICAgICBjb25zdCBzdW1SZXF1ZXN0cyA9IGdyb3VwLnN1bS5yZXF1ZXN0czsKICAgICAgICAgICAgcm93cy5wdXNoKHsKICAgICAgICAgICAgICAgIGRhdGUsCiAgICAgICAgICAgICAgICBuYW1lc3BhY2VJZCwKICAgICAgICAgICAgICAgIGF2Z1NhbXBsZUludGVydmFsLAogICAgICAgICAgICAgICAgc3VtUmVxdWVzdHMKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBpbmZvOiB7CiAgICAgICAgICAgIGZldGNoTWlsbGlzLAogICAgICAgICAgICBjb3N0LAogICAgICAgICAgICBidWRnZXQKICAgICAgICB9LAogICAgICAgIHJvd3MKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gX2dldFIyU3RvcmFnZUJ5RGF0ZShwcm9maWxlLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgIGNvbnN0IHJlc09iaiA9IGF3YWl0IHF1ZXJ5KHByb2ZpbGUsIChxKT0+cS5vYmplY3QoJ3IyU3RvcmFnZUFkYXB0aXZlR3JvdXBzJykuYXJnTG9uZygnbGltaXQnLCAxMDAwMCkuYXJnUmF3KCdmaWx0ZXInLCBge2RhdGVfZ2VxOiAkc3RhcnQsIGRhdGVfbGVxOiAkZW5kfWApLmFyZ1Jhdygnb3JkZXJCeScsIGBbZGF0ZV9BU0NdYCkub2JqZWN0KCdkaW1lbnNpb25zJykuc2NhbGFyKCdkYXRlJykuc2NhbGFyKCdidWNrZXROYW1lJykuZW5kKCkub2JqZWN0KCdtYXgnKS5zY2FsYXIoJ21ldGFkYXRhU2l6ZScpLnNjYWxhcigncGF5bG9hZFNpemUnKS5zY2FsYXIoJ29iamVjdENvdW50Jykuc2NhbGFyKCd1cGxvYWRDb3VudCcpLmVuZCgpCiAgICAsIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5yMlN0b3JhZ2VBZGFwdGl2ZUdyb3Vwcyl7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBncm91cC5kaW1lbnNpb25zLmRhdGU7CiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldE5hbWUgPSBncm91cC5kaW1lbnNpb25zLmJ1Y2tldE5hbWU7CiAgICAgICAgICAgIGNvbnN0IG1heE1ldGFkYXRhU2l6ZSA9IGdyb3VwLm1heC5tZXRhZGF0YVNpemU7CiAgICAgICAgICAgIGNvbnN0IG1heFBheWxvYWRTaXplID0gZ3JvdXAubWF4LnBheWxvYWRTaXplOwogICAgICAgICAgICBjb25zdCBtYXhPYmplY3RDb3VudCA9IGdyb3VwLm1heC5vYmplY3RDb3VudDsKICAgICAgICAgICAgY29uc3QgbWF4VXBsb2FkQ291bnQgPSBncm91cC5tYXgudXBsb2FkQ291bnQ7CiAgICAgICAgICAgIHJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICBkYXRlLAogICAgICAgICAgICAgICAgYnVja2V0TmFtZSwKICAgICAgICAgICAgICAgIG1heE1ldGFkYXRhU2l6ZSwKICAgICAgICAgICAgICAgIG1heFBheWxvYWRTaXplLAogICAgICAgICAgICAgICAgbWF4T2JqZWN0Q291bnQsCiAgICAgICAgICAgICAgICBtYXhVcGxvYWRDb3VudAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGluZm86IHsKICAgICAgICAgICAgZmV0Y2hNaWxsaXMsCiAgICAgICAgICAgIGNvc3QsCiAgICAgICAgICAgIGJ1ZGdldAogICAgICAgIH0sCiAgICAgICAgcm93cwogICAgfTsKfQphc3luYyBmdW5jdGlvbiBfZ2V0UjJPcGVyYXRpb25zQnlEYXRlKHByb2ZpbGUsIG9wZXJhdGlvbkNsYXNzLCBzdGFydERhdGVJbmNsdXNpdmUsIGVuZERhdGVJbmNsdXNpdmUpIHsKICAgIGNvbnN0IGFjdGlvblR5cGVzID0gb3BlcmF0aW9uQ2xhc3MgPT09ICdBJyA/IFsKICAgICAgICAnTGlzdEJ1Y2tldHMnLAogICAgICAgICdQdXRCdWNrZXQnLAogICAgICAgICdMaXN0T2JqZWN0cycsCiAgICAgICAgJ1B1dE9iamVjdCcsCiAgICAgICAgJ0NvcHlPYmplY3QnLAogICAgICAgICdDb21wbGV0ZU11bHRpcGFydFVwbG9hZCcsCiAgICAgICAgJ0NyZWF0ZU11bHRpcGFydFVwbG9hZCcsCiAgICAgICAgJ1VwbG9hZFBhcnRDb3B5JwogICAgXSA6IFsKICAgICAgICAnSGVhZEJ1Y2tldCcsCiAgICAgICAgJ0hlYWRPYmplY3QnLAogICAgICAgICdHZXRPYmplY3QnCiAgICBdOwogICAgY29uc3QgcmVzT2JqID0gYXdhaXQgcXVlcnkocHJvZmlsZSwgKHEpPT5xLm9iamVjdCgncjJPcGVyYXRpb25zQWRhcHRpdmVHcm91cHMnKS5hcmdMb25nKCdsaW1pdCcsIDEwMDAwKS5hcmdSYXcoJ2ZpbHRlcicsIGB7ZGF0ZV9nZXE6ICRzdGFydCwgZGF0ZV9sZXE6ICRlbmQsIGFjdGlvblN0YXR1czogInN1Y2Nlc3MiLCBhY3Rpb25UeXBlX2luOiAke0pTT04uc3RyaW5naWZ5KGFjdGlvblR5cGVzKX19YCkuYXJnUmF3KCdvcmRlckJ5JywgYFtkYXRlX0FTQ11gKS5vYmplY3QoJ2RpbWVuc2lvbnMnKS5zY2FsYXIoJ2RhdGUnKS5zY2FsYXIoJ2J1Y2tldE5hbWUnKS5lbmQoKS5vYmplY3QoJ3N1bScpLnNjYWxhcigncmVxdWVzdHMnKS5zY2FsYXIoJ3Jlc3BvbnNlT2JqZWN0U2l6ZScpLmVuZCgpCiAgICAsIHsKICAgICAgICBzdGFydDogc3RhcnREYXRlSW5jbHVzaXZlLAogICAgICAgIGVuZDogZW5kRGF0ZUluY2x1c2l2ZQogICAgfSk7CiAgICBjb25zdCBmZXRjaE1pbGxpcyA9IHJlc09iai5mZXRjaE1pbGxpczsKICAgIGNvbnN0IHJlcyA9IHJlc09iajsKICAgIGNvbnN0IGNvc3QgPSByZXMuZGF0YS5jb3N0OwogICAgY29uc3QgYnVkZ2V0ID0gcmVzLmRhdGEudmlld2VyLmJ1ZGdldDsKICAgIGNvbnN0IHJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiByZXMuZGF0YS52aWV3ZXIuYWNjb3VudHMpewogICAgICAgIGNoZWNrRXF1YWwoJ2FjY291bnQuYWNjb3VudFRhZycsIGFjY291bnQuYWNjb3VudFRhZywgcHJvZmlsZS5hY2NvdW50SWQpOwogICAgICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgYWNjb3VudC5yMk9wZXJhdGlvbnNBZGFwdGl2ZUdyb3Vwcyl7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBncm91cC5kaW1lbnNpb25zLmRhdGU7CiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldE5hbWUgPSBncm91cC5kaW1lbnNpb25zLmJ1Y2tldE5hbWU7CiAgICAgICAgICAgIGNvbnN0IHN1bVN1Y2Nlc3NmdWxSZXF1ZXN0cyA9IGdyb3VwLnN1bS5yZXF1ZXN0czsKICAgICAgICAgICAgY29uc3Qgc3VtU3VjY2Vzc2Z1bFJlc3BvbnNlT2JqZWN0U2l6ZSA9IGdyb3VwLnN1bS5yZXNwb25zZU9iamVjdFNpemU7CiAgICAgICAgICAgIHJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICBkYXRlLAogICAgICAgICAgICAgICAgYnVja2V0TmFtZSwKICAgICAgICAgICAgICAgIHN1bVN1Y2Nlc3NmdWxSZXF1ZXN0cywKICAgICAgICAgICAgICAgIHN1bVN1Y2Nlc3NmdWxSZXNwb25zZU9iamVjdFNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgICBpbmZvOiB7CiAgICAgICAgICAgIGZldGNoTWlsbGlzLAogICAgICAgICAgICBjb3N0LAogICAgICAgICAgICBidWRnZXQKICAgICAgICB9LAogICAgICAgIHJvd3MKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gY29tcHV0ZUR1cmFibGVPYmplY3RzQ29zdHNUYWJsZShjbGllbnQsIG9wdHMpIHsKICAgIGNvbnN0IHsgc3RhcnQ6IHN0YXJ0MSAsIGVuZDogZW5kMSAgfSA9ICgoKT0+ewogICAgICAgIGlmICgnbG9va2JhY2tEYXlzJyBpbiBvcHRzKSB7CiAgICAgICAgICAgIGNvbnN0IGVuZCA9IHV0Y0N1cnJlbnREYXRlKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gYWRkRGF5c1RvRGF0ZShlbmQsIC1vcHRzLmxvb2tiYWNrRGF5cyk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzdGFydCwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhcnQgLCBlbmQgIH0gPSBvcHRzOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgc3RhcnQsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KSgpOwogICAgY29uc3QgW3N0b3JhZ2UsIHBlcmlvZGljLCBpbnZvY2F0aW9ucywgbmFtZXNwYWNlc10gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgY2xpZW50LmdldER1cmFibGVPYmplY3RTdG9yYWdlQnlEYXRlKHN0YXJ0MSwgZW5kMSksCiAgICAgICAgY2xpZW50LmdldER1cmFibGVPYmplY3RQZXJpb2RpY01ldHJpY3NCeURhdGUoc3RhcnQxLCBlbmQxKSwKICAgICAgICBjbGllbnQuZ2V0RHVyYWJsZU9iamVjdEludm9jYXRpb25zQnlEYXRlKHN0YXJ0MSwgZW5kMSksCiAgICAgICAgdHJ5TGlzdER1cmFibGVPYmplY3RzTmFtZXNwYWNlcyhjbGllbnQucHJvZmlsZSksIAogICAgXSk7CiAgICBjb25zdCBncWxSZXN1bHRJbmZvcyA9IHsKICAgICAgICAnc3RvcmFnZSc6IHN0b3JhZ2UuaW5mbywKICAgICAgICAncGVyaW9kaWMnOiBwZXJpb2RpYy5pbmZvLAogICAgICAgICdpbnZvY2F0aW9ucyc6IGludm9jYXRpb25zLmluZm8KICAgIH07CiAgICBjb25zdCByb3dzQnlOYW1lc3BhY2UgPSB7fTsKICAgIGNvbnN0IHJvd3NCeURhdGUgPSB7fTsKICAgIGZvciAoY29uc3QgcFJvdyBvZiBwZXJpb2RpYy5yb3dzKXsKICAgICAgICBjb25zdCB7IGRhdGUgLCBuYW1lc3BhY2VJZCAsIG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zICwgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50ICwgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCAsIHN1bVN1YnJlcXVlc3RzICwgc3VtQWN0aXZlVGltZSAsIHN1bVN0b3JhZ2VSZWFkVW5pdHMgLCBzdW1TdG9yYWdlV3JpdGVVbml0cyAsIHN1bVN0b3JhZ2VEZWxldGVzICwgIH0gPSBwUm93OwogICAgICAgIGxldCByb3dzID0gcm93c0J5TmFtZXNwYWNlW25hbWVzcGFjZUlkXTsKICAgICAgICBpZiAoIXJvd3MpIHsKICAgICAgICAgICAgcm93cyA9IFtdOwogICAgICAgICAgICByb3dzQnlOYW1lc3BhY2VbbmFtZXNwYWNlSWRdID0gcm93czsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGVSb3dzID0gcm93c0J5RGF0ZVtkYXRlXTsKICAgICAgICBpZiAoIWRhdGVSb3dzKSB7CiAgICAgICAgICAgIGRhdGVSb3dzID0gW107CiAgICAgICAgICAgIHJvd3NCeURhdGVbZGF0ZV0gPSBkYXRlUm93czsKICAgICAgICB9CiAgICAgICAgY29uc3QgeyBzdW1SZXF1ZXN0cyAgfSA9IGludm9jYXRpb25zLnJvd3MuZmlsdGVyKCh2KT0+di5kYXRlID09PSBkYXRlICYmIHYubmFtZXNwYWNlSWQgPT09IG5hbWVzcGFjZUlkCiAgICAgICAgKVswXSB8fCB7CiAgICAgICAgICAgIHN1bVJlcXVlc3RzOiAwCiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IHJlcXVlc3RzQ29zdCAsIHdlYnNvY2tldHNDb3N0ICwgc3VicmVxdWVzdHNDb3N0ICwgYWN0aXZlQ29zdCAsIHJlYWRVbml0c0Nvc3QgLCB3cml0ZVVuaXRzQ29zdCAsIGRlbGV0ZXNDb3N0ICwgdG90YWxDb3N0ICwgYWN0aXZlR2JTZWNvbmRzICB9ID0gY29tcHV0ZUNvc3RzKHsKICAgICAgICAgICAgc3VtUmVxdWVzdHMsCiAgICAgICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMsCiAgICAgICAgICAgIHN1bUFjdGl2ZVRpbWUsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHMsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VXcml0ZVVuaXRzLAogICAgICAgICAgICBzdW1TdG9yYWdlRGVsZXRlcywKICAgICAgICAgICAgZXhjbHVkZUZyZWVVc2FnZTogZmFsc2UsCiAgICAgICAgICAgIHN0b3JhZ2VDb3N0OiAwCiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgcm93ID0gewogICAgICAgICAgICBkYXRlLAogICAgICAgICAgICBzdW1SZXF1ZXN0cywKICAgICAgICAgICAgcmVxdWVzdHNDb3N0LAogICAgICAgICAgICBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucywKICAgICAgICAgICAgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50LAogICAgICAgICAgICB3ZWJzb2NrZXRzQ29zdCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMsCiAgICAgICAgICAgIHN1YnJlcXVlc3RzQ29zdCwKICAgICAgICAgICAgc3VtQWN0aXZlVGltZSwKICAgICAgICAgICAgYWN0aXZlR2JTZWNvbmRzLAogICAgICAgICAgICBhY3RpdmVDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlUmVhZFVuaXRzLAogICAgICAgICAgICByZWFkVW5pdHNDb3N0LAogICAgICAgICAgICBzdW1TdG9yYWdlV3JpdGVVbml0cywKICAgICAgICAgICAgd3JpdGVVbml0c0Nvc3QsCiAgICAgICAgICAgIHN1bVN0b3JhZ2VEZWxldGVzLAogICAgICAgICAgICBkZWxldGVzQ29zdCwKICAgICAgICAgICAgdG90YWxDb3N0CiAgICAgICAgfTsKICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgICBkYXRlUm93cy5wdXNoKHJvdyk7CiAgICB9CiAgICBjb25zdCBuYW1lc3BhY2VUYWJsZXMgPSB7fTsKICAgIGZvciAoY29uc3QgW25hbWVzcGFjZUlkLCByb3dzXSBvZiBPYmplY3QuZW50cmllcyhyb3dzQnlOYW1lc3BhY2UpKXsKICAgICAgICBjb25zdCBlc3RpbWF0ZWQzMERheVJvdyA9IGNvbXB1dGVFc3RpbWF0ZWQzMERheVJvdyhyb3dzLCBmYWxzZSk7CiAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gbmFtZXNwYWNlcy5maW5kKCh2KT0+di5pZCA9PT0gbmFtZXNwYWNlSWQKICAgICAgICApOwogICAgICAgIG5hbWVzcGFjZVRhYmxlc1tuYW1lc3BhY2VJZF0gPSB7CiAgICAgICAgICAgIHJvd3MsCiAgICAgICAgICAgIGVzdGltYXRlZDMwRGF5Um93LAogICAgICAgICAgICBuYW1lc3BhY2UsCiAgICAgICAgICAgIGVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlOiB1bmRlZmluZWQKICAgICAgICB9OwogICAgfQogICAgY29uc3QgYWNjb3VudFJvd3MgPSBbXTsKICAgIGZvciAoY29uc3QgW2RhdGUsIGRhdGVSb3dzXSBvZiBPYmplY3QuZW50cmllcyhyb3dzQnlEYXRlKSl7CiAgICAgICAgY29uc3QgeyBtYXhTdG9yZWRCeXRlcyAgfSA9IHN0b3JhZ2Uucm93cy5maWx0ZXIoKHYpPT52LmRhdGUgPT09IGRhdGUKICAgICAgICApWzBdIHx8IHsKICAgICAgICAgICAgbWF4U3RvcmVkQnl0ZXM6IDAKICAgICAgICB9OwogICAgICAgIGNvbnN0IHN0b3JhZ2VHYiA9IG1heFN0b3JlZEJ5dGVzIC8gMTAyNCAvIDEwMjQgLyAxMDI0OwogICAgICAgIGNvbnN0IHN0b3JhZ2VDb3N0ID0gc3RvcmFnZUdiICogLjIwIC8gMzA7CiAgICAgICAgYWNjb3VudFJvd3MucHVzaChjb21wdXRlVG90YWxSb3coZGF0ZSwgZGF0ZVJvd3MsIHsKICAgICAgICAgICAgc3RvcmFnZUdiLAogICAgICAgICAgICBzdG9yYWdlQ29zdAogICAgICAgIH0pKTsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VDb3N0ID0gYWNjb3VudFJvd3MubGVuZ3RoID4gMCA/IGFjY291bnRSb3dzLm1hcCgodik9PnYuc3RvcmFnZUNvc3QgfHwgMAogICAgKS5yZWR1Y2UoKGEsIGIpPT5hICsgYgogICAgKSA6IDA7CiAgICBjb25zdCBhY2NvdW50T3B0cyA9IHsKICAgICAgICBzdG9yYWdlR2I6IDAsCiAgICAgICAgc3RvcmFnZUNvc3QKICAgIH07CiAgICBjb25zdCBlc3RpbWF0ZWQzMERheVJvdyA9IGNvbXB1dGVFc3RpbWF0ZWQzMERheVJvdyhhY2NvdW50Um93cywgZmFsc2UsIGFjY291bnRPcHRzKTsKICAgIGNvbnN0IGVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlID0gY29tcHV0ZUVzdGltYXRlZDMwRGF5Um93KGFjY291bnRSb3dzLCB0cnVlLCBhY2NvdW50T3B0cyk7CiAgICBjb25zdCBhY2NvdW50VGFibGUgPSB7CiAgICAgICAgcm93czogYWNjb3VudFJvd3MsCiAgICAgICAgZXN0aW1hdGVkMzBEYXlSb3csCiAgICAgICAgZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUsCiAgICAgICAgbmFtZXNwYWNlOiB1bmRlZmluZWQKICAgIH07CiAgICByZXR1cm4gewogICAgICAgIGFjY291bnRUYWJsZSwKICAgICAgICBuYW1lc3BhY2VUYWJsZXMsCiAgICAgICAgZ3FsUmVzdWx0SW5mb3MKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUNvc3RzKGlucHV0KSB7CiAgICBjb25zdCB7IHN1bUFjdGl2ZVRpbWUgLCBzdW1TdG9yYWdlUmVhZFVuaXRzICwgc3VtU3RvcmFnZVdyaXRlVW5pdHMgLCBzdW1TdG9yYWdlRGVsZXRlcyAsIGV4Y2x1ZGVGcmVlVXNhZ2UgLCBzdG9yYWdlQ29zdCAgfSA9IGlucHV0OwogICAgY29uc3QgeyBzdW1SZXF1ZXN0czogc3VtUmVxdWVzdHMxICwgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50OiBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQxICwgc3VtU3VicmVxdWVzdHM6IHN1bVN1YnJlcXVlc3RzMSAgfSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxldCB7IHN1bVJlcXVlc3RzICwgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50ICwgc3VtU3VicmVxdWVzdHMgIH0gPSBpbnB1dDsKICAgICAgICBpZiAoZXhjbHVkZUZyZWVVc2FnZSkgewogICAgICAgICAgICBsZXQgcmVtYWluaW5nID0gMTAwMDAwMDsKICAgICAgICAgICAgbGV0IHRha2UgPSBNYXRoLm1pbihyZW1haW5pbmcsIHN1bVJlcXVlc3RzKTsKICAgICAgICAgICAgaWYgKHRha2UgPiAwKSB7CiAgICAgICAgICAgICAgICBzdW1SZXF1ZXN0cyAtPSB0YWtlOwogICAgICAgICAgICAgICAgcmVtYWluaW5nIC09IHRha2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFrZSA9IE1hdGgubWluKHJlbWFpbmluZywgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50KTsKICAgICAgICAgICAgaWYgKHRha2UgPiAwKSB7CiAgICAgICAgICAgICAgICBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQgLT0gdGFrZTsKICAgICAgICAgICAgICAgIHJlbWFpbmluZyAtPSB0YWtlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRha2UgPSBNYXRoLm1pbihyZW1haW5pbmcsIHN1bVN1YnJlcXVlc3RzKTsKICAgICAgICAgICAgaWYgKHRha2UgPiAwKSB7CiAgICAgICAgICAgICAgICBzdW1TdWJyZXF1ZXN0cyAtPSB0YWtlOwogICAgICAgICAgICAgICAgcmVtYWluaW5nIC09IHRha2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3VtUmVxdWVzdHMsCiAgICAgICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHMKICAgICAgICB9OwogICAgfSgpOwogICAgY29uc3QgcmVxdWVzdHNDb3N0ID0gc3VtUmVxdWVzdHMxIC8gMTAwMDAwMCAqIDAuMTU7CiAgICBjb25zdCB3ZWJzb2NrZXRzQ29zdCA9IHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudDEgLyAxMDAwMDAwICogMC4xNTsKICAgIGNvbnN0IHN1YnJlcXVlc3RzQ29zdCA9IHN1bVN1YnJlcXVlc3RzMSAvIDEwMDAwMDAgKiAwLjE1OwogICAgY29uc3QgYWN0aXZlVGltZVNlY29uZHMgPSBzdW1BY3RpdmVUaW1lIC8gMTAwMCAvIDEwMDA7CiAgICBsZXQgYWN0aXZlR2JTZWNvbmRzID0gYWN0aXZlVGltZVNlY29uZHMgKiAxMjggLyAxMDI0OwogICAgaWYgKGV4Y2x1ZGVGcmVlVXNhZ2UpIHsKICAgICAgICBhY3RpdmVHYlNlY29uZHMgPSBNYXRoLm1heCgwLCBhY3RpdmVHYlNlY29uZHMgLSA0MDAwMDApOwogICAgfQogICAgY29uc3QgYWN0aXZlQ29zdCA9IGFjdGl2ZUdiU2Vjb25kcyAvIDQwMDAwMCAqIDEyLjUwOwogICAgY29uc3QgcmVhZFVuaXRzQ29zdCA9IChleGNsdWRlRnJlZVVzYWdlID8gTWF0aC5tYXgoMCwgc3VtU3RvcmFnZVJlYWRVbml0cyAtIDEwMDAwMDApIDogc3VtU3RvcmFnZVJlYWRVbml0cykgLyAxMDAwMDAwICogLjIwOwogICAgY29uc3Qgd3JpdGVVbml0c0Nvc3QgPSAoZXhjbHVkZUZyZWVVc2FnZSA/IE1hdGgubWF4KDAsIHN1bVN0b3JhZ2VXcml0ZVVuaXRzIC0gMTAwMDAwMCkgOiBzdW1TdG9yYWdlV3JpdGVVbml0cykgLyAxMDAwMDAwICogMTsKICAgIGNvbnN0IGRlbGV0ZXNDb3N0ID0gKGV4Y2x1ZGVGcmVlVXNhZ2UgPyBNYXRoLm1heCgwLCBzdW1TdG9yYWdlRGVsZXRlcyAtIDEwMDAwMDApIDogc3VtU3RvcmFnZURlbGV0ZXMpIC8gMTAwMDAwMCAqIDE7CiAgICBsZXQgbmV3U3RvcmFnZUNvc3QgPSBzdG9yYWdlQ29zdCB8fCAwOwogICAgaWYgKGV4Y2x1ZGVGcmVlVXNhZ2UpIG5ld1N0b3JhZ2VDb3N0ID0gTWF0aC5tYXgoMCwgbmV3U3RvcmFnZUNvc3QgLSAwLjIwKTsKICAgIGNvbnN0IHRvdGFsQ29zdCA9IHJlcXVlc3RzQ29zdCArIHdlYnNvY2tldHNDb3N0ICsgc3VicmVxdWVzdHNDb3N0ICsgYWN0aXZlQ29zdCArIHJlYWRVbml0c0Nvc3QgKyB3cml0ZVVuaXRzQ29zdCArIGRlbGV0ZXNDb3N0ICsgbmV3U3RvcmFnZUNvc3Q7CiAgICByZXR1cm4gewogICAgICAgIHJlcXVlc3RzQ29zdCwKICAgICAgICB3ZWJzb2NrZXRzQ29zdCwKICAgICAgICBzdWJyZXF1ZXN0c0Nvc3QsCiAgICAgICAgYWN0aXZlQ29zdCwKICAgICAgICByZWFkVW5pdHNDb3N0LAogICAgICAgIHdyaXRlVW5pdHNDb3N0LAogICAgICAgIGRlbGV0ZXNDb3N0LAogICAgICAgIHRvdGFsQ29zdCwKICAgICAgICBhY3RpdmVHYlNlY29uZHMsCiAgICAgICAgbmV3U3RvcmFnZUNvc3QKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gdHJ5TGlzdER1cmFibGVPYmplY3RzTmFtZXNwYWNlcyhwcm9maWxlKSB7CiAgICB0cnkgewogICAgICAgIHJldHVybiBhd2FpdCBsaXN0RHVyYWJsZU9iamVjdHNOYW1lc3BhY2VzKHByb2ZpbGUuYWNjb3VudElkLCBwcm9maWxlLmFwaVRva2VuKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oZSk7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQp9CmZ1bmN0aW9uIGNvbXB1dGVUb3RhbFJvdyhkYXRlLCByb3dzLCBvcHRzKSB7CiAgICBsZXQgY29tcHV0ZWRTdG9yYWdlQ29zdCA9IGZhbHNlOwogICAgY29uc3QgY29tcHV0ZVN0b3JhZ2VDb3N0T25jZSA9ICgpPT57CiAgICAgICAgY29uc3QgcnQgPSAhY29tcHV0ZWRTdG9yYWdlQ29zdCA/IG9wdHM/LnN0b3JhZ2VDb3N0IHx8IDAgOiAwOwogICAgICAgIGNvbXB1dGVkU3RvcmFnZUNvc3QgPSB0cnVlOwogICAgICAgIHJldHVybiBydDsKICAgIH07CiAgICByZXR1cm4gcm93cy5yZWR1Y2UoKGxocywgcmhzKT0+KHsKICAgICAgICAgICAgZGF0ZSwKICAgICAgICAgICAgc3VtUmVxdWVzdHM6IGxocy5zdW1SZXF1ZXN0cyArIHJocy5zdW1SZXF1ZXN0cywKICAgICAgICAgICAgcmVxdWVzdHNDb3N0OiBsaHMucmVxdWVzdHNDb3N0ICsgcmhzLnJlcXVlc3RzQ29zdCwKICAgICAgICAgICAgbWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnM6IGxocy5tYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucyArIHJocy5tYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucywKICAgICAgICAgICAgc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50OiBsaHMuc3VtSW5ib3VuZFdlYnNvY2tldE1zZ0NvdW50ICsgcmhzLnN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudDogbGhzLnN1bU91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQgKyByaHMuc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICAgICAgd2Vic29ja2V0c0Nvc3Q6IGxocy53ZWJzb2NrZXRzQ29zdCArIHJocy53ZWJzb2NrZXRzQ29zdCwKICAgICAgICAgICAgc3VtU3VicmVxdWVzdHM6IGxocy5zdW1TdWJyZXF1ZXN0cyArIHJocy5zdW1TdWJyZXF1ZXN0cywKICAgICAgICAgICAgc3VicmVxdWVzdHNDb3N0OiBsaHMuc3VicmVxdWVzdHNDb3N0ICsgcmhzLnN1YnJlcXVlc3RzQ29zdCwKICAgICAgICAgICAgc3VtQWN0aXZlVGltZTogbGhzLnN1bUFjdGl2ZVRpbWUgKyByaHMuc3VtQWN0aXZlVGltZSwKICAgICAgICAgICAgYWN0aXZlR2JTZWNvbmRzOiBsaHMuYWN0aXZlR2JTZWNvbmRzICsgcmhzLmFjdGl2ZUdiU2Vjb25kcywKICAgICAgICAgICAgYWN0aXZlQ29zdDogbGhzLmFjdGl2ZUNvc3QgKyByaHMuYWN0aXZlQ29zdCwKICAgICAgICAgICAgc3VtU3RvcmFnZVJlYWRVbml0czogbGhzLnN1bVN0b3JhZ2VSZWFkVW5pdHMgKyByaHMuc3VtU3RvcmFnZVJlYWRVbml0cywKICAgICAgICAgICAgcmVhZFVuaXRzQ29zdDogbGhzLnJlYWRVbml0c0Nvc3QgKyByaHMucmVhZFVuaXRzQ29zdCwKICAgICAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHM6IGxocy5zdW1TdG9yYWdlV3JpdGVVbml0cyArIHJocy5zdW1TdG9yYWdlV3JpdGVVbml0cywKICAgICAgICAgICAgd3JpdGVVbml0c0Nvc3Q6IGxocy53cml0ZVVuaXRzQ29zdCArIHJocy53cml0ZVVuaXRzQ29zdCwKICAgICAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXM6IGxocy5zdW1TdG9yYWdlRGVsZXRlcyArIHJocy5zdW1TdG9yYWdlRGVsZXRlcywKICAgICAgICAgICAgZGVsZXRlc0Nvc3Q6IGxocy5kZWxldGVzQ29zdCArIHJocy5kZWxldGVzQ29zdCwKICAgICAgICAgICAgc3RvcmFnZUdiOiBvcHRzPy5zdG9yYWdlR2IsCiAgICAgICAgICAgIHN0b3JhZ2VDb3N0OiBvcHRzPy5zdG9yYWdlQ29zdCwKICAgICAgICAgICAgdG90YWxDb3N0OiBsaHMudG90YWxDb3N0ICsgcmhzLnRvdGFsQ29zdCArIGNvbXB1dGVTdG9yYWdlQ29zdE9uY2UoKQogICAgICAgIH0pCiAgICApOwp9CmZ1bmN0aW9uIG11bHRpcGx5Um93KHJvdywgbXVsdGlwbGllcikgewogICAgcmV0dXJuIHsKICAgICAgICBkYXRlOiAnJywKICAgICAgICBzdW1SZXF1ZXN0czogcm93LnN1bVJlcXVlc3RzICogbXVsdGlwbGllciwKICAgICAgICByZXF1ZXN0c0Nvc3Q6IHJvdy5yZXF1ZXN0c0Nvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIG1heEFjdGl2ZVdlYnNvY2tldENvbm5lY3Rpb25zOiByb3cubWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudDogcm93LnN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudDogcm93LnN1bU91dGJvdW5kV2Vic29ja2V0TXNnQ291bnQgKiBtdWx0aXBsaWVyLAogICAgICAgIHdlYnNvY2tldHNDb3N0OiByb3cud2Vic29ja2V0c0Nvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bVN1YnJlcXVlc3RzOiByb3cuc3VtU3VicmVxdWVzdHMgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1YnJlcXVlc3RzQ29zdDogcm93LnN1YnJlcXVlc3RzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtQWN0aXZlVGltZTogcm93LnN1bUFjdGl2ZVRpbWUgKiBtdWx0aXBsaWVyLAogICAgICAgIGFjdGl2ZUdiU2Vjb25kczogcm93LmFjdGl2ZUdiU2Vjb25kcyAqIG11bHRpcGxpZXIsCiAgICAgICAgYWN0aXZlQ29zdDogcm93LmFjdGl2ZUNvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHM6IHJvdy5zdW1TdG9yYWdlUmVhZFVuaXRzICogbXVsdGlwbGllciwKICAgICAgICByZWFkVW5pdHNDb3N0OiByb3cucmVhZFVuaXRzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHM6IHJvdy5zdW1TdG9yYWdlV3JpdGVVbml0cyAqIG11bHRpcGxpZXIsCiAgICAgICAgd3JpdGVVbml0c0Nvc3Q6IHJvdy53cml0ZVVuaXRzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXM6IHJvdy5zdW1TdG9yYWdlRGVsZXRlcyAqIG11bHRpcGxpZXIsCiAgICAgICAgZGVsZXRlc0Nvc3Q6IHJvdy5kZWxldGVzQ29zdCAqIG11bHRpcGxpZXIsCiAgICAgICAgc3RvcmFnZUdiOiByb3cuc3RvcmFnZUdiID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByb3cuc3RvcmFnZUdiICogbXVsdGlwbGllciwKICAgICAgICBzdG9yYWdlQ29zdDogcm93LnN0b3JhZ2VDb3N0ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByb3cuc3RvcmFnZUNvc3QgKiBtdWx0aXBsaWVyLAogICAgICAgIHRvdGFsQ29zdDogcm93LnRvdGFsQ29zdCAqIG11bHRpcGxpZXIKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUVzdGltYXRlZDMwRGF5Um93KHJvd3MsIGV4Y2x1ZGVGcmVlVXNhZ2UsIG9wdHMpIHsKICAgIGlmIChyb3dzLmxlbmd0aCA8PSAxKSByZXR1cm4gdW5kZWZpbmVkOwogICAgY29uc3Qgc3VtID0gY29tcHV0ZVRvdGFsUm93KCcnLCByb3dzLnNsaWNlKDAsIC0xKSwgb3B0cyk7CiAgICBjb25zdCBkYXlzID0gcm93cy5sZW5ndGggLSAxOwogICAgY29uc3QgZXN0Um93ID0gbXVsdGlwbHlSb3coc3VtLCAzMCAvIGRheXMpOwogICAgY29uc3QgeyBzdW1SZXF1ZXN0cyAsIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCAsIHN1bVN1YnJlcXVlc3RzICwgc3VtU3RvcmFnZVJlYWRVbml0cyAsIHN1bVN0b3JhZ2VXcml0ZVVuaXRzICwgc3VtU3RvcmFnZURlbGV0ZXMgLCBzdW1BY3RpdmVUaW1lICwgbWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMgLCBzdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50ICwgc3RvcmFnZUdiICwgc3RvcmFnZUNvc3QgIH0gPSBlc3RSb3c7CiAgICBjb25zdCB7IHJlcXVlc3RzQ29zdCAsIHdlYnNvY2tldHNDb3N0ICwgc3VicmVxdWVzdHNDb3N0ICwgYWN0aXZlQ29zdCAsIHJlYWRVbml0c0Nvc3QgLCB3cml0ZVVuaXRzQ29zdCAsIGRlbGV0ZXNDb3N0ICwgdG90YWxDb3N0ICwgYWN0aXZlR2JTZWNvbmRzICwgbmV3U3RvcmFnZUNvc3QgIH0gPSBjb21wdXRlQ29zdHMoewogICAgICAgIHN1bVJlcXVlc3RzLAogICAgICAgIHN1bUluYm91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICBzdW1TdWJyZXF1ZXN0cywKICAgICAgICBzdW1BY3RpdmVUaW1lLAogICAgICAgIHN1bVN0b3JhZ2VSZWFkVW5pdHMsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHMsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXMsCiAgICAgICAgZXhjbHVkZUZyZWVVc2FnZSwKICAgICAgICBzdG9yYWdlQ29zdAogICAgfSk7CiAgICByZXR1cm4gewogICAgICAgIGRhdGU6ICcnLAogICAgICAgIHN1bVJlcXVlc3RzLAogICAgICAgIHJlcXVlc3RzQ29zdCwKICAgICAgICBtYXhBY3RpdmVXZWJzb2NrZXRDb25uZWN0aW9ucywKICAgICAgICBzdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQsCiAgICAgICAgc3VtT3V0Ym91bmRXZWJzb2NrZXRNc2dDb3VudCwKICAgICAgICB3ZWJzb2NrZXRzQ29zdCwKICAgICAgICBzdW1TdWJyZXF1ZXN0cywKICAgICAgICBzdWJyZXF1ZXN0c0Nvc3QsCiAgICAgICAgc3VtQWN0aXZlVGltZSwKICAgICAgICBhY3RpdmVHYlNlY29uZHMsCiAgICAgICAgYWN0aXZlQ29zdCwKICAgICAgICBzdW1TdG9yYWdlUmVhZFVuaXRzLAogICAgICAgIHJlYWRVbml0c0Nvc3QsCiAgICAgICAgc3VtU3RvcmFnZVdyaXRlVW5pdHMsCiAgICAgICAgd3JpdGVVbml0c0Nvc3QsCiAgICAgICAgc3VtU3RvcmFnZURlbGV0ZXMsCiAgICAgICAgZGVsZXRlc0Nvc3QsCiAgICAgICAgc3RvcmFnZUdiLAogICAgICAgIHN0b3JhZ2VDb3N0OiBuZXdTdG9yYWdlQ29zdCwKICAgICAgICB0b3RhbENvc3QKICAgIH07Cn0KZnVuY3Rpb24gdXRjQ3VycmVudERhdGUoKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7Cn0KZnVuY3Rpb24gYWRkRGF5c1RvRGF0ZShkYXRlLCBkYXlzKSB7CiAgICBjb25zdCBkID0gbmV3IERhdGUoYCR7ZGF0ZX1UMDA6MDA6MDBaYCk7CiAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpICsgZGF5cywgZC5nZXRIb3VycygpLCBkLmdldE1pbnV0ZXMoKSwgZC5nZXRTZWNvbmRzKCksIGQuZ2V0TWlsbGlzZWNvbmRzKCkpLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDEwKTsKfQpjbGFzcyBNYXRlcmlhbCB7CiAgICBzdGF0aWMgaGlnaEVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44NyknOwogICAgc3RhdGljIG1lZGl1bUVtcGhhc2lzVGV4dENvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC42MCknOwp9CmNvbnN0IE1BVEVSSUFMX0NTUyA9IGNzc2AKCjpyb290IHsKICAtLXN1cmZhY2UtMDEtYmFja2dyb3VuZC1jb2xvcjogcmdiKDMwLjc1LCAzMC43NSwgMzAuNzUpOwogIC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNDAuOTUsIDQwLjk1LCA0MC45NSk7CiAgLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44Nyk7CiAgLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYwKTsKICAtLWRpc2FibGVkLXRleHQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zOCk7CiAgLS1idXR0b24tYm9yZGVyLXJhZGl1czogMC4yNXJlbTsKICAtLXByaW1hcnktY29sb3I6ICNiYjg2ZmM7CiAgLS1iYWNrZ3JvdW5kLWNvbG9yOiAjMTIxMjEyOwogIC0tc2Fucy1zZXJpZi1mb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCBhdmVuaXIgbmV4dCwgYXZlbmlyLCBoZWx2ZXRpY2EgbmV1ZSwgaGVsdmV0aWNhLCBVYnVudHUsIHJvYm90bywgbm90bywgc2Vnb2UgdWksIGFyaWFsLCBzYW5zLXNlcmlmOwogIC0tbW9ub3NwYWNlLWZvbnQtZmFtaWx5OiBNZW5sbywgQ29uc29sYXMsIHVpLW1vbm9zcGFjZSwgbW9ub3NwYWNlOwp9CgovKiogdGV4dCBzaXplIGNsYXNzZXMgKi8KCi5oNiB7CiAgICBmb250LXNpemU6IDEuMjVyZW07CiAgICBsZXR0ZXItc3BhY2luZzogMC4wMDc1MHJlbTsKICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7Cn0KCi5ib2R5MiwgZmllbGRzZXQgbGFiZWwsIGZpZWxkc2V0IG91dHB1dCwgZmllbGRzZXQgZGV0YWlscyB7CiAgICBmb250LXNpemU6IDAuODc1cmVtOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDE3ODZyZW07CiAgICBmb250LXdlaWdodDogbm9ybWFsOwogICAgbGluZS1oZWlnaHQ6IDEuMjVyZW07Cn0KCi5idXR0b24sIGJ1dHRvbiwgLmFjdGlvbi1pY29uIHsKICAgIGZvbnQtc2l6ZTogMC44NzVyZW07CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMDg5MjlyZW07CiAgICBmb250LXdlaWdodDogYm9sZGVyOwp9Cgoub3ZlcmxpbmUsIHRoIHsKICAgIGZvbnQtc2l6ZTogMC42MjVyZW07CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDAuMTUwMDByZW07CiAgICBmb250LXdlaWdodDogbm9ybWFsOwp9CgouY2FwdGlvbiB7CiAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICBsZXR0ZXItc3BhY2luZzogMC4wMzMzM3JlbTsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7Cn0KCi8qIGxpZ2h0IHRleHQgb24gZGFyayBiYWNrZ3JvdW5kIGNvbG9ycyAqLwoKLmhpZ2gtZW1waGFzaXMtdGV4dCB7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKLm1lZGl1bS1lbXBoYXNpcy10ZXh0LCBmaWVsZHNldCBsYWJlbCwgdGggewogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKLmRpc2FibGVkLWVtcGhhc2lzLXRleHQgewogICAgY29sb3I6IHZhcigtLWRpc2FibGVkLXRleHQtY29sb3IpOwp9CgovKiogZWxldmF0aW9uIGJhY2tncm91bmRzICovCgouc3VyZmFjZS0wMSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwp9Cgouc3VyZmFjZS0wNCB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTA0LWJhY2tncm91bmQtY29sb3IpOwp9CgovKiogYWN0aW9uLWljb24gKi8KCi5hY3Rpb24taWNvbiB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgbWluLWhlaWdodDogMnJlbTsKICAgIG1pbi13aWR0aDogMnJlbTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgb3BhY2l0eTogMC42OTsgIC8qKiBtZWRpdW0tZW1waGFzaXMgLyBoaWdoLWVtcGhhc2lzICovCiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKQG1lZGlhIChob3ZlcjogaG92ZXIpIHsKICAgIC5hY3Rpb24taWNvbjpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICBvcGFjaXR5OiAxOwogICAgfQp9CgovKiogYnV0dG9uICovCgpidXR0b24gewogICAgYm9yZGVyOiBub25lOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wMS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgbWluLXdpZHRoOiA4cmVtOwogICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYnV0dG9uLWJvcmRlci1yYWRpdXMpOwp9CgpidXR0b24uc2VsZWN0ZWQgewogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wNC1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwp9CgpAbWVkaWEgKGhvdmVyKSB7CiAgICBidXR0b246aG92ZXIgewogICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtMDQtYmFja2dyb3VuZC1jb2xvcik7CiAgICAgICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICB9Cn0KCmJ1dHRvbjpkaXNhYmxlZCB7CiAgICBjb2xvcjogdmFyKC0tZGlzYWJsZWQtdGV4dC1jb2xvcik7Cn0KCkBtZWRpYSAoaG92ZXIpIHsKICAgIGJ1dHRvbjpkaXNhYmxlZDpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VyZmFjZS0wMS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICBjdXJzb3I6IGRlZmF1bHQ7CiAgICB9Cn0KCi8qKiBhbmNob3JzICovCgphIHsKICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsKICAgIHRleHQtdW5kZXJsaW5lLW9mZnNldDogMC4ycmVtOwogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwp9CgpAbWVkaWEgKGhvdmVyOiBob3ZlcikgewogICAgYTpob3ZlciB7CiAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgICB9Cn0KCi8qKiBmb3JtcyAqLwoKZmllbGRzZXQgewogICAgYm9yZGVyOiBzb2xpZCAxcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYwKTsKICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXJvdy1nYXA6IDFyZW07CiAgICBncmlkLWNvbHVtbi1nYXA6IDFyZW07CiAgICBwYWRkaW5nOiAxcmVtOwp9CgpsYWJlbCB7CiAgICBncmlkLWNvbHVtbjogMTsKICAgIHBhZGRpbmc6IDAuNXJlbSAwOwp9CgouZm9ybS1saHMgewogICAgZ3JpZC1jb2x1bW46IDE7Cn0KCmlucHV0LCAuZm9ybS1yaHMgewogICAgZ3JpZC1jb2x1bW46IDI7CiAgICBtaW4td2lkdGg6IDA7Cn0KCi5mb3JtLXJvdyB7CiAgICBncmlkLWNvbHVtbjogMSAvIHNwYW4gMjsKfQoKZmllbGRzZXQgaW5wdXRbdHlwZT10ZXh0XSB7CiAgICBwYWRkaW5nOiAwLjVyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLTAxLWJhY2tncm91bmQtY29sb3IpOwogICAgY29sb3I6IHZhcigtLWhpZ2gtZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBib3JkZXI6IHNvbGlkIDFweCB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7CiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1idXR0b24tYm9yZGVyLXJhZGl1cyk7Cn0KCmZpZWxkc2V0IG91dHB1dCB7CiAgICBwYWRkaW5nOiAwLjVyZW0gMDsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCmZpZWxkc2V0IGRldGFpbHMgewogICAgY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKYDsKY29uc3QgSEVBREVSX0hUTUwgPSBodG1sYAo8aGVhZGVyIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQiPgogICAgPGRpdiBpZD0iaGVhZGVyLWNvbnRlbnQiPgogICAgICAgIFdlYnRhaWwKICAgICAgICA8c3BhbiBpZD0iaGVhZGVyLXZlcnNpb24iIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9zcGFuPgogICAgICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9za3ltZXRob2QvZGVub2ZsYXJlIiB0YXJnZXQ9Il9ibGFuayIgaWQ9ImdpdGh1Yi1sb2dvLWFuY2hvciI+PGltZyBpZD0iZ2l0aHViLWxvZ28iPjwvYT4KICAgIDwvZGl2Pgo8L2hlYWRlcj4KYDsKY29uc3QgSEVBREVSX0NTUyA9IGNzc2AKaGVhZGVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxcmVtIDA7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKI2hlYWRlci1jb250ZW50IHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogYmFzZWxpbmU7CiAgICBwYWRkaW5nLXJpZ2h0OiAyLjJyZW07Cn0KCiNoZWFkZXItdmVyc2lvbiB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNnaXRodWItbG9nby1hbmNob3IgewogICAgbGluZS1oZWlnaHQ6IDA7CiAgICBvcGFjaXR5OiAwLjU7Cn0KCkBtZWRpYSAoaG92ZXI6IGhvdmVyKSB7CiAgICAjZ2l0aHViLWxvZ28tYW5jaG9yOmhvdmVyIHsKICAgICAgICBvcGFjaXR5OiAwLjc1OwogICAgfQp9CgojZ2l0aHViLWxvZ28gewogICAgd2lkdGg6IDFyZW07CiAgICBtYXJnaW4tYm90dG9tOiAtMC4xcmVtOwp9CgpgOwpmdW5jdGlvbiBpbml0SGVhZGVyKGRvY3VtZW50LCB2bTEsIGRhdGEzKSB7CiAgICBjb25zdCBoZWFkZXJDb250ZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItY29udGVudCcpOwogICAgaWYgKChkYXRhMy5mbGFncyB8fCAnJykuaW5jbHVkZXMoJ2RlbW8tdG9nZ2xlJykpIHsKICAgICAgICBoZWFkZXJDb250ZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIChlKT0+ewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZtMS50b2dnbGVEZW1vTW9kZSgpOwogICAgICAgIH0pOwogICAgfQogICAgY29uc3QgaGVhZGVyVmVyc2lvblNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhZGVyLXZlcnNpb24nKTsKICAgIGNvbnN0IHsgdmVyc2lvbiAgfSA9IGRhdGEzOwogICAgaGVhZGVyVmVyc2lvblNwYW4udGV4dENvbnRlbnQgPSB2ZXJzaW9uID8gYHYke3ZlcnNpb259YCA6ICcnOwogICAgY29uc3QgZ2l0aHViTG9nb0ltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnaXRodWItbG9nbycpOwogICAgZ2l0aHViTG9nb0ltZy5zcmMgPSBjb21wdXRlR2l0aHViTG9nb0RhdGFVcmwoKTsKICAgIHJldHVybiAoKT0+e307Cn0KZnVuY3Rpb24gY29tcHV0ZUdpdGh1YkxvZ29EYXRhVXJsKCkgewogICAgY29uc3Qgc3ZnMSA9IEdJVEhVQl9MT0dPLnJlcGxhY2UoJ2ZpbGw6d2hpdGU7JywgYGZpbGw6JHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9O2ApOwogICAgcmV0dXJuICdkYXRhOmltYWdlL3N2Zyt4bWw7dXRmOCwnICsgc3ZnMTsKfQpjb25zdCBHSVRIVUJfTE9HTyA9IGA8c3ZnIHdpZHRoPSJhdXRvIiBoZWlnaHQ9ImF1dG8iIHZpZXdCb3g9IjAgMCAxMzYgMTMzIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MjsiPgo8ZyB0cmFuc2Zvcm09Im1hdHJpeCg0LjE2NjY3LDAsMCw0LjE2NjY3LC01NjgsLTEzODEuMDYpIj4KICAgIDxwYXRoIGQ9Ik0xNTIuNjA4LDMzMS40NTVDMTQzLjYxNCwzMzEuNDU1IDEzNi4zMiwzMzguNzQ4IDEzNi4zMiwzNDcuNzQ1QzEzNi4zMiwzNTQuOTQyIDE0MC45ODcsMzYxLjA0NyAxNDcuNDYsMzYzLjIwMUMxNDguMjc1LDM2My4zNTEgMTQ4LjU3MiwzNjIuODQ4IDE0OC41NzIsMzYyLjQxNkMxNDguNTcyLDM2Mi4wMjkgMTQ4LjU1OCwzNjEuMDA1IDE0OC41NSwzNTkuNjQ2QzE0NC4wMTksMzYwLjYzIDE0My4wNjMsMzU3LjQ2MiAxNDMuMDYzLDM1Ny40NjJDMTQyLjMyMiwzNTUuNTggMTQxLjI1NCwzNTUuMDc5IDE0MS4yNTQsMzU1LjA3OUMxMzkuNzc1LDM1NC4wNjkgMTQxLjM2NiwzNTQuMDg5IDE0MS4zNjYsMzU0LjA4OUMxNDMuMDAxLDM1NC4yMDQgMTQzLjg2MSwzNTUuNzY4IDE0My44NjEsMzU1Ljc2OEMxNDUuMzE0LDM1OC4yNTcgMTQ3LjY3NCwzNTcuNTM4IDE0OC42MDIsMzU3LjEyMUMxNDguNzUsMzU2LjA2OSAxNDkuMTcxLDM1NS4zNTEgMTQ5LjYzNiwzNTQuOTQ0QzE0Ni4wMTksMzU0LjUzMyAxNDIuMjE2LDM1My4xMzUgMTQyLjIxNiwzNDYuODkzQzE0Mi4yMTYsMzQ1LjExNSAxNDIuODUxLDM0My42NiAxNDMuODkzLDM0Mi41MjJDMTQzLjcyNSwzNDIuMTEgMTQzLjE2NiwzNDAuNDUzIDE0NC4wNTMsMzM4LjIxMUMxNDQuMDUzLDMzOC4yMTEgMTQ1LjQyLDMzNy43NzMgMTQ4LjUzMiwzMzkuODgxQzE0OS44MzEsMzM5LjUxOSAxNTEuMjI1LDMzOS4zMzkgMTUyLjYxLDMzOS4zMzJDMTUzLjk5NCwzMzkuMzM5IDE1NS4zODcsMzM5LjUxOSAxNTYuNjg4LDMzOS44ODFDMTU5Ljc5OCwzMzcuNzczIDE2MS4xNjMsMzM4LjIxMSAxNjEuMTYzLDMzOC4yMTFDMTYyLjA1MiwzNDAuNDUzIDE2MS40OTMsMzQyLjExIDE2MS4zMjYsMzQyLjUyMkMxNjIuMzcsMzQzLjY2IDE2MywzNDUuMTE1IDE2MywzNDYuODkzQzE2MywzNTMuMTUxIDE1OS4xOTEsMzU0LjUyOCAxNTUuNTYzLDM1NC45MzFDMTU2LjE0NywzNTUuNDM0IDE1Ni42NjgsMzU2LjQyOCAxNTYuNjY4LDM1Ny45NDdDMTU2LjY2OCwzNjAuMTI1IDE1Ni42NDgsMzYxLjg4MiAxNTYuNjQ4LDM2Mi40MTZDMTU2LjY0OCwzNjIuODUyIDE1Ni45NDIsMzYzLjM1OSAxNTcuNzY4LDM2My4yQzE2NC4yMzYsMzYxLjA0MSAxNjguODk5LDM1NC45NCAxNjguODk5LDM0Ny43NDVDMTY4Ljg5OSwzMzguNzQ4IDE2MS42MDUsMzMxLjQ1NSAxNTIuNjA4LDMzMS40NTVaIiBzdHlsZT0iZmlsbDp3aGl0ZTsiLz4KPC9nPgo8L3N2Zz5gOwpmdW5jdGlvbiBhY3Rpb25JY29uKGljb24sIG9wdHMgPSB7fSkgewogICAgY29uc3QgeyB0ZXh0ICwgb25jbGljayAgfSA9IG9wdHM7CiAgICByZXR1cm4gaHRtbGA8ZGl2IGNsYXNzPSJhY3Rpb24taWNvbiIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIG9uY2xpY2sgJiYgb25jbGljaygpOwogICAgfX0+JHtpY29ufSR7dGV4dCB8fCAnJ308L2Rpdj5gOwp9CmNvbnN0IENMRUFSX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik01IDEzaDE0di0ySDV2MnptLTIgNGgxNHYtMkgzdjJ6TTcgN3YyaDE0VjdIN3oiLz48L3N2Zz5gOwpjb25zdCBFRElUX0lDT04gPSBzdmdgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBmaWxsPSIke01hdGVyaWFsLmhpZ2hFbXBoYXNpc1RleHRDb2xvcn0iPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xNC4wNiA5LjAybC45Mi45Mkw1LjkyIDE5SDV2LS45Mmw5LjA2LTkuMDZNMTcuNjYgM2MtLjI1IDAtLjUxLjEtLjcuMjlsLTEuODMgMS44MyAzLjc1IDMuNzUgMS44My0xLjgzYy4zOS0uMzkuMzktMS4wMiAwLTEuNDFsLTIuMzQtMi4zNGMtLjItLjItLjQ1LS4yOS0uNzEtLjI5em0tMy42IDMuMTlMMyAxNy4yNVYyMWgzLjc1TDE3LjgxIDkuOTRsLTMuNzUtMy43NXoiLz48L3N2Zz5gOwpjb25zdCBBRERfSUNPTiA9IHN2Z2A8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjQiIGZpbGw9IiR7TWF0ZXJpYWwuaGlnaEVtcGhhc2lzVGV4dENvbG9yfSI+PjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMFYweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xOSAxM2gtNnY2aC0ydi02SDV2LTJoNlY1aDJ2Nmg2djJ6Ii8+PC9zdmc+YDsKY29uc3QgQ0hFQ0tfQk9YX1VOQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgNXYxNEg1VjVoMTRtMC0ySDVjLTEuMSAwLTIgLjktMiAydjE0YzAgMS4xLjkgMiAyIDJoMTRjMS4xIDAgMi0uOSAyLTJWNWMwLTEuMS0uOS0yLTItMnoiLz48L3N2Zz5gOwpjb25zdCBDSEVDS19CT1hfQ0hFQ0tFRF9JQ09OID0gc3ZnYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgZmlsbD0iJHtNYXRlcmlhbC5oaWdoRW1waGFzaXNUZXh0Q29sb3J9Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bTAgMTZINVY1aDE0djE0ek0xNy45OSA5bC0xLjQxLTEuNDItNi41OSA2LjU5LTIuNTgtMi41Ny0xLjQyIDEuNDEgNCAzLjk5eiIvPjwvc3ZnPmA7CmNvbnN0IFNJREVCQVJfSFRNTCA9IGh0bWxgCjxkaXYgaWQ9InNpZGViYXIiPgogICAgJHtIRUFERVJfSFRNTH0KICAgIDxhIGlkPSJzaWRlYmFyLWFib3V0IiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiIGhyZWY9IiMiPkFib3V0PC9hPgogICAgPGRpdiBpZD0icHJvZmlsZXMiPjwvZGl2PgogICAgPGRpdiBpZD0ic2lkZWJhci1hbmFseXRpY3MiPjwvZGl2PgogICAgPGRpdiBpZD0ic2NyaXB0cyI+PC9kaXY+CjwvZGl2PgpgOwpjb25zdCBTSURFQkFSX0NTUyA9IGNzc2AKCiNzaWRlYmFyIHsKICAgIG1hcmdpbi1sZWZ0OiAxcmVtOwogICAgaGVpZ2h0OiAxMDB2aDsKICAgIG1pbi13aWR0aDogMTVyZW07Cn0KCiNzaWRlYmFyLWFib3V0IHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgbWFyZ2luLWJvdHRvbTogMXJlbTsKfQoKI3NpZGViYXIgLmJ1dHRvbi1ncmlkIHsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAycmVtOwogICAgZ3JpZC1nYXA6IDFweDsKICAgIG1hcmdpbi1sZWZ0OiAxcHg7CiAgICBtYXJnaW4tdG9wOiAxcmVtOwp9Cgojc2lkZWJhciAuYnV0dG9uLWdyaWQtbmV3IHsKICAgIGdyaWQtY29sdW1uOiAxOwogICAgbWluLXdpZHRoOiA4cmVtOwp9Cgojc2lkZWJhciBidXR0b24gewogICAgZ3JpZC1jb2x1bW46IDE7Cn0KCiNzaWRlYmFyIC5idXR0b24tZ3JpZCAuaGludCB7CiAgICBncmlkLWNvbHVtbjogMTsgCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNzY3JpcHRzLXNjcm9sbGVyIHsKICAgIGhlaWdodDogY2FsYygxMDB2aCAtIDI4cmVtKTsKfQoKI3NpZGViYXIgLmV4dHJhLXRvcC1tYXJnaW4gewogICAgbWFyZ2luLXRvcDogMXJlbTsKfQoKYDsKZnVuY3Rpb24gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtMiwgZGF0YTQpIHsKICAgIGNvbnN0IHVwZGF0ZUhlYWRlciA9IGluaXRIZWFkZXIoZG9jdW1lbnQsIHZtMiwgZGF0YTQpOwogICAgY29uc3QgYWJvdXRBbmNob3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhci1hYm91dCcpOwogICAgY29uc3QgcHJvZmlsZXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZXMnKTsKICAgIGNvbnN0IGFuYWx5dGljc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyLWFuYWx5dGljcycpOwogICAgY29uc3Qgc2NyaXB0c0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JpcHRzJyk7CiAgICBhYm91dEFuY2hvci5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMi5zaG93QWJvdXQoKTsKICAgIH07CiAgICByZXR1cm4gKCk9PnsKICAgICAgICB1cGRhdGVIZWFkZXIoKTsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihQUk9GSUxFU19IVE1MKHZtMiksIHByb2ZpbGVzRGl2KTsKICAgICAgICBMaXRFbGVtZW50LnJlbmRlcihBTkFMWVRJQ1NfSFRNTCh2bTIpLCBhbmFseXRpY3NEaXYpOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKFNDUklQVFNfSFRNTCh2bTIpLCBzY3JpcHRzRGl2KTsKICAgIH07Cn0KY29uc3QgUFJPRklMRVNfSFRNTCA9ICh2bTMpPT5odG1sYAogICAgPGRpdiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPlByb2ZpbGVzPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJidXR0b24tZ3JpZCI+CiAgICAgICAgJHt2bTMucHJvZmlsZXMubWFwKChwcm9maWxlKT0+aHRtbGA8YnV0dG9uIAogICAgICAgICAgICBjbGFzcz0iJHtwcm9maWxlLmlkID09PSB2bTMuc2VsZWN0ZWRQcm9maWxlSWQgPyAnc2VsZWN0ZWQnIDogJyd9IiAKICAgICAgICAgICAgQGNsaWNrPSR7KCk9PnsKICAgICAgICAgICAgdm0zLnNlbGVjdGVkUHJvZmlsZUlkID0gcHJvZmlsZS5pZDsKICAgICAgICB9fQogICAgICAgICAgICA/ZGlzYWJsZWQ9IiR7dm0zLnByb2ZpbGVGb3JtLnNob3dpbmd9Ij4ke3Byb2ZpbGUudGV4dH08L2J1dHRvbj4KICAgICAgICAke3Byb2ZpbGUuaWQgPT09IHZtMy5zZWxlY3RlZFByb2ZpbGVJZCA/IGh0bWxgJHthY3Rpb25JY29uKEVESVRfSUNPTiwgewogICAgICAgICAgICBvbmNsaWNrOiAoKT0+dm0zLmVkaXRQcm9maWxlKHByb2ZpbGUuaWQpCiAgICAgICAgfSl9YCA6ICcnfWAKICAgICl9CiAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQtbmV3Ij4ke2FjdGlvbkljb24oQUREX0lDT04sIHsKICAgICAgICB0ZXh0OiAnTmV3JywKICAgICAgICBvbmNsaWNrOiAoKT0+dm0zLm5ld1Byb2ZpbGUoKQogICAgfSl9PC9kaXY+CiAgICA8L2Rpdj4KYAo7CmNvbnN0IEFOQUxZVElDU19IVE1MID0gKHZtNCk9Pmh0bWxgCiAgICA8ZGl2IGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCBleHRyYS10b3AtbWFyZ2luIj5BbmFseXRpY3M8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncmlkIj4KICAgICAgICAke3ZtNC5hbmFseXRpY3MubWFwKChhbmFseXRpYyk9Pmh0bWxgPGJ1dHRvbgogICAgICAgICAgICAgICAgY2xhc3M9IiR7dm00LnNlbGVjdGVkQW5hbHl0aWNJZCA9PT0gYW5hbHl0aWMuaWQgPyAnc2VsZWN0ZWQnIDogJyd9IiAKICAgICAgICAgICAgICAgIEBjbGljaz0keygpPT52bTQuc2hvd0FuYWx5dGljKGFuYWx5dGljLmlkKQogICAgICAgIH0gCiAgICAgICAgICAgICAgICA/ZGlzYWJsZWQ9IiR7dm00LnByb2ZpbGVGb3JtLnNob3dpbmd9Ij4ke2FuYWx5dGljLnRleHR9PC9idXR0b24+CiAgICAgICAgYAogICAgKX0KICAgIDwvZGl2PgpgCjsKY29uc3QgU0NSSVBUU19IVE1MID0gKHZtNSk9Pmh0bWxgCiAgICA8ZGl2IGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCBleHRyYS10b3AtbWFyZ2luIj5TY3JpcHRzPC9kaXY+CiAgICA8ZGl2IGlkPSJzY3JpcHRzLXNjcm9sbGVyIiBjbGFzcz0iaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCI+CiAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyaWQiPgogICAgICAgICAgICAke3ZtNS5zY3JpcHRzLm1hcCgoc2NyaXB0KT0+aHRtbGA8YnV0dG9uCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9IiR7dm01LnNlbGVjdGVkU2NyaXB0SWRzLmhhcyhzY3JpcHQuaWQpID8gJ3NlbGVjdGVkJyA6ICcnfSIgCiAgICAgICAgICAgICAgICAgICAgQGNsaWNrPSR7KGUpPT5oYW5kbGVTY3JpcHRDbGljayhlLCBzY3JpcHQuaWQsIHZtNSkKICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgID9kaXNhYmxlZD0iJHt2bTUucHJvZmlsZUZvcm0uc2hvd2luZ30iPiR7c2NyaXB0LnRleHR9PC9idXR0b24+CiAgICAgICAgICAgIGAKICAgICl9CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncmlkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXB0aW9uIG1lZGl1bS1lbXBoYXNpcy10ZXh0IGhpbnQiPiR7Y29tcHV0ZU11bHRpc2VsZWN0S2V5Q2hhcigpfS1jbGljayB0byBtdWx0aXNlbGVjdDwvZGl2PgogICAgPC9kaXY+CmAKOwpmdW5jdGlvbiBjb21wdXRlTXVsdGlzZWxlY3RLZXlDaGFyKCkgewogICAgcmV0dXJuIGlzTWFjaW50b3NoKCkgPyAn4oyYJyA6ICdjdHJsJzsKfQpmdW5jdGlvbiBpc01hY2ludG9zaCgpIHsKICAgIHJldHVybiBuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZignTWFjJykgPiAtMTsKfQpmdW5jdGlvbiBoYW5kbGVTY3JpcHRDbGljayhlLCBzY3JpcHRJZCwgdm02KSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBuZXdTY3JpcHRJZHMgPSBuZXcgU2V0KFsKICAgICAgICBzY3JpcHRJZAogICAgXSk7CiAgICBjb25zdCBtdWx0aSA9IGlzTWFjaW50b3NoKCkgPyBlLm1ldGFLZXkgOiBlLmN0cmxLZXk7CiAgICB2bTYuc2VsZWN0ZWRTY3JpcHRJZHMgPSBtdWx0aSA/IHZtNi5zZWxlY3RlZFNjcmlwdElkcy5oYXMoc2NyaXB0SWQpID8gc2V0U3VidHJhY3Qodm02LnNlbGVjdGVkU2NyaXB0SWRzLCBuZXdTY3JpcHRJZHMpIDogc2V0VW5pb24odm02LnNlbGVjdGVkU2NyaXB0SWRzLCBuZXdTY3JpcHRJZHMpIDogbmV3U2NyaXB0SWRzOwp9CmNsYXNzIEFwcENvbnN0YW50cyB7CiAgICBzdGF0aWMgV0VCU09DS0VUX1BJTkdfSU5URVJWQUxfU0VDT05EUyA9IDEwOwogICAgc3RhdGljIElOQUNUSVZFX1RBSUxfU0VDT05EUyA9IDU7Cn0KY2xhc3MgVGFpbENvbnRyb2xsZXIgewogICAgY2FsbGJhY2tzOwogICAgcmVjb3JkcyA9IG5ldyBNYXAoKTsKICAgIHdlYnNvY2tldFBpbmdJbnRlcnZhbFNlY29uZHM7CiAgICBpbmFjdGl2ZVRhaWxTZWNvbmRzOwogICAgdGFpbE9wdGlvbnMgPSB7CiAgICAgICAgZmlsdGVyczogW10KICAgIH07CiAgICBvbmxpbmU7CiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja3MsIG9wdHMpewogICAgICAgIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzOwogICAgICAgIHRoaXMud2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA9IG9wdHMud2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kczsKICAgICAgICB0aGlzLmluYWN0aXZlVGFpbFNlY29uZHMgPSBvcHRzLmluYWN0aXZlVGFpbFNlY29uZHM7CiAgICAgICAgY29uc3QgbmF2aWdhdG9yQXNBbnkgPSB3aW5kb3cubmF2aWdhdG9yOwogICAgICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yQXNBbnkub25MaW5lID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgdGhpcy5zZXRPbmxpbmUobmF2aWdhdG9yQXNBbnkub25MaW5lKTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsICgpPT50aGlzLnNldE9ubGluZSh0cnVlKQogICAgICAgICk7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCAoKT0+dGhpcy5zZXRPbmxpbmUoZmFsc2UpCiAgICAgICAgKTsKICAgIH0KICAgIHNldFRhaWxPcHRpb25zKHRhaWxPcHRpb25zKSB7CiAgICAgICAgY29uc29sZS5sb2coYFRhaWxDb250cm9sbGVyLnNldFRhaWxPcHRpb25zICR7SlNPTi5zdHJpbmdpZnkodGFpbE9wdGlvbnMpfWApOwogICAgICAgIHRoaXMudGFpbE9wdGlvbnMgPSB0YWlsT3B0aW9uczsKICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiB0aGlzLnJlY29yZHMudmFsdWVzKCkpewogICAgICAgICAgICBpZiAocmVjb3JkLmNvbm5lY3Rpb24pIHsKICAgICAgICAgICAgICAgIHJlY29yZC5jb25uZWN0aW9uLnNldE9wdGlvbnModGFpbE9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgc2V0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbiwgc2NyaXB0SWRzKSB7CiAgICAgICAgY29uc3Qgc3RvcEtleXMgPSBzZXRTdWJ0cmFjdCh0aGlzLmNvbXB1dGVTdGFydGluZ09yU3RhcnRlZFRhaWxLZXlzKCksIG5ldyBTZXQoWwogICAgICAgICAgICAuLi5zY3JpcHRJZHMKICAgICAgICBdLm1hcCgodik9PnBhY2tUYWlsS2V5KGFjY291bnRJZCwgdikKICAgICAgICApKSk7CiAgICAgICAgZm9yIChjb25zdCBzdG9wS2V5IG9mIHN0b3BLZXlzKXsKICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gdGhpcy5yZWNvcmRzLmdldChzdG9wS2V5KTsKICAgICAgICAgICAgcmVjb3JkLnN0YXRlID0gJ2luYWN0aXZlJzsKICAgICAgICAgICAgcmVjb3JkLnN0b3BSZXF1ZXN0ZWRUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ2luYWN0aXZlJyAmJiByZWNvcmQuc3RvcFJlcXVlc3RlZFRpbWUgJiYgRGF0ZS5ub3coKSAtIHJlY29yZC5zdG9wUmVxdWVzdGVkVGltZSA+PSB0aGlzLmluYWN0aXZlVGFpbFNlY29uZHMpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmQuc3RhdGUgPSAnc3RvcHBpbmcnOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTdG9wcGluZyAke3JlY29yZC5zY3JpcHRJZH0sIGluYWN0aXZlIGZvciAke0RhdGUubm93KCkgLSByZWNvcmQuc3RvcFJlcXVlc3RlZFRpbWV9bXNgKTsKICAgICAgICAgICAgICAgICAgICByZWNvcmQuY29ubmVjdGlvbj8uY2xvc2UoMTAwMCwgJ25vIGxvbmdlciBpbnRlcmVzdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvcmRzLmRlbGV0ZShyZWNvcmQudGFpbEtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMuaW5hY3RpdmVUYWlsU2Vjb25kcyAqIDEwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc3RvcEtleXMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaFRhaWxzQ2hhbmdlZCgpOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IHNjcmlwdElkIG9mIHNjcmlwdElkcyl7CiAgICAgICAgICAgIGNvbnN0IHRhaWxLZXkgPSBwYWNrVGFpbEtleShhY2NvdW50SWQsIHNjcmlwdElkKTsKICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdSZWNvcmQgPSB0aGlzLnJlY29yZHMuZ2V0KHRhaWxLZXkpOwogICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmQpIHsKICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1JlY29yZC5zdGF0ZSA9PT0gJ2luYWN0aXZlJykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXZpdmluZyBpbmFjdGl2ZSAke3NjcmlwdElkfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhpc3RpbmdSZWNvcmQuc3RhdGUgPSAnc3RhcnRlZCc7CiAgICAgICAgICAgICAgICBleGlzdGluZ1JlY29yZC5zdG9wUmVxdWVzdGVkVGltZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ3N0YXJ0aW5nJywKICAgICAgICAgICAgICAgICAgICB0YWlsS2V5LAogICAgICAgICAgICAgICAgICAgIGFwaVRva2VuLAogICAgICAgICAgICAgICAgICAgIGFjY291bnRJZCwKICAgICAgICAgICAgICAgICAgICBzY3JpcHRJZCwKICAgICAgICAgICAgICAgICAgICByZXRyeUNvdW50QWZ0ZXJDbG9zZTogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb3Jkcy5zZXQodGFpbEtleSwgcmVjb3JkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpOwogICAgICAgICAgICAgICAgcmVjb3JkLnN0YXRlID0gJ3N0YXJ0ZWQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hUYWlsc0NoYW5nZWQoKTsKICAgICAgICB9CiAgICB9CiAgICBkaXNwYXRjaFRhaWxzQ2hhbmdlZCgpIHsKICAgICAgICBjb25zdCB0YWlsS2V5cyA9IG5ldyBTZXQoWwogICAgICAgICAgICAuLi50aGlzLnJlY29yZHMudmFsdWVzKCkKICAgICAgICBdLmZpbHRlcigodik9PnYuc3RhdGUgPT09ICdzdGFydGVkJwogICAgICAgICkubWFwKCh2KT0+di50YWlsS2V5CiAgICAgICAgKSk7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsc0NoYW5nZWQodGFpbEtleXMpOwogICAgfQogICAgY29tcHV0ZVN0YXJ0aW5nT3JTdGFydGVkVGFpbEtleXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXQoWwogICAgICAgICAgICAuLi50aGlzLnJlY29yZHMudmFsdWVzKCkKICAgICAgICBdLmZpbHRlcigodik9PnYuc3RhdGUgPT09ICdzdGFydGluZycgfHwgdi5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnCiAgICAgICAgKS5tYXAoKHYpPT52LnRhaWxLZXkKICAgICAgICApKTsKICAgIH0KICAgIHNldE9ubGluZShvbmxpbmUpIHsKICAgICAgICBpZiAob25saW5lID09PSB0aGlzLm9ubGluZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IG9sZE9ubGluZSA9IHRoaXMub25saW5lOwogICAgICAgIHRoaXMub25saW5lID0gb25saW5lOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uTmV0d29ya1N0YXR1c0NoYW5nZWQob25saW5lKTsKICAgICAgICBpZiAodHlwZW9mIG9sZE9ubGluZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIGlmIChvbmxpbmUpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHRoaXMucmVjb3Jkcy52YWx1ZXMoKSl7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgYWNjb3VudElkICwgc2NyaXB0SWQgIH0gPSByZWNvcmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpLmNhdGNoKChlKT0+dGhpcy5jYWxsYmFja3Mub25UYWlsRmFpbGVkVG9TdGFydChhY2NvdW50SWQsIHNjcmlwdElkLCAncmVzdGFydC1hZnRlci1jb21pbmctb25saW5lJywgZSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiB0aGlzLnJlY29yZHMudmFsdWVzKCkpewogICAgICAgICAgICAgICAgICAgIHJlY29yZC5jb25uZWN0aW9uPy5jbG9zZSgxMDAwLCAnb2ZmbGluZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpIHsKICAgICAgICBjb25zdCBhbGxvd2VkVG9TdGFydCA9IHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0aW5nJyB8fCByZWNvcmQuc3RhdGUgPT09ICdzdGFydGVkJzsKICAgICAgICBpZiAoIWFsbG93ZWRUb1N0YXJ0KSByZXR1cm47CiAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBzY3JpcHRJZCAgfSA9IHVucGFja1RhaWxLZXkocmVjb3JkLnRhaWxLZXkpOwogICAgICAgIGNvbnN0IHsgYXBpVG9rZW4gIH0gPSByZWNvcmQ7CiAgICAgICAgaWYgKCFyZWNvcmQudGFpbCB8fCBEYXRlLm5vdygpID4gbmV3IERhdGUocmVjb3JkLnRhaWwuZXhwaXJlc19hdCkuZ2V0VGltZSgpIC0gMTAwMCAqIDYwICogNSkgewogICAgICAgICAgICBjb25zdCB0YWlsQ3JlYXRpbmdUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ3JlYXRpbmcoYWNjb3VudElkLCBzY3JpcHRJZCk7CiAgICAgICAgICAgIGNvbnN0IHRhaWwgPSBhd2FpdCBjcmVhdGVUYWlsKGFjY291bnRJZCwgc2NyaXB0SWQsIGFwaVRva2VuKTsKICAgICAgICAgICAgcmVjb3JkLnRhaWwgPSB0YWlsOwogICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDcmVhdGVkKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCkgLSB0YWlsQ3JlYXRpbmdUaW1lLCB0YWlsKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ2luYWN0aXZlJykgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgY2FsbGJhY2tzICwgd2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgZGlzID0gdGhpczsKICAgICAgICBjb25zdCBvcGVuaW5nVGltZSA9IERhdGUubm93KCk7CiAgICAgICAgY29uc3QgdGFpbENvbm5lY3Rpb25DYWxsYmFja3MgPSB7CiAgICAgICAgICAgIG9uT3BlbiAoX2NuLCB0aW1lU3RhbXApIHsKICAgICAgICAgICAgICAgIHJlY29yZC5yZXRyeUNvdW50QWZ0ZXJDbG9zZSA9IDA7CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk9wZW4oYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBEYXRlLm5vdygpIC0gb3BlbmluZ1RpbWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkNsb3NlIChfY24sIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbikgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25DbG9zZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGNvZGUsIHJlYXNvbiwgd2FzQ2xlYW4pOwogICAgICAgICAgICAgICAgcmVjb3JkLmNsb3NlVGltZSA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXRlID09PSAnc3RhcnRlZCcgJiYgZGlzLm9ubGluZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmQucmV0cnlDb3VudEFmdGVyQ2xvc2UrKzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWxheVNlY29uZHMgPSBNYXRoLm1pbihyZWNvcmQucmV0cnlDb3VudEFmdGVyQ2xvc2UgKiA1LCA2MCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFdpbGwgYXR0ZW1wdCB0byByZXN0YXJ0ICR7c2NyaXB0SWR9IGluICR7ZGVsYXlTZWNvbmRzfSBzZWNvbmRzYCk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkaXMuc3RhcnRUYWlsQ29ubmVjdGlvbihyZWNvcmQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgZGVsYXlTZWNvbmRzICogMTAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uRXJyb3IgKF9jbiwgdGltZVN0YW1wLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uRXJyb3IoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBlcnJvckluZm8pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxNZXNzYWdlIChfY24sIHRpbWVTdGFtcCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5zdGF0ZSAhPT0gJ3N0YXJ0ZWQnKSByZXR1cm47CiAgICAgICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBtZXNzYWdlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25VbnBhcnNlZE1lc3NhZ2UgKF9jbiwgdGltZVN0YW1wLCBtZXNzYWdlLCBwYXJzZUVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb25VbnBhcnNlZE1lc3NhZ2UnLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpOwogICAgICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25VbnBhcnNlZE1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBtZXNzYWdlLCBwYXJzZUVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmVjb3JkLmNvbm5lY3Rpb24gPSBuZXcgVGFpbENvbm5lY3Rpb24ocmVjb3JkLnRhaWwudXJsLCB0YWlsQ29ubmVjdGlvbkNhbGxiYWNrcywgewogICAgICAgICAgICB3ZWJzb2NrZXRQaW5nSW50ZXJ2YWxTZWNvbmRzCiAgICAgICAgfSkuc2V0T3B0aW9ucyh0aGlzLnRhaWxPcHRpb25zKTsKICAgIH0KfQpmdW5jdGlvbiB1bnBhY2tUYWlsS2V5KHRhaWxLZXkpIHsKICAgIGNvbnN0IG0gPSAvXihbXlxzLV0rKS0oW15cc10rKSQvLmV4ZWModGFpbEtleSk7CiAgICBpZiAoIW0pIHRocm93IG5ldyBFcnJvcihgQmFkIHRhaWxLZXk6ICR7dGFpbEtleX1gKTsKICAgIHJldHVybiB7CiAgICAgICAgYWNjb3VudElkOiBtWzFdLAogICAgICAgIHNjcmlwdElkOiBtWzJdCiAgICB9Owp9CmZ1bmN0aW9uIHBhY2tUYWlsS2V5KGFjY291bnRJZCwgc2NyaXB0SWQpIHsKICAgIHJldHVybiBgJHthY2NvdW50SWR9LSR7c2NyaXB0SWR9YDsKfQpjbGFzcyBTd2l0Y2hhYmxlVGFpbENvbnRyb2xsZXJDYWxsYmFja3MgewogICAgY2FsbGJhY2tzOwogICAgZW5hYmxlZEZuOwogICAgY29uc3RydWN0b3IoY2FsbGJhY2tzLCBlbmFibGVkRm4pewogICAgICAgIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzOwogICAgICAgIHRoaXMuZW5hYmxlZEZuID0gZW5hYmxlZEZuOwogICAgfQogICAgb25UYWlsQ3JlYXRpbmcoYWNjb3VudElkLCBzY3JpcHRJZCkgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENyZWF0aW5nKGFjY291bnRJZCwgc2NyaXB0SWQpOwogICAgfQogICAgb25UYWlsQ3JlYXRlZChhY2NvdW50SWQsIHNjcmlwdElkLCB0b29rTWlsbGlzLCB0YWlsKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ3JlYXRlZChhY2NvdW50SWQsIHNjcmlwdElkLCB0b29rTWlsbGlzLCB0YWlsKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25PcGVuKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgdG9va01pbGxpcykgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25PcGVuKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgdG9va01pbGxpcyk7CiAgICB9CiAgICBvblRhaWxDb25uZWN0aW9uQ2xvc2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBjb2RlLCByZWFzb24sIHdhc0NsZWFuKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbkNsb3NlKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbik7CiAgICB9CiAgICBvblRhaWxDb25uZWN0aW9uRXJyb3IoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBlcnJvckluZm8pIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uRXJyb3IoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBlcnJvckluZm8pOwogICAgfQogICAgb25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBtZXNzYWdlKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBtZXNzYWdlKTsKICAgIH0KICAgIG9uVGFpbENvbm5lY3Rpb25VbnBhcnNlZE1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgdGltZVN0YW1wLCBtZXNzYWdlLCBwYXJzZUVycm9yKSB7CiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRGbigpKSByZXR1cm47CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvblVucGFyc2VkTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIG1lc3NhZ2UsIHBhcnNlRXJyb3IpOwogICAgfQogICAgb25UYWlsc0NoYW5nZWQodGFpbHMpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxzQ2hhbmdlZCh0YWlscyk7CiAgICB9CiAgICBvbk5ldHdvcmtTdGF0dXNDaGFuZ2VkKG9ubGluZSkgewogICAgICAgIGlmICghdGhpcy5lbmFibGVkRm4oKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uTmV0d29ya1N0YXR1c0NoYW5nZWQob25saW5lKTsKICAgIH0KICAgIG9uVGFpbEZhaWxlZFRvU3RhcnQoYWNjb3VudElkLCBzY3JpcHRJZCwgdHJpZ2dlciwgZXJyb3IpIHsKICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEZuKCkpIHJldHVybjsKICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblRhaWxGYWlsZWRUb1N0YXJ0KGFjY291bnRJZCwgc2NyaXB0SWQsIHRyaWdnZXIsIGVycm9yKTsKICAgIH0KfQpjbGFzcyBEZW1vTW9kZSB7CiAgICBzdGF0aWMgcHJvZmlsZXMgPSBbCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3Byb2ZpbGUxJywKICAgICAgICAgICAgdGV4dDogJ2NvcnAtcHJvZmlsZScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdwcm9maWxlMicsCiAgICAgICAgICAgIHRleHQ6ICdwZXJzLXByb2ZpbGUnCiAgICAgICAgfSwgCiAgICBdOwogICAgc3RhdGljIHNlbGVjdGVkUHJvZmlsZUlkID0gJ3Byb2ZpbGUxJzsKICAgIHN0YXRpYyBzZXRTZWxlY3RlZFByb2ZpbGVJZChfdmFsdWUpIHt9CiAgICBzdGF0aWMgc2NyaXB0cyA9IFsKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAnc2NyaXB0MScsCiAgICAgICAgICAgIHRleHQ6ICd3b3JrZXIxLWRldicKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQyJywKICAgICAgICAgICAgdGV4dDogJ3dvcmtlcjEtcHJvZCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQzJywKICAgICAgICAgICAgdGV4dDogJ3dvcmtlcjItZGV2JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDQnLAogICAgICAgICAgICB0ZXh0OiAnd29ya2VyMi1iZXRhJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDUnLAogICAgICAgICAgICB0ZXh0OiAnd29ya2VyMi1wcm9kJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogJ3NjcmlwdDYnLAogICAgICAgICAgICB0ZXh0OiAnZHVyYWJsZS1vYmplY3QtZGVtbycKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICdzY3JpcHQ3JywKICAgICAgICAgICAgdGV4dDogJ3NlY3JldC1hcHAnCiAgICAgICAgfSwgCiAgICBdOwogICAgc3RhdGljIHNlbGVjdGVkU2NyaXB0SWRzID0gbmV3IFNldChbCiAgICAgICAgJ3NjcmlwdDcnLAogICAgICAgICdzY3JpcHQ0JwogICAgXSk7CiAgICBzdGF0aWMgc2V0U2VsZWN0ZWRTY3JpcHRJZHMoX3NjcmlwdElkcykge30KICAgIHN0YXRpYyB0YWlscyA9IG5ldyBTZXQoKTsKICAgIHN0YXRpYyBsb2dGYWtlT3V0cHV0KGNhbGxiYWNrcykgewogICAgICAgIGNvbnN0IGFjY291bnRJZCA9ICcxNWE3ZmEzYTM3MjU0ZmU0YTdjYWRkMWJiMjc2Mjg3OSc7CiAgICAgICAgY29uc3Qgc2NyaXB0SWQgPSAnc2VjcmV0LWFwcCc7CiAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENyZWF0aW5nKGFjY291bnRJZCwgc2NyaXB0SWQpOwogICAgICAgIGNvbnN0IHRhaWwgPSB7CiAgICAgICAgICAgIGlkOiAnZGIxOWViOGJlOWY0NDQzYWFiOTFhOTA0MmMwZDM1MTcnLAogICAgICAgICAgICB1cmw6ICd3c3M6Ly90YWlsLmRldmVsb3BlcnMud29ya2Vycy5kZXYvZGIxOWViOGJlOWY0NDQzYWFiOTFhOTA0MmMwZDM1MTcnLAogICAgICAgICAgICAnZXhwaXJlc19hdCc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgIH07CiAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENyZWF0ZWQoYWNjb3VudElkLCBzY3JpcHRJZCwgMTU1LCB0YWlsKTsKICAgICAgICBjYWxsYmFja3Mub25UYWlsc0NoYW5nZWQobmV3IFNldChbCiAgICAgICAgICAgIHBhY2tUYWlsS2V5KGFjY291bnRJZCwgc2NyaXB0SWQpCiAgICAgICAgXSkpOwogICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uT3BlbihhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCA0Mik7CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDI7IGkrKyl7CiAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCBjb21wdXRlRmFrZVJlcXVlc3QoKSk7CiAgICAgICAgICAgIGNhbGxiYWNrcy5vblRhaWxDb25uZWN0aW9uTWVzc2FnZShhY2NvdW50SWQsIHNjcmlwdElkLCBEYXRlLm5vdygpLCBjb21wdXRlRmFrZURvUmVxdWVzdCgpKTsKICAgICAgICAgICAgY2FsbGJhY2tzLm9uVGFpbENvbm5lY3Rpb25NZXNzYWdlKGFjY291bnRJZCwgc2NyaXB0SWQsIERhdGUubm93KCksIGNvbXB1dGVGYWtlUmVxdWVzdFdpdGhMb2dzKCkpOwogICAgICAgICAgICBjYWxsYmFja3Mub25UYWlsQ29ubmVjdGlvbk1lc3NhZ2UoYWNjb3VudElkLCBzY3JpcHRJZCwgRGF0ZS5ub3coKSwgY29tcHV0ZUZha2VSZXF1ZXN0RXhjZWVkaW5nVGltZUxpbWl0KCkpOwogICAgICAgIH0KICAgIH0KfQpjb25zdCBVU0VSX0FHRU5UID0gJ01vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwLjE1OyBydjo5MS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzkxLjAnOwpmdW5jdGlvbiBjb21wdXRlRmFrZVJlcXVlc3QoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL2VuZHBvaW50JywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ2NmLWNvbm5lY3RpbmctaXAnOiAnMjAzLjAuMTEzLjEyJywKICAgICAgICAgICAgICAgICAgICAndXNlci1hZ2VudCc6IFVTRVJfQUdFTlQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZjogewogICAgICAgICAgICAgICAgICAgIGNvbG86ICdERlcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFtdLAogICAgICAgIGV4Y2VwdGlvbnM6IFtdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdvaycKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gY29tcHV0ZUZha2VEb1JlcXVlc3QoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2Zha2UtaG9zdC9wdXQnLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdsb2cnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgbWVzc2FnZTogWwogICAgICAgICAgICAgICAgICAgICdsb2dwcm9wczonLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sbzogJ0VXUicsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmFibGVPYmplY3RDbGFzczogJ0xvZ2dlckRPJywKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYWJsZU9iamVjdElkOiAnNTM4ZmM3Y2U1NWIxNGU1M2I2Yjg1NTJiZWZlYjlhZjQnLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhYmxlT2JqZWN0TmFtZTogJ2xvZzEnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV4Y2VwdGlvbnM6IFtdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdvaycKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gY29tcHV0ZUZha2VSZXF1ZXN0V2l0aExvZ3MoKSB7CiAgICBjb25zdCBydCA9IHsKICAgICAgICBldmVudDogewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL215LXdvcmtlci5zdWJkb21haW4ud29ya2Vycy5kZXYvdGVzdD9sb2c9dHJ1ZScsCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICdjZi1jb25uZWN0aW5nLWlwJzogJzIwMy4wLjExMy4xMicsCiAgICAgICAgICAgICAgICAgICAgJ3VzZXItYWdlbnQnOiBVU0VSX0FHRU5UCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2Y6IHsKICAgICAgICAgICAgICAgICAgICBjb2xvOiAnREZXJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsb2dzOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldmVsOiAnbG9nJywKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFsKICAgICAgICAgICAgICAgICAgICAnTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3RldHVyIGFkaXBpc2NpbmcgZWxpdCcKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldmVsOiAnaW5mbycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldmVsOiAnd2FybmluZycsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldmVsOiAnZGVidWcnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgbWVzc2FnZTogWwogICAgICAgICAgICAgICAgICAgICdMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzY2luZyBlbGl0JwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LCAKICAgICAgICBdLAogICAgICAgIGV4Y2VwdGlvbnM6IFtdLAogICAgICAgIGV2ZW50VGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgIG91dGNvbWU6ICdvaycKICAgIH07CiAgICByZXR1cm4gcnQ7Cn0KZnVuY3Rpb24gY29tcHV0ZUZha2VSZXF1ZXN0RXhjZWVkaW5nVGltZUxpbWl0KCkgewogICAgY29uc3QgcnQgPSB7CiAgICAgICAgZXZlbnQ6IHsKICAgICAgICAgICAgcmVxdWVzdDogewogICAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9teS13b3JrZXIuc3ViZG9tYWluLndvcmtlcnMuZGV2L2NvbXB1dGUtZGlnaXRzLW9mLXBpJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ2NmLWNvbm5lY3RpbmctaXAnOiAnMjAzLjAuMTEzLjEyJywKICAgICAgICAgICAgICAgICAgICAndXNlci1hZ2VudCc6IFVTRVJfQUdFTlQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjZjogewogICAgICAgICAgICAgICAgICAgIGNvbG86ICdERlcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvZ3M6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV2ZWw6ICdsb2cnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgbWVzc2FnZTogWwogICAgICAgICAgICAgICAgICAgICdidXJuaW5nIGNwdScKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwgCiAgICAgICAgXSwKICAgICAgICBleGNlcHRpb25zOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdFcnJvcicsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnV29ya2VyIGV4Y2VlZGVkIENQVSB0aW1lIGxpbWl0LicKICAgICAgICAgICAgfSwgCiAgICAgICAgXSwKICAgICAgICBldmVudFRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICBvdXRjb21lOiAnZXhjZWVkZWRDcHUnCiAgICB9OwogICAgcmV0dXJuIHJ0Owp9CmNsYXNzIFFwc0NvbnRyb2xsZXIgewogICAgc29ydGVkRXZlbnRUaW1lcyA9IFtdOwogICAgY2FsbGJhY2tzOwogICAgbjsKICAgIF9xcHMgPSAwOwogICAgZ2V0IHFwcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcXBzOwogICAgfQogICAgY29uc3RydWN0b3IobiwgY2FsbGJhY2tzKXsKICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrczsKICAgICAgICB0aGlzLm4gPSBuOwogICAgfQogICAgYWRkRXZlbnQoZXZlbnRUaW1lKSB7CiAgICAgICAgY29uc3QgcXBzID0gY29tcHV0ZVFwcyh0aGlzLm4sIHRoaXMuc29ydGVkRXZlbnRUaW1lcywgZXZlbnRUaW1lKTsKICAgICAgICBpZiAocXBzID09PSB0aGlzLl9xcHMpIHJldHVybjsKICAgICAgICB0aGlzLl9xcHMgPSBxcHM7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25RcHNDaGFuZ2VkKHFwcyk7CiAgICB9Cn0KZnVuY3Rpb24gY29tcHV0ZVFwcyhuLCBzb3J0ZWRFdmVudFRpbWVzLCBldmVudFRpbWUpIHsKICAgIGFkZChldmVudFRpbWUsIHNvcnRlZEV2ZW50VGltZXMpOwogICAgd2hpbGUoc29ydGVkRXZlbnRUaW1lcy5sZW5ndGggPiBuKXsKICAgICAgICBzb3J0ZWRFdmVudFRpbWVzLnNoaWZ0KCk7CiAgICB9CiAgICBjb25zdCBudW0gPSBzb3J0ZWRFdmVudFRpbWVzLmxlbmd0aDsKICAgIGlmIChudW0gPCAyKSByZXR1cm4gMDsKICAgIGNvbnN0IHRpbWVEaWZmU2Vjb25kcyA9IChzb3J0ZWRFdmVudFRpbWVzW3NvcnRlZEV2ZW50VGltZXMubGVuZ3RoIC0gMV0gLSBzb3J0ZWRFdmVudFRpbWVzWzBdKSAvIDEwMDA7CiAgICByZXR1cm4gKG51bSAtIDEpIC8gdGltZURpZmZTZWNvbmRzOwp9CmZ1bmN0aW9uIGFkZChlbCwgYXJyKSB7CiAgICBhcnIuc3BsaWNlKGZpbmRMb2MoZWwsIGFycikgKyAxLCAwLCBlbCk7CiAgICByZXR1cm4gYXJyOwp9CmZ1bmN0aW9uIGZpbmRMb2MoZWwsIGFyciwgc3QsIGVuKSB7CiAgICBzdCA9IHN0IHx8IDA7CiAgICBlbiA9IGVuIHx8IGFyci5sZW5ndGg7CiAgICBmb3IobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKXsKICAgICAgICBpZiAoYXJyW2ldID4gZWwpIHsKICAgICAgICAgICAgcmV0dXJuIGkgLSAxOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbjsKfQpjbGFzcyBXZWJ0YWlsQXBwVk0gewogICAgX3Byb2ZpbGVzID0gW107CiAgICBnZXQgcHJvZmlsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVtb01vZGUgPyBEZW1vTW9kZS5wcm9maWxlcyA6IHRoaXMuX3Byb2ZpbGVzOwogICAgfQogICAgZ2V0IHJlYWxQcm9maWxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvZmlsZXM7CiAgICB9CiAgICBfc2VsZWN0ZWRQcm9maWxlSWQ7CiAgICBnZXQgc2VsZWN0ZWRQcm9maWxlSWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVtb01vZGUgPyBEZW1vTW9kZS5zZWxlY3RlZFByb2ZpbGVJZCA6IHRoaXMuX3NlbGVjdGVkUHJvZmlsZUlkOwogICAgfQogICAgc2V0IHNlbGVjdGVkUHJvZmlsZUlkKHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHsKICAgICAgICAgICAgRGVtb01vZGUuc2V0U2VsZWN0ZWRQcm9maWxlSWQodmFsdWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdmFsdWUpIHJldHVybjsKICAgICAgICB0aGlzLl9zZWxlY3RlZFByb2ZpbGVJZCA9IHZhbHVlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkID0gdmFsdWU7CiAgICAgICAgc2F2ZVN0YXRlKHRoaXMuc3RhdGUpOwogICAgICAgIHRoaXMuZmluZFNjcmlwdHMoKTsKICAgIH0KICAgIF9hbmFseXRpY3MgPSBbCiAgICAgICAgewogICAgICAgICAgICBpZDogJ2R1cmFibGUtb2JqZWN0cycsCiAgICAgICAgICAgIHRleHQ6ICdEdXJhYmxlIE9iamVjdHMnLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0RhaWx5IG1ldHJpY3MgYW5kIGFzc29jaWF0ZWQgY29zdHMnCiAgICAgICAgfQogICAgXTsKICAgIGdldCBhbmFseXRpY3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FuYWx5dGljczsKICAgIH0KICAgIF9zZWxlY3RlZEFuYWx5dGljSWQ7CiAgICBnZXQgc2VsZWN0ZWRBbmFseXRpY0lkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZEFuYWx5dGljSWQ7CiAgICB9CiAgICBhbmFseXRpY3NTdGF0ZSA9IHsKICAgICAgICBxdWVyeWluZzogZmFsc2UKICAgIH07CiAgICBfc2NyaXB0cyA9IFtdOwogICAgZ2V0IHNjcmlwdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVtb01vZGUgPyBEZW1vTW9kZS5zY3JpcHRzIDogdGhpcy5fc2NyaXB0czsKICAgIH0KICAgIF9zZWxlY3RlZFNjcmlwdElkcyA9IG5ldyBTZXQoKTsKICAgIGdldCBzZWxlY3RlZFNjcmlwdElkcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZW1vTW9kZSA/IERlbW9Nb2RlLnNlbGVjdGVkU2NyaXB0SWRzIDogdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHM7CiAgICB9CiAgICBzZXQgc2VsZWN0ZWRTY3JpcHRJZHMoc2NyaXB0SWRzKSB7CiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkQW5hbHl0aWNJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkQW5hbHl0aWNJZCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgewogICAgICAgICAgICBEZW1vTW9kZS5zZXRTZWxlY3RlZFNjcmlwdElkcyhzY3JpcHRJZHMpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChzZXRFcXVhbCh0aGlzLl9zZWxlY3RlZFNjcmlwdElkcywgc2NyaXB0SWRzKSkgcmV0dXJuOwogICAgICAgIHRoaXMuX3NlbGVjdGVkU2NyaXB0SWRzID0gbmV3IFNldChzY3JpcHRJZHMpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCAmJiB0aGlzLnN0YXRlLnByb2ZpbGVzW3RoaXMuc2VsZWN0ZWRQcm9maWxlSWRdOwogICAgICAgIGlmIChwcm9maWxlKSB7CiAgICAgICAgICAgIHByb2ZpbGUuc2VsZWN0ZWRTY3JpcHRJZHMgPSBbCiAgICAgICAgICAgICAgICAuLi5zY3JpcHRJZHMKICAgICAgICAgICAgXTsKICAgICAgICAgICAgc2F2ZVN0YXRlKHRoaXMuc3RhdGUpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNldFRhaWxzKCk7CiAgICB9CiAgICBwcm9maWxlRm9ybSA9IG5ldyBQcm9maWxlRm9ybVZNKCk7CiAgICBmaWx0ZXJGb3JtID0gbmV3IEZpbHRlckZvcm1WTSgpOwogICAgZmlsdGVyID0ge307CiAgICBleHRyYUZpZWxkcyA9IFtdOwogICAgX3RhaWxzID0gbmV3IFNldCgpOwogICAgZ2V0IHRhaWxzKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlbW9Nb2RlID8gRGVtb01vZGUudGFpbHMgOiB0aGlzLl90YWlsczsKICAgIH0KICAgIHNldCB0YWlscyh0YWlscykgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSBEZW1vTW9kZS50YWlscyA9IHRhaWxzOwogICAgICAgIHRoaXMuX3RhaWxzID0gdGFpbHM7CiAgICB9CiAgICB3ZWxjb21lU2hvd2luZyA9IGZhbHNlOwogICAgYWJvdXRTaG93aW5nID0gZmFsc2U7CiAgICBzdGF0ZSA9IGxvYWRTdGF0ZSgpOwogICAgdGFpbENvbnRyb2xsZXI7CiAgICB0YWlsQ29udHJvbGxlckNhbGxiYWNrczsKICAgIHFwc0NvbnRyb2xsZXI7CiAgICBkZW1vTW9kZSA9IGZhbHNlOwogICAgb25DaGFuZ2UgPSAoKT0+e307CiAgICBsb2dnZXIgPSAoKT0+e307CiAgICBvblJlc2V0T3V0cHV0ID0gKCk9Pnt9OwogICAgb25RcHNDaGFuZ2UgPSAoKT0+e307CiAgICBjb25zdHJ1Y3RvcigpewogICAgICAgIGNvbnN0IGRpcyA9IHRoaXM7CiAgICAgICAgdGhpcy5xcHNDb250cm9sbGVyID0gbmV3IFFwc0NvbnRyb2xsZXIoMjAsIHsKICAgICAgICAgICAgb25RcHNDaGFuZ2VkIChxcHMpIHsKICAgICAgICAgICAgICAgIGlmIChkaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGRpcy5vblFwc0NoYW5nZShxcHMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgbG9nVGFpbHNDaGFuZ2UgPSAoYWN0aW9uLCB0YWlsS2V5cyk9PnsKICAgICAgICAgICAgaWYgKHRhaWxLZXlzLnNpemUgPiAwKSB0aGlzLmxvZ1dpdGhQcmVmaXgoYCR7YWN0aW9ufSAke1sKICAgICAgICAgICAgICAgIC4uLnRhaWxLZXlzCiAgICAgICAgICAgIF0ubWFwKCh2KT0+dW5wYWNrVGFpbEtleSh2KS5zY3JpcHRJZAogICAgICAgICAgICApLnNvcnQoKS5qb2luKCcsICcpfWApOwogICAgICAgIH07CiAgICAgICAgY29uc3QgbG9nV2l0aFByZWZpeCA9IHRoaXMubG9nV2l0aFByZWZpeC5iaW5kKHRoaXMpOwogICAgICAgIGNvbnN0IHZlcmJvc2VXaXRoUHJlZml4ID0gdGhpcy52ZXJib3NlV2l0aFByZWZpeC5iaW5kKHRoaXMpOwogICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHsKICAgICAgICAgICAgb25UYWlsQ3JlYXRpbmcgKF9hY2NvdW50SWQsIHNjcmlwdElkKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgQ3JlYXRpbmcgdGFpbCBmb3IgJHtzY3JpcHRJZH0uLi5gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ3JlYXRlZCAoX2FjY291bnRJZCwgc2NyaXB0SWQsIHRvb2tNaWxsaXMsIHRhaWwpIHsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBDcmVhdGVkIHRhaWwgZm9yICR7c2NyaXB0SWR9IGluICR7dG9va01pbGxpc31tcywgJHtKU09OLnN0cmluZ2lmeSh0YWlsKX1gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbk9wZW4gKF9hY2NvdW50SWQsIHNjcmlwdElkLCBfdGltZVN0YW1wLCB0b29rTWlsbGlzKSB7CiAgICAgICAgICAgICAgICB2ZXJib3NlV2l0aFByZWZpeChgT3BlbmVkIHRhaWwgZm9yICR7c2NyaXB0SWR9IGluICR7dG9va01pbGxpc31tc2ApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uQ2xvc2UgKGFjY291bnRJZCwgc2NyaXB0SWQsIHRpbWVTdGFtcCwgY29kZSwgcmVhc29uLCB3YXNDbGVhbikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVGFpbENvbm5lY3Rpb25DbG9zZScsIHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQsCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQsCiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgICAgcmVhc29uLAogICAgICAgICAgICAgICAgICAgIHdhc0NsZWFuCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBDbG9zZWQgdGFpbCBmb3IgJHtzY3JpcHRJZH0sICR7SlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgICAgcmVhc29uLAogICAgICAgICAgICAgICAgICAgIHdhc0NsZWFuCiAgICAgICAgICAgICAgICB9KX1gKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25UYWlsQ29ubmVjdGlvbkVycm9yIChhY2NvdW50SWQsIHNjcmlwdElkLCB0aW1lU3RhbXAsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVGFpbENvbm5lY3Rpb25FcnJvcicsIHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQsCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQsCiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgIGVycm9ySW5mbwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsb2dXaXRoUHJlZml4KGBFcnJvciBpbiB0YWlsIGZvciAke3NjcmlwdElkfWAsIHsKICAgICAgICAgICAgICAgICAgICBlcnJvckluZm8KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uTWVzc2FnZSAoX2FjY291bnRJZCwgX3NjcmlwdElkLCBfdGltZVN0YW1wLCBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBpZiAoY29tcHV0ZU1lc3NhZ2VQYXNzZXNGaWx0ZXIobWVzc2FnZSwgZGlzLmZpbHRlcikpIHsKICAgICAgICAgICAgICAgICAgICBkdW1wTWVzc2FnZVByZXR0eShtZXNzYWdlLCBkaXMubG9nZ2VyLCBkaXMuY29tcHV0ZUFkZGl0aW9uYWxMb2dzKG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGRpcy5xcHNDb250cm9sbGVyLmFkZEV2ZW50KG1lc3NhZ2UuZXZlbnRUaW1lc3RhbXApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxDb25uZWN0aW9uVW5wYXJzZWRNZXNzYWdlIChfYWNjb3VudElkLCBzY3JpcHRJZCwgX3RpbWVTdGFtcCwgbWVzc2FnZSwgcGFyc2VFcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7CiAgICAgICAgICAgICAgICBsb2dXaXRoUHJlZml4KGBVbnBhcnNlZCBtZXNzYWdlIGluIHRhaWwgZm9yICR7c2NyaXB0SWR9YCwgcGFyc2VFcnJvci5zdGFjayB8fCBwYXJzZUVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxzQ2hhbmdlZCAodGFpbHMpIHsKICAgICAgICAgICAgICAgIGlmIChzZXRFcXVhbChkaXMudGFpbHMsIHRhaWxzKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlZCA9IHNldFN1YnRyYWN0KGRpcy50YWlscywgdGFpbHMpOwogICAgICAgICAgICAgICAgbG9nVGFpbHNDaGFuZ2UoJ1VudGFpbGluZycsIHJlbW92ZWQpOwogICAgICAgICAgICAgICAgY29uc3QgYWRkZWQgPSBzZXRTdWJ0cmFjdCh0YWlscywgZGlzLnRhaWxzKTsKICAgICAgICAgICAgICAgIGxvZ1RhaWxzQ2hhbmdlKCdUYWlsaW5nJywgYWRkZWQpOwogICAgICAgICAgICAgICAgZGlzLnRhaWxzID0gdGFpbHM7CiAgICAgICAgICAgICAgICBkaXMub25DaGFuZ2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25OZXR3b3JrU3RhdHVzQ2hhbmdlZCAob25saW5lKSB7CiAgICAgICAgICAgICAgICBpZiAob25saW5lKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeCgnJWNPTkxJTkUlYycsICdjb2xvcjogZ3JlZW4nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nV2l0aFByZWZpeCgnJWNPRkZMSU5FJWMnLCAnY29sb3I6IHJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvblRhaWxGYWlsZWRUb1N0YXJ0IChfYWNjb3VudElkLCBzY3JpcHRJZCwgdHJpZ2dlciwgZXJyb3IpIHsKICAgICAgICAgICAgICAgIHZlcmJvc2VXaXRoUHJlZml4KGBUYWlsIGZvciAke3NjcmlwdElkfSBmYWlsZWQgdG8gc3RhcnQgKCR7dHJpZ2dlcn0pOiAke2Vycm9yLm5hbWV9ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3Qgd2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcyA9IEFwcENvbnN0YW50cy5XRUJTT0NLRVRfUElOR19JTlRFUlZBTF9TRUNPTkRTOwogICAgICAgIGNvbnN0IGluYWN0aXZlVGFpbFNlY29uZHMgPSBBcHBDb25zdGFudHMuSU5BQ1RJVkVfVEFJTF9TRUNPTkRTOwogICAgICAgIHRoaXMudGFpbENvbnRyb2xsZXIgPSBuZXcgVGFpbENvbnRyb2xsZXIobmV3IFN3aXRjaGFibGVUYWlsQ29udHJvbGxlckNhbGxiYWNrcyhjYWxsYmFja3MsICgpPT4hdGhpcy5kZW1vTW9kZQogICAgICAgICksIHsKICAgICAgICAgICAgd2Vic29ja2V0UGluZ0ludGVydmFsU2Vjb25kcywKICAgICAgICAgICAgaW5hY3RpdmVUYWlsU2Vjb25kcwogICAgICAgIH0pOwogICAgICAgIHRoaXMudGFpbENvbnRyb2xsZXJDYWxsYmFja3MgPSBjYWxsYmFja3M7CiAgICAgICAgdGhpcy5leHRyYUZpZWxkcyA9IFsKICAgICAgICAgICAgLi4udGhpcy5zdGF0ZS5leHRyYUZpZWxkcyB8fCBbXQogICAgICAgIF07CiAgICAgICAgdGhpcy5maWx0ZXIgPSB0aGlzLnN0YXRlLmZpbHRlciB8fCB7fTsKICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgc2F2ZTogZmFsc2UKICAgICAgICB9KTsKICAgIH0KICAgIHN0YXJ0KCkgewogICAgICAgIHRoaXMucmVsb2FkUHJvZmlsZXMoKTsKICAgICAgICB0aGlzLnJlY29tcHV0ZVdlbGNvbWVTaG93aW5nKCk7CiAgICAgICAgdGhpcy5wZXJmb3JtSW5pdGlhbFNlbGVjdGlvbigpOwogICAgfQogICAgbmV3UHJvZmlsZSgpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgewogICAgICAgICAgICBpZiAodGhpcy53ZWxjb21lU2hvd2luZykge30gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5wcm9maWxlSWQgPSBnZW5lcmF0ZVV1aWQoKTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0udGl0bGUgPSAnTmV3IFByb2ZpbGUnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ubmFtZSA9IHRoaXMuX3Byb2ZpbGVzLmxlbmd0aCA9PT0gMCA/ICdkZWZhdWx0JyA6IGBwcm9maWxlJHt0aGlzLl9wcm9maWxlcy5sZW5ndGggKyAxfWA7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5hY2NvdW50SWQgPSAnJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmFwaVRva2VuID0gJyc7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5kZWxldGVWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSAnJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGVkaXRQcm9maWxlKHByb2ZpbGVJZCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbcHJvZmlsZUlkXTsKICAgICAgICBpZiAoIXByb2ZpbGUpIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSAke3Byb2ZpbGVJZH0gbm90IGZvdW5kYCk7CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRQcm9maWxlSWQgPSBwcm9maWxlSWQ7CiAgICAgICAgY29uc3QgeyBuYW1lICwgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ucHJvZmlsZUlkID0gcHJvZmlsZUlkOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS50aXRsZSA9ICdFZGl0IFByb2ZpbGUnOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5hY2NvdW50SWQgPSBhY2NvdW50SWQ7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5hcGlUb2tlbiA9IGFwaVRva2VuOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uZGVsZXRlVmlzaWJsZSA9IHRydWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSAnJzsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLmNvbXB1dGVTYXZlRW5hYmxlZCgpOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGRlbGV0ZVByb2ZpbGUocHJvZmlsZUlkKSB7CiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZSBwcm9maWxlJywgcHJvZmlsZUlkKTsKICAgICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdOwogICAgICAgIGlmICghcHJvZmlsZSkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlICR7cHJvZmlsZUlkfSBub3QgZm91bmRgKTsKICAgICAgICBkZWxldGUgdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdOwogICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICB0aGlzLnByb2ZpbGVGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLnJlbG9hZFByb2ZpbGVzKCk7CiAgICAgICAgdGhpcy5yZWNvbXB1dGVXZWxjb21lU2hvd2luZygpOwogICAgICAgIHRoaXMucGVyZm9ybUluaXRpYWxTZWxlY3Rpb24oKTsKICAgIH0KICAgIGNhbmNlbFByb2ZpbGUoKSB7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2V0UHJvZmlsZU5hbWUobmFtZSkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0ubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5jb21wdXRlU2F2ZUVuYWJsZWQoKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBzZXRQcm9maWxlQWNjb3VudElkKGFjY291bnRJZCkgewogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uYWNjb3VudElkID0gYWNjb3VudElkOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2V0UHJvZmlsZUFwaVRva2VuKGFwaVRva2VuKSB7CiAgICAgICAgdGhpcy5wcm9maWxlRm9ybS5hcGlUb2tlbiA9IGFwaVRva2VuOwogICAgICAgIHRoaXMucHJvZmlsZUZvcm0uY29tcHV0ZVNhdmVFbmFibGVkKCk7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2F2ZVByb2ZpbGUoKSB7CiAgICAgICAgY29uc3QgeyBwcm9maWxlRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgeyBwcm9maWxlSWQgIH0gPSBwcm9maWxlRm9ybTsKICAgICAgICBjb25zdCBuZXdQcm9maWxlID0gewogICAgICAgICAgICBuYW1lOiBwcm9maWxlRm9ybS5uYW1lLnRyaW0oKSwKICAgICAgICAgICAgYWNjb3VudElkOiBwcm9maWxlRm9ybS5hY2NvdW50SWQudHJpbSgpLAogICAgICAgICAgICBhcGlUb2tlbjogcHJvZmlsZUZvcm0uYXBpVG9rZW4udHJpbSgpCiAgICAgICAgfTsKICAgICAgICB0aGlzLnRyeVNhdmVQcm9maWxlKHByb2ZpbGVJZCwgbmV3UHJvZmlsZSk7CiAgICB9CiAgICBlZGl0RXZlbnRGaWx0ZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGZpbHRlckZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkTmFtZSA9ICdFdmVudCB0eXBlOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdhbGwnLAogICAgICAgICAgICAgICAgdGV4dDogJ0FsbCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdjcm9uJywKICAgICAgICAgICAgICAgIHRleHQ6ICdDUk9OIHRyaWdnZXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlkOiAnaHR0cCcsCiAgICAgICAgICAgICAgICB0ZXh0OiAnSFRUUCByZXF1ZXN0JwogICAgICAgICAgICB9LCAKICAgICAgICBdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBmaWx0ZXIuZXZlbnQxID09PSAnaHR0cCcgPyAnaHR0cCcgOiBmaWx0ZXIuZXZlbnQxID09PSAnY3JvbicgPyAnY3JvbicgOiAnYWxsJzsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gJ0Nob29zZSB3aGljaCB0eXBlcyBvZiBldmVudHMgdG8gc2hvdyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5ldmVudDEgPT09IGZpbHRlckZvcm0uZmllbGRWYWx1ZSkgcmV0dXJuOwogICAgICAgICAgICBmaWx0ZXIuZXZlbnQxID0gZmlsdGVyRm9ybS5maWVsZFZhbHVlOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkQ2hvaWNlVGV4dCA9IGZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMuZmluZCgodik9PnYuaWQgPT09IGZpbHRlckZvcm0uZmllbGRWYWx1ZQogICAgICAgICAgICApLnRleHQ7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgRXZlbnQgdHlwZSBmaWx0ZXIgY2hhbmdlZCB0bzogJHtzZWxlY3RlZENob2ljZVRleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U3RhdHVzRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnU3RhdHVzOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdhbGwnLAogICAgICAgICAgICAgICAgdGV4dDogJ0FsbCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWQ6ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgIHRleHQ6ICdTdWNjZXNzJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZDogJ2Vycm9yJywKICAgICAgICAgICAgICAgIHRleHQ6ICdFcnJvcicKICAgICAgICAgICAgfSwgCiAgICAgICAgXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmlsdGVyLnN0YXR1czEgPT09ICdzdWNjZXNzJyA/ICdzdWNjZXNzJyA6IGZpbHRlci5zdGF0dXMxID09PSAnZXJyb3InID8gJ2Vycm9yJyA6ICdhbGwnOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnU2hvdyBldmVudHMgdGhpcyB0aGlzIHN0YXR1cyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5zdGF0dXMxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLnN0YXR1czEgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRDaG9pY2VUZXh0ID0gZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcy5maW5kKCh2KT0+di5pZCA9PT0gZmlsdGVyRm9ybS5maWVsZFZhbHVlCiAgICAgICAgICAgICkudGV4dDsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBTdGF0dXMgZmlsdGVyIGNoYW5nZWQgdG86ICR7c2VsZWN0ZWRDaG9pY2VUZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdElwQWRkcmVzc0ZpbHRlcigpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyICwgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgaXNWYWxpZElwQWRkcmVzcyA9IChpcEFkZHJlc3MpPT57CiAgICAgICAgICAgIHJldHVybiAvXihzZWxmfFtcZFwuOmEtZl17Myx9KSQvLnRlc3QoaXBBZGRyZXNzKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGNoZWNrVmFsaWRJcEFkZHJlc3MgPSAoaXBBZGRyZXNzKT0+ewogICAgICAgICAgICBpZiAoIWlzVmFsaWRJcEFkZHJlc3MoaXBBZGRyZXNzKSkgdGhyb3cgbmV3IEVycm9yKGBCYWQgaXAgYWRkcmVzczogJHtpcEFkZHJlc3N9YCk7CiAgICAgICAgICAgIHJldHVybiBpcEFkZHJlc3M7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBwYXJzZUZpbHRlcklwQWRkcmVzc2VzRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2MSA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2MSA9PT0gJycpIHJldHVybiBbXTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KHYxLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICApLmZpbHRlcigodik9PnYgIT09ICcnCiAgICAgICAgICAgICkubWFwKGNoZWNrVmFsaWRJcEFkZHJlc3MpKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUZpbHRlcklwQWRkcmVzc2VzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5pcEFkZHJlc3MxIHx8IFtdKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0lQIGFkZHJlc3Mocyk6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUZpbHRlcklwQWRkcmVzc2VzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9IGAnc2VsZicgdG8gZmlsdGVyIHlvdXIgb3duIGFkZHJlc3MsIGNvbW1hLXNlcGFyYXRlZCBpZiBtdWx0aXBsZSwgZS5nLiBzZWxmLCAxLjEuMS4xYDsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmlsdGVySXBBZGRyZXNzZXNGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldChmaWx0ZXIuaXBBZGRyZXNzMSB8fCBbXSksIG5ldyBTZXQobmV3VmFsdWUpKSkgcmV0dXJuOwogICAgICAgICAgICBmaWx0ZXIuaXBBZGRyZXNzMSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBuZXdWYWx1ZS5sZW5ndGggPT09IDAgPyAnYW55IElQIGFkZHJlc3MnIDogbmV3VmFsdWUuam9pbignLCAnKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBJUCBhZGRyZXNzIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0TWV0aG9kRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBjb25zdCBwYXJzZUZpbHRlck1ldGhvZHNGcm9tRmllbGRWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHsgZmllbGRWYWx1ZSAgfSA9IGZpbHRlckZvcm07CiAgICAgICAgICAgIGNvbnN0IHYyID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYyID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QodjIuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKS50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICkuZmlsdGVyKCh2KT0+diAhPT0gJycKICAgICAgICAgICAgKSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJNZXRob2RzID0gKCk9PnsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KGZpbHRlci5tZXRob2QxIHx8IFtdKS5tYXAoKHYpPT52LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0hUVFAgTWV0aG9kKHMpOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJNZXRob2RzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9ICdjb21tYS1zZXBhcmF0ZWQgaWYgbXVsdGlwbGUsIGUuZy4gR0VULCBQT1NUJzsKICAgICAgICBmaWx0ZXJGb3JtLmFwcGx5VmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmlsdGVyTWV0aG9kc0Zyb21GaWVsZFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzZXRFcXVhbChuZXcgU2V0KGZpbHRlci5tZXRob2QxIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZSkpKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5tZXRob2QxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlLmxlbmd0aCA9PT0gMCA/ICdhbnkgbWV0aG9kJyA6IG5ld1ZhbHVlLmpvaW4oJywgJyk7CiAgICAgICAgICAgIHRoaXMubG9nV2l0aFByZWZpeChgTWV0aG9kIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2FtcGxpbmdSYXRlRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgcGFyc2VTYW1wbGVSYXRlRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2ID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHYgPT09ICcnKSByZXR1cm4gMTsKICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2KTsKICAgICAgICAgICAgaWYgKCFpc1ZhbGlkU2FtcGxpbmdSYXRlKG51bSkpIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCByYXRlOiAke3Z9YCk7CiAgICAgICAgICAgIHJldHVybiBudW07CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGZpbHRlckZvcm0uc2hvd2luZyA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkTmFtZSA9ICdTYW1wbGluZyByYXRlOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSAodHlwZW9mIGZpbHRlci5zYW1wbGluZ1JhdGUxID09PSAnbnVtYmVyJyAmJiBpc1ZhbGlkU2FtcGxpbmdSYXRlKGZpbHRlci5zYW1wbGluZ1JhdGUxKSA/IGZpbHRlci5zYW1wbGluZ1JhdGUxIDogMSkudG9GaXhlZCgyKTsKICAgICAgICBmaWx0ZXJGb3JtLmhlbHBUZXh0ID0gJ0NhbiByYW5nZSBmcm9tIDAgKDAlKSB0byAxICgxMDAlKSc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZVNhbXBsZVJhdGVGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoZmlsdGVyLnNhbXBsaW5nUmF0ZTEgPT09IG5ld1ZhbHVlKSByZXR1cm47CiAgICAgICAgICAgIGZpbHRlci5zYW1wbGluZ1JhdGUxID0gbmV3VmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IG5ld1ZhbHVlID09PSAxID8gJ25vIHNhbXBsaW5nJyA6IGAke25ld1ZhbHVlfSAoJHsobmV3VmFsdWUgKiAxMDApLnRvRml4ZWQoMil9JSlgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNhbXBsZSByYXRlIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBlZGl0U2VhcmNoRmlsdGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBmaWx0ZXIgLCBmaWx0ZXJGb3JtICB9ID0gdGhpczsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnU2VhcmNoIHRleHQ6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGZpbHRlci5zZWFyY2gxIHx8ICcnOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnRmlsdGVyIGJ5IGEgdGV4dCBtYXRjaCBpbiBjb25zb2xlLmxvZyBtZXNzYWdlcyc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgaWYgKGZpbHRlci5zZWFyY2gxID09PSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUpIHJldHVybjsKICAgICAgICAgICAgZmlsdGVyLnNlYXJjaDEgPSBmaWx0ZXJGb3JtLmZpZWxkVmFsdWU7CiAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoewogICAgICAgICAgICAgICAgc2F2ZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IChmaWx0ZXIuc2VhcmNoMSB8fCAnJykubGVuZ3RoID09PSAwID8gJ25vIHNlYXJjaCBmaWx0ZXInIDogYCcke2ZpbHRlci5zZWFyY2gxfSdgOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYFNlYXJjaCBmaWx0ZXIgY2hhbmdlZCB0bzogJHt0ZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdEhlYWRlckZpbHRlcigpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyICwgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgY29uc3QgcGFyc2VGaWx0ZXJIZWFkZXJzRnJvbUZpZWxkVmFsdWUgPSAoKT0+ewogICAgICAgICAgICBjb25zdCB7IGZpZWxkVmFsdWUgIH0gPSBmaWx0ZXJGb3JtOwogICAgICAgICAgICBjb25zdCB2MyA9IChmaWVsZFZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGlmICh2MyA9PT0gJycpIHJldHVybiBbXTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0KHYzLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkKICAgICAgICAgICAgKS5maWx0ZXIoKHYpPT52ICE9PSAnJwogICAgICAgICAgICApKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUZpbHRlckhlYWRlcnMgPSAoKT0+ewogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QoZmlsdGVyLmhlYWRlcjEgfHwgW10pLmpvaW4oJywgJyk7CiAgICAgICAgfTsKICAgICAgICBmaWx0ZXJGb3JtLnNob3dpbmcgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZE5hbWUgPSAnSGVhZGVyKHMpOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSBjb21wdXRlRmllbGRWYWx1ZUZyb21GaWx0ZXJIZWFkZXJzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9IGAna2V5Jywgb3IgJ2tleTpxdWVyeScsIGNvbW1hLXNlcGFyYXRlZCBpZiBtdWx0aXBsZWA7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZUZpbHRlckhlYWRlcnNGcm9tRmllbGRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldChmaWx0ZXIuaGVhZGVyMSB8fCBbXSksIG5ldyBTZXQobmV3VmFsdWUpKSkgcmV0dXJuOwogICAgICAgICAgICBmaWx0ZXIuaGVhZGVyMSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBuZXdWYWx1ZS5sZW5ndGggPT09IDAgPyAnbm8gaGVhZGVyIGZpbHRlcicgOiBuZXdWYWx1ZS5qb2luKCcsICcpOwogICAgICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYEhlYWRlciBmaWx0ZXIgY2hhbmdlZCB0bzogJHt0ZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdExvZ3Byb3BGaWx0ZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuZGVtb01vZGUpIHJldHVybjsKICAgICAgICBjb25zdCB7IGZpbHRlciAsIGZpbHRlckZvcm0gIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IHBhcnNlTG9ncHJvcEZpbHRlcnNGcm9tRmllbGRWYWx1ZSA9ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHsgZmllbGRWYWx1ZSAgfSA9IGZpbHRlckZvcm07CiAgICAgICAgICAgIGNvbnN0IHY0ID0gKGZpZWxkVmFsdWUgfHwgJycpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHY0ID09PSAnJykgcmV0dXJuIFtdOwogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QodjQuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKQogICAgICAgICAgICApLmZpbHRlcigodik9PnYgIT09ICcnCiAgICAgICAgICAgICkpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgY29tcHV0ZUZpZWxkVmFsdWVGcm9tTG9nUHJvcEZpbHRlcnMgPSAoKT0+ewogICAgICAgICAgICByZXR1cm4gZGlzdGluY3QoZmlsdGVyLmxvZ3Byb3AxIHx8IFtdKS5qb2luKCcsICcpOwogICAgICAgIH07CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0xvZ3Byb3Aocyk6JzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWVDaG9pY2VzID0gW107CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlT3B0aW9ucyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGNvbXB1dGVGaWVsZFZhbHVlRnJvbUxvZ1Byb3BGaWx0ZXJzKCk7CiAgICAgICAgZmlsdGVyRm9ybS5oZWxwVGV4dCA9IGAna2V5Jywgb3IgJ2tleTp2YWx1ZScsIGNvbW1hLXNlcGFyYXRlZCBpZiBtdWx0aXBsZSwgdmFsdWUgbWF5IGluY2x1ZGUgKmA7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZUxvZ3Byb3BGaWx0ZXJzRnJvbUZpZWxkVmFsdWUoKTsKICAgICAgICAgICAgdGhpcy5zZXRMb2dwcm9wRmlsdGVyKG5ld1ZhbHVlKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIHNldExvZ3Byb3BGaWx0ZXIobG9ncHJvcEZpbHRlcnMpIHsKICAgICAgICBjb25zdCB7IGZpbHRlciAgfSA9IHRoaXM7CiAgICAgICAgaWYgKHNldEVxdWFsKG5ldyBTZXQoZmlsdGVyLmxvZ3Byb3AxIHx8IFtdKSwgbmV3IFNldChsb2dwcm9wRmlsdGVycykpKSByZXR1cm47CiAgICAgICAgZmlsdGVyLmxvZ3Byb3AxID0gbG9ncHJvcEZpbHRlcnM7CiAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBjb25zdCB0ZXh0ID0gbG9ncHJvcEZpbHRlcnMubGVuZ3RoID09PSAwID8gJ25vIGxvZ3Byb3AgZmlsdGVyJyA6IGxvZ3Byb3BGaWx0ZXJzLmpvaW4oJywgJyk7CiAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBMb2dwcm9wIGZpbHRlciBjaGFuZ2VkIHRvOiAke3RleHR9YCk7CiAgICB9CiAgICBoYXNBbnlGaWx0ZXJzKCkgewogICAgICAgIGNvbnN0IHsgZmlsdGVyICB9ID0gdGhpczsKICAgICAgICBjb25zdCB7IGV2ZW50MSAgfSA9IGZpbHRlcjsKICAgICAgICByZXR1cm4gY29tcHV0ZVRhaWxPcHRpb25zRm9yRmlsdGVyKGZpbHRlcikuZmlsdGVycy5sZW5ndGggPiAwIHx8IHR5cGVvZiBldmVudDEgPT09ICdzdHJpbmcnICYmIGV2ZW50MSAhPT0gJycgJiYgZXZlbnQxICE9PSAnYWxsJzsKICAgIH0KICAgIHJlc2V0RmlsdGVycygpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIHRoaXMuZmlsdGVyID0ge307CiAgICAgICAgdGhpcy5hcHBseUZpbHRlcih7CiAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICB9KTsKICAgICAgICB0aGlzLmxvZ1dpdGhQcmVmaXgoYEZpbHRlcnMgcmVzZXRgKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBjYW5jZWxGaWx0ZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ2NhbmNlbEZpbHRlcicpOwogICAgICAgIHRoaXMuZmlsdGVyRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgc2F2ZUZpbHRlcigpIHsKICAgICAgICBjb25zb2xlLmxvZygnc2F2ZUZpbHRlcicpOwogICAgICAgIGNvbnN0IHsgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgZmlsdGVyRm9ybS5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgZmlsdGVyRm9ybS5vdXRwdXRNZXNzYWdlID0gJ0NoZWNraW5nIGZpbHRlci4uLic7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpbHRlckZvcm0uYXBwbHlWYWx1ZSgpOwogICAgICAgICAgICBmaWx0ZXJGb3JtLm91dHB1dE1lc3NhZ2UgPSBgYDsKICAgICAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBmaWx0ZXJGb3JtLm91dHB1dE1lc3NhZ2UgPSBgRXJyb3I6ICR7ZS5tZXNzYWdlfWA7CiAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfQogICAgfQogICAgc2VsZWN0RmlsdGVyQ2hvaWNlKGlkKSB7CiAgICAgICAgaWYgKHRoaXMuZmlsdGVyRm9ybS5maWVsZFZhbHVlID09PSBpZCkgcmV0dXJuOwogICAgICAgIHRoaXMuZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gaWQ7CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgZWRpdFNlbGVjdGlvbkZpZWxkcygpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgZmlsdGVyRm9ybSAgfSA9IHRoaXM7CiAgICAgICAgZmlsdGVyRm9ybS5zaG93aW5nID0gdHJ1ZTsKICAgICAgICBmaWx0ZXJGb3JtLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIGZpbHRlckZvcm0uZmllbGROYW1lID0gJ0FkZGl0aW9uYWwgZmllbGRzOic7CiAgICAgICAgZmlsdGVyRm9ybS5maWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgICAgIGZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMgPSBFWFRSQV9GSUVMRFNfT1BUSU9OUzsKICAgICAgICBmaWx0ZXJGb3JtLmZpZWxkVmFsdWUgPSAodGhpcy5leHRyYUZpZWxkcyB8fCBbXSkuam9pbignLCcpOwogICAgICAgIGZpbHRlckZvcm0uaGVscFRleHQgPSAnU2VsZWN0IGFkZGl0aW9uYWwgZmllbGRzIHRvIHNob3cgaW4gdGhlIG91dHB1dCc7CiAgICAgICAgZmlsdGVyRm9ybS5hcHBseVZhbHVlID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgbmV3VmFsdWVzID0gZGlzdGluY3QoKGZpbHRlckZvcm0uZmllbGRWYWx1ZSB8fCAnJykuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKQogICAgICAgICAgICApLmZpbHRlcigodik9PnYgIT09ICcnCiAgICAgICAgICAgICkpOwogICAgICAgICAgICBpZiAoc2V0RXF1YWwobmV3IFNldCh0aGlzLmV4dHJhRmllbGRzIHx8IFtdKSwgbmV3IFNldChuZXdWYWx1ZXMpKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmV4dHJhRmllbGRzID0gbmV3VmFsdWVzOwogICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHsKICAgICAgICAgICAgICAgIHNhdmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGV4dHJhRmllbGRzVGV4dCA9IHRoaXMuY29tcHV0ZVNlbGVjdGlvbkZpZWxkc1RleHQoKTsKICAgICAgICAgICAgdGhpcy5sb2dXaXRoUHJlZml4KGBPdXRwdXQgZmllbGRzIGNoYW5nZWQgdG86ICR7ZXh0cmFGaWVsZHNUZXh0fWApOwogICAgICAgIH07CiAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgfQogICAgY29tcHV0ZVNlbGVjdGlvbkZpZWxkc1RleHQoKSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJ3N0YW5kYXJkIGZpZWxkcycsCiAgICAgICAgICAgIC4uLnRoaXMuZXh0cmFGaWVsZHMubWFwKChpZCk9PkVYVFJBX0ZJRUxEU19PUFRJT05TLmZpbmQoKHYpPT52LmlkID09PSBpZAogICAgICAgICAgICAgICAgKT8udGV4dCB8fCBpZAogICAgICAgICAgICApCiAgICAgICAgXS5qb2luKCcsICcpOwogICAgfQogICAgdG9nZ2xlRmlsdGVyT3B0aW9uKGlkKSB7CiAgICAgICAgY29uc3QgZXh0cmFGaWVsZHMgPSBkaXN0aW5jdCgodGhpcy5maWx0ZXJGb3JtLmZpZWxkVmFsdWUgfHwgJycpLnNwbGl0KCcsJykubWFwKCh2KT0+di50cmltKCkKICAgICAgICApLmZpbHRlcigodik9PnYgIT09ICcnCiAgICAgICAgKSk7CiAgICAgICAgY29uc3QgaSA9IGV4dHJhRmllbGRzLmluZGV4T2YoaWQpOwogICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgZXh0cmFGaWVsZHMuc3BsaWNlKGksIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4dHJhRmllbGRzLnB1c2goaWQpOwogICAgICAgIH0KICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gZXh0cmFGaWVsZHMuam9pbignLCcpOwogICAgICAgIGlmICh0aGlzLmZpbHRlckZvcm0uZmllbGRWYWx1ZSA9PT0gZmllbGRWYWx1ZSkgcmV0dXJuOwogICAgICAgIHRoaXMuZmlsdGVyRm9ybS5maWVsZFZhbHVlID0gZmllbGRWYWx1ZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICB0b2dnbGVEZW1vTW9kZSgpIHsKICAgICAgICB0aGlzLnNldERlbW9Nb2RlKCF0aGlzLmRlbW9Nb2RlKTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICByZXNldE91dHB1dCgpIHsKICAgICAgICBpZiAodGhpcy5kZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIHRoaXMub25SZXNldE91dHB1dCgpOwogICAgfQogICAgc2hvd0Fib3V0KCkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlKSByZXR1cm47CiAgICAgICAgdGhpcy5hYm91dFNob3dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgIH0KICAgIGNsb3NlQWJvdXQoKSB7CiAgICAgICAgdGhpcy5hYm91dFNob3dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9CiAgICBzaG93QW5hbHl0aWMoYW5hbHl0aWNJZCkgewogICAgICAgIGNvbnN0IGFuYWx5dGljID0gdGhpcy5hbmFseXRpY3MuZmluZCgodik9PnYuaWQgPT09IGFuYWx5dGljSWQKICAgICAgICApOwogICAgICAgIGlmICghYW5hbHl0aWMgfHwgYW5hbHl0aWMuaWQgPT09IHRoaXMuX3NlbGVjdGVkQW5hbHl0aWNJZCkgcmV0dXJuOwogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9maWxlc1t0aGlzLnNlbGVjdGVkUHJvZmlsZUlkXTsKICAgICAgICBpZiAocHJvZmlsZSA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICAgICAgdGhpcy5fc2VsZWN0ZWRBbmFseXRpY0lkID0gYW5hbHl0aWNJZDsKICAgICAgICB0aGlzLmFuYWx5dGljc1N0YXRlLnF1ZXJ5aW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmFuYWx5dGljc1N0YXRlLmR1cmFibGVPYmplY3RzQ29zdHMgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5hbmFseXRpY3NTdGF0ZS5lcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENmR3FsQ2xpZW50KHsKICAgICAgICAgICAgYWNjb3VudElkLAogICAgICAgICAgICBhcGlUb2tlbgogICAgICAgIH0pOwogICAgICAgIHRoaXMucXVlcnlEdXJhYmxlT2JqZWN0c0Nvc3RzKGNsaWVudCk7CiAgICB9CiAgICBzZXREZW1vTW9kZShkZW1vTW9kZSkgewogICAgICAgIGlmICh0aGlzLmRlbW9Nb2RlID09PSBkZW1vTW9kZSkgcmV0dXJuOwogICAgICAgIHRoaXMuZGVtb01vZGUgPSBkZW1vTW9kZTsKICAgICAgICBpZiAoZGVtb01vZGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0VuYWJsZSBkZW1vIG1vZGUnKTsKICAgICAgICAgICAgdGhpcy5vblFwc0NoYW5nZSgxMi4zNCk7CiAgICAgICAgICAgIHRoaXMub25SZXNldE91dHB1dCgpOwogICAgICAgICAgICBEZW1vTW9kZS5sb2dGYWtlT3V0cHV0KHRoaXMudGFpbENvbnRyb2xsZXJDYWxsYmFja3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEaXNhYmxlIGRlbW8gbW9kZScpOwogICAgICAgICAgICB0aGlzLm9uUXBzQ2hhbmdlKHRoaXMucXBzQ29udHJvbGxlci5xcHMpOwogICAgICAgICAgICB0aGlzLm9uUmVzZXRPdXRwdXQoKTsKICAgICAgICB9CiAgICB9CiAgICBhcHBseUZpbHRlcihvcHRzKSB7CiAgICAgICAgY29uc3QgeyBzYXZlICB9ID0gb3B0czsKICAgICAgICB0aGlzLnN0YXRlLmZpbHRlciA9IHRoaXMuZmlsdGVyOwogICAgICAgIHRoaXMuc3RhdGUuZXh0cmFGaWVsZHMgPSB0aGlzLmV4dHJhRmllbGRzOwogICAgICAgIGlmIChzYXZlKSBzYXZlU3RhdGUodGhpcy5zdGF0ZSk7CiAgICAgICAgY29uc3QgdGFpbE9wdGlvbnMgPSBjb21wdXRlVGFpbE9wdGlvbnNGb3JGaWx0ZXIodGhpcy5maWx0ZXIpOwogICAgICAgIHRoaXMudGFpbENvbnRyb2xsZXIuc2V0VGFpbE9wdGlvbnModGFpbE9wdGlvbnMpOwogICAgfQogICAgbG9nV2l0aFByZWZpeCguLi5kYXRhNSkgewogICAgICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRMb2NhbFl5eXlNbURkSGhNbVNzKG5ldyBEYXRlKCkpOwogICAgICAgIGlmIChkYXRhNS5sZW5ndGggPiAwICYmIHR5cGVvZiBkYXRhNVswXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgZGF0YTUgPSBbCiAgICAgICAgICAgICAgICBgWyVjJHt0aW1lfSVjXSAke2RhdGE1WzBdfWAsCiAgICAgICAgICAgICAgICAnY29sb3I6IGdyYXknLAogICAgICAgICAgICAgICAgJycsCiAgICAgICAgICAgICAgICAuLi5kYXRhNS5zbGljZSgxKQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZ2dlciguLi5kYXRhNSk7CiAgICB9CiAgICB2ZXJib3NlV2l0aFByZWZpeChtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgdGltZSA9IGZvcm1hdExvY2FsWXl5eU1tRGRIaE1tU3MobmV3IERhdGUoKSk7CiAgICAgICAgdGhpcy5sb2dnZXIoYFslYyR7dGltZX0lY10gJWMke21lc3NhZ2V9JWNgLCAnY29sb3I6IGdyYXknLCAnJywgJ2NvbG9yOiBncmF5Jyk7CiAgICB9CiAgICBwZXJmb3JtSW5pdGlhbFNlbGVjdGlvbigpIHsKICAgICAgICBjb25zdCBpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZCA9IGNvbXB1dGVJbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZCh0aGlzLnN0YXRlLCB0aGlzLl9wcm9maWxlcyk7CiAgICAgICAgaWYgKGluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbml0aWFsbHkgc2VsZWN0aW5nIHByb2ZpbGU6ICR7dGhpcy5zdGF0ZS5wcm9maWxlc1tpbml0aWFsbHlTZWxlY3RlZFByb2ZpbGVJZF0ubmFtZX1gKTsKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9IGluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyB0cnlTYXZlUHJvZmlsZShwcm9maWxlSWQsIHByb2ZpbGUpIHsKICAgICAgICBjb25zdCB7IHByb2ZpbGVGb3JtICB9ID0gdGhpczsKICAgICAgICBwcm9maWxlRm9ybS5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgcHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlID0gdHJ1ZTsKICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gJ0NoZWNraW5nIHByb2ZpbGUuLi4nOwogICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBjYW5MaXN0VGFpbHMgPSBhd2FpdCBjb21wdXRlQ2FuTGlzdFRhaWxzKHByb2ZpbGUuYWNjb3VudElkLCBwcm9maWxlLmFwaVRva2VuKTsKICAgICAgICAgICAgaWYgKGNhbkxpc3RUYWlscykgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9maWxlc1twcm9maWxlSWRdID0gcHJvZmlsZTsKICAgICAgICAgICAgICAgIHNhdmVTdGF0ZSh0aGlzLnN0YXRlKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkUHJvZmlsZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVjb21wdXRlV2VsY29tZVNob3dpbmcoKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVGb3JtLnNob3dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgPSBwcm9maWxlSWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcm9maWxlRm9ybS5vdXRwdXRNZXNzYWdlID0gYFRoZXNlIGNyZWRlbnRpYWxzIGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gdGFpbGA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHByb2ZpbGVGb3JtLm91dHB1dE1lc3NhZ2UgPSBgRXJyb3I6ICR7ZS5tZXNzYWdlfWA7CiAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICBwcm9maWxlRm9ybS5wcm9ncmVzc1Zpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgcHJvZmlsZUZvcm0uZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTsKICAgICAgICB9CiAgICB9CiAgICByZWxvYWRQcm9maWxlcygpIHsKICAgICAgICBjb25zdCB7IHN0YXRlICB9ID0gdGhpczsKICAgICAgICB0aGlzLl9wcm9maWxlcy5zcGxpY2UoMCk7CiAgICAgICAgZm9yIChjb25zdCBbcHJvZmlsZUlkLCBwcm9maWxlXSBvZiBPYmplY3QuZW50cmllcyhzdGF0ZS5wcm9maWxlcykpewogICAgICAgICAgICBjb25zdCBuYW1lID0gcHJvZmlsZS5uYW1lIHx8ICcodW5uYW1lZCknOwogICAgICAgICAgICB0aGlzLl9wcm9maWxlcy5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBwcm9maWxlSWQsCiAgICAgICAgICAgICAgICB0ZXh0OiBuYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGZpbmRTY3JpcHRzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgICAgIGlmIChwcm9maWxlID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgeyBhY2NvdW50SWQgLCBhcGlUb2tlbiAgfSA9IHByb2ZpbGU7CiAgICAgICAgICAgIHRoaXMudmVyYm9zZVdpdGhQcmVmaXgoYEZpbmRpbmcgc2NyaXB0cyBmb3IgJHtwcm9maWxlLm5hbWUudG9VcHBlckNhc2UoKX0uLi5gKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjb25zdCBzY3JpcHRzID0gYXdhaXQgbGlzdFNjcmlwdHMoYWNjb3VudElkLCBhcGlUb2tlbik7CiAgICAgICAgICAgIGlmICghdGhpcy5kZW1vTW9kZSkgdGhpcy52ZXJib3NlV2l0aFByZWZpeChgRm91bmQgJHtzY3JpcHRzLmxlbmd0aH0gc2NyaXB0cyBpbiAke0RhdGUubm93KCkgLSBzdGFydH1tc2ApOwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNwbGljZSgwKTsKICAgICAgICAgICAgZm9yIChjb25zdCBzY3JpcHQgb2Ygc2NyaXB0cyl7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBzY3JpcHQuaWQsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogc2NyaXB0LmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zY3JpcHRzLnNvcnQoKGxocywgcmhzKT0+bGhzLnRleHQubG9jYWxlQ29tcGFyZShyaHMudGV4dCkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRTY3JpcHRJZHMgPSB0aGlzLmNvbXB1dGVTZWxlY3RlZFNjcmlwdElkc0FmdGVyRmluZFNjcmlwdHMoKTsKICAgICAgICAgICAgaWYgKHNlbGVjdGVkU2NyaXB0SWRzLnNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2NyaXB0SWRzID0gc2VsZWN0ZWRTY3JpcHRJZHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLmRlbW9Nb2RlKSB0aGlzLm9uQ2hhbmdlKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuZGVtb01vZGUpIHRoaXMubG9nZ2VyKGBFcnJvciBpbiBmaW5kU2NyaXB0czogJHtlLnN0YWNrfWApOwogICAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVTZWxlY3RlZFNjcmlwdElkc0FmdGVyRmluZFNjcmlwdHMoKSB7CiAgICAgICAgaWYgKHRoaXMuX3NjcmlwdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsbHkgc2VsZWN0aW5nIG5vIHNjcmlwdHMsIG5vIHNjcmlwdHMgdG8gc2VsZWN0Jyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgU2V0KCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvZmlsZUlkICYmIHRoaXMuc2VsZWN0ZWRQcm9maWxlSWQgJiYgdGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdGhpcy5zdGF0ZS5zZWxlY3RlZFByb2ZpbGVJZCkgewogICAgICAgICAgICBjb25zdCBpbml0aWFsUHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgICAgIGlmIChpbml0aWFsUHJvZmlsZSAmJiBpbml0aWFsUHJvZmlsZS5zZWxlY3RlZFNjcmlwdElkcyAmJiBpbml0aWFsUHJvZmlsZS5zZWxlY3RlZFNjcmlwdElkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2NyaXB0SWRzID0gbmV3IFNldCh0aGlzLl9zY3JpcHRzLm1hcCgodik9PnYuaWQKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IHNldEludGVyc2VjdChjdXJyZW50U2NyaXB0SWRzLCBuZXcgU2V0KGluaXRpYWxQcm9maWxlLnNlbGVjdGVkU2NyaXB0SWRzKSk7CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlcy5zaXplID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbml0aWFsbHkgc2VsZWN0aW5nIHNjcmlwdCR7Y2FuZGlkYXRlcy5zaXplID09PSAxID8gJycgOiAncyd9ICR7WwogICAgICAgICAgICAgICAgICAgICAgICAuLi5jYW5kaWRhdGVzCiAgICAgICAgICAgICAgICAgICAgXS5zb3J0KCkuam9pbignLCAnKX06IHJlbWVtYmVyZWQgZnJvbSBsYXN0IHRpbWVgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBmaXJzdFNjcmlwdElkID0gdGhpcy5fc2NyaXB0c1swXS5pZDsKICAgICAgICBjb25zb2xlLmxvZyhgSW5pdGlhbGx5IHNlbGVjdGluZyBzY3JpcHQgJHtmaXJzdFNjcmlwdElkfTogZmlyc3Qgb25lIGluIHRoZSBsaXN0YCk7CiAgICAgICAgcmV0dXJuIG5ldyBTZXQoWwogICAgICAgICAgICB0aGlzLl9zY3JpcHRzWzBdLmlkCiAgICAgICAgXSk7CiAgICB9CiAgICBhc3luYyBzZXRUYWlscygpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFByb2ZpbGVJZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZXNbdGhpcy5zZWxlY3RlZFByb2ZpbGVJZF07CiAgICAgICAgaWYgKHByb2ZpbGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHsgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwcm9maWxlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMudGFpbENvbnRyb2xsZXIuc2V0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbiwgdGhpcy5fc2VsZWN0ZWRTY3JpcHRJZHMpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhpcy5sb2dnZXIoJ0Vycm9yIGluIHNldFRhaWxzJywgZS5zdGFjayB8fCBlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVBZGRpdGlvbmFsTG9ncyhtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgcnQgPSBbXTsKICAgICAgICBjb25zdCBpbmNsdWRlSXBBZGRyZXNzID0gdGhpcy5leHRyYUZpZWxkcy5pbmNsdWRlcygnaXAtYWRkcmVzcycpOwogICAgICAgIGNvbnN0IGluY2x1ZGVVc2VyQWdlbnQgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCd1c2VyLWFnZW50Jyk7CiAgICAgICAgY29uc3QgaW5jbHVkZVJlZmVyZXIgPSB0aGlzLmV4dHJhRmllbGRzLmluY2x1ZGVzKCdyZWZlcmVyJyk7CiAgICAgICAgaWYgKGluY2x1ZGVJcEFkZHJlc3MgfHwgaW5jbHVkZVVzZXJBZ2VudCB8fCBpbmNsdWRlUmVmZXJlcikgewogICAgICAgICAgICBpZiAoIWlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQobWVzc2FnZS5ldmVudCkpIHsKICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlSXBBZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXBBZGRyZXNzID0gbWVzc2FnZS5ldmVudC5yZXF1ZXN0LmhlYWRlcnNbJ2NmLWNvbm5lY3RpbmctaXAnXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlwQWRkcmVzcykgcnQucHVzaChjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQoJ0lQIGFkZHJlc3MnLCBpcEFkZHJlc3MpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlVXNlckFnZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlckFnZW50ID0gbWVzc2FnZS5ldmVudC5yZXF1ZXN0LmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJBZ2VudCkgcnQucHVzaChjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQoJ1VzZXIgYWdlbnQnLCB1c2VyQWdlbnQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlUmVmZXJlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZmVyZXIgPSBtZXNzYWdlLmV2ZW50LnJlcXVlc3QuaGVhZGVyc1sncmVmZXJlciddIHx8IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmZXJlcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWZlcmVyVXJsID0gdHJ5UGFyc2VVcmwocmVmZXJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmZXJlclVybCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0VXJsID0gdHJ5UGFyc2VVcmwobWVzc2FnZS5ldmVudC5yZXF1ZXN0LnVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdFVybCAmJiByZXF1ZXN0VXJsLm9yaWdpbiA9PT0gcmVmZXJlclVybC5vcmlnaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nKSBydC5wdXNoKGNvbXB1dGVBZGRpdGlvbmFsTG9nRm9yRXh0cmFGaWVsZCgnUmVmZXJlcicsIHJlZmVyZXIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ0OwogICAgfQogICAgcmVjb21wdXRlV2VsY29tZVNob3dpbmcoKSB7CiAgICAgICAgY29uc3Qgc2hvdWxkU2hvdyA9IHRoaXMucHJvZmlsZXMubGVuZ3RoID09PSAwOwogICAgICAgIGlmIChzaG91bGRTaG93ID09PSB0aGlzLndlbGNvbWVTaG93aW5nKSByZXR1cm47CiAgICAgICAgdGhpcy5zZXREZW1vTW9kZShzaG91bGRTaG93KTsKICAgICAgICB0aGlzLndlbGNvbWVTaG93aW5nID0gc2hvdWxkU2hvdzsKICAgIH0KICAgIGFzeW5jIHF1ZXJ5RHVyYWJsZU9iamVjdHNDb3N0cyhjbGllbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmFuYWx5dGljc1N0YXRlLmR1cmFibGVPYmplY3RzQ29zdHMgPSBhd2FpdCBjb21wdXRlRHVyYWJsZU9iamVjdHNDb3N0c1RhYmxlKGNsaWVudCwgewogICAgICAgICAgICAgICAgbG9va2JhY2tEYXlzOiAyOAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHRoaXMuYW5hbHl0aWNzU3RhdGUuZHVyYWJsZU9iamVjdHNDb3N0cy5hY2NvdW50VGFibGUucm93cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5hbHl0aWNzU3RhdGUuZHVyYWJsZU9iamVjdHNDb3N0cyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZHVyYWJsZSBvYmplY3QgYW5hbHl0aWNzIGZvdW5kJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihlKTsKICAgICAgICAgICAgbGV0IGVycm9yID0gYCR7ZX1gOwogICAgICAgICAgICBpZiAoZXJyb3IuaW5jbHVkZXMoJyhjb2RlPWF1dGh6KScpKSB7CiAgICAgICAgICAgICAgICBlcnJvciA9IGBUaGUgYXV0aCB0b2tlbiBmb3IgdGhpcyBwcm9maWxlIGRvZXMgbm90IGhhdmUgdGhlIEFjY291bnQgQW5hbHl0aWNzOlJlYWQgcGVybWlzc2lvbi5gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYW5hbHl0aWNzU3RhdGUuZXJyb3IgPSBlcnJvcjsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIHRoaXMuYW5hbHl0aWNzU3RhdGUucXVlcnlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSgpOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBjb21wdXRlQWRkaXRpb25hbExvZ0ZvckV4dHJhRmllbGQobmFtZSwgdmFsdWUpIHsKICAgIHJldHVybiB7CiAgICAgICAgZGF0YTogWwogICAgICAgICAgICBgICVjfCVjIFslYyR7bmFtZX0lY10gJHt2YWx1ZX1gLAogICAgICAgICAgICAnY29sb3I6Z3JheScsCiAgICAgICAgICAgICcnLAogICAgICAgICAgICAnY29sb3I6Z3JheScKICAgICAgICBdCiAgICB9Owp9CmNsYXNzIFByb2ZpbGVGb3JtVk0gewogICAgc2hvd2luZyA9IGZhbHNlOwogICAgZW5hYmxlZCA9IGZhbHNlOwogICAgbmFtZSA9ICcnOwogICAgYWNjb3VudElkID0gJyc7CiAgICBhcGlUb2tlbiA9ICcnOwogICAgZGVsZXRlVmlzaWJsZSA9IGZhbHNlOwogICAgc2F2ZUVuYWJsZWQgPSBmYWxzZTsKICAgIHByb2ZpbGVJZCA9ICcnOwogICAgdGl0bGUgPSAnJzsKICAgIHByb2dyZXNzVmlzaWJsZSA9IGZhbHNlOwogICAgb3V0cHV0TWVzc2FnZSA9ICcnOwogICAgY29tcHV0ZVNhdmVFbmFibGVkKCkgewogICAgICAgIHRoaXMuc2F2ZUVuYWJsZWQgPSB0aGlzLm5hbWUudHJpbSgpLmxlbmd0aCA+IDAgJiYgdGhpcy5hcGlUb2tlbi50cmltKCkubGVuZ3RoID4gMCAmJiB0aGlzLmFjY291bnRJZC50cmltKCkubGVuZ3RoID4gMDsKICAgIH0KfQpjbGFzcyBGaWx0ZXJGb3JtVk0gewogICAgc2hvd2luZyA9IGZhbHNlOwogICAgZW5hYmxlZCA9IGZhbHNlOwogICAgZmllbGROYW1lID0gJyc7CiAgICBmaWVsZFZhbHVlQ2hvaWNlcyA9IFtdOwogICAgZmllbGRWYWx1ZU9wdGlvbnMgPSBbXTsKICAgIGZpZWxkVmFsdWU7CiAgICBoZWxwVGV4dCA9ICcnOwogICAgb3V0cHV0TWVzc2FnZSA9ICcnOwogICAgYXBwbHlWYWx1ZSA9ICgpPT57fTsKfQpjb25zdCBFWFRSQV9GSUVMRFNfT1BUSU9OUyA9IFsKICAgIHsKICAgICAgICBpZDogJ2lwLWFkZHJlc3MnLAogICAgICAgIHRleHQ6ICdJUCBhZGRyZXNzJwogICAgfSwKICAgIHsKICAgICAgICBpZDogJ3VzZXItYWdlbnQnLAogICAgICAgIHRleHQ6ICdVc2VyIGFnZW50JwogICAgfSwKICAgIHsKICAgICAgICBpZDogJ3JlZmVyZXInLAogICAgICAgIHRleHQ6ICdSZWZlcmVyJwogICAgfSwgCl07CmNvbnN0IFNUQVRFX0tFWSA9ICdzdGF0ZTEnOwpmdW5jdGlvbiBsb2FkU3RhdGUoKSB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGpzb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVEFURV9LRVkpIHx8IHVuZGVmaW5lZDsKICAgICAgICBpZiAoanNvbikgewogICAgICAgICAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKGpzb24pOwogICAgICAgICAgICBjb25zdCBydCA9IHBhcnNlU3RhdGUob2JqKTsKICAgICAgICAgICAgcmV0dXJuIHJ0OwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ2xvYWRTdGF0ZTogRXJyb3IgbG9hZGluZyBzdGF0ZScsIGUuc3RhY2sgfHwgZSk7CiAgICB9CiAgICBjb25zb2xlLmxvZygnbG9hZFN0YXRlOiByZXR1cm5pbmcgbmV3IHN0YXRlJyk7CiAgICByZXR1cm4gewogICAgICAgIHByb2ZpbGVzOiB7fQogICAgfTsKfQpmdW5jdGlvbiBwYXJzZVN0YXRlKHBhcnNlZCkgewogICAgaWYgKHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIG9iamVjdGApOwogICAgY29uc3QgeyBwcm9maWxlcyAgfSA9IHBhcnNlZDsKICAgIGlmICh0eXBlb2YgcHJvZmlsZXMgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIHByb2ZpbGVzIG9iamVjdGApOwogICAgZm9yIChjb25zdCBbcHJvZmlsZUlkLCBwcm9maWxlU3RhdGVdIG9mIE9iamVjdC5lbnRyaWVzKHByb2ZpbGVzKSl7CiAgICAgICAgaWYgKHR5cGVvZiBwcm9maWxlSWQgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgRXJyb3IoJ1Byb2ZpbGUgaWQgbXVzdCBiZSBzdHJpbmcnKTsKICAgICAgICBwYXJzZVByb2ZpbGVTdGF0ZShwcm9maWxlU3RhdGUpOwogICAgfQogICAgcmV0dXJuIHBhcnNlZDsKfQpmdW5jdGlvbiBwYXJzZVByb2ZpbGVTdGF0ZShwYXJzZWQpIHsKICAgIGlmICh0eXBlb2YgcGFyc2VkICE9PSAnb2JqZWN0JyB8fCBwYXJzZWQgPT09IG51bGwpIHRocm93IG5ldyBFcnJvcignUHJvZmlsZSBzdGF0ZSBtdXN0IGJlIG9iamVjdCcpOwogICAgY29uc3QgeyBuYW1lICwgYWNjb3VudElkICwgYXBpVG9rZW4gIH0gPSBwYXJzZWQ7CiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8IG5hbWUudHJpbSgpLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKGBQcm9maWxlIHN0YXRlIG5hbWUgbXVzdCBleGlzdGApOwogICAgaWYgKHR5cGVvZiBhY2NvdW50SWQgIT09ICdzdHJpbmcnIHx8IGFjY291bnRJZC50cmltKCkubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoYFByb2ZpbGUgc3RhdGUgYWNjb3VudElkIG11c3QgZXhpc3RgKTsKICAgIGlmICh0eXBlb2YgYXBpVG9rZW4gIT09ICdzdHJpbmcnIHx8IGFwaVRva2VuLnRyaW0oKS5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcihgUHJvZmlsZSBzdGF0ZSBhcGlUb2tlbiBtdXN0IGV4aXN0YCk7CiAgICByZXR1cm4gcGFyc2VkOwp9CmZ1bmN0aW9uIHNhdmVTdGF0ZShzdGF0ZSkgewogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RBVEVfS0VZLCBKU09OLnN0cmluZ2lmeShzdGF0ZSkpOwp9CmFzeW5jIGZ1bmN0aW9uIGNvbXB1dGVDYW5MaXN0VGFpbHMoYWNjb3VudElkLCBhcGlUb2tlbikgewogICAgdHJ5IHsKICAgICAgICBhd2FpdCBsaXN0VGFpbHMoYWNjb3VudElkLCAnJywgYXBpVG9rZW4pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChlIGluc3RhbmNlb2YgQ2xvdWRmbGFyZUFwaUVycm9yICYmIGUuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHt9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmZ1bmN0aW9uIGlzVmFsaWRTYW1wbGluZ1JhdGUoc2FtcGxpbmdSYXRlKSB7CiAgICByZXR1cm4gIWlzTmFOKHNhbXBsaW5nUmF0ZSkgJiYgc2FtcGxpbmdSYXRlID49IDAgJiYgc2FtcGxpbmdSYXRlIDw9IDE7Cn0KZnVuY3Rpb24gY29tcHV0ZUluaXRpYWxseVNlbGVjdGVkUHJvZmlsZUlkKHN0YXRlLCBwcm9maWxlcykgewogICAgaWYgKHN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkICYmIHN0YXRlLnByb2ZpbGVzW3N0YXRlLnNlbGVjdGVkUHJvZmlsZUlkXSkgcmV0dXJuIHN0YXRlLnNlbGVjdGVkUHJvZmlsZUlkOwogICAgaWYgKHByb2ZpbGVzLmxlbmd0aCA+IDApIHJldHVybiBwcm9maWxlc1swXS5pZDsKICAgIHJldHVybiB1bmRlZmluZWQ7Cn0KZnVuY3Rpb24gY29tcHV0ZVRhaWxPcHRpb25zRm9yRmlsdGVyKGZpbHRlcikgewogICAgY29uc3QgZmlsdGVycyA9IFtdOwogICAgaWYgKGZpbHRlci5zdGF0dXMxID09PSAnZXJyb3InKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgb3V0Y29tZTogWwogICAgICAgICAgICAgICAgJ2V4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAnZXhjZWVkZWRDcHUnLAogICAgICAgICAgICAgICAgJ2NhbmNlbGVkJywKICAgICAgICAgICAgICAgICd1bmtub3duJwogICAgICAgICAgICBdCiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGZpbHRlci5zdGF0dXMxID09PSAnc3VjY2VzcycpIHsKICAgICAgICBmaWx0ZXJzLnB1c2goewogICAgICAgICAgICBvdXRjb21lOiBbCiAgICAgICAgICAgICAgICAnb2snCiAgICAgICAgICAgIF0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIuc2FtcGxpbmdSYXRlMSAhPT0gdW5kZWZpbmVkICYmIGlzVmFsaWRTYW1wbGluZ1JhdGUoZmlsdGVyLnNhbXBsaW5nUmF0ZTEpICYmIGZpbHRlci5zYW1wbGluZ1JhdGUxIDwgMSkgewogICAgICAgIGZpbHRlcnMucHVzaCh7CiAgICAgICAgICAgIHNhbXBsaW5nX3JhdGU6IGZpbHRlci5zYW1wbGluZ1JhdGUxCiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZmlsdGVyLnNlYXJjaDEgIT09IHVuZGVmaW5lZCAmJiBmaWx0ZXIuc2VhcmNoMS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgcXVlcnk6IGZpbHRlci5zZWFyY2gxCiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZmlsdGVyLm1ldGhvZDEgJiYgZmlsdGVyLm1ldGhvZDEubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlcnMucHVzaCh7CiAgICAgICAgICAgIG1ldGhvZDogZmlsdGVyLm1ldGhvZDEKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChmaWx0ZXIuaXBBZGRyZXNzMSAmJiBmaWx0ZXIuaXBBZGRyZXNzMS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKHsKICAgICAgICAgICAgY2xpZW50X2lwOiBmaWx0ZXIuaXBBZGRyZXNzMQogICAgICAgIH0pOwogICAgfQogICAgaWYgKGZpbHRlci5oZWFkZXIxICYmIGZpbHRlci5oZWFkZXIxLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKGNvbnN0IGhlYWRlciBvZiBmaWx0ZXIuaGVhZGVyMSl7CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChwYXJzZUhlYWRlckZpbHRlcihoZWFkZXIpKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIGZpbHRlcnMKICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZU1lc3NhZ2VQYXNzZXNGaWx0ZXIobWVzc2FnZSwgZmlsdGVyKSB7CiAgICBpZiAoIWNvbXB1dGVNZXNzYWdlUGFzc2VzTG9nUHJvcEZpbHRlcihtZXNzYWdlLCBmaWx0ZXIubG9ncHJvcDEpKSByZXR1cm4gZmFsc2U7CiAgICBpZiAoZmlsdGVyLmV2ZW50MSA9PT0gJ2Nyb24nIHx8IGZpbHRlci5ldmVudDEgPT09ICdodHRwJykgewogICAgICAgIGNvbnN0IGlzQ3JvbiA9IGlzVGFpbE1lc3NhZ2VDcm9uRXZlbnQobWVzc2FnZSk7CiAgICAgICAgcmV0dXJuIGlzQ3JvbiAmJiBmaWx0ZXIuZXZlbnQxID09PSAnY3JvbicgfHwgIWlzQ3JvbiAmJiBmaWx0ZXIuZXZlbnQxID09PSAnaHR0cCc7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBjb21wdXRlTWVzc2FnZVBhc3Nlc0xvZ1Byb3BGaWx0ZXIobWVzc2FnZSwgbG9ncHJvcDEpIHsKICAgIGlmIChsb2dwcm9wMSA9PT0gdW5kZWZpbmVkIHx8IGxvZ3Byb3AxLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRydWU7CiAgICBjb25zdCBsb2dwcm9wRmlsdGVycyA9IGxvZ3Byb3AxLm1hcChwYXJzZUhlYWRlckZpbHRlcik7CiAgICBjb25zdCB7IHByb3BzICB9ID0gcGFyc2VMb2dQcm9wcyhtZXNzYWdlLmxvZ3MpOwogICAgZm9yIChjb25zdCBsb2dwcm9wRmlsdGVyIG9mIGxvZ3Byb3BGaWx0ZXJzKXsKICAgICAgICBpZiAoY29tcHV0ZVByb3BzUGFzc0xvZ3Byb3BGaWx0ZXIocHJvcHMsIGxvZ3Byb3BGaWx0ZXIpKSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiBjb21wdXRlUHJvcHNQYXNzTG9ncHJvcEZpbHRlcihwcm9wcywgbG9ncHJvcEZpbHRlcikgewogICAgY29uc3QgdmFsID0gcHJvcHNbbG9ncHJvcEZpbHRlci5rZXldOwogICAgaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2U7CiAgICBpZiAobG9ncHJvcEZpbHRlci5xdWVyeSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IHEgPSBsb2dwcm9wRmlsdGVyLnF1ZXJ5LnRyaW0oKS5yZXBsYWNlQWxsKC9cKisvZywgJyonKTsKICAgIGlmICghcS5pbmNsdWRlcygnKicpKSByZXR1cm4gcSA9PT0gdmFsOwogICAgaWYgKHEgPT09ICcqJykgcmV0dXJuIHRydWU7CiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ3N0cmluZycpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHBhdHRlcm4gPSAnXicgKyBlc2NhcGVGb3JSZWdleChxKS5yZXBsYWNlQWxsKCdcXConLCAnLionKSArICckJzsKICAgIHJldHVybiBuZXcgUmVnRXhwKHBhdHRlcm4pLnRlc3QodmFsKTsKfQpmdW5jdGlvbiBlc2NhcGVGb3JSZWdleChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvWy1cL1xcXiQqKz8uKCl8W1xde31dL2csICdcXCQmJyk7Cn0KZnVuY3Rpb24gZGlzdGluY3QodmFsdWVzKSB7CiAgICBjb25zdCBydCA9IFtdOwogICAgZm9yIChjb25zdCB2YWx1ZSBvZiB2YWx1ZXMpewogICAgICAgIGlmICghcnQuaW5jbHVkZXModmFsdWUpKSB7CiAgICAgICAgICAgIHJ0LnB1c2godmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBydDsKfQpmdW5jdGlvbiB0cnlQYXJzZVVybCh1cmwpIHsKICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkwodXJsKTsKICAgIH0gY2F0Y2ggIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQp9CmNvbnN0IEZJTFRFUl9FRElUT1JfSFRNTCA9IGh0bWxgCjxmb3JtIGlkPSJmaWx0ZXItZm9ybSIgYXV0b2NvbXBsZXRlPSJvZmYiPgo8ZmllbGRzZXQgaWQ9ImZpbHRlci1maWVsZHNldCI+CiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0tdGl0bGUiIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQgZm9ybS1yb3ciPkVkaXQgZmlsdGVyPC9kaXY+CgogIDxsYWJlbCBpZD0iZmlsdGVyLWZpZWxkLWxhYmVsIj5GaWx0ZXIgZmllbGQ6PC9sYWJlbD4KICA8aW5wdXQgaWQ9ImZpbHRlci1maWVsZC10ZXh0IiB0eXBlPSJ0ZXh0Ij4KICA8ZGl2IGlkPSJmaWx0ZXItZmllbGQtY2hvaWNlIj48L2Rpdj4KICA8ZGl2IGlkPSJmaWx0ZXItZmllbGQtb3B0aW9ucyI+PC9kaXY+CgogIDxkaXYgaWQ9ImZpbHRlci1mb3JtLWhlbHAiIGNsYXNzPSJib2R5MiBtZWRpdW0tZW1waGFzaXMtdGV4dCI+CiAgPC9kaXY+ICAKCiAgPGRpdiBpZD0iZmlsdGVyLWZvcm0tb3V0cHV0LXJvdyIgY2xhc3M9ImZvcm0tcm93Ij4KICAgIDxvdXRwdXQgaWQ9ImZpbHRlci1mb3JtLW91dHB1dCI+PC9vdXRwdXQ+CiAgPC9kaXY+CgogIDxkaXYgaWQ9ImZpbHRlci1mb3JtLWJ1dHRvbnMiIGNsYXNzPSJmb3JtLXJocyI+CiAgICA8YnV0dG9uIGlkPSJmaWx0ZXItYXBwbHkiIHR5cGU9InN1Ym1pdCI+QXBwbHk8L2J1dHRvbj48IS0tIGZpcnN0IHNvIGl0IGlzIGRlZmF1bHQgYnV0dG9uIG9uIHJldHVybiAtLT4KICAgIDxidXR0b24gaWQ9ImZpbHRlci1jYW5jZWwiPkNhbmNlbDwvYnV0dG9uPgogIDwvZGl2Pgo8L2ZpZWxkc2V0Pgo8L2Zvcm0+CmA7CmNvbnN0IEZJTFRFUl9FRElUT1JfQ1NTID0gY3NzYAoKICAgICNmaWx0ZXItZm9ybS1idXR0b25zIHsKICAgICAgICBqdXN0aWZ5LXNlbGY6IGVuZDsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3ctcmV2ZXJzZTsKICAgICAgICBnYXA6IDFyZW07CiAgICB9CgogICAgI2ZpbHRlci1maWVsZC1jaG9pY2UgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZ2FwOiAxcHg7CiAgICB9CgogICAgI2ZpbHRlci1maWVsZC1vcHRpb25zIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgICBnYXA6IDFweDsKICAgIH0KCiAgICAjZmlsdGVyLWZpZWxkLW9wdGlvbnMgYnV0dG9uIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiAwLjVyZW07CiAgICB9CgogICAgI2ZpbHRlci1mb3JtLWhlbHAgewogICAgICAgIGdyaWQtY29sdW1uOiAyOwogICAgfQoKICAgICNmaWx0ZXItZm9ybS1vdXRwdXQtcm93IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiAxcmVtOwogICAgICAgIG1pbi1oZWlnaHQ6IDIuNXJlbTsKICAgIH0KCiAgICAjZmlsdGVyLWZvcm0tb3V0cHV0LXJvdyBvdXRwdXQgewogICAgICAgIGZsZXgtZ3JvdzogMTsKICAgIH0KCmA7CmZ1bmN0aW9uIGluaXRGaWx0ZXJFZGl0b3IoZG9jdW1lbnQsIHZtNykgewogICAgY29uc3QgZmlsdGVyRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZm9ybScpOwogICAgY29uc3QgZmlsdGVyRmllbGRzZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkc2V0Jyk7CiAgICBjb25zdCBmaWx0ZXJGaWVsZExhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1maWVsZC1sYWJlbCcpOwogICAgY29uc3QgZmlsdGVyRmllbGRUZXh0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyLWZpZWxkLXRleHQnKTsKICAgIGNvbnN0IGZpbHRlckZpZWxkQ2hvaWNlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1maWVsZC1jaG9pY2UnKTsKICAgIGNvbnN0IGZpbHRlckZpZWxkT3B0aW9uc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZmllbGQtb3B0aW9ucycpOwogICAgY29uc3QgZmlsdGVyQ2FuY2VsQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1jYW5jZWwnKTsKICAgIGNvbnN0IGZpbHRlckFwcGx5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1hcHBseScpOwogICAgY29uc3QgZmlsdGVyRm9ybU91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXItZm9ybS1vdXRwdXQnKTsKICAgIGNvbnN0IGZpbHRlckZvcm1IZWxwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlci1mb3JtLWhlbHAnKTsKICAgIGZpbHRlckNhbmNlbEJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtNy5jYW5jZWxGaWx0ZXIoKTsKICAgIH07CiAgICBmaWx0ZXJBcHBseUJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGNvbnN0IHR5cGUgPSBjb21wdXRlVHlwZSh2bTcpOwogICAgICAgIGlmICh0eXBlID09PSAndGV4dCcpIHsKICAgICAgICAgICAgdm03LmZpbHRlckZvcm0uZmllbGRWYWx1ZSA9IGZpbHRlckZpZWxkVGV4dElucHV0LnZhbHVlOwogICAgICAgIH0KICAgICAgICB2bTcuc2F2ZUZpbHRlcigpOwogICAgfTsKICAgIHJldHVybiAoKT0+ewogICAgICAgIGNvbnN0IHdhc0hpZGRlbiA9IGZpbHRlckZvcm0uc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnOwogICAgICAgIGZpbHRlckZvcm0uc3R5bGUuZGlzcGxheSA9IHZtNy5maWx0ZXJGb3JtLnNob3dpbmcgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGZpbHRlckZpZWxkc2V0LmRpc2FibGVkID0gIXZtNy5maWx0ZXJGb3JtLmVuYWJsZWQ7CiAgICAgICAgY29uc3QgdHlwZSA9IGNvbXB1dGVUeXBlKHZtNyk7CiAgICAgICAgZmlsdGVyRmllbGRMYWJlbC50ZXh0Q29udGVudCA9IHZtNy5maWx0ZXJGb3JtLmZpZWxkTmFtZTsKICAgICAgICBmaWx0ZXJGaWVsZExhYmVsLmh0bWxGb3IgPSB0eXBlID09ICdjaG9pY2UnID8gZmlsdGVyRmllbGRDaG9pY2VEaXYuaWQgOiB0eXBlID09ICdvcHRpb25zJyA/IGZpbHRlckZpZWxkT3B0aW9uc0Rpdi5pZCA6IGZpbHRlckZpZWxkVGV4dElucHV0LmlkOwogICAgICAgIGZpbHRlckZpZWxkVGV4dElucHV0LnN0eWxlLmRpc3BsYXkgPSB0eXBlID09ICd0ZXh0JyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgZmlsdGVyRmllbGRDaG9pY2VEaXYuc3R5bGUuZGlzcGxheSA9IHR5cGUgPT0gJ2Nob2ljZScgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoQ0hPSUNFU19IVE1MKHZtNyksIGZpbHRlckZpZWxkQ2hvaWNlRGl2KTsKICAgICAgICBmaWx0ZXJGaWVsZE9wdGlvbnNEaXYuc3R5bGUuZGlzcGxheSA9IHR5cGUgPT0gJ29wdGlvbnMnID8gJ2ZsZXgnIDogJ25vbmUnOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKE9QVElPTlNfSFRNTCh2bTcpLCBmaWx0ZXJGaWVsZE9wdGlvbnNEaXYpOwogICAgICAgIGZpbHRlckZvcm1IZWxwRGl2LnRleHRDb250ZW50ID0gdm03LmZpbHRlckZvcm0uaGVscFRleHQ7CiAgICAgICAgZmlsdGVyRm9ybU91dHB1dC50ZXh0Q29udGVudCA9IHZtNy5maWx0ZXJGb3JtLm91dHB1dE1lc3NhZ2U7CiAgICAgICAgaWYgKHdhc0hpZGRlbiAmJiB2bTcuZmlsdGVyRm9ybS5zaG93aW5nKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmaWx0ZXIgZm9ybSBvcGVuJyk7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAndGV4dCcgJiYgdm03LmZpbHRlckZvcm0uZmllbGRWYWx1ZSkgZmlsdGVyRmllbGRUZXh0SW5wdXQudmFsdWUgPSB2bTcuZmlsdGVyRm9ybS5maWVsZFZhbHVlOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZFRleHRJbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgZmlsdGVyRmllbGRUZXh0SW5wdXQuc2VsZWN0KCk7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgIH0KICAgIH07Cn0KZnVuY3Rpb24gY29tcHV0ZVR5cGUodm04KSB7CiAgICByZXR1cm4gdm04LmZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMubGVuZ3RoID4gMCA/ICdjaG9pY2UnIDogdm04LmZpbHRlckZvcm0uZmllbGRWYWx1ZU9wdGlvbnMubGVuZ3RoID8gJ29wdGlvbnMnIDogJ3RleHQnOwp9CmNvbnN0IENIT0lDRVNfSFRNTCA9ICh2bTkpPT57CiAgICByZXR1cm4gdm05LmZpbHRlckZvcm0uZmllbGRWYWx1ZUNob2ljZXMubWFwKChjaG9pY2UpPT5odG1sYDxidXR0b24gY2xhc3M9IiR7Y2hvaWNlLmlkID09PSB2bTkuZmlsdGVyRm9ybS5maWVsZFZhbHVlID8gJ3NlbGVjdGVkJyA6ICcnfSIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdm05LnNlbGVjdEZpbHRlckNob2ljZShjaG9pY2UuaWQpOwogICAgICAgIH19ID9kaXNhYmxlZD0iJHshdm05LmZpbHRlckZvcm0uc2hvd2luZ30iPiR7Y2hvaWNlLnRleHR9PC9idXR0b24+YAogICAgKTsKfTsKY29uc3QgT1BUSU9OU19IVE1MID0gKHZtMTApPT57CiAgICByZXR1cm4gdm0xMC5maWx0ZXJGb3JtLmZpZWxkVmFsdWVPcHRpb25zLm1hcCgob3B0aW9uKT0+ewogICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZmllbGRWYWx1ZVNldCh2bTEwKS5oYXMob3B0aW9uLmlkKTsKICAgICAgICByZXR1cm4gaHRtbGA8YnV0dG9uIGNsYXNzPSIke3NlbGVjdGVkID8gJ3NlbGVjdGVkJyA6ICcnfSIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdm0xMC50b2dnbGVGaWx0ZXJPcHRpb24ob3B0aW9uLmlkKTsKICAgICAgICB9fSA/ZGlzYWJsZWQ9IiR7IXZtMTAuZmlsdGVyRm9ybS5zaG93aW5nfSI+JHtzZWxlY3RlZCA/IENIRUNLX0JPWF9DSEVDS0VEX0lDT04gOiBDSEVDS19CT1hfVU5DSEVDS0VEX0lDT059ICR7b3B0aW9uLnRleHR9PC9idXR0b24+YDsKICAgIH0pOwp9OwpmdW5jdGlvbiBmaWVsZFZhbHVlU2V0KHZtMTEpIHsKICAgIHJldHVybiBuZXcgU2V0KCh2bTExLmZpbHRlckZvcm0uZmllbGRWYWx1ZSB8fCAnJykuc3BsaXQoJywnKS5tYXAoKHYpPT52LnRyaW0oKQogICAgKS5maWx0ZXIoKHYpPT52Lmxlbmd0aCA+IDAKICAgICkpOwp9CmNvbnN0IFBST0ZJTEVfRURJVE9SX0hUTUwgPSBodG1sYAo8Zm9ybSBpZD0icHJvZmlsZS1mb3JtIiBhdXRvY29tcGxldGU9Im9mZiI+CjxmaWVsZHNldCBpZD0icHJvZmlsZS1maWVsZHNldCI+CiAgPGRpdiBpZD0icHJvZmlsZS1mb3JtLXRpdGxlIiBjbGFzcz0iaDYgaGlnaC1lbXBoYXNpcy10ZXh0IGZvcm0tcm93Ij5Qcm9maWxlPC9kaXY+CgogIDxsYWJlbCBmb3I9InByb2ZpbGUtbmFtZSI+UHJvZmlsZSBuYW1lOjwvbGFiZWw+CiAgPGlucHV0IGlkPSJwcm9maWxlLW5hbWUiIHR5cGU9InRleHQiPgoKICA8bGFiZWwgZm9yPSJhY2NvdW50LWlkIj5DbG91ZGZsYXJlIEFjY291bnQgSUQ6PC9sYWJlbD4KICA8aW5wdXQgaWQ9InByb2ZpbGUtYWNjb3VudC1pZCIgdHlwZT0idGV4dCI+CgogIDxsYWJlbCBmb3I9ImFwaS10b2tlbiI+Q2xvdWRmbGFyZSBBUEkgVG9rZW46PC9sYWJlbD4KICA8aW5wdXQgaWQ9InByb2ZpbGUtYXBpLXRva2VuIiB0eXBlPSJ0ZXh0Ij4KCiAgPGRldGFpbHMgaWQ9InByb2ZpbGUtZm9ybS1oZWxwLXJvdyIgY2xhc3M9ImZvcm0tcm93Ij4KICAgIDxzdW1tYXJ5PlVzZSBhIDxhIGhyZWY9Imh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1ByaW5jaXBsZV9vZl9sZWFzdF9wcml2aWxlZ2UiIHRhcmdldD0iX2JsYW5rIj5sZWFzdCBwcml2aWxlZ2U8L2E+IHRva2VuIHdpdGggcGVybWlzc2lvbjogPGNvZGU+QWNjb3VudCAmZ3Q7IFdvcmtlcnMgVGFpbCAmZ3Q7IFJlYWQ8L2NvZGU+PC9zdW1tYXJ5PgogICAgPG9sPgogICAgICAgIDxsaT5TZWxlY3QgPHNwYW4gY2xhc3M9ImNmLWJ1dHRvbiI+Q3JlYXRlIFRva2VuPC9zcGFuPiBvbiB5b3VyIENsb3VkZmxhcmUgPGEgaHJlZj0iaHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tL3Byb2ZpbGUvYXBpLXRva2VucyIgdGFyZ2V0PSJfYmxhbmsiPkFQSSBUb2tlbnM8L2E+IHBhZ2UuPC9saT4KICAgICAgICA8bGk+U2Nyb2xsIGRvd24gdG8gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPkNyZWF0ZSBDdXN0b20gVG9rZW48L3NwYW4+LCB0aGVuIDxzcGFuIGNsYXNzPSJjZi1idXR0b24iPkdldCBzdGFydGVkPC9zcGFuPjwvbGk+CiAgICAgICAgPGxpPlVuZGVyIDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5QZXJtaXNzaW9uczwvc3Bhbj4sIGdyYW50IHlvdXIgdG9rZW4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPkFjY291bnQ8L3NwYW4+IDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5Xb3JrZXJzIFRhaWw8L3NwYW4+IDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5SZWFkPC9zcGFuPjwvbGk+CiAgICAgICAgPGxpPkFsc28gKGZvciBhbmFseXRpY3MpLCBncmFudCB5b3VyIHRva2VuIDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5BY2NvdW50PC9zcGFuPiA8c3BhbiBjbGFzcz0iY2Ytc2VjdGlvbiI+QWNjb3VudCBBbmFseXRpY3M8L3NwYW4+IDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5SZWFkPC9zcGFuPjwvbGk+CiAgICAgICAgPGxpPkFsc28gKGZvciBETyBuYW1lcyksIGdyYW50IHlvdXIgdG9rZW4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPkFjY291bnQ8L3NwYW4+IDxzcGFuIGNsYXNzPSJjZi1zZWN0aW9uIj5Xb3JrZXIgU2NyaXB0czwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmLXNlY3Rpb24iPlJlYWQ8L3NwYW4+PC9saT4KICAgIDwvb2w+CiAgPC9kZXRhaWxzPiAgCgogIDxkaXYgaWQ9InByb2ZpbGUtZm9ybS1vdXRwdXQtcm93IiBjbGFzcz0iZm9ybS1yb3ciPgogICAgPG91dHB1dCBpZD0icHJvZmlsZS1mb3JtLW91dHB1dCI+PC9vdXRwdXQ+CiAgICA8cHJvZ3Jlc3MgaWQ9InByb2ZpbGUtZm9ybS1wcm9ncmVzcyIgY2xhc3M9InB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXIiPjwvcHJvZ3Jlc3M+CiAgPC9kaXY+CgogIDxkaXYgY2xhc3M9ImZvcm0tbGhzIj4KICAgIDxidXR0b24gaWQ9InByb2ZpbGUtZGVsZXRlIj5EZWxldGU8L2J1dHRvbj4KICA8L2Rpdj4KICA8ZGl2IGlkPSJwcm9maWxlLWZvcm0tYnV0dG9ucyIgY2xhc3M9ImZvcm0tcmhzIj4KICAgIDxidXR0b24gaWQ9InByb2ZpbGUtY2FuY2VsIj5DYW5jZWw8L2J1dHRvbj4KICAgIDxidXR0b24gaWQ9InByb2ZpbGUtc2F2ZSI+U2F2ZTwvYnV0dG9uPgogIDwvZGl2Pgo8L2ZpZWxkc2V0Pgo8L2Zvcm0+CmA7CmNvbnN0IFBST0ZJTEVfRURJVE9SX0NTUyA9IGNzc2AKCiAgICAjcHJvZmlsZS1mb3JtLWJ1dHRvbnMgewogICAgICAgIGp1c3RpZnktc2VsZjogZW5kOwogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZ2FwOiAxcmVtOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgewogICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLWhlbHAtcm93IHN1bW1hcnkgewogICAgICAgIHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0taGVscC1yb3cgb2wgewogICAgICAgIGN1cnNvcjogZGVmYXVsdDsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLWhlbHAtcm93IGxpIHsKICAgICAgICBwYWRkaW5nOiAwLjVyZW0gMDsKICAgIH0KCiAgICAuY2YtYnV0dG9uIHsKICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmx1ZTsKICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgcGFkZGluZzogMC4yNXJlbSAwLjVyZW07CiAgICAgICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsKICAgIH0KCiAgICAuY2Ytc2VjdGlvbiB7CiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogICAgICAgIGNvbG9yOiBibGFjazsKICAgICAgICBwYWRkaW5nOiAwLjI1cmVtIDAuNXJlbTsKICAgICAgICBvdXRsaW5lOiBzb2xpZCAxcHggZ3JheTsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLW91dHB1dC1yb3cgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgbWluLWhlaWdodDogMi41cmVtOwogICAgfQoKICAgICNwcm9maWxlLWZvcm0tb3V0cHV0LXJvdyBvdXRwdXQgewogICAgICAgIGZsZXgtZ3JvdzogMTsKICAgIH0KCiAgICAjcHJvZmlsZS1mb3JtLXByb2dyZXNzIHsKICAgICAgICBmb250LXNpemU6IDAuNXJlbTsgLyogZGVmYXVsdCAzZW0gPT4gMS41cmVtICovCiAgICB9CgpgOwpmdW5jdGlvbiBpbml0UHJvZmlsZUVkaXRvcihkb2N1bWVudCwgdm0xMikgewogICAgY29uc3QgcHJvZmlsZUZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtJyk7CiAgICBjb25zdCBwcm9maWxlRm9ybVRpdGxlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS10aXRsZScpOwogICAgY29uc3QgcHJvZmlsZUZpZWxkc2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZmllbGRzZXQnKTsKICAgIGNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1uYW1lJyk7CiAgICBjb25zdCBwcm9maWxlQWNjb3VudElkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1hY2NvdW50LWlkJyk7CiAgICBjb25zdCBwcm9maWxlQXBpVG9rZW5JbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWFwaS10b2tlbicpOwogICAgY29uc3QgcHJvZmlsZURlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWRlbGV0ZScpOwogICAgY29uc3QgcHJvZmlsZUNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWNhbmNlbCcpOwogICAgY29uc3QgcHJvZmlsZVNhdmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1zYXZlJyk7CiAgICBjb25zdCBwcm9maWxlRm9ybVByb2dyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtZm9ybS1wcm9ncmVzcycpOwogICAgY29uc3QgcHJvZmlsZUZvcm1PdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZmlsZS1mb3JtLW91dHB1dCcpOwogICAgY29uc3QgcHJvZmlsZUZvcm1IZWxwRGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWZvcm0taGVscC1yb3cnKTsKICAgIHByb2ZpbGVDYW5jZWxCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTEyLmNhbmNlbFByb2ZpbGUoKTsKICAgIH07CiAgICBwcm9maWxlTmFtZUlucHV0Lm9uaW5wdXQgPSAoKT0+ewogICAgICAgIHZtMTIuc2V0UHJvZmlsZU5hbWUocHJvZmlsZU5hbWVJbnB1dC52YWx1ZSk7CiAgICB9OwogICAgcHJvZmlsZUFjY291bnRJZElucHV0Lm9uaW5wdXQgPSAoKT0+ewogICAgICAgIHZtMTIuc2V0UHJvZmlsZUFjY291bnRJZChwcm9maWxlQWNjb3VudElkSW5wdXQudmFsdWUpOwogICAgfTsKICAgIHByb2ZpbGVBcGlUb2tlbklucHV0Lm9uaW5wdXQgPSAoKT0+ewogICAgICAgIHZtMTIuc2V0UHJvZmlsZUFwaVRva2VuKHByb2ZpbGVBcGlUb2tlbklucHV0LnZhbHVlKTsKICAgIH07CiAgICBwcm9maWxlU2F2ZUJ1dHRvbi5vbmNsaWNrID0gKGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTIuc2F2ZVByb2ZpbGUoKTsKICAgIH07CiAgICBwcm9maWxlRGVsZXRlQnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xMi5kZWxldGVQcm9maWxlKHZtMTIucHJvZmlsZUZvcm0ucHJvZmlsZUlkKTsKICAgIH07CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBjb25zdCB3YXNIaWRkZW4gPSBwcm9maWxlRm9ybS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZSc7CiAgICAgICAgcHJvZmlsZUZvcm0uc3R5bGUuZGlzcGxheSA9IHZtMTIucHJvZmlsZUZvcm0uc2hvd2luZyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgcHJvZmlsZUZpZWxkc2V0LmRpc2FibGVkID0gIXZtMTIucHJvZmlsZUZvcm0uZW5hYmxlZDsKICAgICAgICBwcm9maWxlRm9ybVRpdGxlRGl2LnRleHRDb250ZW50ID0gdm0xMi5wcm9maWxlRm9ybS50aXRsZTsKICAgICAgICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gdm0xMi5wcm9maWxlRm9ybS5uYW1lOwogICAgICAgIHByb2ZpbGVBY2NvdW50SWRJbnB1dC52YWx1ZSA9IHZtMTIucHJvZmlsZUZvcm0uYWNjb3VudElkOwogICAgICAgIHByb2ZpbGVBcGlUb2tlbklucHV0LnZhbHVlID0gdm0xMi5wcm9maWxlRm9ybS5hcGlUb2tlbjsKICAgICAgICBwcm9maWxlRGVsZXRlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSB2bTEyLnByb2ZpbGVGb3JtLmRlbGV0ZVZpc2libGUgPyAnaW5saW5lLWJsb2NrJyA6ICdub25lJzsKICAgICAgICBwcm9maWxlU2F2ZUJ1dHRvbi5kaXNhYmxlZCA9ICF2bTEyLnByb2ZpbGVGb3JtLnNhdmVFbmFibGVkOwogICAgICAgIHByb2ZpbGVGb3JtUHJvZ3Jlc3Muc3R5bGUuZGlzcGxheSA9IHZtMTIucHJvZmlsZUZvcm0ucHJvZ3Jlc3NWaXNpYmxlID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBwcm9maWxlRm9ybU91dHB1dC50ZXh0Q29udGVudCA9IHZtMTIucHJvZmlsZUZvcm0ub3V0cHV0TWVzc2FnZTsKICAgICAgICBpZiAod2FzSGlkZGVuICYmIHZtMTIucHJvZmlsZUZvcm0uc2hvd2luZykgewogICAgICAgICAgICBjb25zdCBpbml0aWFsRGV0YWlsc09wZW4gPSB2bTEyLnJlYWxQcm9maWxlcy5sZW5ndGggPT09IDA7CiAgICAgICAgICAgIHByb2ZpbGVGb3JtSGVscERldGFpbHMub3BlbiA9IGluaXRpYWxEZXRhaWxzT3BlbjsKICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgcHJvZmlsZU5hbWVJbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgcHJvZmlsZU5hbWVJbnB1dC5zZWxlY3QoKTsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgfQogICAgfTsKfQpjb25zdCBXRUxDT01FX1BBTkVMX0hUTUwgPSBodG1sYAo8Zm9ybSBpZD0id2VsY29tZS1wYW5lbCIgYXV0b2NvbXBsZXRlPSJvZmYiPgo8ZmllbGRzZXQgaWQ9IndlbGNvbWUtcGFuZWwtZmllbGRzZXQiPgogIDxkaXYgaWQ9IndlbGNvbWUtcGFuZWwtZm9ybS10aXRsZSIgY2xhc3M9Img2IGhpZ2gtZW1waGFzaXMtdGV4dCBmb3JtLXJvdyI+dGl0bGU8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iZm9ybS1yb3cgYm9keTIgbWVkaXVtLWVtcGhhc2lzLXRleHQiPgogICAgV2VsY29tZSB0byA8c3BhbiBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij5XZWJ0YWlsIGZvciBDbG91ZGZsYXJlIFdvcmtlcnM8L3NwYW4+IQogICAgPHA+VmlldyBsaXZlIHJlcXVlc3RzIGFuZCBsb2dzIGZyb20gPGEgaHJlZj0iaHR0cHM6Ly93b3JrZXJzLmNsb3VkZmxhcmUuY29tLyIgdGFyZ2V0PSJfYmxhbmsiPkNsb3VkZmxhcmUgV29ya2VyczwvYT4gZnJvbSB0aGUgY29tZm9ydCBvZiB5b3VyIGJyb3dzZXIuIAogICAgQSBmZXcgZW5oYW5jZW1lbnRzIG92ZXIgd2hhdCdzIHByb3ZpZGVkIDxhIGhyZWY9Imh0dHBzOi8vYmxvZy5jbG91ZGZsYXJlLmNvbS9pbnRyb2R1Y2luZy13b3JrZXJzLWRhc2hib2FyZC1sb2dzLyIgdGFyZ2V0PSJfYmxhbmsiPmJ5IGRlZmF1bHQ8L2E+IGluIHRoZSBDbG91ZGZsYXJlIGRhc2hib2FyZDo8L3A+CiAgICA8dWw+CiAgICAgICAgPGxpPlRhaWwgbXVsdGlwbGUgd29ya2VycyBhdCB0aGUgc2FtZSB0aW1lPC9saT4KICAgICAgICA8bGk+QWR2YW5jZWQgZmlsdGVyaW5nIGFuZCBtdWx0aS1jb2xvciBvdXRwdXQgc2ltaWxhciB0byA8YSBocmVmPSJodHRwczovL2RldmVsb3BlcnMuY2xvdWRmbGFyZS5jb20vd29ya2Vycy9jbGktd3JhbmdsZXIvY29tbWFuZHMjdGFpbCIgdGFyZ2V0PSJfYmxhbmsiPndyYW5nbGVyIHRhaWw8L2E+PC9saT4KICAgICAgICA8bGk+RHVyYWJsZSBvYmplY3QgY2xhc3MvbmFtZS9pZCBhbmQgY29sbyBpbmZvcm1hdGlvbiBjYW4gYmUgc3VyZmFjZWQgd2l0aCA8YSBocmVmPSJodHRwczovL2Rlbm9mbGFyZS5kZXYvZXhhbXBsZXMvd2VidGFpbCNsb2dwcm9wcyIgdGFyZ2V0PSJfYmxhbmsiPmxvZ3Byb3BzPC9hPjwvbGk+CiAgICAgICAgPGxpPk11bHRpcGxlIHByb2ZpbGVzLCBzd2l0Y2ggZWFzaWx5IGJldHdlZW4gbXVsdGlwbGUgYWNjb3VudHM8L2xpPgogICAgICAgIDxsaT5ObyBuZWVkIHRvIGxvZyBpbiB3aXRoIHlvdXIgZnVsbCBDbG91ZGZsYXJlIGNyZWRlbnRpYWxzLiAgUHJvZmlsZXMgYXJlIHN0b3JlZCBsb2NhbGx5IGluIHRoZSBicm93c2VyLCBhbmQgY2FuIGJlIHBlcm1pc3Npb25lZCBvbmx5IGZvciB0YWlsaW5nIHdvcmtlcnM8L2xpPgogICAgICAgIDxsaT5JbXBsZW1lbnRlZCBhcyA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2t5bWV0aG9kL2Rlbm9mbGFyZS90cmVlL21hc3Rlci9leGFtcGxlcy93ZWJ0YWlsLXdvcmtlciIgdGFyZ2V0PSJfYmxhbmsiPmFuIG9wZW4tc291cmNlIENsb3VkZmxhcmUgV29ya2VyPC9hPiwgCiAgICAgICAgICAgPGEgaHJlZj0iaHR0cHM6Ly9kZW5vZmxhcmUuZGV2L2V4YW1wbGVzL3dlYnRhaWwjZGVwbG95LWl0LXRvLXlvdXItb3duLWFjY291bnQiIHRhcmdldD0iX2JsYW5rIj5kZXBsb3kgaXQgdG8geW91ciBvd24gYWNjb3VudDwvYT4sIAogICAgICAgICAgICBvciA8YSBocmVmPSJodHRwczovL2Rlbm9mbGFyZS5kZXYvZXhhbXBsZXMvd2VidGFpbCNob3N0LWl0LWxvY2FsbHkiIHRhcmdldD0iX2JsYW5rIj5ob3N0IGl0IGxvY2FsbHk8L2E+IHdpdGggPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NreW1ldGhvZC9kZW5vZmxhcmUiIHRhcmdldD0iX2JsYW5rIj48Y29kZT5kZW5vZmxhcmU8L2NvZGU+PC9hPjwvbGk+CiAgICA8L3VsPgogICAgPHAgaWQ9IndlbGNvbWUtcGFuZWwtdHJhaWxlciI+Q3JlYXRlIGEgbmV3IHByb2ZpbGUgdG8gZ2V0IHN0YXJ0ZWQhPC9wPgogICAgPHAgaWQ9ImFib3V0LXBhbmVsLXRyYWlsZXIiPkhlYWQgb3ZlciB0byB0aGUgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NreW1ldGhvZC9kZW5vZmxhcmUiIHRhcmdldD0iX2JsYW5rIj5EZW5vZmxhcmUgR2l0SHViIHJlcG88L2E+IHRvIHJlcXVlc3QgZmVhdHVyZXMsIHJlcG9ydCBidWdzLCBvciBjaGVjayBvdXQgdGhlIGNvZGUhPC9wPgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJmb3JtLXJocyI+CiAgICA8YnV0dG9uIGlkPSJ3ZWxjb21lLXBhbmVsLW5ldy1wcm9maWxlIiB0eXBlPSJzdWJtaXQiPk5ldyBwcm9maWxlPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJ3ZWxjb21lLXBhbmVsLWNsb3NlIiB0eXBlPSJzdWJtaXQiPkNsb3NlPC9idXR0b24+CiAgPC9kaXY+CjwvZmllbGRzZXQ+CjwvZm9ybT4KYDsKY29uc3QgV0VMQ09NRV9QQU5FTF9DU1MgPSBjc3NgCgogICAgI3dlbGNvbWUtcGFuZWwtZm9ybS10aXRsZSB7CiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICB9CgpgOwpmdW5jdGlvbiBpbml0V2VsY29tZVBhbmVsKGRvY3VtZW50LCB2bTEzKSB7CiAgICBjb25zdCB3ZWxjb21lUGFuZWxFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlbGNvbWUtcGFuZWwnKTsKICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLXBhbmVsLWZvcm0tdGl0bGUnKTsKICAgIGNvbnN0IHdlbGNvbWVUcmFpbGVyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLXBhbmVsLXRyYWlsZXInKTsKICAgIGNvbnN0IGFib3V0VHJhaWxlckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWJvdXQtcGFuZWwtdHJhaWxlcicpOwogICAgY29uc3QgbmV3UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLXBhbmVsLW5ldy1wcm9maWxlJyk7CiAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLXBhbmVsLWNsb3NlJyk7CiAgICBuZXdQcm9maWxlQnV0dG9uLm9uY2xpY2sgPSAoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xMy5uZXdQcm9maWxlKCk7CiAgICB9OwogICAgY2xvc2VCdXR0b24ub25jbGljayA9IChlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTEzLmNsb3NlQWJvdXQoKTsKICAgIH07CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBjb25zdCB3YXNIaWRkZW4gPSB3ZWxjb21lUGFuZWxFbGVtZW50LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJzsKICAgICAgICBjb25zdCBzaG93ID0gdm0xMy53ZWxjb21lU2hvd2luZyAmJiAhdm0xMy5wcm9maWxlRm9ybS5zaG93aW5nIHx8IHZtMTMuYWJvdXRTaG93aW5nOwogICAgICAgIHdlbGNvbWVQYW5lbEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHNob3cgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIGNvbnN0IHdlbGNvbWUgPSB2bTEzLndlbGNvbWVTaG93aW5nOwogICAgICAgIHRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHdlbGNvbWUgPyAnSGVsbG8g8J+RiycgOiAnQWJvdXQnOwogICAgICAgIHdlbGNvbWVUcmFpbGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gd2VsY29tZSA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgYWJvdXRUcmFpbGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gd2VsY29tZSA/ICdub25lJyA6ICdibG9jayc7CiAgICAgICAgbmV3UHJvZmlsZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gd2VsY29tZSA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgY2xvc2VCdXR0b24uc3R5bGUuZGlzcGxheSA9IHdlbGNvbWUgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIGlmICh3YXNIaWRkZW4gJiYgc2hvdykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt3ZWxjb21lID8gJ3dlbGNvbWUnIDogJ2Fib3V0J30gcGFuZWwgb3BlbmApOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgICAgICAgICAod2VsY29tZSA/IG5ld1Byb2ZpbGVCdXR0b24gOiBjbG9zZUJ1dHRvbikuZm9jdXMoKTsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgfQogICAgfTsKfQpjb25zdCBNT0RBTF9IVE1MID0gaHRtbGAKPGRpdiBpZD0ibW9kYWwiIGNsYXNzPSJtb2RhbCBoaWRkZW4tdmVydGljYWwtc2Nyb2xsIj4KICAgIDxkaXYgY2xhc3M9Im1vZGFsLWNvbnRlbnQiPgogICAgJHtXRUxDT01FX1BBTkVMX0hUTUx9CiAgICAke1BST0ZJTEVfRURJVE9SX0hUTUx9CiAgICAke0ZJTFRFUl9FRElUT1JfSFRNTH0KICAgIDwvZGl2Pgo8L2Rpdj4KYDsKY29uc3QgTU9EQUxfQ1NTID0gY3NzYAoubW9kYWwgewogICAgZGlzcGxheTogbm9uZTsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDE7CiAgICBsZWZ0OiAwOwogICAgdG9wOiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNCk7Cn0KCi5tb2RhbC1jb250ZW50IHsKICAgIG1hcmdpbjogMTAlIGF1dG87CiAgICB3aWR0aDogODAlOwogICAgbWF4LXdpZHRoOiA0MHJlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwp9CgpAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2MDBweCkgewogICAgLm1vZGFsLWNvbnRlbnQgewogICAgICAgIG1hcmdpbjogMTAlIDA7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICB9Cn0KCmA7CmZ1bmN0aW9uIGluaXRNb2RhbChkb2N1bWVudCwgdm0xNCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKTsKICAgIGNvbnN0IHVwZGF0ZVByb2ZpbGVFZGl0b3IgPSBpbml0UHJvZmlsZUVkaXRvcihkb2N1bWVudCwgdm0xNCk7CiAgICBjb25zdCB1cGRhdGVGaWx0ZXJFZGl0b3IgPSBpbml0RmlsdGVyRWRpdG9yKGRvY3VtZW50LCB2bTE0KTsKICAgIGNvbnN0IHVwZGF0ZVdlbGNvbWVQYW5lbCA9IGluaXRXZWxjb21lUGFuZWwoZG9jdW1lbnQsIHZtMTQpOwogICAgY29uc3QgY2xvc2VNb2RhbCA9ICgpPT57CiAgICAgICAgaWYgKCF2bTE0LnByb2ZpbGVGb3JtLnNob3dpbmcgJiYgIXZtMTQuZmlsdGVyRm9ybS5zaG93aW5nICYmICF2bTE0LndlbGNvbWVTaG93aW5nICYmICF2bTE0LmFib3V0U2hvd2luZykgcmV0dXJuOwogICAgICAgIGlmICh2bTE0LnByb2ZpbGVGb3JtLnByb2dyZXNzVmlzaWJsZSkgcmV0dXJuOwogICAgICAgIHZtMTQucHJvZmlsZUZvcm0uc2hvd2luZyA9IGZhbHNlOwogICAgICAgIHZtMTQuZmlsdGVyRm9ybS5zaG93aW5nID0gZmFsc2U7CiAgICAgICAgdm0xNC5hYm91dFNob3dpbmcgPSBmYWxzZTsKICAgICAgICB2bTE0Lm9uQ2hhbmdlKCk7CiAgICB9OwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KT0+ewogICAgICAgIGlmIChldmVudC50YXJnZXQgPT0gbW9kYWwpIHsKICAgICAgICAgICAgY2xvc2VNb2RhbCgpOwogICAgICAgIH0KICAgIH0pOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCk9PnsKICAgICAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDsKICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykgewogICAgICAgICAgICBjbG9zZU1vZGFsKCk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gKCk9PnsKICAgICAgICB1cGRhdGVQcm9maWxlRWRpdG9yKCk7CiAgICAgICAgdXBkYXRlRmlsdGVyRWRpdG9yKCk7CiAgICAgICAgdXBkYXRlV2VsY29tZVBhbmVsKCk7CiAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9IHZtMTQucHJvZmlsZUZvcm0uc2hvd2luZyB8fCB2bTE0LmZpbHRlckZvcm0uc2hvd2luZyB8fCB2bTE0LndlbGNvbWVTaG93aW5nIHx8IHZtMTQuYWJvdXRTaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgIH07Cn0KY29uc3QgQ0lSQ1VMQVJfUFJPR1JFU1NfQ1NTID0gY3NzYAoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciB7CiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJvcmRlcjogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHBhZGRpbmc6IDAuMjVlbTsKICAgIHdpZHRoOiAzZW07CiAgICBoZWlnaHQ6IDNlbTsKICAgIGNvbG9yOiB2YXIoLS1wdXJlLW1hdGVyaWFsLXByaW1hcnktcmdiLCByZ2IoMzMsIDE1MCwgMjQzKSk7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZvbnQtc2l6ZTogMTZweDsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOjotd2Via2l0LXByb2dyZXNzLWJhciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoKLyogSW5kZXRlcm1pbmF0ZSAqLwoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlIHsKICAgIC13ZWJraXQtbWFzay1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKSwgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB0cmFuc3BhcmVudCA1MCUsIGJsYWNrIDUwJSk7CiAgICBtYXNrLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodHJhbnNwYXJlbnQgNTAlLCBibGFjayA1MCUpLCBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsIHRyYW5zcGFyZW50IDUwJSwgYmxhY2sgNTAlKTsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciA2cyBpbmZpbml0ZSBjdWJpYy1iZXppZXIoMC4zLCAwLjYsIDEsIDEpOwp9Cgo6LW1zLWxhbmcoeCksIC5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGUgewogICAgYW5pbWF0aW9uOiBub25lOwp9CgoucHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhcjppbmRldGVybWluYXRlOjpiZWZvcmUsCi5wdXJlLW1hdGVyaWFsLXByb2dyZXNzLWNpcmN1bGFyOmluZGV0ZXJtaW5hdGU6Oi13ZWJraXQtcHJvZ3Jlc3MtdmFsdWUgewogICAgY29udGVudDogIiI7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBtYXJnaW4tYm90dG9tOiAwLjI1ZW07CiAgICBib3JkZXI6IHNvbGlkIDAuMjVlbSB0cmFuc3BhcmVudDsKICAgIGJvcmRlci10b3AtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhci1wc2V1ZG8gMC43NXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6LW1vei1wcm9ncmVzcy1iYXIgewogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJvcmRlcjogc29saWQgMC4yNWVtIHRyYW5zcGFyZW50OwogICAgYm9yZGVyLXRvcC1jb2xvcjogY3VycmVudENvbG9yOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGFuaW1hdGlvbjogcHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhci1wc2V1ZG8gMC43NXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTsKfQoKLnB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXI6aW5kZXRlcm1pbmF0ZTo6LW1zLWZpbGwgewogICAgYW5pbWF0aW9uLW5hbWU6IC1tcy1yaW5nOwp9CgpAa2V5ZnJhbWVzIHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXIgewogICAgMCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOwogICAgfQogICAgMTIuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDE4MGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgMjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSg2MzBkZWcpOwogICAgfQogICAgMzcuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDgxMGRlZyk7CiAgICAgICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogbGluZWFyOwogICAgfQogICAgNTAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxMjYwZGVnKTsKICAgIH0KICAgIDYyLjUlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxNDQwZGVnKTsKICAgICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7CiAgICB9CiAgICA3NSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDE4OTBkZWcpOwogICAgfQogICAgODcuNSUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDIwNzBkZWcpOwogICAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjsKICAgIH0KICAgIDEwMCUgewogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDI1MjBkZWcpOwogICAgfQp9CgpAa2V5ZnJhbWVzIHB1cmUtbWF0ZXJpYWwtcHJvZ3Jlc3MtY2lyY3VsYXItcHNldWRvIHsKICAgIDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgtMzBkZWcpOwogICAgfQogICAgMjkuNCUgewogICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIH0KICAgIDI5LjQxJSB7CiAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgIH0KICAgIDY0LjclIHsKICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIH0KICAgIDY0LjcxJSB7CiAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogY3VycmVudENvbG9yOwogICAgfQogICAgMTAwJSB7CiAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6IGN1cnJlbnRDb2xvcjsKICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMjI1ZGVnKTsKICAgIH0KfQpgOwpjb25zdCBDT05TT0xFX0hUTUwgPSBodG1sYAo8ZGl2IGlkPSJjb25zb2xlIj4KICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyIj4KICAgICAgICA8ZGl2IGlkPSJjb25zb2xlLWhlYWRlci1maWx0ZXJzIiBjbGFzcz0iYm9keTIiPjwvZGl2PgogICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLXN0YXR1cyI+CiAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLXRhaWxzIiBjbGFzcz0ib3ZlcmxpbmUgbWVkaXVtLWVtcGhhc2lzLXRleHQiPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJjb25zb2xlLWhlYWRlci1xcHMiIGNsYXNzPSJvdmVybGluZSBtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9ImNvbnNvbGUtaGVhZGVyLWNsZWFyIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGNvZGUgaWQ9ImNvbnNvbGUtbGFzdC1saW5lIiBjbGFzcz0ibGluZSI+c3BhY2VyPC9jb2RlPgo8L2Rpdj4KYDsKY29uc3QgQ09OU09MRV9DU1MgPSBjc3NgCgojY29uc29sZSB7CiAgICBjb2xvcjogdmFyKC0taGlnaC1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKICAgIGhlaWdodDogMTAwdmg7CiAgICB3aWR0aDogMTAwJTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwogICAgb3ZlcmZsb3cteTogc2Nyb2xsOwogICAgb3ZlcmZsb3cteDogaGlkZGVuOwogICAgZmxleC1ncm93OiAxOwp9CgojY29uc29sZTo6LXdlYmtpdC1zY3JvbGxiYXIgewogICAgd2lkdGg6IDFyZW07CiAgICBoZWlnaHQ6IDNyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKfQoKI2NvbnNvbGU6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLW1lZGl1bS1lbXBoYXNpcy10ZXh0LWNvbG9yKTsKfQoKI2NvbnNvbGUtaGVhZGVyIHsKICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICB0b3A6IDA7CiAgICBoZWlnaHQ6IDMuNzVyZW07CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxLjI1cmVtIDFyZW0gMXJlbSAwOwp9CgojY29uc29sZS1oZWFkZXItZmlsdGVycyB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBjb2xvcjogdmFyKC0tbWVkaXVtLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgZm9udC1mYW1pbHk6IHZhcigtLXNhbnMtc2VyaWYtZm9udC1mYW1pbHkpOwoKICAgIGRpc3BsYXk6IC13ZWJraXQtYm94OwogICAgLXdlYmtpdC1saW5lLWNsYW1wOiAzOwogICAgLXdlYmtpdC1ib3gtb3JpZW50OiB2ZXJ0aWNhbDsgIAogICAgb3ZlcmZsb3c6IGhpZGRlbjsKfQoKI2NvbnNvbGUtaGVhZGVyLXN0YXR1cyB7CiAgICBoZWlnaHQ6IDFyZW07CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIG1pbi13aWR0aDogNnJlbTsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgcGFkZGluZy10b3A6IDAuMjVyZW07CiAgICB1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKfQoKI2NvbnNvbGUtaGVhZGVyLXRhaWxzIHsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7Cn0KCiNjb25zb2xlLWhlYWRlci1jbGVhciB7CiAgICBtYXJnaW4tcmlnaHQ6IC0wLjVyZW07CiAgICBtYXJnaW4tbGVmdDogMXJlbTsKICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoKI2NvbnNvbGUtaGVhZGVyLWNsZWFyIC5hY3Rpb24taWNvbiB7CiAgICBwYWRkaW5nLXJpZ2h0OiAwLjVyZW07CiAgICBwYWRkaW5nLWxlZnQ6IDAuNXJlbTsKfQoKI2NvbnNvbGUgLmxpbmUgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBmb250LXNpemU6IDAuNzVyZW07IC8qIDEycHggKi8KICAgIGxpbmUtaGVpZ2h0OiAxLjFyZW07CiAgICBmb250LWZhbWlseTogdmFyKC0tbW9ub3NwYWNlLWZvbnQtZmFtaWx5KTsKICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKfQoKI2NvbnNvbGUtbGFzdC1saW5lIHsKICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoKYDsKZnVuY3Rpb24gaW5pdENvbnNvbGUoZG9jdW1lbnQsIHZtMTUpIHsKICAgIGNvbnN0IGNvbnNvbGVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZScpOwogICAgY29uc3QgY29uc29sZUhlYWRlckZpbHRlcnNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZS1oZWFkZXItZmlsdGVycycpOwogICAgY29uc3QgY29uc29sZUhlYWRlclRhaWxzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlLWhlYWRlci10YWlscycpOwogICAgY29uc3QgY29uc29sZUhlYWRlclFwc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZS1oZWFkZXItcXBzJyk7CiAgICBjb25zdCBjb25zb2xlSGVhZGVyQ2xlYXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtaGVhZGVyLWNsZWFyJyk7CiAgICBjb25zdCBjb25zb2xlTGFzdExpbmVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbGFzdC1saW5lJyk7CiAgICBsZXQgc2hvd2luZ0NsZWFyQnV0dG9uID0gZmFsc2U7CiAgICB2bTE1LmxvZ2dlciA9ICguLi5kYXRhNik9PnsKICAgICAgICBjb25zdCBsaW5lRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvZGUnKTsKICAgICAgICBsaW5lRWxlbWVudC5jbGFzc05hbWUgPSAnbGluZSc7CiAgICAgICAgbGV0IHBvcyA9IDA7CiAgICAgICAgd2hpbGUocG9zIDwgZGF0YTYubGVuZ3RoKXsKICAgICAgICAgICAgaWYgKHBvcyA+IDApIHsKICAgICAgICAgICAgICAgIGxpbmVFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcsICcpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBtc2cgPSBkYXRhNltwb3NdOwogICAgICAgICAgICBpZiAodHlwZW9mIG1zZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRva2VucyA9IG1zZy5zcGxpdCgnJWMnKTsKICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJlbmRlcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwICYmIGkgPCB0b2tlbnMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRhdGE2W3BvcyArIGldOwogICAgICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc3R5bGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGUuaW5jbHVkZXMoJ3gtJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gL3gtZHVyYWJsZS1vYmplY3QtKGNsYXNzfG5hbWV8aWQpXHMqOlxzKicoLio/KScvLmV4ZWMoc3R5bGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBtWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1bMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvZ3Byb3BOYW1lID0gJ2R1cmFibGVPYmplY3QnICsgdHlwZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoKSArIHR5cGUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmhyZWYgPSAnIyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEub25jbGljayA9ICgpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bTE1LnNldExvZ3Byb3BGaWx0ZXIoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ3Byb3BOYW1lICsgJzonICsgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0xNS5vbkNoYW5nZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRva2Vuc1tpXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcmVuZGVyZWQpIHJlbmRlclRleHRJbnRvU3Bhbih0b2tlbnNbaV0sIHNwYW4pOwogICAgICAgICAgICAgICAgICAgIGxpbmVFbGVtZW50LmFwcGVuZENoaWxkKHNwYW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9zICs9IDEgKyB0b2tlbnMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxpbmVFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKEpTT04uc3RyaW5naWZ5KG1zZykpKTsKICAgICAgICAgICAgICAgIHBvcysrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnNvbGVEaXYuaW5zZXJ0QmVmb3JlKGxpbmVFbGVtZW50LCBjb25zb2xlTGFzdExpbmVFbGVtZW50KTsKICAgICAgICBjb25zdCB7IHNjcm9sbEhlaWdodCAsIHNjcm9sbFRvcCAsIGNsaWVudEhlaWdodCAgfSA9IGNvbnNvbGVEaXY7CiAgICAgICAgY29uc3QgZGlmZiA9IHNjcm9sbEhlaWdodCAtIHNjcm9sbFRvcDsKICAgICAgICBjb25zdCBhdXRvc2Nyb2xsID0gZGlmZiAtIDE2ICogNCA8PSBjbGllbnRIZWlnaHQ7CiAgICAgICAgaWYgKGF1dG9zY3JvbGwpIHsKICAgICAgICAgICAgY29uc29sZUxhc3RMaW5lRWxlbWVudC5zY3JvbGxJbnRvVmlldyhmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGlmICghc2hvd2luZ0NsZWFyQnV0dG9uKSB7CiAgICAgICAgICAgIGNvbnNvbGVIZWFkZXJDbGVhckVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgICAgICAgc2hvd2luZ0NsZWFyQnV0dG9uID0gdHJ1ZTsKICAgICAgICB9CiAgICB9OwogICAgdm0xNS5vblJlc2V0T3V0cHV0ID0gKCk9PnsKICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnNvbGVEaXYucXVlcnlTZWxlY3RvckFsbCgnLmxpbmUnKTsKICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKT0+ewogICAgICAgICAgICBpZiAobGluZS5pZCAhPT0gJ2NvbnNvbGUtbGFzdC1saW5lJykgY29uc29sZURpdi5yZW1vdmVDaGlsZChsaW5lKTsKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlSGVhZGVyQ2xlYXJFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgICBzaG93aW5nQ2xlYXJCdXR0b24gPSBmYWxzZTsKICAgIH07CiAgICBjb25zb2xlSGVhZGVyUXBzRWxlbWVudC50ZXh0Q29udGVudCA9IGNvbXB1dGVRcHNUZXh0KDApOwogICAgdm0xNS5vblFwc0NoYW5nZSA9IChxcHMpPT57CiAgICAgICAgY29uc29sZUhlYWRlclFwc0VsZW1lbnQudGV4dENvbnRlbnQgPSBjb21wdXRlUXBzVGV4dChxcHMpOwogICAgfTsKICAgIExpdEVsZW1lbnQucmVuZGVyKGFjdGlvbkljb24oQ0xFQVJfSUNPTiwgewogICAgICAgIHRleHQ6ICdDbGVhcicsCiAgICAgICAgb25jbGljazogKCk9PnZtMTUucmVzZXRPdXRwdXQoKQogICAgfSksIGNvbnNvbGVIZWFkZXJDbGVhckVsZW1lbnQpOwogICAgcmV0dXJuICgpPT57CiAgICAgICAgY29uc29sZURpdi5zdHlsZS5kaXNwbGF5ID0gdm0xNS5zZWxlY3RlZEFuYWx5dGljSWQgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIGNvbnNvbGVIZWFkZXJGaWx0ZXJzRGl2LnN0eWxlLnZpc2liaWxpdHkgPSB2bTE1LnByb2ZpbGVzLmxlbmd0aCA+IDAgPyAndmlzaWJsZScgOiAnaGlkZGVuJzsKICAgICAgICBjb25zb2xlSGVhZGVyVGFpbHNFbGVtZW50LnRleHRDb250ZW50ID0gY29tcHV0ZVRhaWxzVGV4dCh2bTE1LnRhaWxzLnNpemUpOwogICAgICAgIExpdEVsZW1lbnQucmVuZGVyKEZJTFRFUlNfSFRNTCh2bTE1KSwgY29uc29sZUhlYWRlckZpbHRlcnNEaXYpOwogICAgfTsKfQpjb25zdCBGSUxURVJTX0hUTUwgPSAodm0xNik9PnsKICAgIHJldHVybiBodG1sYFNob3dpbmcgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYuZWRpdFNlbGVjdGlvbkZpZWxkcygpOwogICAgfX0+JHt2bTE2LmNvbXB1dGVTZWxlY3Rpb25GaWVsZHNUZXh0KCl9PC9hPgogICAgIGZvciA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0RXZlbnRGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZUV2ZW50RmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPgogICAgIHdpdGggPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYuZWRpdFN0YXR1c0ZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlU3RhdHVzRmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPiwKICAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0SXBBZGRyZXNzRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVJcEFkZHJlc3NGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+LAogICAgIDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LmVkaXRNZXRob2RGaWx0ZXIoKTsKICAgIH19PiR7Y29tcHV0ZU1ldGhvZEZpbHRlclRleHQodm0xNi5maWx0ZXIpfTwvYT4sCiAgICAgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYuZWRpdFNhbXBsaW5nUmF0ZUZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlU2FtcGxpbmdSYXRlRmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPiwgCiAgICAgPGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT57CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZtMTYuZWRpdFNlYXJjaEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlU2VhcmNoRmlsdGVyVGV4dCh2bTE2LmZpbHRlcil9PC9hPiwgCiAgICA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0SGVhZGVyRmlsdGVyKCk7CiAgICB9fT4ke2NvbXB1dGVIZWFkZXJGaWx0ZXJUZXh0KHZtMTYuZmlsdGVyKX08L2E+LAogICAgIGFuZCA8YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PnsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdm0xNi5lZGl0TG9ncHJvcEZpbHRlcigpOwogICAgfX0+JHtjb21wdXRlTG9ncHJvcEZpbHRlclRleHQodm0xNi5maWx0ZXIpfTwvYT4uCiAgICAgJHt2bTE2Lmhhc0FueUZpbHRlcnMoKSA/IGh0bWxgKDxhIGhyZWY9IiMiIEBjbGljaz0keyhlKT0+ewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2bTE2LnJlc2V0RmlsdGVycygpOwogICAgfX0+cmVzZXQ8L2E+KWAgOiAnJ31gOwp9OwpmdW5jdGlvbiBjb21wdXRlRXZlbnRGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgeyBldmVudDEgIH0gPSBmaWx0ZXI7CiAgICByZXR1cm4gZXZlbnQxID09PSAnY3JvbicgPyAnQ1JPTiB0cmlnZ2VyIGV2ZW50cycgOiBldmVudDEgPT09ICdodHRwJyA/ICdIVFRQIHJlcXVlc3QgZXZlbnRzJyA6ICdhbGwgZXZlbnRzJzsKfQpmdW5jdGlvbiBjb21wdXRlU3RhdHVzRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IHsgc3RhdHVzMSAgfSA9IGZpbHRlcjsKICAgIHJldHVybiBzdGF0dXMxID09PSAnZXJyb3InID8gJ2Vycm9yIHN0YXR1cycgOiBzdGF0dXMxID09PSAnc3VjY2VzcycgPyAnc3VjY2VzcyBzdGF0dXMnIDogJ2FueSBzdGF0dXMnOwp9CmZ1bmN0aW9uIGNvbXB1dGVJcEFkZHJlc3NGaWx0ZXJUZXh0KGZpbHRlcikgewogICAgY29uc3QgaXBBZGRyZXNzMSA9IGZpbHRlci5pcEFkZHJlc3MxIHx8IFtdOwogICAgcmV0dXJuIGlwQWRkcmVzczEubGVuZ3RoID09PSAwID8gJ2FueSBJUCBhZGRyZXNzJyA6IGlwQWRkcmVzczEubGVuZ3RoID09PSAxID8gYElQIGFkZHJlc3Mgb2YgJHtpcEFkZHJlc3MxWzBdfWAgOiBgSVAgYWRkcmVzcyBpbiBbJHtpcEFkZHJlc3MxLmpvaW4oJywgJyl9XWA7Cn0KZnVuY3Rpb24gY29tcHV0ZU1ldGhvZEZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCBtZXRob2QxID0gZmlsdGVyLm1ldGhvZDEgfHwgW107CiAgICByZXR1cm4gbWV0aG9kMS5sZW5ndGggPT09IDAgPyAnYW55IG1ldGhvZCcgOiBtZXRob2QxLmxlbmd0aCA9PT0gMSA/IGBtZXRob2Qgb2YgJHttZXRob2QxWzBdfWAgOiBgbWV0aG9kIGluIFske21ldGhvZDEuam9pbignLCAnKX1dYDsKfQpmdW5jdGlvbiBjb21wdXRlU2FtcGxpbmdSYXRlRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IHNhbXBsaW5nUmF0ZTEgPSB0eXBlb2YgZmlsdGVyLnNhbXBsaW5nUmF0ZTEgPT09ICdudW1iZXInID8gZmlsdGVyLnNhbXBsaW5nUmF0ZTEgOiAxOwogICAgcmV0dXJuIHNhbXBsaW5nUmF0ZTEgPj0gMSA/ICdubyBzYW1wbGluZycgOiBgJHsoTWF0aC5tYXgoMCwgc2FtcGxpbmdSYXRlMSkgKiAxMDApLnRvRml4ZWQoMil9JSBzYW1wbGluZyByYXRlYDsKfQpmdW5jdGlvbiBjb21wdXRlU2VhcmNoRmlsdGVyVGV4dChmaWx0ZXIpIHsKICAgIGNvbnN0IHsgc2VhcmNoMSAgfSA9IGZpbHRlcjsKICAgIHJldHVybiB0eXBlb2Ygc2VhcmNoMSA9PT0gJ3N0cmluZycgJiYgc2VhcmNoMS5sZW5ndGggPiAwID8gYGNvbnNvbGUgbG9ncyBjb250YWluaW5nICIke3NlYXJjaDF9ImAgOiAnbm8gc2VhcmNoIGZpbHRlcic7Cn0KZnVuY3Rpb24gY29tcHV0ZUhlYWRlckZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCBoZWFkZXIxID0gZmlsdGVyLmhlYWRlcjEgfHwgW107CiAgICByZXR1cm4gaGVhZGVyMS5sZW5ndGggPT09IDAgPyAnbm8gaGVhZGVyIGZpbHRlcicgOiBoZWFkZXIxLmxlbmd0aCA9PT0gMSA/IGBoZWFkZXIgZmlsdGVyIG9mICR7aGVhZGVyMVswXX1gIDogYGhlYWRlciBmaWx0ZXJzIG9mIFske2hlYWRlcjEuam9pbignLCAnKX1dYDsKfQpmdW5jdGlvbiBjb21wdXRlTG9ncHJvcEZpbHRlclRleHQoZmlsdGVyKSB7CiAgICBjb25zdCBsb2dwcm9wMSA9IGZpbHRlci5sb2dwcm9wMSB8fCBbXTsKICAgIHJldHVybiBsb2dwcm9wMS5sZW5ndGggPT09IDAgPyAnbm8gbG9ncHJvcCBmaWx0ZXInIDogbG9ncHJvcDEubGVuZ3RoID09PSAxID8gYGxvZ3Byb3AgZmlsdGVyIG9mICR7bG9ncHJvcDFbMF19YCA6IGBsb2dwcm9wIGZpbHRlcnMgb2YgWyR7bG9ncHJvcDEuam9pbignLCAnKX1dYDsKfQpmdW5jdGlvbiBjb21wdXRlVGFpbHNUZXh0KHRhaWxDb3VudCkgewogICAgcmV0dXJuIHRhaWxDb3VudCA9PT0gMCA/ICdubyB0YWlscycgOiB0YWlsQ291bnQgPT09IDEgPyAnMSB0YWlsJyA6IGAke3RhaWxDb3VudH0gdGFpbHNgOwp9CmZ1bmN0aW9uIGNvbXB1dGVRcHNUZXh0KHFwcykgewogICAgcmV0dXJuIGAke3Fwcy50b0ZpeGVkKDIpfSBxcHNgOwp9CmZ1bmN0aW9uIHJlbmRlclRleHRJbnRvU3Bhbih0ZXh0LCBzcGFuKSB7CiAgICBjb25zdCBwYXR0ZXJuID0gLyhodHRwczpcL1wvW15ccyldK3xcZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9fFtcZDAtZl0rKDooW1xkMC1mXXswLDR9KT8pezUsN30pL2c7CiAgICBsZXQgbTsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlKG51bGwgIT09IChtID0gcGF0dGVybi5leGVjKHRleHQpKSl7CiAgICAgICAgaWYgKG0uaW5kZXggPiBpKSB7CiAgICAgICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zdWJzdHJpbmcoaSwgbS5pbmRleCkpKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdXJsT3JJcCA9IG1bMF07CiAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBhLmhyZWYgPSB1cmxPcklwLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykgPyB1cmxPcklwIDogYGh0dHBzOi8vaXBpbmZvLmlvLyR7dXJsT3JJcH1gOwogICAgICAgIGEudGFyZ2V0ID0gJ19ibGFuayc7CiAgICAgICAgYS5yZWwgPSAnbm9yZWZlcnJlciBub29wZW5lciBub2ZvbGxvdyc7CiAgICAgICAgYS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh1cmxPcklwKSk7CiAgICAgICAgc3Bhbi5hcHBlbmRDaGlsZChhKTsKICAgICAgICBpID0gbS5pbmRleCArIHVybE9ySXAubGVuZ3RoOwogICAgfQogICAgaWYgKGkgPCB0ZXh0Lmxlbmd0aCkgewogICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dC5zdWJzdHJpbmcoaSkpKTsKICAgIH0KfQpjb25zdCBBTkFMWVRJQ1NfSFRNTDEgPSBodG1sYAo8ZGl2IGlkPSJhbmFseXRpY3MiPgogICAgPGRpdiBpZD0iYW5hbHl0aWNzLWhlYWRlciI+CiAgICAgICAgPGRpdiBpZD0iYW5hbHl0aWNzLWhlYWRpbmciIGNsYXNzPSJoNiBoaWdoLWVtcGhhc2lzLXRleHQiPjwvZGl2PgogICAgICAgIDxkaXYgaWQ9ImFuYWx5dGljcy1zdWJoZWFkaW5nIiBjbGFzcz0ibWVkaXVtLWVtcGhhc2lzLXRleHQiPjwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtcXVlcnlpbmciPjxwcm9ncmVzcyBpZD0iYW5hbHl0aWNzLXByb2dyZXNzIiBjbGFzcz0icHVyZS1tYXRlcmlhbC1wcm9ncmVzcy1jaXJjdWxhciI+PC9wcm9ncmVzcz48ZGl2IGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+RmV0Y2hpbmcgYW5hbHl0aWNzLi4uPC9kaXY+PC9kaXY+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtZXJyb3IiIGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtdGFibGUiIGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtbmFtZXNwYWNlcy10YWJsZSIgIGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+PC9kaXY+CiAgICA8ZGl2IGlkPSJhbmFseXRpY3MtZm9vdG5vdGUiIGNsYXNzPSJtZWRpdW0tZW1waGFzaXMtdGV4dCI+PHN1cD4qPC9zdXA+IEVzdGltYXRlZCBiYXNlZCBvbiByZWNlbnQgdXNhZ2U8L2Rpdj4KPC9kaXY+CmA7CmNvbnN0IEFOQUxZVElDU19DU1MgPSBjc3NgCgojYW5hbHl0aWNzIHsKICAgIGNvbG9yOiB2YXIoLS1oaWdoLWVtcGhhc2lzLXRleHQtY29sb3IpOwogICAgaGVpZ2h0OiAxMDB2aDsKICAgIHdpZHRoOiAxMDAlOwogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7CiAgICBvdmVyZmxvdy15OiBzY3JvbGw7CiAgICBvdmVyZmxvdy14OiBoaWRkZW47CiAgICBmbGV4LWdyb3c6IDE7CiAgICBkaXNwbGF5OiBub25lOwp9CgojYW5hbHl0aWNzOjotd2Via2l0LXNjcm9sbGJhciB7CiAgICB3aWR0aDogMXJlbTsKICAgIGhlaWdodDogM3JlbTsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpOwp9CgojYW5hbHl0aWNzOjotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCiNhbmFseXRpY3MtaGVhZGVyIHsKICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICB0b3A6IDA7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIHBhZGRpbmc6IDFyZW0gMDsKICAgIGhlaWdodDogM3JlbTsKfQoKI2FuYWx5dGljcy1zdWJoZWFkaW5nIHsKICAgIHBhZGRpbmc6IDAuNXJlbSAwOwp9CgojYW5hbHl0aWNzLXByb2dyZXNzIHsKICAgIGZvbnQtc2l6ZTogMC41cmVtOyAvKiBkZWZhdWx0IDNlbSA9PiAxLjVyZW0gKi8KfQoKI2FuYWx5dGljcy1xdWVyeWluZyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGdhcDogMC41cmVtOwp9CgojYW5hbHl0aWNzIHRhYmxlIHsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgYm9yZGVyLXNwYWNpbmc6IDAuMzc1cmVtOwogICAgZm9udC1zaXplOiAwLjc1cmVtOwogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQoKI2FuYWx5dGljcyB0aCB7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCiNhbmFseXRpY3MgLnNwYWNlciB7CiAgICB3aWR0aDogMC43NXJlbTsKfQoKI2FuYWx5dGljcy10YWJsZSAuZXN0aW1hdGUgdGQgewogICAgcGFkZGluZy10b3A6IDFyZW07Cn0KCiNhbmFseXRpY3MgLm1vbm8gewogICAgZm9udC1mYW1pbHk6IHZhcigtLW1vbm9zcGFjZS1mb250LWZhbWlseSk7Cn0KCiNhbmFseXRpY3MtbmFtZXNwYWNlcy10YWJsZSB7CiAgICBtYXJnaW4tdG9wOiAycmVtOwp9CgojYW5hbHl0aWNzLW5hbWVzcGFjZXMtdGFibGUgYS51bnNlbGVjdGVkIHsKICAgIGNvbG9yOiB2YXIoLS1tZWRpdW0tZW1waGFzaXMtdGV4dC1jb2xvcik7Cn0KCkBtZWRpYSAoaG92ZXI6IGhvdmVyKSB7CiAgICAjYW5hbHl0aWNzLW5hbWVzcGFjZXMtdGFibGUgYS51bnNlbGVjdGVkOmhvdmVyIHsKICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7CiAgICB9Cn0KCiNhbmFseXRpY3MgLmxlZnQtYWxpZ25lZCB7CiAgICB0ZXh0LWFsaWduOiBsZWZ0Owp9CgojYW5hbHl0aWNzLWZvb3Rub3RlIHsKICAgIG1hcmdpbi10b3A6IDFyZW07CiAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICBkaXNwbGF5OiBub25lOwp9CgpgOwpmdW5jdGlvbiBpbml0QW5hbHl0aWNzKGRvY3VtZW50LCB2bTE3KSB7CiAgICBjb25zdCBhbmFseXRpY3NEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzJyk7CiAgICBjb25zdCBhbmFseXRpY3NIZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5dGljcy1oZWFkaW5nJyk7CiAgICBjb25zdCBhbmFseXRpY3NTdWJoZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5dGljcy1zdWJoZWFkaW5nJyk7CiAgICBjb25zdCBhbmFseXRpY3NRdWVyeWluZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLXF1ZXJ5aW5nJyk7CiAgICBjb25zdCBhbmFseXRpY3NFcnJvckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLWVycm9yJyk7CiAgICBjb25zdCBhbmFseXRpY3NUYWJsZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLXRhYmxlJyk7CiAgICBjb25zdCBhbmFseXRpY3NOYW1lc3BhY2VzVGFibGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5dGljcy1uYW1lc3BhY2VzLXRhYmxlJyk7CiAgICBjb25zdCBhbmFseXRpY3NGb290bm90ZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLWZvb3Rub3RlJyk7CiAgICByZXR1cm4gKCk9PnsKICAgICAgICBhbmFseXRpY3NEaXYuc3R5bGUuZGlzcGxheSA9IHZtMTcuc2VsZWN0ZWRBbmFseXRpY0lkID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBpZiAoIXZtMTcuc2VsZWN0ZWRBbmFseXRpY0lkKSByZXR1cm47CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRBbmFseXRpYyA9IHZtMTcuYW5hbHl0aWNzLmZpbmQoKHYpPT52LmlkID09PSB2bTE3LnNlbGVjdGVkQW5hbHl0aWNJZAogICAgICAgICk7CiAgICAgICAgaWYgKCFzZWxlY3RlZEFuYWx5dGljKSByZXR1cm47CiAgICAgICAgYW5hbHl0aWNzSGVhZGluZy50ZXh0Q29udGVudCA9IHNlbGVjdGVkQW5hbHl0aWMudGV4dDsKICAgICAgICBhbmFseXRpY3NTdWJoZWFkaW5nLnRleHRDb250ZW50ID0gc2VsZWN0ZWRBbmFseXRpYy5kZXNjcmlwdGlvbiB8fCAnJzsKICAgICAgICBjb25zdCB7IGR1cmFibGVPYmplY3RzQ29zdHMgLCBxdWVyeWluZyAsIGVycm9yICB9ID0gdm0xNy5hbmFseXRpY3NTdGF0ZTsKICAgICAgICBhbmFseXRpY3NRdWVyeWluZ0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHF1ZXJ5aW5nID8gJ2ZsZXgnIDogJ25vbmUnOwogICAgICAgIGFuYWx5dGljc0Vycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yIHx8ICcnOwogICAgICAgIGFuYWx5dGljc0Zvb3Rub3RlRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gZHVyYWJsZU9iamVjdHNDb3N0cyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgaWYgKGR1cmFibGVPYmplY3RzQ29zdHMpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyQ29zdHMgPSAobmFtZXNwYWNlSWQpPT57CiAgICAgICAgICAgICAgICBjb25zdCB0YWJsZSA9IGR1cmFibGVPYmplY3RzQ29zdHMubmFtZXNwYWNlVGFibGVzW25hbWVzcGFjZUlkIHx8ICcnXSB8fCBkdXJhYmxlT2JqZWN0c0Nvc3RzLmFjY291bnRUYWJsZTsKICAgICAgICAgICAgICAgIExpdEVsZW1lbnQucmVuZGVyKENPU1RTX0hUTUwodGFibGUsIG5hbWVzcGFjZUlkKSwgYW5hbHl0aWNzVGFibGVFbGVtZW50KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmVuZGVyQ29zdHModW5kZWZpbmVkKTsKICAgICAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIoTkFNRVNQQUNFU19IVE1MKGR1cmFibGVPYmplY3RzQ29zdHMsIHJlbmRlckNvc3RzKSwgYW5hbHl0aWNzTmFtZXNwYWNlc1RhYmxlRWxlbWVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTGl0RWxlbWVudC5yZW5kZXIodW5kZWZpbmVkLCBhbmFseXRpY3NUYWJsZUVsZW1lbnQpOwogICAgICAgICAgICBMaXRFbGVtZW50LnJlbmRlcih1bmRlZmluZWQsIGFuYWx5dGljc05hbWVzcGFjZXNUYWJsZUVsZW1lbnQpOwogICAgICAgIH0KICAgIH07Cn0KY29uc3QgRklYRURfMSA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZW4tVVMnLCB7CiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEsCiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDEKfSk7CmNvbnN0IEZJWEVEXzIgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoJ2VuLVVTJywgewogICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyLAogICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyCn0pOwpmdW5jdGlvbiBmb3JtYXQxKHZhbCkgewogICAgaWYgKHZhbCA8IDEwMDApIHJldHVybiB2YWwudG9TdHJpbmcoKTsKICAgIHJldHVybiBgJHtGSVhFRF8xLmZvcm1hdCh2YWwgLyAxMDAwKX1rYDsKfQpmdW5jdGlvbiBmb3JtYXQyKHZhbCkgewogICAgaWYgKHZhbCA8IDEwMDApIHJldHVybiB2YWwudG9GaXhlZCgyKTsKICAgIHJldHVybiBgJHtGSVhFRF8yLmZvcm1hdCh2YWwgLyAxMDAwKX1rYDsKfQpmdW5jdGlvbiBmb3JtYXRHYih2YWwpIHsKICAgIGlmICh2YWwgPCAxKSByZXR1cm4gYCR7Zm9ybWF0Mih2YWwgKiAxMDI0KX1tYmA7CiAgICByZXR1cm4gYCR7Zm9ybWF0Mih2YWwpfWdiYDsKfQpmdW5jdGlvbiBjbGlja05hbWVzcGFjZShlLCByZW5kZXJDb3N0cykgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgdGV4dCA9IGUudGFyZ2V0LnRleHRDb250ZW50IHx8ICcnOwogICAgY29uc29sZS5sb2coJ2NsaWNrTmFtZXNwYWNlJywgdGV4dCk7CiAgICByZW5kZXJDb3N0cyh0ZXh0LnN0YXJ0c1dpdGgoJ0FsbCcpID8gdW5kZWZpbmVkIDogdGV4dCk7CiAgICBjb25zdCBhbmNob3JzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2FuYWx5dGljcy1uYW1lc3BhY2VzLXRhYmxlIGEnKTsKICAgIGFuY2hvcnMuZm9yRWFjaCgoYSk9PnsKICAgICAgICBhLmNsYXNzTmFtZSA9IGEgPT09IGUudGFyZ2V0ID8gJycgOiAndW5zZWxlY3RlZCc7CiAgICB9KTsKfQpjb25zdCBOQU1FU1BBQ0VTX0hUTUwgPSAodGFibGUsIHJlbmRlckNvc3RzKT0+aHRtbGAKICAgIDx0YWJsZT4KICAgICAgICA8dHI+CiAgICAgICAgICAgIDx0aD5OYW1lc3BhY2UgSUQ8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGg+U2NyaXB0PC90aD4KICAgICAgICAgICAgPHRoPkNsYXNzPC90aD48dGggY2xhc3M9InNwYWNlciI+PC90aD4KICAgICAgICAgICAgPHRoPlRvdGFsPC90aD4KICAgICAgICA8L3RyPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZWZ0LWFsaWduZWQgbW9ubyI+PGEgaHJlZj0iIyIgQGNsaWNrPSR7KGUpPT5jbGlja05hbWVzcGFjZShlLCByZW5kZXJDb3N0cykKICAgIH0+QWxsIGR1cmFibGUgb2JqZWN0czwvYT48L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHsodGFibGUuYWNjb3VudFRhYmxlLmVzdGltYXRlZDMwRGF5Um93Py50b3RhbENvc3QgfHwgMCkudG9GaXhlZCgyKX08L3RkPgogICAgICAgIDwvdHI+CiAgICAke1sKICAgICAgICAuLi5PYmplY3QuZW50cmllcyh0YWJsZS5uYW1lc3BhY2VUYWJsZXMpCiAgICBdLnNvcnQoKGEsIGIpPT4oYlsxXS5lc3RpbWF0ZWQzMERheVJvdz8udG90YWxDb3N0IHx8IDApIC0gKGFbMV0uZXN0aW1hdGVkMzBEYXlSb3c/LnRvdGFsQ29zdCB8fCAwKQogICAgKS5tYXAoKHYpPT57CiAgICAgICAgY29uc3QgW25hbWVzcGFjZUlkLCB0XSA9IHY7CiAgICAgICAgcmV0dXJuIGh0bWxgPHRyPgogICAgICAgICAgICA8dGQgY2xhc3M9ImxlZnQtYWxpZ25lZCBtb25vIj48YSBocmVmPSIjIiBAY2xpY2s9JHsoZSk9PmNsaWNrTmFtZXNwYWNlKGUsIHJlbmRlckNvc3RzKQogICAgICAgIH0gY2xhc3M9InVuc2VsZWN0ZWQiPiR7bmFtZXNwYWNlSWR9PC9hPjwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGVmdC1hbGlnbmVkIj4ke3QubmFtZXNwYWNlPy5zY3JpcHQgfHwgJyd9PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZWZ0LWFsaWduZWQiPiR7dC5uYW1lc3BhY2U/LmNsYXNzIHx8ICcnfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHsodC5lc3RpbWF0ZWQzMERheVJvdz8udG90YWxDb3N0IHx8IDApLnRvRml4ZWQoMil9PC90ZD4KICAgICAgICAgICAgPC90cj5gOwogICAgfSl9CiAgICA8L3RhYmxlPgpgCjsKY29uc3QgQ09TVFNfSFRNTCA9ICh0YWJsZSwgbmFtZXNwYWNlSWQpPT5odG1sYAogICAgPHRhYmxlPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPlVUQyBEYXk8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+UmVxdWVzdHM8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iNCI+V2Vic29ja2V0czwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5TdWJyZXF1ZXN0czwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5EdXJhdGlvbjwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5SZWFkczwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5Xcml0ZXM8L3RoPjx0aCBjbGFzcz0ic3BhY2VyIj48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+RGVsZXRlczwvdGg+PHRoIGNsYXNzPSJzcGFjZXIiPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj5TdG9yYWdlPC90aD48dGggY2xhc3M9InNwYWNlciI+PC90aD4KICAgICAgICAgICAgPHRoPlRvdGFsPC90aD4KICAgICAgICA8L3RyPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPjwvdGg+PHRoPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGg+TWF4PC90aD4KICAgICAgICAgICAgPHRoPkluPC90aD4KICAgICAgICAgICAgPHRoPk91dDwvdGg+CiAgICAgICAgICAgIDx0aD48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoPkdCLXNlYzwvdGg+CiAgICAgICAgICAgIDx0aD48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoIGNvbHNwYW49IjIiPjwvdGg+PHRoPjwvdGg+CiAgICAgICAgICAgIDx0aCBjb2xzcGFuPSIyIj48L3RoPjx0aD48L3RoPgogICAgICAgICAgICA8dGggY29sc3Bhbj0iMiI+PC90aD48dGg+PC90aD4KICAgICAgICAgICAgPHRoPjwvdGg+CiAgICAgICAgPC90cj4KICAgICAgICAke3RhYmxlLnJvd3MubWFwKCh2KT0+aHRtbGA8dHI+CiAgICAgICAgICAgIDx0ZD4ke3YuZGF0ZX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYuc3VtUmVxdWVzdHMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHYucmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYubWF4QWN0aXZlV2Vic29ja2V0Q29ubmVjdGlvbnMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1JbmJvdW5kV2Vic29ja2V0TXNnQ291bnQpfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1PdXRib3VuZFdlYnNvY2tldE1zZ0NvdW50KX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LndlYnNvY2tldHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQxKHYuc3VtU3VicmVxdWVzdHMpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHYuc3VicmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHtmb3JtYXQyKHYuYWN0aXZlR2JTZWNvbmRzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LmFjdGl2ZUNvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1TdG9yYWdlUmVhZFVuaXRzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LnJlYWRVbml0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iaGlnaC1lbXBoYXNpcy10ZXh0Ij4ke2Zvcm1hdDEodi5zdW1TdG9yYWdlV3JpdGVVbml0cyl9PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodi53cml0ZVVuaXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJoaWdoLWVtcGhhc2lzLXRleHQiPiR7Zm9ybWF0MSh2LnN1bVN0b3JhZ2VEZWxldGVzKX08L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LmRlbGV0ZXNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9ImhpZ2gtZW1waGFzaXMtdGV4dCI+JHt2LnN0b3JhZ2VHYiA9PT0gdW5kZWZpbmVkID8gJz8nIDogZm9ybWF0R2Iodi5zdG9yYWdlR2IpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3Yuc3RvcmFnZUNvc3QgPT09IHVuZGVmaW5lZCA/ICcnIDogYCQke2Zvcm1hdDIodi5zdG9yYWdlQ29zdCl9YH08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih2LnRvdGFsQ29zdCl9PC90ZD4KICAgICAgICA8L3RyPmAKICAgICl9CgogICAgICAgICR7dGFibGUuZXN0aW1hdGVkMzBEYXlSb3cgPyBodG1sYDx0ciBjbGFzcz0iZXN0aW1hdGUiPgogICAgICAgICAgICA8dGQ+MzAtZGF5IGJpbGw8c3VwPio8L3N1cD48L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3cucmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy53ZWJzb2NrZXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LnN1YnJlcXVlc3RzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LmFjdGl2ZUNvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy5yZWFkVW5pdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3cud3JpdGVVbml0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvdy5kZWxldGVzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LnN0b3JhZ2VDb3N0IHx8IDApfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93LnRvdGFsQ29zdCl9PC90ZD4KICAgICAgICA8L3RyPmAgOiAnJ30KICAgICAgICAke3RhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlID8gaHRtbGA8dHI+CiAgICAgICAgICAgIDx0ZD7iiJIgZnJlZSB1c2FnZTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZS5yZXF1ZXN0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLndlYnNvY2tldHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUuc3VicmVxdWVzdHNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUuYWN0aXZlQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLnJlYWRVbml0c0Nvc3QpfTwvdGQ+PHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+JCR7Zm9ybWF0Mih0YWJsZS5lc3RpbWF0ZWQzMERheVJvd01pbnVzRnJlZS53cml0ZVVuaXRzQ29zdCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPjwvdGQ+CiAgICAgICAgICAgIDx0ZD4kJHtmb3JtYXQyKHRhYmxlLmVzdGltYXRlZDMwRGF5Um93TWludXNGcmVlLmRlbGV0ZXNDb3N0KX08L3RkPjx0ZD48L3RkPgogICAgICAgICAgICA8dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUuc3RvcmFnZUNvc3QgfHwgMCl9PC90ZD48dGQ+PC90ZD4KICAgICAgICAgICAgPHRkPiQke2Zvcm1hdDIodGFibGUuZXN0aW1hdGVkMzBEYXlSb3dNaW51c0ZyZWUudG90YWxDb3N0KX08L3RkPgogICAgICAgIDwvdHI+YCA6ICcnfQogICAgPC90YWJsZT4KYAo7CmNvbnN0IGFwcE1vZHVsZVNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAtbW9kdWxlLXNjcmlwdCcpOwpmdW5jdGlvbiBzZXRBcHBTdGF0ZShhcHBTdGF0ZSkgewogICAgYXBwTW9kdWxlU2NyaXB0LmRhdGFzZXQuc3RhdGUgPSBhcHBTdGF0ZTsKfQpzZXRBcHBTdGF0ZSgnc3RhcnRpbmcnKTsKY29uc3QgYXBwQ3NzID0gY3NzYAoKbWFpbiB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZ2FwOiAwLjVyZW07Cn0KCjpyb290IHsKICAgIC0tcHVyZS1tYXRlcmlhbC1wcmltYXJ5LXJnYjogcmdiKDE4NywgMTM0LCAyNTIpOwp9CgouaGlkZGVuLXZlcnRpY2FsLXNjcm9sbCB7CiAgICBzY3JvbGxiYXItd2lkdGg6IG5vbmU7IC1tcy1vdmVyZmxvdy1zdHlsZTogbm9uZTsKICAgIG92ZXJmbG93LXk6IHNjcm9sbDsKfQoKLmhpZGRlbi12ZXJ0aWNhbC1zY3JvbGw6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIGZvciBDaHJvbWUsIFNhZmFyaSwgYW5kIE9wZXJhICovCn0KCmA7CmNvbnN0IGFwcEh0bWwgPSBodG1sYAo8bWFpbj4KJHtTSURFQkFSX0hUTUx9CiR7Q09OU09MRV9IVE1MfQoke0FOQUxZVElDU19IVE1MMX0KJHtNT0RBTF9IVE1MfQo8L21haW4+YDsKZnVuY3Rpb24gYXBwZW5kU3R5bGVzaGVldHMoY3NzVGV4dHMpIHsKICAgIGNvbnN0IHN0eWxlU2hlZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgc3R5bGVTaGVldC50eXBlID0gJ3RleHQvY3NzJzsKICAgIHN0eWxlU2hlZXQudGV4dENvbnRlbnQgPSBjc3NUZXh0cy5qb2luKCdcblxuJyk7CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlU2hlZXQpOwp9CmFwcGVuZFN0eWxlc2hlZXRzKFsKICAgIE1BVEVSSUFMX0NTUy5jc3NUZXh0LAogICAgYXBwQ3NzLmNzc1RleHQsCiAgICBIRUFERVJfQ1NTLmNzc1RleHQsCiAgICBTSURFQkFSX0NTUy5jc3NUZXh0LAogICAgQ09OU09MRV9DU1MuY3NzVGV4dCwKICAgIEFOQUxZVElDU19DU1MuY3NzVGV4dCwKICAgIE1PREFMX0NTUy5jc3NUZXh0LAogICAgV0VMQ09NRV9QQU5FTF9DU1MuY3NzVGV4dCwKICAgIFBST0ZJTEVfRURJVE9SX0NTUy5jc3NUZXh0LAogICAgRklMVEVSX0VESVRPUl9DU1MuY3NzVGV4dCwKICAgIENJUkNVTEFSX1BST0dSRVNTX0NTUy5jc3NUZXh0LCAKXSk7CkxpdEVsZW1lbnQucmVuZGVyKGFwcEh0bWwsIGRvY3VtZW50LmJvZHkpOwpmdW5jdGlvbiBwYXJzZVN0YXRpY0RhdGEoKSB7CiAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdGljLWRhdGEtc2NyaXB0Jyk7CiAgICBjb25zdCBkYXRhMSA9IEpTT04ucGFyc2Uoc2NyaXB0LnRleHQpOwogICAgY29uc3QgdmVyc2lvbiA9IHR5cGVvZiBkYXRhMS52ZXJzaW9uID09PSAnc3RyaW5nJyA/IGRhdGExLnZlcnNpb24gOiB1bmRlZmluZWQ7CiAgICBjb25zdCBmbGFncyA9IHR5cGVvZiBkYXRhMS5mbGFncyA9PT0gJ3N0cmluZycgPyBkYXRhMS5mbGFncyA6IHVuZGVmaW5lZDsKICAgIHJldHVybiB7CiAgICAgICAgdmVyc2lvbiwKICAgICAgICBmbGFncwogICAgfTsKfQpjb25zdCBkYXRhID0gcGFyc2VTdGF0aWNEYXRhKCk7CmNvbnN0IHZtID0gbmV3IFdlYnRhaWxBcHBWTSgpOwpjb25zdCB1cGRhdGVTaWRlYmFyID0gaW5pdFNpZGViYXIoZG9jdW1lbnQsIHZtLCBkYXRhKTsKY29uc3QgdXBkYXRlQ29uc29sZSA9IGluaXRDb25zb2xlKGRvY3VtZW50LCB2bSk7CmNvbnN0IHVwZGF0ZUFuYWx5dGljcyA9IGluaXRBbmFseXRpY3MoZG9jdW1lbnQsIHZtKTsKY29uc3QgdXBkYXRlTW9kYWwgPSBpbml0TW9kYWwoZG9jdW1lbnQsIHZtKTsKdm0ub25DaGFuZ2UgPSAoKT0+ewogICAgdXBkYXRlU2lkZWJhcigpOwogICAgdXBkYXRlQ29uc29sZSgpOwogICAgdXBkYXRlQW5hbHl0aWNzKCk7CiAgICB1cGRhdGVNb2RhbCgpOwp9OwpDbG91ZGZsYXJlQXBpLlVSTF9UUkFOU0ZPUk1FUiA9IENmR3FsQ2xpZW50LlVSTF9UUkFOU0ZPUk1FUiA9ICh2KT0+YC9mZXRjaC8ke3Yuc3Vic3RyaW5nKCdodHRwczovLycubGVuZ3RoKX1gCjsKdm0uc3RhcnQoKTsKc2V0QXBwU3RhdGUoJ3N0YXJ0ZWQnKTsKCg==';